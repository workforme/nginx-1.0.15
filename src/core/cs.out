cscope 15 $HOME/nginx-1.0.15/src/core -q 0000003240 0000470994
	@nginx.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

10 
	~<ngöx.h
>

13 
ngx_öt_t
 
ngx_add_öhîôed_sockës
(
ngx_cy˛e_t
 *
cy˛e
);

14 
ngx_öt_t
 
ngx_gë_›ti⁄s
(
¨gc
, *c⁄° *
¨gv
);

15 
ngx_öt_t
 
ngx_¥o˚ss_›ti⁄s
(
ngx_cy˛e_t
 *
cy˛e
);

16 
ngx_öt_t
 
ngx_ßve_¨gv
(
ngx_cy˛e_t
 *
cy˛e
, 
¨gc
, *c⁄° *
¨gv
);

17 *
ngx_c‹e_moduÀ_¸óã_c⁄f
(
ngx_cy˛e_t
 *
cy˛e
);

18 *
ngx_c‹e_moduÀ_öô_c⁄f
(
ngx_cy˛e_t
 *
cy˛e
, *
c⁄f
);

19 *
ngx_£t_u£r
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

20 *
ngx_£t_ív
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

21 *
ngx_£t_¥i‹ôy
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

22 *
ngx_£t_˝u_afföôy
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
,

23 *
c⁄f
);

26 
ngx_c⁄f_íum_t
 
	gngx_debug_poöts
[] = {

27 { 
ngx_°rög
("°›"), 
NGX_DEBUG_POINTS_STOP
 },

28 { 
ngx_°rög
("ab‹t"), 
NGX_DEBUG_POINTS_ABORT
 },

29 { 
ngx_nuŒ_°rög
, 0 }

33 
ngx_comm™d_t
 
	gngx_c‹e_comm™ds
[] = {

35 { 
ngx_°rög
("daemon"),

36 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_FLAG
,

37 
ngx_c⁄f_£t_Êag_¶Ÿ
,

39 
off£tof
(
ngx_c‹e_c⁄f_t
, 
d´m⁄
),

40 
NULL
 },

42 { 
ngx_°rög
("master_process"),

43 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_FLAG
,

44 
ngx_c⁄f_£t_Êag_¶Ÿ
,

46 
off£tof
(
ngx_c‹e_c⁄f_t
, 
ma°î
),

47 
NULL
 },

49 { 
ngx_°rög
("timer_resolution"),

50 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_TAKE1
,

51 
ngx_c⁄f_£t_m£c_¶Ÿ
,

53 
off£tof
(
ngx_c‹e_c⁄f_t
, 
timî_ªsﬁuti⁄
),

54 
NULL
 },

56 { 
ngx_°rög
("pid"),

57 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_TAKE1
,

58 
ngx_c⁄f_£t_°r_¶Ÿ
,

60 
off£tof
(
ngx_c‹e_c⁄f_t
, 
pid
),

61 
NULL
 },

63 { 
ngx_°rög
("lock_file"),

64 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_TAKE1
,

65 
ngx_c⁄f_£t_°r_¶Ÿ
,

67 
off£tof
(
ngx_c‹e_c⁄f_t
, 
lock_fûe
),

68 
NULL
 },

70 { 
ngx_°rög
("worker_processes"),

71 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_TAKE1
,

72 
ngx_c⁄f_£t_num_¶Ÿ
,

74 
off£tof
(
ngx_c‹e_c⁄f_t
, 
w‹kî_¥o˚s£s
),

75 
NULL
 },

77 { 
ngx_°rög
("debug_points"),

78 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_TAKE1
,

79 
ngx_c⁄f_£t_íum_¶Ÿ
,

81 
off£tof
(
ngx_c‹e_c⁄f_t
, 
debug_poöts
),

82 &
ngx_debug_poöts
 },

84 { 
ngx_°rög
("user"),

85 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_TAKE12
,

86 
ngx_£t_u£r
,

89 
NULL
 },

91 { 
ngx_°rög
("worker_priority"),

92 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_TAKE1
,

93 
ngx_£t_¥i‹ôy
,

96 
NULL
 },

98 { 
ngx_°rög
("worker_cpu_affinity"),

99 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_1MORE
,

100 
ngx_£t_˝u_afföôy
,

103 
NULL
 },

105 { 
ngx_°rög
("worker_rlimit_nofile"),

106 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_TAKE1
,

107 
ngx_c⁄f_£t_num_¶Ÿ
,

109 
off£tof
(
ngx_c‹e_c⁄f_t
, 
æimô_nofûe
),

110 
NULL
 },

112 { 
ngx_°rög
("worker_rlimit_core"),

113 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_TAKE1
,

114 
ngx_c⁄f_£t_off_¶Ÿ
,

116 
off£tof
(
ngx_c‹e_c⁄f_t
, 
æimô_c‹e
),

117 
NULL
 },

119 { 
ngx_°rög
("worker_rlimit_sigpending"),

120 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_TAKE1
,

121 
ngx_c⁄f_£t_num_¶Ÿ
,

123 
off£tof
(
ngx_c‹e_c⁄f_t
, 
æimô_sig≥ndög
),

124 
NULL
 },

126 { 
ngx_°rög
("working_directory"),

127 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_TAKE1
,

128 
ngx_c⁄f_£t_°r_¶Ÿ
,

130 
off£tof
(
ngx_c‹e_c⁄f_t
, 
w‹kög_dúe˘‹y
),

131 
NULL
 },

133 { 
ngx_°rög
("env"),

134 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_TAKE1
,

135 
ngx_£t_ív
,

138 
NULL
 },

140 #i‡(
NGX_THREADS
)

142 { 
ngx_°rög
("worker_threads"),

143 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_TAKE1
,

144 
ngx_c⁄f_£t_num_¶Ÿ
,

146 
off£tof
(
ngx_c‹e_c⁄f_t
, 
w‹kî_thªads
),

147 
NULL
 },

149 { 
ngx_°rög
("thread_stack_size"),

150 
NGX_MAIN_CONF
|
NGX_DIRECT_CONF
|
NGX_CONF_TAKE1
,

151 
ngx_c⁄f_£t_size_¶Ÿ
,

153 
off£tof
(
ngx_c‹e_c⁄f_t
, 
thªad_°ack_size
),

154 
NULL
 },

158 
ngx_nuŒ_comm™d


162 
ngx_c‹e_moduÀ_t
 
	gngx_c‹e_moduÀ_˘x
 = {

163 
ngx_°rög
("core"),

164 
ngx_c‹e_moduÀ_¸óã_c⁄f
,

165 
ngx_c‹e_moduÀ_öô_c⁄f


169 
ngx_moduÀ_t
 
	gngx_c‹e_moduÀ
 = {

170 
NGX_MODULE_V1
,

171 &
ngx_c‹e_moduÀ_˘x
,

172 
ngx_c‹e_comm™ds
,

173 
NGX_CORE_MODULE
,

174 
NULL
,

175 
NULL
,

176 
NULL
,

177 
NULL
,

178 
NULL
,

179 
NULL
,

180 
NULL
,

181 
NGX_MODULE_V1_PADDING


185 
ngx_uöt_t
 
	gngx_max_moduÀ
;

187 
ngx_uöt_t
 
	gngx_show_hñp
;

188 
ngx_uöt_t
 
	gngx_show_vîsi⁄
;

189 
ngx_uöt_t
 
	gngx_show_c⁄figuª
;

190 
u_ch¨
 *
	gngx_¥efix
;

191 
u_ch¨
 *
	gngx_c⁄f_fûe
;

192 
u_ch¨
 *
	gngx_c⁄f_∑øms
;

193 *
	gngx_sig«l
;

196 **
	gngx_os_ívú⁄
;

199 
ngx_cde˛


200 
	$maö
(
¨gc
, *c⁄° *
¨gv
)

202 
ngx_öt_t
 
i
;

203 
ngx_log_t
 *
log
;

204 
ngx_cy˛e_t
 *
cy˛e
, 
öô_cy˛e
;

205 
ngx_c‹e_c⁄f_t
 *
ccf
;

207 #i‡(
NGX_FREEBSD
)

208 
	`ngx_debug_öô
();

211 i‡(
	`ngx_°ªº‹_öô
(Ë!
NGX_OK
) {

215 i‡(
	`ngx_gë_›ti⁄s
(
¨gc
, 
¨gv
Ë!
NGX_OK
) {

219 i‡(
ngx_show_vîsi⁄
) {

220 
	`ngx_wrôe_°dîr
("ngöx vîsi⁄: " 
NGINX_VER
 
NGX_LINEFEED
);

222 i‡(
ngx_show_hñp
) {

223 
	`ngx_wrôe_°dîr
(

225 "[-∞¥efix] [-g dúe˘ives]" 
NGX_LINEFEED


226 
NGX_LINEFEED


227 "O±i⁄s:" 
NGX_LINEFEED


228 " -?,-h :Åhi†hñp" 
NGX_LINEFEED


229 " -v : show vîsi⁄ándÉxô" 
NGX_LINEFEED


231 
NGX_LINEFEED


232 " -à :Åe° c⁄figuøti⁄ándÉxô" 
NGX_LINEFEED


234 "durög c⁄figuøti⁄Åe°ög" 
NGX_LINEFEED


236 "°›, quô,Ñe›í,Ññﬂd" 
NGX_LINEFEED


237 #ifde‡
NGX_PREFIX


239 
NGX_PREFIX
 ")" 
NGX_LINEFEED


241 " -∞¥efix : sëÖªfixÖ©h (deÁu…: NONE)" 
NGX_LINEFEED


244 
NGX_CONF_PATH
 ")" 
NGX_LINEFEED


246 "fûe" 
NGX_LINEFEED
 NGX_LINEFEED

250 i‡(
ngx_show_c⁄figuª
) {

251 
	`ngx_wrôe_°dîr
(

252 #ifde‡
NGX_COMPILER


253 "buûàby " 
NGX_COMPILER
 
NGX_LINEFEED


255 #i‡(
NGX_SSL
)

256 #ifde‡
SSL_CTRL_SET_TLSEXT_HOSTNAME


257 "TLS SNI suµ‹àíabÀd" 
NGX_LINEFEED


259 "TLS SNI suµ‹àdißbÀd" 
NGX_LINEFEED


262 "c⁄figuªárgumíts:" 
NGX_CONFIGURE
 
NGX_LINEFEED
);

265 i‡(!
ngx_ã°_c⁄fig
) {

270  
ngx_max_sockës
 = -1;

272 
	`ngx_time_öô
();

274 #i‡(
NGX_PCRE
)

275 
	`ngx_ªgex_öô
();

278 
ngx_pid
 = 
	`ngx_gëpid
();

280 
log
 = 
	`ngx_log_öô
(
ngx_¥efix
);

281 i‡(
log
 =
NULL
) {

286 #i‡(
NGX_OPENSSL
)

287 
	`ngx_s¶_öô
(
log
);

295 
	`ngx_memzîo
(&
öô_cy˛e
, (
ngx_cy˛e_t
));

296 
öô_cy˛e
.
log
 =Üog;

297 
ngx_cy˛e
 = &
öô_cy˛e
;

299 
öô_cy˛e
.
poﬁ
 = 
	`ngx_¸óã_poﬁ
(1024, 
log
);

300 i‡(
öô_cy˛e
.
poﬁ
 =
NULL
) {

304 i‡(
	`ngx_ßve_¨gv
(&
öô_cy˛e
, 
¨gc
, 
¨gv
Ë!
NGX_OK
) {

308 i‡(
	`ngx_¥o˚ss_›ti⁄s
(&
öô_cy˛e
Ë!
NGX_OK
) {

312 i‡(
	`ngx_os_öô
(
log
Ë!
NGX_OK
) {

320 i‡(
	`ngx_¸c32_èbÀ_öô
(Ë!
NGX_OK
) {

324 i‡(
	`ngx_add_öhîôed_sockës
(&
öô_cy˛e
Ë!
NGX_OK
) {

328 
ngx_max_moduÀ
 = 0;

329 
i
 = 0; 
ngx_moduÀs
[i]; i++) {

330 
ngx_moduÀs
[
i
]->
ödex
 = 
ngx_max_moduÀ
++;

333 
cy˛e
 = 
	`ngx_öô_cy˛e
(&
öô_cy˛e
);

334 i‡(
cy˛e
 =
NULL
) {

335 i‡(
ngx_ã°_c⁄fig
) {

336 
	`ngx_log_°dîr
(0, "configuration file %sÅest failed",

337 
öô_cy˛e
.
c⁄f_fûe
.
d©a
);

343 i‡(
ngx_ã°_c⁄fig
) {

344 i‡(!
ngx_quõt_mode
) {

345 
	`ngx_log_°dîr
(0, "configuration file %sÅest is successful",

346 
cy˛e
->
c⁄f_fûe
.
d©a
);

352 i‡(
ngx_sig«l
) {

353  
	`ngx_sig«l_¥o˚ss
(
cy˛e
, 
ngx_sig«l
);

356 
	`ngx_os_°©us
(
cy˛e
->
log
);

358 
ngx_cy˛e
 = 
cy˛e
;

360 
ccf
 = (
ngx_c‹e_c⁄f_t
 *Ë
	`ngx_gë_c⁄f
(
cy˛e
->
c⁄f_˘x
, 
ngx_c‹e_moduÀ
);

362 i‡(
ccf
->
ma°î
 && 
ngx_¥o˚ss
 =
NGX_PROCESS_SINGLE
) {

363 
ngx_¥o˚ss
 = 
NGX_PROCESS_MASTER
;

366 #i‡!(
NGX_WIN32
)

368 i‡(
	`ngx_öô_sig«ls
(
cy˛e
->
log
Ë!
NGX_OK
) {

372 i‡(!
ngx_öhîôed
 && 
ccf
->
d´m⁄
) {

373 i‡(
	`ngx_d´m⁄
(
cy˛e
->
log
Ë!
NGX_OK
) {

377 
ngx_d´m⁄ized
 = 1;

380 i‡(
ngx_öhîôed
) {

381 
ngx_d´m⁄ized
 = 1;

386 i‡(
	`ngx_¸óã_pidfûe
(&
ccf
->
pid
, 
cy˛e
->
log
Ë!
NGX_OK
) {

390 i‡(
cy˛e
->
log
->
fûe
->
fd
 !
ngx_°dîr
) {

392 i‡(
	`ngx_£t_°dîr
(
cy˛e
->
log
->
fûe
->
fd
Ë=
NGX_FILE_ERROR
) {

393 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

394 
ngx_£t_°dîr_n
 " failed");

399 i‡(
log
->
fûe
->
fd
 !
ngx_°dîr
) {

400 i‡(
	`ngx_˛o£_fûe
(
log
->
fûe
->
fd
Ë=
NGX_FILE_ERROR
) {

401 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_î∫o
,

402 
ngx_˛o£_fûe_n
 " built-inÜog failed");

406 
ngx_u£_°dîr
 = 0;

408 i‡(
ngx_¥o˚ss
 =
NGX_PROCESS_SINGLE
) {

409 
	`ngx_sögÀ_¥o˚ss_cy˛e
(
cy˛e
);

412 
	`ngx_ma°î_¥o˚ss_cy˛e
(
cy˛e
);

416 
	}
}

419 
ngx_öt_t


420 
	$ngx_add_öhîôed_sockës
(
ngx_cy˛e_t
 *
cy˛e
)

422 
u_ch¨
 *
p
, *
v
, *
öhîôed
;

423 
ngx_öt_t
 
s
;

424 
ngx_li°íög_t
 *
ls
;

426 
öhîôed
 = (
u_ch¨
 *Ë
	`gëív
(
NGINX_VAR
);

428 i‡(
öhîôed
 =
NULL
) {

429  
NGX_OK
;

432 
	`ngx_log_îr‹
(
NGX_LOG_NOTICE
, 
cy˛e
->
log
, 0,

433 "usög inhîôed sockë†‰om \"%s\"", 
öhîôed
);

435 i‡(
	`ngx_¨øy_öô
(&
cy˛e
->
li°íög
, cy˛e->
poﬁ
, 10,

436 (
ngx_li°íög_t
))

437 !
NGX_OK
)

439  
NGX_ERROR
;

442 
p
 = 
öhîôed
, 
v
 =Ö; *p;Ö++) {

443 i‡(*
p
 == ':' || *p == ';') {

444 
s
 = 
	`ngx_©oi
(
v
, 
p
 - v);

445 i‡(
s
 =
NGX_ERROR
) {

446 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 0,

447 "övÆid sockëÇumbî \"%s\" i¿" 
NGINX_VAR


449 " o‡thêv¨übÀ", 
v
);

453 
v
 = 
p
 + 1;

455 
ls
 = 
	`ngx_¨øy_push
(&
cy˛e
->
li°íög
);

456 i‡(
ls
 =
NULL
) {

457  
NGX_ERROR
;

460 
	`ngx_memzîo
(
ls
, (
ngx_li°íög_t
));

462 
ls
->
fd
 = (
ngx_sockë_t
Ë
s
;

466 
ngx_öhîôed
 = 1;

468  
	`ngx_£t_öhîôed_sockës
(
cy˛e
);

469 
	}
}

473 
	$ngx_£t_ívú⁄mít
(
ngx_cy˛e_t
 *
cy˛e
, 
ngx_uöt_t
 *
œ°
)

475 **
p
, **
ív
;

476 
ngx_°r_t
 *
v¨
;

477 
ngx_uöt_t
 
i
, 
n
;

478 
ngx_c‹e_c⁄f_t
 *
ccf
;

480 
ccf
 = (
ngx_c‹e_c⁄f_t
 *Ë
	`ngx_gë_c⁄f
(
cy˛e
->
c⁄f_˘x
, 
ngx_c‹e_moduÀ
);

482 i‡(
œ°
 =
NULL
 && 
ccf
->
ívú⁄mít
) {

483  
ccf
->
ívú⁄mít
;

486 
v¨
 = 
ccf
->
ív
.
ñts
;

488 
i
 = 0; i < 
ccf
->
ív
.
√…s
; i++) {

489 i‡(
	`ngx_°rcmp
(
v¨
[
i
].
d©a
, "TZ") == 0

490 || 
	`ngx_°∫cmp
(
v¨
[
i
].
d©a
, "TZ=", 3) == 0)

492 
tz_found
;

496 
v¨
 = 
	`ngx_¨øy_push
(&
ccf
->
ív
);

497 i‡(
v¨
 =
NULL
) {

498  
NULL
;

501 
v¨
->
Àn
 = 2;

502 
v¨
->
d©a
 = (
u_ch¨
 *) "TZ";

504 
v¨
 = 
ccf
->
ív
.
ñts
;

506 
tz_found
:

508 
n
 = 0;

510 
i
 = 0; i < 
ccf
->
ív
.
√…s
; i++) {

512 i‡(
v¨
[
i
].
d©a
[v¨[i].
Àn
] == '=') {

513 
n
++;

517 
p
 = 
ngx_os_ívú⁄
; *p;Ö++) {

519 i‡(
	`ngx_°∫cmp
(*
p
, 
v¨
[
i
].
d©a
, v¨[i].
Àn
) == 0

520 && (*
p
)[
v¨
[
i
].
Àn
] == '=')

522 
n
++;

528 i‡(
œ°
) {

529 
ív
 = 
	`ngx_Æloc
((*
œ°
 + 
n
 + 1Ë* (*), 
cy˛e
->
log
);

530 *
œ°
 = 
n
;

533 
ív
 = 
	`ngx_∑Œoc
(
cy˛e
->
poﬁ
, (
n
 + 1) * (*));

536 i‡(
ív
 =
NULL
) {

537  
NULL
;

540 
n
 = 0;

542 
i
 = 0; i < 
ccf
->
ív
.
√…s
; i++) {

544 i‡(
v¨
[
i
].
d©a
[v¨[i].
Àn
] == '=') {

545 
ív
[
n
++] = (*Ë
v¨
[
i
].
d©a
;

549 
p
 = 
ngx_os_ívú⁄
; *p;Ö++) {

551 i‡(
	`ngx_°∫cmp
(*
p
, 
v¨
[
i
].
d©a
, v¨[i].
Àn
) == 0

552 && (*
p
)[
v¨
[
i
].
Àn
] == '=')

554 
ív
[
n
++] = *
p
;

560 
ív
[
n
] = 
NULL
;

562 i‡(
œ°
 =
NULL
) {

563 
ccf
->
ívú⁄mít
 = 
ív
;

564 
ívú⁄
 = 
ív
;

567  
ív
;

568 
	}
}

571 
ngx_pid_t


572 
	$ngx_exec_√w_bö¨y
(
ngx_cy˛e_t
 *
cy˛e
, *c⁄° *
¨gv
)

574 **
ív
, *
v¨
;

575 
u_ch¨
 *
p
;

576 
ngx_uöt_t
 
i
, 
n
;

577 
ngx_pid_t
 
pid
;

578 
ngx_exec_˘x_t
 
˘x
;

579 
ngx_c‹e_c⁄f_t
 *
ccf
;

580 
ngx_li°íög_t
 *
ls
;

582 
	`ngx_memzîo
(&
˘x
, (
ngx_exec_˘x_t
));

584 
˘x
.
∑th
 = 
¨gv
[0];

585 
˘x
.
«me
 = "new binaryÖrocess";

586 
˘x
.
¨gv
 =árgv;

588 
n
 = 2;

589 
ív
 = 
	`ngx_£t_ívú⁄mít
(
cy˛e
, &
n
);

590 i‡(
ív
 =
NULL
) {

591  
NGX_INVALID_PID
;

594 
v¨
 = 
	`ngx_Æloc
((
NGINX_VAR
)

595 + 
cy˛e
->
li°íög
.
√…s
 * (
NGX_INT32_LEN
 + 1) + 2,

596 
cy˛e
->
log
);

598 
p
 = 
	`ngx_˝ymem
(
v¨
, 
NGINX_VAR
 "=", (NGINX_VAR));

600 
ls
 = 
cy˛e
->
li°íög
.
ñts
;

601 
i
 = 0; i < 
cy˛e
->
li°íög
.
√…s
; i++) {

602 
p
 = 
	`ngx_•rötf
’, "%ud;", 
ls
[
i
].
fd
);

605 *
p
 = '\0';

607 
ív
[
n
++] = 
v¨
;

609 #i‡(
NGX_SETPROCTITLE_USES_ENV
)

613 
ív
[
n
++] = "SPARE=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"

621 
ív
[
n
] = 
NULL
;

623 #i‡(
NGX_DEBUG
)

625 **
e
;

626 
e
 = 
ív
; *e;É++) {

627 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
cy˛e
->
log
, 0, "ív: %s", *
e
);

632 
˘x
.
ívp
 = (*c⁄° *Ë
ív
;

634 
ccf
 = (
ngx_c‹e_c⁄f_t
 *Ë
	`ngx_gë_c⁄f
(
cy˛e
->
c⁄f_˘x
, 
ngx_c‹e_moduÀ
);

636 i‡(
	`ngx_ª«me_fûe
(
ccf
->
pid
.
d©a
, ccf->
ﬁdpid
.d©aË!
NGX_OK
) {

637 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_î∫o
,

638 
ngx_ª«me_fûe_n
 " %sÅo %s failed "

640 
ccf
->
pid
.
d©a
, ccf->
ﬁdpid
.d©a, 
¨gv
[0]);

642 
	`ngx_‰ì
(
ív
);

643 
	`ngx_‰ì
(
v¨
);

645  
NGX_INVALID_PID
;

648 
pid
 = 
	`ngx_execuã
(
cy˛e
, &
˘x
);

650 i‡(
pid
 =
NGX_INVALID_PID
) {

651 i‡(
	`ngx_ª«me_fûe
(
ccf
->
ﬁdpid
.
d©a
, ccf->
pid
.d©aË!
NGX_OK
) {

652 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_î∫o
,

653 
ngx_ª«me_fûe_n
 " %s backÅo %s failedáfter "

655 
ccf
->
ﬁdpid
.
d©a
, ccf->
pid
.d©a, 
¨gv
[0]);

659 
	`ngx_‰ì
(
ív
);

660 
	`ngx_‰ì
(
v¨
);

662  
pid
;

663 
	}
}

666 
ngx_öt_t


667 
	$ngx_gë_›ti⁄s
(
¨gc
, *c⁄° *
¨gv
)

669 
u_ch¨
 *
p
;

670 
ngx_öt_t
 
i
;

672 
i
 = 1; i < 
¨gc
; i++) {

674 
p
 = (
u_ch¨
 *Ë
¨gv
[
i
];

676 i‡(*
p
++ != '-') {

677 
	`ngx_log_°dîr
(0, "övÆid o±i⁄: \"%s\"", 
¨gv
[
i
]);

678  
NGX_ERROR
;

681 *
p
) {

683 *
p
++) {

687 
ngx_show_vîsi⁄
 = 1;

688 
ngx_show_hñp
 = 1;

692 
ngx_show_vîsi⁄
 = 1;

696 
ngx_show_vîsi⁄
 = 1;

697 
ngx_show_c⁄figuª
 = 1;

701 
ngx_ã°_c⁄fig
 = 1;

705 
ngx_quõt_mode
 = 1;

709 i‡(*
p
) {

710 
ngx_¥efix
 = 
p
;

711 
√xt
;

714 i‡(
¨gv
[++
i
]) {

715 
ngx_¥efix
 = (
u_ch¨
 *Ë
¨gv
[
i
];

716 
√xt
;

719 
	`ngx_log_°dîr
(0, "option \"-p\"Ñequires directoryÇame");

720  
NGX_ERROR
;

723 i‡(*
p
) {

724 
ngx_c⁄f_fûe
 = 
p
;

725 
√xt
;

728 i‡(
¨gv
[++
i
]) {

729 
ngx_c⁄f_fûe
 = (
u_ch¨
 *Ë
¨gv
[
i
];

730 
√xt
;

733 
	`ngx_log_°dîr
(0, "option \"-c\"Ñequires fileÇame");

734  
NGX_ERROR
;

737 i‡(*
p
) {

738 
ngx_c⁄f_∑øms
 = 
p
;

739 
√xt
;

742 i‡(
¨gv
[++
i
]) {

743 
ngx_c⁄f_∑øms
 = (
u_ch¨
 *Ë
¨gv
[
i
];

744 
√xt
;

747 
	`ngx_log_°dîr
(0, "option \"-g\"ÑequiresÖarameter");

748  
NGX_ERROR
;

751 i‡(*
p
) {

752 
ngx_sig«l
 = (*Ë
p
;

754 } i‡(
¨gv
[++
i
]) {

755 
ngx_sig«l
 = 
¨gv
[
i
];

758 
	`ngx_log_°dîr
(0, "option \"-s\"ÑequiresÖarameter");

759  
NGX_ERROR
;

762 i‡(
	`ngx_°rcmp
(
ngx_sig«l
, "stop") == 0

763 || 
	`ngx_°rcmp
(
ngx_sig«l
, "quit") == 0

764 || 
	`ngx_°rcmp
(
ngx_sig«l
, "reopen") == 0

765 || 
	`ngx_°rcmp
(
ngx_sig«l
, "reload") == 0)

767 
ngx_¥o˚ss
 = 
NGX_PROCESS_SIGNALLER
;

768 
√xt
;

771 
	`ngx_log_°dîr
(0, "övÆid o±i⁄: \"-†%s\"", 
ngx_sig«l
);

772  
NGX_ERROR
;

775 
	`ngx_log_°dîr
(0, "övÆid o±i⁄: \"%c\"", *(
p
 - 1));

776  
NGX_ERROR
;

780 
√xt
:

785  
NGX_OK
;

786 
	}
}

789 
ngx_öt_t


790 
	$ngx_ßve_¨gv
(
ngx_cy˛e_t
 *
cy˛e
, 
¨gc
, *c⁄° *
¨gv
)

792 #i‡(
NGX_FREEBSD
)

794 
ngx_os_¨gv
 = (**Ë
¨gv
;

795 
ngx_¨gc
 = 
¨gc
;

796 
ngx_¨gv
 = (**Ë
¨gv
;

799 
size_t
 
Àn
;

800 
ngx_öt_t
 
i
;

802 
ngx_os_¨gv
 = (**Ë
¨gv
;

803 
ngx_¨gc
 = 
¨gc
;

805 
ngx_¨gv
 = 
	`ngx_Æloc
((
¨gc
 + 1Ë* (*), 
cy˛e
->
log
);

806 i‡(
ngx_¨gv
 =
NULL
) {

807  
NGX_ERROR
;

810 
i
 = 0; i < 
¨gc
; i++) {

811 
Àn
 = 
	`ngx_°æí
(
¨gv
[
i
]) + 1;

813 
ngx_¨gv
[
i
] = 
	`ngx_Æloc
(
Àn
, 
cy˛e
->
log
);

814 i‡(
ngx_¨gv
[
i
] =
NULL
) {

815  
NGX_ERROR
;

818 (Ë
	`ngx_˝y°∫
((
u_ch¨
 *Ë
ngx_¨gv
[
i
], (u_ch¨ *Ë
¨gv
[i], 
Àn
);

821 
ngx_¨gv
[
i
] = 
NULL
;

825 
ngx_os_ívú⁄
 = 
ívú⁄
;

827  
NGX_OK
;

828 
	}
}

831 
ngx_öt_t


832 
	$ngx_¥o˚ss_›ti⁄s
(
ngx_cy˛e_t
 *
cy˛e
)

834 
u_ch¨
 *
p
;

835 
size_t
 
Àn
;

837 i‡(
ngx_¥efix
) {

838 
Àn
 = 
	`ngx_°æí
(
ngx_¥efix
);

839 
p
 = 
ngx_¥efix
;

841 i‡(!
	`ngx_∑th_£∑øt‹
(*
p
)) {

842 
p
 = 
	`ngx_≤Æloc
(
cy˛e
->
poﬁ
, 
Àn
 + 1);

843 i‡(
p
 =
NULL
) {

844  
NGX_ERROR
;

847 
	`ngx_mem˝y
(
p
, 
ngx_¥efix
, 
Àn
);

848 
p
[
Àn
++] = '/';

851 
cy˛e
->
c⁄f_¥efix
.
Àn
 =Üen;

852 
cy˛e
->
c⁄f_¥efix
.
d©a
 = 
p
;

853 
cy˛e
->
¥efix
.
Àn
 =Üen;

854 
cy˛e
->
¥efix
.
d©a
 = 
p
;

858 #i‚de‡
NGX_PREFIX


860 
p
 = 
	`ngx_≤Æloc
(
cy˛e
->
poﬁ
, 
NGX_MAX_PATH
);

861 i‡(
p
 =
NULL
) {

862  
NGX_ERROR
;

865 i‡(
	`ngx_gëcwd
(
p
, 
NGX_MAX_PATH
) == 0) {

866 
	`ngx_log_°dîr
(
ngx_î∫o
, "[emîg]: " 
ngx_gëcwd_n
 " failed");

867  
NGX_ERROR
;

870 
Àn
 = 
	`ngx_°æí
(
p
);

872 
p
[
Àn
++] = '/';

874 
cy˛e
->
c⁄f_¥efix
.
Àn
 =Üen;

875 
cy˛e
->
c⁄f_¥efix
.
d©a
 = 
p
;

876 
cy˛e
->
¥efix
.
Àn
 =Üen;

877 
cy˛e
->
¥efix
.
d©a
 = 
p
;

881 #ifde‡
NGX_CONF_PREFIX


882 
	`ngx_°r_£t
(&
cy˛e
->
c⁄f_¥efix
, 
NGX_CONF_PREFIX
);

884 
	`ngx_°r_£t
(&
cy˛e
->
c⁄f_¥efix
, 
NGX_PREFIX
);

886 
	`ngx_°r_£t
(&
cy˛e
->
¥efix
, 
NGX_PREFIX
);

891 i‡(
ngx_c⁄f_fûe
) {

892 
cy˛e
->
c⁄f_fûe
.
Àn
 = 
	`ngx_°æí
(
ngx_c⁄f_fûe
);

893 
cy˛e
->
c⁄f_fûe
.
d©a
 = 
ngx_c⁄f_fûe
;

896 
	`ngx_°r_£t
(&
cy˛e
->
c⁄f_fûe
, 
NGX_CONF_PATH
);

899 i‡(
	`ngx_c⁄f_fuŒ_«me
(
cy˛e
, &cy˛e->
c⁄f_fûe
, 0Ë!
NGX_OK
) {

900  
NGX_ERROR
;

903 
p
 = 
cy˛e
->
c⁄f_fûe
.
d©a
 + cy˛e->c⁄f_fûe.
Àn
 - 1;

904 
p
 > 
cy˛e
->
c⁄f_fûe
.
d©a
;

905 
p
--)

907 i‡(
	`ngx_∑th_£∑øt‹
(*
p
)) {

908 
cy˛e
->
c⁄f_¥efix
.
Àn
 = 
p
 - 
ngx_cy˛e
->
c⁄f_fûe
.
d©a
 + 1;

909 
cy˛e
->
c⁄f_¥efix
.
d©a
 = 
ngx_cy˛e
->
c⁄f_fûe
.data;

914 i‡(
ngx_c⁄f_∑øms
) {

915 
cy˛e
->
c⁄f_∑øm
.
Àn
 = 
	`ngx_°æí
(
ngx_c⁄f_∑øms
);

916 
cy˛e
->
c⁄f_∑øm
.
d©a
 = 
ngx_c⁄f_∑øms
;

919 i‡(
ngx_ã°_c⁄fig
) {

920 
cy˛e
->
log
->
log_Àvñ
 = 
NGX_LOG_INFO
;

923  
NGX_OK
;

924 
	}
}

928 
	$ngx_c‹e_moduÀ_¸óã_c⁄f
(
ngx_cy˛e_t
 *
cy˛e
)

930 
ngx_c‹e_c⁄f_t
 *
ccf
;

932 
ccf
 = 
	`ngx_pˇŒoc
(
cy˛e
->
poﬁ
, (
ngx_c‹e_c⁄f_t
));

933 i‡(
ccf
 =
NULL
) {

934  
NULL
;

947 
ccf
->
d´m⁄
 = 
NGX_CONF_UNSET
;

948 
ccf
->
ma°î
 = 
NGX_CONF_UNSET
;

949 
ccf
->
timî_ªsﬁuti⁄
 = 
NGX_CONF_UNSET_MSEC
;

951 
ccf
->
w‹kî_¥o˚s£s
 = 
NGX_CONF_UNSET
;

952 
ccf
->
debug_poöts
 = 
NGX_CONF_UNSET
;

954 
ccf
->
æimô_nofûe
 = 
NGX_CONF_UNSET
;

955 
ccf
->
æimô_c‹e
 = 
NGX_CONF_UNSET
;

956 
ccf
->
æimô_sig≥ndög
 = 
NGX_CONF_UNSET
;

958 
ccf
->
u£r
 = (
ngx_uid_t
Ë
NGX_CONF_UNSET_UINT
;

959 
ccf
->
group
 = (
ngx_gid_t
Ë
NGX_CONF_UNSET_UINT
;

961 #i‡(
NGX_THREADS
)

962 
ccf
->
w‹kî_thªads
 = 
NGX_CONF_UNSET
;

963 
ccf
->
thªad_°ack_size
 = 
NGX_CONF_UNSET_SIZE
;

966 i‡(
	`ngx_¨øy_öô
(&
ccf
->
ív
, 
cy˛e
->
poﬁ
, 1, (
ngx_°r_t
))

967 !
NGX_OK
)

969  
NULL
;

972  
ccf
;

973 
	}
}

977 
	$ngx_c‹e_moduÀ_öô_c⁄f
(
ngx_cy˛e_t
 *
cy˛e
, *
c⁄f
)

979 
ngx_c‹e_c⁄f_t
 *
ccf
 = 
c⁄f
;

981 
	`ngx_c⁄f_öô_vÆue
(
ccf
->
d´m⁄
, 1);

982 
	`ngx_c⁄f_öô_vÆue
(
ccf
->
ma°î
, 1);

983 
	`ngx_c⁄f_öô_m£c_vÆue
(
ccf
->
timî_ªsﬁuti⁄
, 0);

985 
	`ngx_c⁄f_öô_vÆue
(
ccf
->
w‹kî_¥o˚s£s
, 1);

986 
	`ngx_c⁄f_öô_vÆue
(
ccf
->
debug_poöts
, 0);

988 #i‡(
NGX_HAVE_SCHED_SETAFFINITY
)

990 i‡(
ccf
->
˝u_afföôy_n


991 && 
ccf
->
˝u_afföôy_n
 != 1

992 && 
ccf
->
˝u_afföôy_n
 !(
ngx_uöt_t
Ëccf->
w‹kî_¥o˚s£s
)

994 
	`ngx_log_îr‹
(
NGX_LOG_WARN
, 
cy˛e
->
log
, 0,

1002 #i‡(
NGX_THREADS
)

1004 
	`ngx_c⁄f_öô_vÆue
(
ccf
->
w‹kî_thªads
, 0);

1005 
ngx_thªads_n
 = 
ccf
->
w‹kî_thªads
;

1006 
	`ngx_c⁄f_öô_size_vÆue
(
ccf
->
thªad_°ack_size
, 2 * 1024 * 1024);

1011 i‡(
ccf
->
pid
.
Àn
 == 0) {

1012 
	`ngx_°r_£t
(&
ccf
->
pid
, 
NGX_PID_PATH
);

1015 i‡(
	`ngx_c⁄f_fuŒ_«me
(
cy˛e
, &
ccf
->
pid
, 0Ë!
NGX_OK
) {

1016  
NGX_CONF_ERROR
;

1019 
ccf
->
ﬁdpid
.
Àn
 = ccf->
pid
.À¿+ (
NGX_OLDPID_EXT
);

1021 
ccf
->
ﬁdpid
.
d©a
 = 
	`ngx_≤Æloc
(
cy˛e
->
poﬁ
, ccf->ﬁdpid.
Àn
);

1022 i‡(
ccf
->
ﬁdpid
.
d©a
 =
NULL
) {

1023  
NGX_CONF_ERROR
;

1026 
	`ngx_mem˝y
(
	`ngx_˝ymem
(
ccf
->
ﬁdpid
.
d©a
, ccf->
pid
.d©a, ccf->pid.
Àn
),

1027 
NGX_OLDPID_EXT
, (NGX_OLDPID_EXT));

1030 #i‡!(
NGX_WIN32
)

1032 i‡(
ccf
->
u£r
 =(
uid_t
Ë
NGX_CONF_UNSET_UINT
 && 
	`gëeuid
() == 0) {

1033 
group
 *
gΩ
;

1034 
∑sswd
 *
pwd
;

1036 
	`ngx_£t_î∫o
(0);

1037 
pwd
 = 
	`gëpw«m
(
NGX_USER
);

1038 i‡(
pwd
 =
NULL
) {

1039 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

1040 "gëpw«m(\"" 
NGX_USER
 "\") failed");

1041  
NGX_CONF_ERROR
;

1044 
ccf
->
u£∫ame
 = 
NGX_USER
;

1045 
ccf
->
u£r
 = 
pwd
->
pw_uid
;

1047 
	`ngx_£t_î∫o
(0);

1048 
gΩ
 = 
	`gëg∫am
(
NGX_GROUP
);

1049 i‡(
gΩ
 =
NULL
) {

1050 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

1051 "gëg∫am(\"" 
NGX_GROUP
 "\") failed");

1052  
NGX_CONF_ERROR
;

1055 
ccf
->
group
 = 
gΩ
->
gr_gid
;

1059 i‡(
ccf
->
lock_fûe
.
Àn
 == 0) {

1060 
	`ngx_°r_£t
(&
ccf
->
lock_fûe
, 
NGX_LOCK_PATH
);

1063 i‡(
	`ngx_c⁄f_fuŒ_«me
(
cy˛e
, &
ccf
->
lock_fûe
, 0Ë!
NGX_OK
) {

1064  
NGX_CONF_ERROR
;

1068 
ngx_°r_t
 
lock_fûe
;

1070 
lock_fûe
 = 
cy˛e
->
ﬁd_cy˛e
->lock_file;

1072 i‡(
lock_fûe
.
Àn
) {

1073 
lock_fûe
.
Àn
--;

1075 i‡(
ccf
->
lock_fûe
.
Àn
 !=Üock_file.len

1076 || 
	`ngx_°∫cmp
(
ccf
->
lock_fûe
.
d©a
,Üock_fûe.d©a,Üock_fûe.
Àn
)

1079 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 0,

1083 
cy˛e
->
lock_fûe
.
Àn
 =Üock_file.len + 1;

1084 
lock_fûe
.
Àn
 += (".accept");

1086 
cy˛e
->
lock_fûe
.
d©a
 = 
	`ngx_p°rdup
(cy˛e->
poﬁ
, &lock_file);

1087 i‡(
cy˛e
->
lock_fûe
.
d©a
 =
NULL
) {

1088  
NGX_CONF_ERROR
;

1092 
cy˛e
->
lock_fûe
.
Àn
 = 
ccf
->lock_file.len + 1;

1093 
cy˛e
->
lock_fûe
.
d©a
 = 
	`ngx_≤Æloc
(cy˛e->
poﬁ
,

1094 
ccf
->
lock_fûe
.
Àn
 + (".accept"));

1095 i‡(
cy˛e
->
lock_fûe
.
d©a
 =
NULL
) {

1096  
NGX_CONF_ERROR
;

1099 
	`ngx_mem˝y
(
	`ngx_˝ymem
(
cy˛e
->
lock_fûe
.
d©a
, 
ccf
->lock_file.data,

1100 
ccf
->
lock_fûe
.
Àn
),

1107  
NGX_CONF_OK
;

1108 
	}
}

1112 
	$ngx_£t_u£r
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1114 #i‡(
NGX_WIN32
)

1116 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_WARN
, 
cf
, 0,

1119  
NGX_CONF_OK
;

1123 
ngx_c‹e_c⁄f_t
 *
ccf
 = 
c⁄f
;

1125 *
group
;

1126 
∑sswd
 *
pwd
;

1127 
group
 *
gΩ
;

1128 
ngx_°r_t
 *
vÆue
;

1130 i‡(
ccf
->
u£r
 !(
uid_t
Ë
NGX_CONF_UNSET_UINT
) {

1134 i‡(
	`gëeuid
() != 0) {

1135 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_WARN
, 
cf
, 0,

1139  
NGX_CONF_OK
;

1142 
vÆue
 = (
ngx_°r_t
 *Ë
cf
->
¨gs
->
ñts
;

1144 
ccf
->
u£∫ame
 = (*Ë
vÆue
[1].
d©a
;

1146 
	`ngx_£t_î∫o
(0);

1147 
pwd
 = 
	`gëpw«m
((c⁄° *Ë
vÆue
[1].
d©a
);

1148 i‡(
pwd
 =
NULL
) {

1149 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 
ngx_î∫o
,

1150 "gëpw«m(\"%s\"ËÁûed", 
vÆue
[1].
d©a
);

1151  
NGX_CONF_ERROR
;

1154 
ccf
->
u£r
 = 
pwd
->
pw_uid
;

1156 
group
 = (*Ë((
cf
->
¨gs
->
√…s
 =2Ë? 
vÆue
[1].
d©a
 : value[2].data);

1158 
	`ngx_£t_î∫o
(0);

1159 
gΩ
 = 
	`gëg∫am
(
group
);

1160 i‡(
gΩ
 =
NULL
) {

1161 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 
ngx_î∫o
,

1162 "gëg∫am(\"%s\"ËÁûed", 
group
);

1163  
NGX_CONF_ERROR
;

1166 
ccf
->
group
 = 
gΩ
->
gr_gid
;

1168  
NGX_CONF_OK
;

1171 
	}
}

1175 
	$ngx_£t_ív
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1177 
ngx_c‹e_c⁄f_t
 *
ccf
 = 
c⁄f
;

1179 
ngx_°r_t
 *
vÆue
, *
v¨
;

1180 
ngx_uöt_t
 
i
;

1182 
v¨
 = 
	`ngx_¨øy_push
(&
ccf
->
ív
);

1183 i‡(
v¨
 =
NULL
) {

1184  
NGX_CONF_ERROR
;

1187 
vÆue
 = 
cf
->
¨gs
->
ñts
;

1188 *
v¨
 = 
vÆue
[1];

1190 
i
 = 0; i < 
vÆue
[1].
Àn
; i++) {

1192 i‡(
vÆue
[1].
d©a
[
i
] == '=') {

1194 
v¨
->
Àn
 = 
i
;

1196  
NGX_CONF_OK
;

1200  
NGX_CONF_OK
;

1201 
	}
}

1205 
	$ngx_£t_¥i‹ôy
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1207 
ngx_c‹e_c⁄f_t
 *
ccf
 = 
c⁄f
;

1209 
ngx_°r_t
 *
vÆue
;

1210 
ngx_uöt_t
 
n
, 
möus
;

1212 i‡(
ccf
->
¥i‹ôy
 != 0) {

1216 
vÆue
 = 
cf
->
¨gs
->
ñts
;

1218 i‡(
vÆue
[1].
d©a
[0] == '-') {

1219 
n
 = 1;

1220 
möus
 = 1;

1222 } i‡(
vÆue
[1].
d©a
[0] == '+') {

1223 
n
 = 1;

1224 
möus
 = 0;

1227 
n
 = 0;

1228 
möus
 = 0;

1231 
ccf
->
¥i‹ôy
 = 
	`ngx_©oi
(&
vÆue
[1].
d©a
[
n
], vÆue[1].
Àn
 -Ç);

1232 i‡(
ccf
->
¥i‹ôy
 =
NGX_ERROR
) {

1236 i‡(
möus
) {

1237 
ccf
->
¥i‹ôy
 = -ccf->priority;

1240  
NGX_CONF_OK
;

1241 
	}
}

1245 
	$ngx_£t_˝u_afföôy
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1247 #i‡(
NGX_HAVE_SCHED_SETAFFINITY
)

1248 
ngx_c‹e_c⁄f_t
 *
ccf
 = 
c⁄f
;

1250 
u_ch¨
 
ch
;

1251 
u_l⁄g
 *
mask
;

1252 
ngx_°r_t
 *
vÆue
;

1253 
ngx_uöt_t
 
i
, 
n
;

1255 i‡(
ccf
->
˝u_afföôy
) {

1259 
mask
 = 
	`ngx_∑Œoc
(
cf
->
poﬁ
, (cf->
¨gs
->
√…s
 - 1) * ());

1260 i‡(
mask
 =
NULL
) {

1261  
NGX_CONF_ERROR
;

1264 
ccf
->
˝u_afföôy_n
 = 
cf
->
¨gs
->
√…s
 - 1;

1265 
ccf
->
˝u_afföôy
 = 
mask
;

1267 
vÆue
 = 
cf
->
¨gs
->
ñts
;

1269 
n
 = 1;Ç < 
cf
->
¨gs
->
√…s
;Ç++) {

1271 i‡(
vÆue
[
n
].
Àn
 > 32) {

1272 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

1274  
NGX_CONF_ERROR
;

1277 
mask
[
n
 - 1] = 0;

1279 
i
 = 0; i < 
vÆue
[
n
].
Àn
; i++) {

1281 
ch
 = 
vÆue
[
n
].
d©a
[
i
];

1283 i‡(
ch
 == ' ') {

1287 
mask
[
n
 - 1] <<= 1;

1289 i‡(
ch
 == '0') {

1293 i‡(
ch
 == '1') {

1294 
mask
[
n
 - 1] |= 1;

1298 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

1300 
ch
);

1301  
NGX_CONF_ERROR
;

1307 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_WARN
, 
cf
, 0,

1312  
NGX_CONF_OK
;

1313 
	}
}

1316 
u_l⁄g


1317 
	$ngx_gë_˝u_afföôy
(
ngx_uöt_t
 
n
)

1319 
ngx_c‹e_c⁄f_t
 *
ccf
;

1321 
ccf
 = (
ngx_c‹e_c⁄f_t
 *Ë
	`ngx_gë_c⁄f
(
ngx_cy˛e
->
c⁄f_˘x
,

1322 
ngx_c‹e_moduÀ
);

1324 i‡(
ccf
->
˝u_afföôy
 =
NULL
) {

1328 i‡(
ccf
->
˝u_afföôy_n
 > 
n
) {

1329  
ccf
->
˝u_afföôy
[
n
];

1332  
ccf
->
˝u_afföôy
[ccf->
˝u_afföôy_n
 - 1];

1333 
	}
}

	@nginx.h

8 #i‚de‡
_NGINX_H_INCLUDED_


9 
	#_NGINX_H_INCLUDED_


	)

12 
	#ngöx_vîsi⁄
 1000015

	)

13 
	#NGINX_VERSION
 "1.0.15"

	)

14 
	#NGINX_VER
 "ngöx/" 
NGINX_VERSION


	)

16 
	#NGINX_VAR
 "NGINX"

	)

17 
	#NGX_OLDPID_EXT
 ".ﬁdbö"

	)

	@ngx_array.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 
ngx_¨øy_t
 *

13 
	$ngx_¨øy_¸óã
(
ngx_poﬁ_t
 *
p
, 
ngx_uöt_t
 
n
, 
size_t
 
size
)

15 
ngx_¨øy_t
 *
a
;

17 
a
 = 
	`ngx_∑Œoc
(
p
, (
ngx_¨øy_t
));

18 i‡(
a
 =
NULL
) {

19  
NULL
;

22 
a
->
ñts
 = 
	`ngx_∑Œoc
(
p
, 
n
 * 
size
);

23 i‡(
a
->
ñts
 =
NULL
) {

24  
NULL
;

27 
a
->
√…s
 = 0;

28 
a
->
size
 = size;

29 
a
->
«Œoc
 = 
n
;

30 
a
->
poﬁ
 = 
p
;

32  
a
;

33 
	}
}

37 
	$ngx_¨øy_de°roy
(
ngx_¨øy_t
 *
a
)

39 
ngx_poﬁ_t
 *
p
;

41 
p
 = 
a
->
poﬁ
;

43 i‡((
u_ch¨
 *Ë
a
->
ñts
 +á->
size
 *á->
«Œoc
 =
p
->
d
.
œ°
) {

44 
p
->
d
.
œ°
 -
a
->
size
 *á->
«Œoc
;

47 i‡((
u_ch¨
 *Ë
a
 + (
ngx_¨øy_t
Ë=
p
->
d
.
œ°
) {

48 
p
->
d
.
œ°
 = (
u_ch¨
 *Ë
a
;

50 
	}
}

54 
	$ngx_¨øy_push
(
ngx_¨øy_t
 *
a
)

56 *
ñt
, *
√w
;

57 
size_t
 
size
;

58 
ngx_poﬁ_t
 *
p
;

60 i‡(
a
->
√…s
 =a->
«Œoc
) {

64 
size
 = 
a
->sizê*á->
«Œoc
;

66 
p
 = 
a
->
poﬁ
;

68 i‡((
u_ch¨
 *Ë
a
->
ñts
 + 
size
 =
p
->
d
.
œ°


69 && 
p
->
d
.
œ°
 + 
a
->
size
 <p->d.
íd
)

76 
p
->
d
.
œ°
 +
a
->
size
;

77 
a
->
«Œoc
++;

82 
√w
 = 
	`ngx_∑Œoc
(
p
, 2 * 
size
);

83 i‡(
√w
 =
NULL
) {

84  
NULL
;

87 
	`ngx_mem˝y
(
√w
, 
a
->
ñts
, 
size
);

88 
a
->
ñts
 = 
√w
;

89 
a
->
«Œoc
 *= 2;

93 
ñt
 = (
u_ch¨
 *Ë
a
->
ñts
 +á->
size
 *á->
√…s
;

94 
a
->
√…s
++;

96  
ñt
;

97 
	}
}

101 
	$ngx_¨øy_push_n
(
ngx_¨øy_t
 *
a
, 
ngx_uöt_t
 
n
)

103 *
ñt
, *
√w
;

104 
size_t
 
size
;

105 
ngx_uöt_t
 
«Œoc
;

106 
ngx_poﬁ_t
 *
p
;

108 
size
 = 
n
 * 
a
->size;

110 i‡(
a
->
√…s
 + 
n
 >á->
«Œoc
) {

114 
p
 = 
a
->
poﬁ
;

116 i‡((
u_ch¨
 *Ë
a
->
ñts
 +á->
size
 *á->
«Œoc
 =
p
->
d
.
œ°


117 && 
p
->
d
.
œ°
 + 
size
 <p->d.
íd
)

124 
p
->
d
.
œ°
 +
size
;

125 
a
->
«Œoc
 +
n
;

130 
«Œoc
 = 2 * ((
n
 >
a
->nalloc) ?Ç :á->nalloc);

132 
√w
 = 
	`ngx_∑Œoc
(
p
, 
«Œoc
 * 
a
->
size
);

133 i‡(
√w
 =
NULL
) {

134  
NULL
;

137 
	`ngx_mem˝y
(
√w
, 
a
->
ñts
,á->
√…s
 *á->
size
);

138 
a
->
ñts
 = 
√w
;

139 
a
->
«Œoc
 =Çalloc;

143 
ñt
 = (
u_ch¨
 *Ë
a
->
ñts
 +á->
size
 *á->
√…s
;

144 
a
->
√…s
 +
n
;

146  
ñt
;

147 
	}
}

	@ngx_array.h

8 #i‚de‡
_NGX_ARRAY_H_INCLUDED_


9 
	#_NGX_ARRAY_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 
	sngx_¨øy_s
 {

17 *
	mñts
;

18 
ngx_uöt_t
 
	m√…s
;

19 
size_t
 
	msize
;

20 
ngx_uöt_t
 
	m«Œoc
;

21 
ngx_poﬁ_t
 *
	mpoﬁ
;

25 
ngx_¨øy_t
 *
ngx_¨øy_¸óã
(
ngx_poﬁ_t
 *
p
, 
ngx_uöt_t
 
n
, 
size_t
 
size
);

26 
ngx_¨øy_de°roy
(
ngx_¨øy_t
 *
a
);

27 *
ngx_¨øy_push
(
ngx_¨øy_t
 *
a
);

28 *
ngx_¨øy_push_n
(
ngx_¨øy_t
 *
a
, 
ngx_uöt_t
 
n
);

31 
ngx_ölöe
 
ngx_öt_t


32 
	$ngx_¨øy_öô
(
ngx_¨øy_t
 *
¨øy
, 
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uöt_t
 
n
, 
size_t
 
size
)

39 
¨øy
->
√…s
 = 0;

40 
¨øy
->
size
 = size;

41 
¨øy
->
«Œoc
 = 
n
;

42 
¨øy
->
poﬁ
 =Öool;

44 
¨øy
->
ñts
 = 
	`ngx_∑Œoc
(
poﬁ
, 
n
 * 
size
);

45 i‡(
¨øy
->
ñts
 =
NULL
) {

46  
NGX_ERROR
;

49  
NGX_OK
;

50 
	}
}

	@ngx_buf.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 
ngx_buf_t
 *

13 
	$ngx_¸óã_ãmp_buf
(
ngx_poﬁ_t
 *
poﬁ
, 
size_t
 
size
)

15 
ngx_buf_t
 *
b
;

17 
b
 = 
	`ngx_ˇŒoc_buf
(
poﬁ
);

18 i‡(
b
 =
NULL
) {

19  
NULL
;

22 
b
->
°¨t
 = 
	`ngx_∑Œoc
(
poﬁ
, 
size
);

23 i‡(
b
->
°¨t
 =
NULL
) {

24  
NULL
;

38 
b
->
pos
 = b->
°¨t
;

39 
b
->
œ°
 = b->
°¨t
;

40 
b
->
íd
 = b->
œ°
 + 
size
;

41 
b
->
ãmp‹¨y
 = 1;

43  
b
;

44 
	}
}

47 
ngx_chaö_t
 *

48 
	$ngx_Æloc_chaö_lök
(
ngx_poﬁ_t
 *
poﬁ
)

50 
ngx_chaö_t
 *
˛
;

52 
˛
 = 
poﬁ
->
chaö
;

54 i‡(
˛
) {

55 
poﬁ
->
chaö
 = 
˛
->
√xt
;

56  
˛
;

59 
˛
 = 
	`ngx_∑Œoc
(
poﬁ
, (
ngx_chaö_t
));

60 i‡(
˛
 =
NULL
) {

61  
NULL
;

64  
˛
;

65 
	}
}

68 
ngx_chaö_t
 *

69 
	$ngx_¸óã_chaö_of_bufs
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_bufs_t
 *
bufs
)

71 
u_ch¨
 *
p
;

72 
ngx_öt_t
 
i
;

73 
ngx_buf_t
 *
b
;

74 
ngx_chaö_t
 *
chaö
, *
˛
, **
Œ
;

76 
p
 = 
	`ngx_∑Œoc
(
poﬁ
, 
bufs
->
num
 * bufs->
size
);

77 i‡(
p
 =
NULL
) {

78  
NULL
;

81 
Œ
 = &
chaö
;

83 
i
 = 0; i < 
bufs
->
num
; i++) {

85 
b
 = 
	`ngx_ˇŒoc_buf
(
poﬁ
);

86 i‡(
b
 =
NULL
) {

87  
NULL
;

102 
b
->
pos
 = 
p
;

103 
b
->
œ°
 = 
p
;

104 
b
->
ãmp‹¨y
 = 1;

106 
b
->
°¨t
 = 
p
;

107 
p
 +
bufs
->
size
;

108 
b
->
íd
 = 
p
;

110 
˛
 = 
	`ngx_Æloc_chaö_lök
(
poﬁ
);

111 i‡(
˛
 =
NULL
) {

112  
NULL
;

115 
˛
->
buf
 = 
b
;

116 *
Œ
 = 
˛
;

117 
Œ
 = &
˛
->
√xt
;

120 *
Œ
 = 
NULL
;

122  
chaö
;

123 
	}
}

126 
ngx_öt_t


127 
	$ngx_chaö_add_c›y
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_chaö_t
 **
chaö
,Çgx_chaö_à*
ö
)

129 
ngx_chaö_t
 *
˛
, **
Œ
;

131 
Œ
 = 
chaö
;

133 
˛
 = *
chaö
; cl; c»˛->
√xt
) {

134 
Œ
 = &
˛
->
√xt
;

137 
ö
) {

138 
˛
 = 
	`ngx_Æloc_chaö_lök
(
poﬁ
);

139 i‡(
˛
 =
NULL
) {

140  
NGX_ERROR
;

143 
˛
->
buf
 = 
ö
->buf;

144 *
Œ
 = 
˛
;

145 
Œ
 = &
˛
->
√xt
;

146 
ö
 = in->
√xt
;

149 *
Œ
 = 
NULL
;

151  
NGX_OK
;

152 
	}
}

155 
ngx_chaö_t
 *

156 
	$ngx_chaö_gë_‰ì_buf
(
ngx_poﬁ_t
 *
p
, 
ngx_chaö_t
 **
‰ì
)

158 
ngx_chaö_t
 *
˛
;

160 i‡(*
‰ì
) {

161 
˛
 = *
‰ì
;

162 *
‰ì
 = 
˛
->
√xt
;

163 
˛
->
√xt
 = 
NULL
;

164  
˛
;

167 
˛
 = 
	`ngx_Æloc_chaö_lök
(
p
);

168 i‡(
˛
 =
NULL
) {

169  
NULL
;

172 
˛
->
buf
 = 
	`ngx_ˇŒoc_buf
(
p
);

173 i‡(
˛
->
buf
 =
NULL
) {

174  
NULL
;

177 
˛
->
√xt
 = 
NULL
;

179  
˛
;

180 
	}
}

184 
	$ngx_chaö_upd©e_chaös
(
ngx_chaö_t
 **
‰ì
,Çgx_chaö_à**
busy
,

185 
ngx_chaö_t
 **
out
, 
ngx_buf_èg_t
 
èg
)

187 
ngx_chaö_t
 *
˛
;

189 i‡(*
busy
 =
NULL
) {

190 *
busy
 = *
out
;

193 
˛
 = *
busy
; cl->
√xt
; cl = cl->next) { }

195 
˛
->
√xt
 = *
out
;

198 *
out
 = 
NULL
;

200 *
busy
) {

201 i‡(
	`ngx_buf_size
((*
busy
)->
buf
) != 0) {

205 i‡((*
busy
)->
buf
->
èg
 !=Åag) {

206 *
busy
 = (*busy)->
√xt
;

210 (*
busy
)->
buf
->
pos
 = (*busy)->buf->
°¨t
;

211 (*
busy
)->
buf
->
œ°
 = (*busy)->buf->
°¨t
;

213 
˛
 = *
busy
;

214 *
busy
 = 
˛
->
√xt
;

215 
˛
->
√xt
 = *
‰ì
;

216 *
‰ì
 = 
˛
;

218 
	}
}

	@ngx_buf.h

8 #i‚de‡
_NGX_BUF_H_INCLUDED_


9 
	#_NGX_BUF_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 * 
	tngx_buf_èg_t
;

18 
ngx_buf_s
 
	tngx_buf_t
;

20 
	sngx_buf_s
 {

21 
u_ch¨
 *
	mpos
;

22 
u_ch¨
 *
	mœ°
;

23 
off_t
 
	mfûe_pos
;

24 
off_t
 
	mfûe_œ°
;

26 
u_ch¨
 *
	m°¨t
;

27 
u_ch¨
 *
	míd
;

28 
ngx_buf_èg_t
 
	mèg
;

29 
ngx_fûe_t
 *
	mfûe
;

30 
ngx_buf_t
 *
	mshadow
;

34 
	mãmp‹¨y
:1;

40 
	mmem‹y
:1;

43 
	mmm≠
:1;

45 
	mªcy˛ed
:1;

46 
	mö_fûe
:1;

47 
	mÊush
:1;

48 
	msync
:1;

49 
	mœ°_buf
:1;

50 
	mœ°_ö_chaö
:1;

52 
	mœ°_shadow
:1;

53 
	mãmp_fûe
:1;

55  
	mnum
;

59 
	sngx_chaö_s
 {

60 
ngx_buf_t
 *
	mbuf
;

61 
ngx_chaö_t
 *
	m√xt
;

66 
ngx_öt_t
 
	mnum
;

67 
size_t
 
	msize
;

68 } 
	tngx_bufs_t
;

71 
ngx_ouçut_chaö_˘x_s
 
	tngx_ouçut_chaö_˘x_t
;

73 
	$ngx_öt_t
 (*
	tngx_ouçut_chaö_fûãr_±
)(*
	t˘x
, 
	tngx_chaö_t
 *
	tö
);

75 #i‡(
NGX_HAVE_FILE_AIO
)

76 (*
	tngx_ouçut_chaö_aio_±
)(
	tngx_ouçut_chaö_˘x_t
 *
	t˘x
,

77 
	tngx_fûe_t
 *
	tfûe
);

80 
	sngx_ouçut_chaö_˘x_s
 {

81 
ngx_buf_t
 *
buf
;

82 
ngx_chaö_t
 *
ö
;

83 
ngx_chaö_t
 *
‰ì
;

84 
ngx_chaö_t
 *
busy
;

86 
£ndfûe
:1;

87 
dúe˘io
:1;

88 #i‡(
NGX_HAVE_ALIGNED_DIRECTIO
)

89 
u«lig√d
:1;

91 
√ed_ö_mem‹y
:1;

92 
√ed_ö_ãmp
:1;

93 #i‡(
NGX_HAVE_FILE_AIO
)

94 
aio
:1;

96 
ngx_ouçut_chaö_aio_±
 
aio_h™dÀr
;

99 
off_t
 
Æignmít
;

101 
ngx_poﬁ_t
 *
poﬁ
;

102 
ngx_öt_t
 
Æloˇãd
;

103 
ngx_bufs_t
 
bufs
;

104 
ngx_buf_èg_t
 
èg
;

106 
ngx_ouçut_chaö_fûãr_±
 
ouçut_fûãr
;

107 *
fûãr_˘x
;

112 
ngx_chaö_t
 *
out
;

113 
ngx_chaö_t
 **
œ°
;

114 
ngx_c⁄√˘i⁄_t
 *
c⁄√˘i⁄
;

115 
ngx_poﬁ_t
 *
poﬁ
;

116 
off_t
 
limô
;

117 } 
	tngx_chaö_wrôî_˘x_t
;

120 
	#NGX_CHAIN_ERROR
 (
ngx_chaö_t
 *Ë
NGX_ERROR


	)

123 
	#ngx_buf_ö_mem‹y
(
b
Ë(b->
ãmp‹¨y
 || b->
mem‹y
 || b->
mm≠
)

	)

124 
	#ngx_buf_ö_mem‹y_⁄ly
(
b
Ë(
	`ngx_buf_ö_mem‹y
(bË&& !b->
ö_fûe
)

	)

126 
	#ngx_buf_•ecül
(
b
) \

127 ((
b
->
Êush
 || b->
œ°_buf
 || b->
sync
) \

128 && !
	`ngx_buf_ö_mem‹y
(
b
Ë&& !b->
ö_fûe
)

	)

130 
	#ngx_buf_sync_⁄ly
(
b
) \

131 (
b
->
sync
 \

132 && !
	`ngx_buf_ö_mem‹y
(
b
Ë&& !b->
ö_fûe
 && !b->
Êush
 && !b->
œ°_buf
)

	)

134 
	#ngx_buf_size
(
b
) \

135 (
	`ngx_buf_ö_mem‹y
(
b
Ë? (
off_t
Ë(b->
œ°
 - b->
pos
): \

136 (
b
->
fûe_œ°
 - b->
fûe_pos
))

	)

138 
ngx_buf_t
 *
	`ngx_¸óã_ãmp_buf
(
ngx_poﬁ_t
 *
poﬁ
, 
size_t
 
size
);

139 
ngx_chaö_t
 *
	`ngx_¸óã_chaö_of_bufs
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_bufs_t
 *
bufs
);

142 
	#ngx_Æloc_buf
(
poﬁ
Ë
	`ngx_∑Œoc
’oﬁ, (
ngx_buf_t
))

	)

143 
	#ngx_ˇŒoc_buf
(
poﬁ
Ë
	`ngx_pˇŒoc
’oﬁ, (
ngx_buf_t
))

	)

145 
ngx_chaö_t
 *
	`ngx_Æloc_chaö_lök
(
ngx_poﬁ_t
 *
poﬁ
);

146 
	#ngx_‰ì_chaö
(
poﬁ
, 
˛
) \

147 
˛
->
√xt
 = 
poﬁ
->
chaö
; \

148 
poﬁ
->
chaö
 = 
˛


	)

152 
ngx_öt_t
 
	`ngx_ouçut_chaö
(
ngx_ouçut_chaö_˘x_t
 *
˘x
, 
ngx_chaö_t
 *
ö
);

153 
ngx_öt_t
 
	`ngx_chaö_wrôî
(*
˘x
, 
ngx_chaö_t
 *
ö
);

155 
ngx_öt_t
 
	`ngx_chaö_add_c›y
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_chaö_t
 **
chaö
,

156 
ngx_chaö_t
 *
ö
);

157 
ngx_chaö_t
 *
	`ngx_chaö_gë_‰ì_buf
(
ngx_poﬁ_t
 *
p
,Çgx_chaö_à**
‰ì
);

158 
	`ngx_chaö_upd©e_chaös
(
ngx_chaö_t
 **
‰ì
,Çgx_chaö_à**
busy
,

159 
ngx_chaö_t
 **
out
, 
ngx_buf_èg_t
 
èg
);

	@ngx_conf_file.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

11 
	#NGX_CONF_BUFFER
 4096

	)

13 
ngx_öt_t
 
ngx_c⁄f_h™dÀr
(
ngx_c⁄f_t
 *
cf
,Çgx_öt_à
œ°
);

14 
ngx_öt_t
 
ngx_c⁄f_ªad_tokí
(
ngx_c⁄f_t
 *
cf
);

15 *
ngx_c⁄f_ö˛ude
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

16 
ngx_öt_t
 
ngx_c⁄f_ã°_fuŒ_«me
(
ngx_°r_t
 *
«me
);

17 
ngx_c⁄f_Êush_fûes
(
ngx_cy˛e_t
 *
cy˛e
);

20 
ngx_comm™d_t
 
	gngx_c⁄f_comm™ds
[] = {

22 { 
ngx_°rög
("include"),

23 
NGX_ANY_CONF
|
NGX_CONF_TAKE1
,

24 
ngx_c⁄f_ö˛ude
,

27 
NULL
 },

29 
ngx_nuŒ_comm™d


33 
ngx_moduÀ_t
 
	gngx_c⁄f_moduÀ
 = {

34 
NGX_MODULE_V1
,

35 
NULL
,

36 
ngx_c⁄f_comm™ds
,

37 
NGX_CONF_MODULE
,

38 
NULL
,

39 
NULL
,

40 
NULL
,

41 
NULL
,

42 
NULL
,

43 
ngx_c⁄f_Êush_fûes
,

44 
NULL
,

45 
NGX_MODULE_V1_PADDING


51 
ngx_uöt_t
 
	g¨gumít_numbî
[] = {

52 
NGX_CONF_NOARGS
,

53 
NGX_CONF_TAKE1
,

54 
NGX_CONF_TAKE2
,

55 
NGX_CONF_TAKE3
,

56 
NGX_CONF_TAKE4
,

57 
NGX_CONF_TAKE5
,

58 
NGX_CONF_TAKE6
,

59 
NGX_CONF_TAKE7


64 
	$ngx_c⁄f_∑øm
(
ngx_c⁄f_t
 *
cf
)

66 *
rv
;

67 
ngx_°r_t
 *
∑øm
;

68 
ngx_buf_t
 
b
;

69 
ngx_c⁄f_fûe_t
 
c⁄f_fûe
;

71 
∑øm
 = &
cf
->
cy˛e
->
c⁄f_∑øm
;

73 i‡(
∑øm
->
Àn
 == 0) {

74  
NGX_CONF_OK
;

77 
	`ngx_memzîo
(&
c⁄f_fûe
, (
ngx_c⁄f_fûe_t
));

79 
	`ngx_memzîo
(&
b
, (
ngx_buf_t
));

81 
b
.
°¨t
 = 
∑øm
->
d©a
;

82 
b
.
pos
 = 
∑øm
->
d©a
;

83 
b
.
œ°
 = 
∑øm
->
d©a
 +Ö¨am->
Àn
;

84 
b
.
íd
 = b.
œ°
;

85 
b
.
ãmp‹¨y
 = 1;

87 
c⁄f_fûe
.
fûe
.
fd
 = 
NGX_INVALID_FILE
;

88 
c⁄f_fûe
.
fûe
.
«me
.
d©a
 = 
NULL
;

89 
c⁄f_fûe
.
löe
 = 0;

91 
cf
->
c⁄f_fûe
 = &conf_file;

92 
cf
->
c⁄f_fûe
->
buf„r
 = &
b
;

94 
rv
 = 
	`ngx_c⁄f_∑r£
(
cf
, 
NULL
);

96 
cf
->
c⁄f_fûe
 = 
NULL
;

98  
rv
;

99 
	}
}

103 
	$ngx_c⁄f_∑r£
(
ngx_c⁄f_t
 *
cf
, 
ngx_°r_t
 *
fûíame
)

105 *
rv
;

106 
ngx_fd_t
 
fd
;

107 
ngx_öt_t
 
rc
;

108 
ngx_buf_t
 
buf
;

109 
ngx_c⁄f_fûe_t
 *
¥ev
, 
c⁄f_fûe
;

111 
∑r£_fûe
 = 0,

112 
∑r£_block
,

113 
∑r£_∑øm


114 } 
ty≥
;

116 #i‡(
NGX_SUPPRESS_WARN
)

117 
fd
 = 
NGX_INVALID_FILE
;

118 
¥ev
 = 
NULL
;

121 i‡(
fûíame
) {

125 
fd
 = 
	`ngx_›í_fûe
(
fûíame
->
d©a
, 
NGX_FILE_RDONLY
, 
NGX_FILE_OPEN
, 0);

126 i‡(
fd
 =
NGX_INVALID_FILE
) {

127 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 
ngx_î∫o
,

128 
ngx_›í_fûe_n
 " \"%s\" failed",

129 
fûíame
->
d©a
);

130  
NGX_CONF_ERROR
;

133 
¥ev
 = 
cf
->
c⁄f_fûe
;

135 
cf
->
c⁄f_fûe
 = &conf_file;

137 i‡(
	`ngx_fd_öfo
(
fd
, &
cf
->
c⁄f_fûe
->
fûe
.
öfo
) == -1) {

138 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cf
->
log
, 
ngx_î∫o
,

139 
ngx_fd_öfo_n
 " \"%s\" faûed", 
fûíame
->
d©a
);

142 
cf
->
c⁄f_fûe
->
buf„r
 = &
buf
;

144 
buf
.
°¨t
 = 
	`ngx_Æloc
(
NGX_CONF_BUFFER
, 
cf
->
log
);

145 i‡(
buf
.
°¨t
 =
NULL
) {

146 
Áûed
;

149 
buf
.
pos
 = buf.
°¨t
;

150 
buf
.
œ°
 = buf.
°¨t
;

151 
buf
.
íd
 = buf.
œ°
 + 
NGX_CONF_BUFFER
;

152 
buf
.
ãmp‹¨y
 = 1;

154 
cf
->
c⁄f_fûe
->
fûe
.
fd
 = fd;

155 
cf
->
c⁄f_fûe
->
fûe
.
«me
.
Àn
 = 
fûíame
->len;

156 
cf
->
c⁄f_fûe
->
fûe
.
«me
.
d©a
 = 
fûíame
->data;

157 
cf
->
c⁄f_fûe
->
fûe
.
off£t
 = 0;

158 
cf
->
c⁄f_fûe
->
fûe
.
log
 = cf->log;

159 
cf
->
c⁄f_fûe
->
löe
 = 1;

161 
ty≥
 = 
∑r£_fûe
;

163 } i‡(
cf
->
c⁄f_fûe
->
fûe
.
fd
 !
NGX_INVALID_FILE
) {

165 
ty≥
 = 
∑r£_block
;

168 
ty≥
 = 
∑r£_∑øm
;

173 
rc
 = 
	`ngx_c⁄f_ªad_tokí
(
cf
);

185 i‡(
rc
 =
NGX_ERROR
) {

186 
d⁄e
;

189 i‡(
rc
 =
NGX_CONF_BLOCK_DONE
) {

191 i‡(
ty≥
 !
∑r£_block
) {

192 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0, "unexpected \"}\"");

193 
Áûed
;

196 
d⁄e
;

199 i‡(
rc
 =
NGX_CONF_FILE_DONE
) {

201 i‡(
ty≥
 =
∑r£_block
) {

202 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

204 
Áûed
;

207 
d⁄e
;

210 i‡(
rc
 =
NGX_CONF_BLOCK_START
) {

212 i‡(
ty≥
 =
∑r£_∑øm
) {

213 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

216 
Áûed
;

222 i‡(
cf
->
h™dÀr
) {

229 
rv
 = (*
cf
->
h™dÀr
)(cf, 
NULL
, cf->
h™dÀr_c⁄f
);

230 i‡(
rv
 =
NGX_CONF_OK
) {

234 i‡(
rv
 =
NGX_CONF_ERROR
) {

235 
Áûed
;

238 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0, 
rv
);

240 
Áûed
;

244 
rc
 = 
	`ngx_c⁄f_h™dÀr
(
cf
,Ñc);

246 i‡(
rc
 =
NGX_ERROR
) {

247 
Áûed
;

251 
Áûed
:

253 
rc
 = 
NGX_ERROR
;

255 
d⁄e
:

257 i‡(
fûíame
) {

258 i‡(
cf
->
c⁄f_fûe
->
buf„r
->
°¨t
) {

259 
	`ngx_‰ì
(
cf
->
c⁄f_fûe
->
buf„r
->
°¨t
);

262 i‡(
	`ngx_˛o£_fûe
(
fd
Ë=
NGX_FILE_ERROR
) {

263 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cf
->
log
, 
ngx_î∫o
,

264 
ngx_˛o£_fûe_n
 " %s failed",

265 
fûíame
->
d©a
);

266  
NGX_CONF_ERROR
;

269 
cf
->
c⁄f_fûe
 = 
¥ev
;

272 i‡(
rc
 =
NGX_ERROR
) {

273  
NGX_CONF_ERROR
;

276  
NGX_CONF_OK
;

277 
	}
}

280 
ngx_öt_t


281 
	$ngx_c⁄f_h™dÀr
(
ngx_c⁄f_t
 *
cf
, 
ngx_öt_t
 
œ°
)

283 *
rv
;

284 *
c⁄f
, **
c⁄Â
;

285 
ngx_uöt_t
 
i
, 
mu…i
;

286 
ngx_°r_t
 *
«me
;

287 
ngx_comm™d_t
 *
cmd
;

289 
«me
 = 
cf
->
¨gs
->
ñts
;

291 
mu…i
 = 0;

293 
i
 = 0; 
ngx_moduÀs
[i]; i++) {

297 i‡(
ngx_moduÀs
[
i
]->
ty≥
 !
NGX_CONF_MODULE


298 && 
ngx_moduÀs
[
i
]->
ty≥
 !
cf
->
moduÀ_ty≥
)

303 
cmd
 = 
ngx_moduÀs
[
i
]->
comm™ds
;

304 i‡(
cmd
 =
NULL
) {

308  ; 
cmd
->
«me
.
Àn
; cmd++) {

310 i‡(
«me
->
Àn
 !
cmd
->name.len) {

314 i‡(
	`ngx_°rcmp
(
«me
->
d©a
, 
cmd
->name.data) != 0) {

321 i‡(!(
cmd
->
ty≥
 & 
cf
->
cmd_ty≥
)) {

322 i‡(
cmd
->
ty≥
 & 
NGX_CONF_MULTI
) {

323 
mu…i
 = 1;

327 
nŸ_Ælowed
;

330 i‡(!(
cmd
->
ty≥
 & 
NGX_CONF_BLOCK
Ë&& 
œ°
 !
NGX_OK
) {

331 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

333 
«me
->
d©a
);

334  
NGX_ERROR
;

337 i‡((
cmd
->
ty≥
 & 
NGX_CONF_BLOCK
Ë&& 
œ°
 !
NGX_CONF_BLOCK_START
) {

338 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

340 
«me
->
d©a
);

341  
NGX_ERROR
;

346 i‡(!(
cmd
->
ty≥
 & 
NGX_CONF_ANY
)) {

348 i‡(
cmd
->
ty≥
 & 
NGX_CONF_FLAG
) {

350 i‡(
cf
->
¨gs
->
√…s
 != 2) {

351 
övÆid
;

354 } i‡(
cmd
->
ty≥
 & 
NGX_CONF_1MORE
) {

356 i‡(
cf
->
¨gs
->
√…s
 < 2) {

357 
övÆid
;

360 } i‡(
cmd
->
ty≥
 & 
NGX_CONF_2MORE
) {

362 i‡(
cf
->
¨gs
->
√…s
 < 3) {

363 
övÆid
;

366 } i‡(
cf
->
¨gs
->
√…s
 > 
NGX_CONF_MAX_ARGS
) {

368 
övÆid
;

370 } i‡(!(
cmd
->
ty≥
 & 
¨gumít_numbî
[
cf
->
¨gs
->
√…s
 - 1]))

372 
övÆid
;

378 
c⁄f
 = 
NULL
;

380 i‡(
cmd
->
ty≥
 & 
NGX_DIRECT_CONF
) {

381 
c⁄f
 = ((**Ë
cf
->
˘x
)[
ngx_moduÀs
[
i
]->
ödex
];

383 } i‡(
cmd
->
ty≥
 & 
NGX_MAIN_CONF
) {

384 
c⁄f
 = &(((**Ë
cf
->
˘x
)[
ngx_moduÀs
[
i
]->
ödex
]);

386 } i‡(
cf
->
˘x
) {

387 
c⁄Â
 = *(**Ë((*Ë
cf
->
˘x
 + 
cmd
->
c⁄f
);

389 i‡(
c⁄Â
) {

390 
c⁄f
 = 
c⁄Â
[
ngx_moduÀs
[
i
]->
˘x_ödex
];

394 
rv
 = 
cmd
->
	`£t
(
cf
, cmd, 
c⁄f
);

396 i‡(
rv
 =
NGX_CONF_OK
) {

397  
NGX_OK
;

400 i‡(
rv
 =
NGX_CONF_ERROR
) {

401  
NGX_ERROR
;

404 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

405 "\"%s\" dúe˘ivê%s", 
«me
->
d©a
, 
rv
);

407  
NGX_ERROR
;

411 i‡(
mu…i
 == 0) {

412 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

413 "unknow¿dúe˘ivê\"%s\"", 
«me
->
d©a
);

415  
NGX_ERROR
;

418 
nŸ_Ælowed
:

420 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

421 "\"%s\" dúe˘ivêi†nŸáŒowed hîe", 
«me
->
d©a
);

422  
NGX_ERROR
;

424 
övÆid
:

426 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

428 
«me
->
d©a
);

430  
NGX_ERROR
;

431 
	}
}

434 
ngx_öt_t


435 
	$ngx_c⁄f_ªad_tokí
(
ngx_c⁄f_t
 *
cf
)

437 
u_ch¨
 *
°¨t
, 
ch
, *
§c
, *
d°
;

438 
off_t
 
fûe_size
;

439 
size_t
 
Àn
;

440 
ssize_t
 
n
, 
size
;

441 
ngx_uöt_t
 
found
, 
√ed_•a˚
, 
œ°_•a˚
, 
sh¨p_commít
, 
v¨übÀ
;

442 
ngx_uöt_t
 
quŸed
, 
s_quŸed
, 
d_quŸed
, 
°¨t_löe
;

443 
ngx_°r_t
 *
w‹d
;

444 
ngx_buf_t
 *
b
;

446 
found
 = 0;

447 
√ed_•a˚
 = 0;

448 
œ°_•a˚
 = 1;

449 
sh¨p_commít
 = 0;

450 
v¨übÀ
 = 0;

451 
quŸed
 = 0;

452 
s_quŸed
 = 0;

453 
d_quŸed
 = 0;

455 
cf
->
¨gs
->
√…s
 = 0;

456 
b
 = 
cf
->
c⁄f_fûe
->
buf„r
;

457 
°¨t
 = 
b
->
pos
;

458 
°¨t_löe
 = 
cf
->
c⁄f_fûe
->
löe
;

460 
fûe_size
 = 
	`ngx_fûe_size
(&
cf
->
c⁄f_fûe
->
fûe
.
öfo
);

464 i‡(
b
->
pos
 >b->
œ°
) {

466 i‡(
cf
->
c⁄f_fûe
->
fûe
.
off£t
 >
fûe_size
) {

468 i‡(
cf
->
¨gs
->
√…s
 > 0) {

470 i‡(
cf
->
c⁄f_fûe
->
fûe
.
fd
 =
NGX_INVALID_FILE
) {

471 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

474  
NGX_ERROR
;

477 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

480  
NGX_ERROR
;

483  
NGX_CONF_FILE_DONE
;

486 
Àn
 = 
b
->
pos
 - 
°¨t
;

488 i‡(
Àn
 =
NGX_CONF_BUFFER
) {

489 
cf
->
c⁄f_fûe
->
löe
 = 
°¨t_löe
;

491 i‡(
d_quŸed
) {

492 
ch
 = '"';

494 } i‡(
s_quŸed
) {

495 
ch
 = '\'';

498 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

500 10, 
°¨t
);

501  
NGX_ERROR
;

504 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

506 "missögÅîmö©ög \"%c\" ch¨a˘î", 
ch
);

507  
NGX_ERROR
;

510 i‡(
Àn
) {

511 
	`ngx_memmove
(
b
->
°¨t
, sèπ, 
Àn
);

514 
size
 = (
ssize_t
Ë(
fûe_size
 - 
cf
->
c⁄f_fûe
->
fûe
.
off£t
);

516 i‡(
size
 > 
b
->
íd
 - (b->
°¨t
 + 
Àn
)) {

517 
size
 = 
b
->
íd
 - (b->
°¨t
 + 
Àn
);

520 
n
 = 
	`ngx_ªad_fûe
(&
cf
->
c⁄f_fûe
->
fûe
, 
b
->
°¨t
 + 
Àn
, 
size
,

521 
cf
->
c⁄f_fûe
->
fûe
.
off£t
);

523 i‡(
n
 =
NGX_ERROR
) {

524  
NGX_ERROR
;

527 i‡(
n
 !
size
) {

528 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

529 
ngx_ªad_fûe_n
 "Ñeturned "

531 
n
, 
size
);

532  
NGX_ERROR
;

535 
b
->
pos
 = b->
°¨t
 + 
Àn
;

536 
b
->
œ°
 = b->
pos
 + 
n
;

537 
°¨t
 = 
b
->start;

540 
ch
 = *
b
->
pos
++;

542 i‡(
ch
 =
LF
) {

543 
cf
->
c⁄f_fûe
->
löe
++;

545 i‡(
sh¨p_commít
) {

546 
sh¨p_commít
 = 0;

550 i‡(
sh¨p_commít
) {

554 i‡(
quŸed
) {

555 
quŸed
 = 0;

559 i‡(
√ed_•a˚
) {

560 i‡(
ch
 =' ' || ch ='\t' || ch =
CR
 || ch =
LF
) {

561 
œ°_•a˚
 = 1;

562 
√ed_•a˚
 = 0;

566 i‡(
ch
 == ';') {

567  
NGX_OK
;

570 i‡(
ch
 == '{') {

571  
NGX_CONF_BLOCK_START
;

574 i‡(
ch
 == ')') {

575 
œ°_•a˚
 = 1;

576 
√ed_•a˚
 = 0;

579 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

580 "u√x≥˘ed \"%c\"", 
ch
);

581  
NGX_ERROR
;

585 i‡(
œ°_•a˚
) {

586 i‡(
ch
 =' ' || ch ='\t' || ch =
CR
 || ch =
LF
) {

590 
°¨t
 = 
b
->
pos
 - 1;

591 
°¨t_löe
 = 
cf
->
c⁄f_fûe
->
löe
;

593 
ch
) {

597 i‡(
cf
->
¨gs
->
√…s
 == 0) {

598 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

599 "u√x≥˘ed \"%c\"", 
ch
);

600  
NGX_ERROR
;

603 i‡(
ch
 == '{') {

604  
NGX_CONF_BLOCK_START
;

607  
NGX_OK
;

610 i‡(
cf
->
¨gs
->
√…s
 != 0) {

611 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

613  
NGX_ERROR
;

616  
NGX_CONF_BLOCK_DONE
;

619 
sh¨p_commít
 = 1;

623 
quŸed
 = 1;

624 
œ°_•a˚
 = 0;

628 
°¨t
++;

629 
d_quŸed
 = 1;

630 
œ°_•a˚
 = 0;

634 
°¨t
++;

635 
s_quŸed
 = 1;

636 
œ°_•a˚
 = 0;

640 
œ°_•a˚
 = 0;

644 i‡(
ch
 ='{' && 
v¨übÀ
) {

648 
v¨übÀ
 = 0;

650 i‡(
ch
 == '\\') {

651 
quŸed
 = 1;

655 i‡(
ch
 == '$') {

656 
v¨übÀ
 = 1;

660 i‡(
d_quŸed
) {

661 i‡(
ch
 == '"') {

662 
d_quŸed
 = 0;

663 
√ed_•a˚
 = 1;

664 
found
 = 1;

667 } i‡(
s_quŸed
) {

668 i‡(
ch
 == '\'') {

669 
s_quŸed
 = 0;

670 
√ed_•a˚
 = 1;

671 
found
 = 1;

674 } i‡(
ch
 =' ' || ch ='\t' || ch =
CR
 || ch =
LF


675 || 
ch
 == ';' || ch == '{')

677 
œ°_•a˚
 = 1;

678 
found
 = 1;

681 i‡(
found
) {

682 
w‹d
 = 
	`ngx_¨øy_push
(
cf
->
¨gs
);

683 i‡(
w‹d
 =
NULL
) {

684  
NGX_ERROR
;

687 
w‹d
->
d©a
 = 
	`ngx_≤Æloc
(
cf
->
poﬁ
, 
b
->
pos
 - 
°¨t
 + 1);

688 i‡(
w‹d
->
d©a
 =
NULL
) {

689  
NGX_ERROR
;

692 
d°
 = 
w‹d
->
d©a
, 
§c
 = 
°¨t
, 
Àn
 = 0;

693 
§c
 < 
b
->
pos
 - 1;

694 
Àn
++)

696 i‡(*
§c
 == '\\') {

697 
§c
[1]) {

701 
§c
++;

705 *
d°
++ = '\t';

706 
§c
 += 2;

710 *
d°
++ = '\r';

711 
§c
 += 2;

715 *
d°
++ = '\n';

716 
§c
 += 2;

721 *
d°
++ = *
§c
++;

723 *
d°
 = '\0';

724 
w‹d
->
Àn
 =Üen;

726 i‡(
ch
 == ';') {

727  
NGX_OK
;

730 i‡(
ch
 == '{') {

731  
NGX_CONF_BLOCK_START
;

734 
found
 = 0;

738 
	}
}

742 
	$ngx_c⁄f_ö˛ude
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

744 *
rv
;

745 
ngx_öt_t
 
n
;

746 
ngx_°r_t
 *
vÆue
, 
fûe
, 
«me
;

747 
ngx_glob_t
 
gl
;

749 
vÆue
 = 
cf
->
¨gs
->
ñts
;

750 
fûe
 = 
vÆue
[1];

752 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
cf
->
log
, 0, "ö˛udê%s", 
fûe
.
d©a
);

754 i‡(
	`ngx_c⁄f_fuŒ_«me
(
cf
->
cy˛e
, &
fûe
, 1Ë!
NGX_OK
) {

755  
NGX_CONF_ERROR
;

758 i‡(
	`°Ωbrk
((*Ë
fûe
.
d©a
, "*?["Ë=
NULL
) {

760 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
cf
->
log
, 0, "ö˛udê%s", 
fûe
.
d©a
);

762  
	`ngx_c⁄f_∑r£
(
cf
, &
fûe
);

765 
	`ngx_memzîo
(&
gl
, (
ngx_glob_t
));

767 
gl
.
∑âîn
 = 
fûe
.
d©a
;

768 
gl
.
log
 = 
cf
->log;

769 
gl
.
ã°
 = 1;

771 i‡(
	`ngx_›í_glob
(&
gl
Ë!
NGX_OK
) {

772 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 
ngx_î∫o
,

773 
ngx_›í_glob_n
 " \"%s\" faûed", 
fûe
.
d©a
);

774  
NGX_CONF_ERROR
;

777 
rv
 = 
NGX_CONF_OK
;

780 
n
 = 
	`ngx_ªad_glob
(&
gl
, &
«me
);

782 i‡(
n
 !
NGX_OK
) {

786 
fûe
.
Àn
 = 
«me
.len++;

787 
fûe
.
d©a
 = 
	`ngx_p°rdup
(
cf
->
poﬁ
, &
«me
);

789 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
cf
->
log
, 0, "ö˛udê%s", 
fûe
.
d©a
);

791 
rv
 = 
	`ngx_c⁄f_∑r£
(
cf
, &
fûe
);

793 i‡(
rv
 !
NGX_CONF_OK
) {

798 
	`ngx_˛o£_glob
(&
gl
);

800  
rv
;

801 
	}
}

804 
ngx_öt_t


805 
	$ngx_c⁄f_fuŒ_«me
(
ngx_cy˛e_t
 *
cy˛e
, 
ngx_°r_t
 *
«me
, 
ngx_uöt_t
 
c⁄f_¥efix
)

807 
size_t
 
Àn
;

808 
u_ch¨
 *
p
, *
n
, *
¥efix
;

809 
ngx_öt_t
 
rc
;

811 
rc
 = 
	`ngx_c⁄f_ã°_fuŒ_«me
(
«me
);

813 i‡(
rc
 =
NGX_OK
) {

814  
rc
;

817 i‡(
c⁄f_¥efix
) {

818 
Àn
 = 
cy˛e
->
c⁄f_¥efix
.len;

819 
¥efix
 = 
cy˛e
->
c⁄f_¥efix
.
d©a
;

822 
Àn
 = 
cy˛e
->
¥efix
.len;

823 
¥efix
 = 
cy˛e
->¥efix.
d©a
;

826 #i‡(
NGX_WIN32
)

828 i‡(
rc
 == 2) {

829 
Àn
 = 
rc
;

834 
n
 = 
	`ngx_≤Æloc
(
cy˛e
->
poﬁ
, 
Àn
 + 
«me
->len + 1);

835 i‡(
n
 =
NULL
) {

836  
NGX_ERROR
;

839 
p
 = 
	`ngx_˝ymem
(
n
, 
¥efix
, 
Àn
);

840 
	`ngx_˝y°∫
(
p
, 
«me
->
d©a
,Çame->
Àn
 + 1);

842 
«me
->
Àn
 +=Üen;

843 
«me
->
d©a
 = 
n
;

845  
NGX_OK
;

846 
	}
}

849 
ngx_öt_t


850 
	$ngx_c⁄f_ã°_fuŒ_«me
(
ngx_°r_t
 *
«me
)

852 #i‡(
NGX_WIN32
)

853 
u_ch¨
 
c0
, 
c1
;

855 
c0
 = 
«me
->
d©a
[0];

857 i‡(
«me
->
Àn
 < 2) {

858 i‡(
c0
 == '/') {

862  
NGX_DECLINED
;

865 
c1
 = 
«me
->
d©a
[1];

867 i‡(
c1
 == ':') {

868 
c0
 |= 0x20;

870 i‡((
c0
 >= 'a' && c0 <= 'z')) {

871  
NGX_OK
;

874  
NGX_DECLINED
;

877 i‡(
c1
 == '/') {

878  
NGX_OK
;

881 i‡(
c0
 == '/') {

885  
NGX_DECLINED
;

889 i‡(
«me
->
d©a
[0] == '/') {

890  
NGX_OK
;

893  
NGX_DECLINED
;

896 
	}
}

899 
ngx_›í_fûe_t
 *

900 
	$ngx_c⁄f_›í_fûe
(
ngx_cy˛e_t
 *
cy˛e
, 
ngx_°r_t
 *
«me
)

902 
ngx_°r_t
 
fuŒ
;

903 
ngx_uöt_t
 
i
;

904 
ngx_li°_∑π_t
 *
∑π
;

905 
ngx_›í_fûe_t
 *
fûe
;

907 #i‡(
NGX_SUPPRESS_WARN
)

908 
	`ngx_°r_nuŒ
(&
fuŒ
);

911 i‡(
«me
->
Àn
) {

912 
fuŒ
 = *
«me
;

914 i‡(
	`ngx_c⁄f_fuŒ_«me
(
cy˛e
, &
fuŒ
, 0Ë!
NGX_OK
) {

915  
NULL
;

918 
∑π
 = &
cy˛e
->
›í_fûes
.part;

919 
fûe
 = 
∑π
->
ñts
;

921 
i
 = 0; ; i++) {

923 i‡(
i
 >
∑π
->
√…s
) {

924 i‡(
∑π
->
√xt
 =
NULL
) {

927 
∑π
 =Ö¨t->
√xt
;

928 
fûe
 = 
∑π
->
ñts
;

929 
i
 = 0;

932 i‡(
fuŒ
.
Àn
 !
fûe
[
i
].
«me
.len) {

936 i‡(
	`ngx_°rcmp
(
fuŒ
.
d©a
, 
fûe
[
i
].
«me
.data) == 0) {

937  &
fûe
[
i
];

942 
fûe
 = 
	`ngx_li°_push
(&
cy˛e
->
›í_fûes
);

943 i‡(
fûe
 =
NULL
) {

944  
NULL
;

947 i‡(
«me
->
Àn
) {

948 
fûe
->
fd
 = 
NGX_INVALID_FILE
;

949 
fûe
->
«me
 = 
fuŒ
;

952 
fûe
->
fd
 = 
ngx_°dîr
;

953 
fûe
->
«me
 = *name;

956 
fûe
->
buf„r
 = 
NULL
;

958  
fûe
;

959 
	}
}

963 
	$ngx_c⁄f_Êush_fûes
(
ngx_cy˛e_t
 *
cy˛e
)

965 
ssize_t
 
n
, 
Àn
;

966 
ngx_uöt_t
 
i
;

967 
ngx_li°_∑π_t
 *
∑π
;

968 
ngx_›í_fûe_t
 *
fûe
;

970 
	`ngx_log_debug0
(
NGX_LOG_DEBUG_CORE
, 
cy˛e
->
log
, 0, "flush files");

972 
∑π
 = &
cy˛e
->
›í_fûes
.part;

973 
fûe
 = 
∑π
->
ñts
;

975 
i
 = 0; ; i++) {

977 i‡(
i
 >
∑π
->
√…s
) {

978 i‡(
∑π
->
√xt
 =
NULL
) {

981 
∑π
 =Ö¨t->
√xt
;

982 
fûe
 = 
∑π
->
ñts
;

983 
i
 = 0;

986 
Àn
 = 
fûe
[
i
].
pos
 - fûe[i].
buf„r
;

988 i‡(
fûe
[
i
].
buf„r
 =
NULL
 || 
Àn
 == 0) {

992 
n
 = 
	`ngx_wrôe_fd
(
fûe
[
i
].
fd
, fûe[i].
buf„r
, 
Àn
);

994 i‡(
n
 =
NGX_FILE_ERROR
) {

995 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_î∫o
,

996 
ngx_wrôe_fd_n
 "Åo \"%s\" failed",

997 
fûe
[
i
].
«me
.
d©a
);

999 } i‡(
n
 !
Àn
) {

1000 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 0,

1001 
ngx_wrôe_fd_n
 "Åo \"%s\" was incomplete: %z of %uz",

1002 
fûe
[
i
].
«me
.
d©a
, 
n
, 
Àn
);

1005 
	}
}

1008 
ngx_cde˛


1009 
	$ngx_c⁄f_log_îr‹
(
ngx_uöt_t
 
Àvñ
, 
ngx_c⁄f_t
 *
cf
, 
ngx_îr_t
 
îr
,

1010 c⁄° *
fmt
, ...)

1012 
u_ch¨
 
îr°r
[
NGX_MAX_CONF_ERRSTR
], *
p
, *
œ°
;

1013 
va_li°
 
¨gs
;

1015 
œ°
 = 
îr°r
 + 
NGX_MAX_CONF_ERRSTR
;

1017 
	`va_°¨t
(
¨gs
, 
fmt
);

1018 
p
 = 
	`ngx_v¶¥ötf
(
îr°r
, 
œ°
, 
fmt
, 
¨gs
);

1019 
	`va_íd
(
¨gs
);

1021 i‡(
îr
) {

1022 
p
 = 
	`ngx_log_î∫o
’, 
œ°
, 
îr
);

1025 i‡(
cf
->
c⁄f_fûe
 =
NULL
) {

1026 
	`ngx_log_îr‹
(
Àvñ
, 
cf
->
log
, 0, "%*s", 
p
 - 
îr°r
,Érrstr);

1030 i‡(
cf
->
c⁄f_fûe
->
fûe
.
fd
 =
NGX_INVALID_FILE
) {

1031 
	`ngx_log_îr‹
(
Àvñ
, 
cf
->
log
, 0, "%*s in commandÜine",

1032 
p
 - 
îr°r
,Érrstr);

1036 
	`ngx_log_îr‹
(
Àvñ
, 
cf
->
log
, 0, "%*s in %s:%ui",

1037 
p
 - 
îr°r
,Érrstr,

1038 
cf
->
c⁄f_fûe
->
fûe
.
«me
.
d©a
, cf->c⁄f_fûe->
löe
);

1039 
	}
}

1043 
	$ngx_c⁄f_£t_Êag_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1045 *
p
 = 
c⁄f
;

1047 
ngx_°r_t
 *
vÆue
;

1048 
ngx_Êag_t
 *
Â
;

1049 
ngx_c⁄f_po°_t
 *
po°
;

1051 
Â
 = (
ngx_Êag_t
 *Ë(
p
 + 
cmd
->
off£t
);

1053 i‡(*
Â
 !
NGX_CONF_UNSET
) {

1057 
vÆue
 = 
cf
->
¨gs
->
ñts
;

1059 i‡(
	`ngx_°rˇ£cmp
(
vÆue
[1].
d©a
, (
u_ch¨
 *) "on") == 0) {

1060 *
Â
 = 1;

1062 } i‡(
	`ngx_°rˇ£cmp
(
vÆue
[1].
d©a
, (
u_ch¨
 *) "off") == 0) {

1063 *
Â
 = 0;

1066 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

1069 
vÆue
[1].
d©a
, 
cmd
->
«me
.data);

1070  
NGX_CONF_ERROR
;

1073 i‡(
cmd
->
po°
) {

1074 
po°
 = 
cmd
->post;

1075  
po°
->
	`po°_h™dÀr
(
cf
,Öo°, 
Â
);

1078  
NGX_CONF_OK
;

1079 
	}
}

1083 
	$ngx_c⁄f_£t_°r_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1085 *
p
 = 
c⁄f
;

1087 
ngx_°r_t
 *
fõld
, *
vÆue
;

1088 
ngx_c⁄f_po°_t
 *
po°
;

1090 
fõld
 = (
ngx_°r_t
 *Ë(
p
 + 
cmd
->
off£t
);

1092 i‡(
fõld
->
d©a
) {

1096 
vÆue
 = 
cf
->
¨gs
->
ñts
;

1098 *
fõld
 = 
vÆue
[1];

1100 i‡(
cmd
->
po°
) {

1101 
po°
 = 
cmd
->post;

1102  
po°
->
	`po°_h™dÀr
(
cf
,Öo°, 
fõld
);

1105  
NGX_CONF_OK
;

1106 
	}
}

1110 
	$ngx_c⁄f_£t_°r_¨øy_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1112 *
p
 = 
c⁄f
;

1114 
ngx_°r_t
 *
vÆue
, *
s
;

1115 
ngx_¨øy_t
 **
a
;

1116 
ngx_c⁄f_po°_t
 *
po°
;

1118 
a
 = (
ngx_¨øy_t
 **Ë(
p
 + 
cmd
->
off£t
);

1120 i‡(*
a
 =
NGX_CONF_UNSET_PTR
) {

1121 *
a
 = 
	`ngx_¨øy_¸óã
(
cf
->
poﬁ
, 4, (
ngx_°r_t
));

1122 i‡(*
a
 =
NULL
) {

1123  
NGX_CONF_ERROR
;

1127 
s
 = 
	`ngx_¨øy_push
(*
a
);

1128 i‡(
s
 =
NULL
) {

1129  
NGX_CONF_ERROR
;

1132 
vÆue
 = 
cf
->
¨gs
->
ñts
;

1134 *
s
 = 
vÆue
[1];

1136 i‡(
cmd
->
po°
) {

1137 
po°
 = 
cmd
->post;

1138  
po°
->
	`po°_h™dÀr
(
cf
,Öo°, 
s
);

1141  
NGX_CONF_OK
;

1142 
	}
}

1146 
	$ngx_c⁄f_£t_keyvÆ_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1148 *
p
 = 
c⁄f
;

1150 
ngx_°r_t
 *
vÆue
;

1151 
ngx_¨øy_t
 **
a
;

1152 
ngx_keyvÆ_t
 *
kv
;

1153 
ngx_c⁄f_po°_t
 *
po°
;

1155 
a
 = (
ngx_¨øy_t
 **Ë(
p
 + 
cmd
->
off£t
);

1157 i‡(*
a
 =
NULL
) {

1158 *
a
 = 
	`ngx_¨øy_¸óã
(
cf
->
poﬁ
, 4, (
ngx_keyvÆ_t
));

1159 i‡(*
a
 =
NULL
) {

1160  
NGX_CONF_ERROR
;

1164 
kv
 = 
	`ngx_¨øy_push
(*
a
);

1165 i‡(
kv
 =
NULL
) {

1166  
NGX_CONF_ERROR
;

1169 
vÆue
 = 
cf
->
¨gs
->
ñts
;

1171 
kv
->
key
 = 
vÆue
[1];

1172 
kv
->
vÆue
 = value[2];

1174 i‡(
cmd
->
po°
) {

1175 
po°
 = 
cmd
->post;

1176  
po°
->
	`po°_h™dÀr
(
cf
,Öo°, 
kv
);

1179  
NGX_CONF_OK
;

1180 
	}
}

1184 
	$ngx_c⁄f_£t_num_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1186 *
p
 = 
c⁄f
;

1188 
ngx_öt_t
 *
≈
;

1189 
ngx_°r_t
 *
vÆue
;

1190 
ngx_c⁄f_po°_t
 *
po°
;

1193 
≈
 = (
ngx_öt_t
 *Ë(
p
 + 
cmd
->
off£t
);

1195 i‡(*
≈
 !
NGX_CONF_UNSET
) {

1199 
vÆue
 = 
cf
->
¨gs
->
ñts
;

1200 *
≈
 = 
	`ngx_©oi
(
vÆue
[1].
d©a
, vÆue[1].
Àn
);

1201 i‡(*
≈
 =
NGX_ERROR
) {

1205 i‡(
cmd
->
po°
) {

1206 
po°
 = 
cmd
->post;

1207  
po°
->
	`po°_h™dÀr
(
cf
,Öo°, 
≈
);

1210  
NGX_CONF_OK
;

1211 
	}
}

1215 
	$ngx_c⁄f_£t_size_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1217 *
p
 = 
c⁄f
;

1219 
size_t
 *
•
;

1220 
ngx_°r_t
 *
vÆue
;

1221 
ngx_c⁄f_po°_t
 *
po°
;

1224 
•
 = (
size_t
 *Ë(
p
 + 
cmd
->
off£t
);

1225 i‡(*
•
 !
NGX_CONF_UNSET_SIZE
) {

1229 
vÆue
 = 
cf
->
¨gs
->
ñts
;

1231 *
•
 = 
	`ngx_∑r£_size
(&
vÆue
[1]);

1232 i‡(*
•
 =(
size_t
Ë
NGX_ERROR
) {

1236 i‡(
cmd
->
po°
) {

1237 
po°
 = 
cmd
->post;

1238  
po°
->
	`po°_h™dÀr
(
cf
,Öo°, 
•
);

1241  
NGX_CONF_OK
;

1242 
	}
}

1246 
	$ngx_c⁄f_£t_off_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1248 *
p
 = 
c⁄f
;

1250 
off_t
 *
›
;

1251 
ngx_°r_t
 *
vÆue
;

1252 
ngx_c⁄f_po°_t
 *
po°
;

1255 
›
 = (
off_t
 *Ë(
p
 + 
cmd
->
off£t
);

1256 i‡(*
›
 !
NGX_CONF_UNSET
) {

1260 
vÆue
 = 
cf
->
¨gs
->
ñts
;

1262 *
›
 = 
	`ngx_∑r£_off£t
(&
vÆue
[1]);

1263 i‡(*
›
 =(
off_t
Ë
NGX_ERROR
) {

1267 i‡(
cmd
->
po°
) {

1268 
po°
 = 
cmd
->post;

1269  
po°
->
	`po°_h™dÀr
(
cf
,Öo°, 
›
);

1272  
NGX_CONF_OK
;

1273 
	}
}

1277 
	$ngx_c⁄f_£t_m£c_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1279 *
p
 = 
c⁄f
;

1281 
ngx_m£c_t
 *
m•
;

1282 
ngx_°r_t
 *
vÆue
;

1283 
ngx_c⁄f_po°_t
 *
po°
;

1286 
m•
 = (
ngx_m£c_t
 *Ë(
p
 + 
cmd
->
off£t
);

1287 i‡(*
m•
 !
NGX_CONF_UNSET_MSEC
) {

1291 
vÆue
 = 
cf
->
¨gs
->
ñts
;

1293 *
m•
 = 
	`ngx_∑r£_time
(&
vÆue
[1], 0);

1294 i‡(*
m•
 =(
ngx_m£c_t
Ë
NGX_ERROR
) {

1298 i‡(*
m•
 =(
ngx_m£c_t
Ë
NGX_PARSE_LARGE_TIME
) {

1302 i‡(
cmd
->
po°
) {

1303 
po°
 = 
cmd
->post;

1304  
po°
->
	`po°_h™dÀr
(
cf
,Öo°, 
m•
);

1307  
NGX_CONF_OK
;

1308 
	}
}

1312 
	$ngx_c⁄f_£t_£c_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1314 *
p
 = 
c⁄f
;

1316 
time_t
 *
•
;

1317 
ngx_°r_t
 *
vÆue
;

1318 
ngx_c⁄f_po°_t
 *
po°
;

1321 
•
 = (
time_t
 *Ë(
p
 + 
cmd
->
off£t
);

1322 i‡(*
•
 !
NGX_CONF_UNSET
) {

1326 
vÆue
 = 
cf
->
¨gs
->
ñts
;

1328 *
•
 = 
	`ngx_∑r£_time
(&
vÆue
[1], 1);

1329 i‡(*
•
 =
NGX_ERROR
) {

1333 i‡(*
•
 =
NGX_PARSE_LARGE_TIME
) {

1337 i‡(
cmd
->
po°
) {

1338 
po°
 = 
cmd
->post;

1339  
po°
->
	`po°_h™dÀr
(
cf
,Öo°, 
•
);

1342  
NGX_CONF_OK
;

1343 
	}
}

1347 
	$ngx_c⁄f_£t_bufs_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1349 *
p
 = 
c⁄f
;

1351 
ngx_°r_t
 *
vÆue
;

1352 
ngx_bufs_t
 *
bufs
;

1355 
bufs
 = (
ngx_bufs_t
 *Ë(
p
 + 
cmd
->
off£t
);

1356 i‡(
bufs
->
num
) {

1360 
vÆue
 = 
cf
->
¨gs
->
ñts
;

1362 
bufs
->
num
 = 
	`ngx_©oi
(
vÆue
[1].
d©a
, vÆue[1].
Àn
);

1363 i‡(
bufs
->
num
 =
NGX_ERROR
 || bufs->num == 0) {

1367 
bufs
->
size
 = 
	`ngx_∑r£_size
(&
vÆue
[2]);

1368 i‡(
bufs
->
size
 =(
size_t
Ë
NGX_ERROR
 || bufs->size == 0) {

1372  
NGX_CONF_OK
;

1373 
	}
}

1377 
	$ngx_c⁄f_£t_íum_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1379 *
p
 = 
c⁄f
;

1381 
ngx_uöt_t
 *
≈
, 
i
;

1382 
ngx_°r_t
 *
vÆue
;

1383 
ngx_c⁄f_íum_t
 *
e
;

1385 
≈
 = (
ngx_uöt_t
 *Ë(
p
 + 
cmd
->
off£t
);

1387 i‡(*
≈
 !
NGX_CONF_UNSET_UINT
) {

1391 
vÆue
 = 
cf
->
¨gs
->
ñts
;

1392 
e
 = 
cmd
->
po°
;

1394 
i
 = 0; 
e
[i].
«me
.
Àn
 != 0; i++) {

1395 i‡(
e
[
i
].
«me
.
Àn
 !
vÆue
[1].len

1396 || 
	`ngx_°rˇ£cmp
(
e
[
i
].
«me
.
d©a
, 
vÆue
[1].data) != 0)

1401 *
≈
 = 
e
[
i
].
vÆue
;

1403  
NGX_CONF_OK
;

1406 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_WARN
, 
cf
, 0,

1407 "övÆid vÆuê\"%s\"", 
vÆue
[1].
d©a
);

1409  
NGX_CONF_ERROR
;

1410 
	}
}

1414 
	$ngx_c⁄f_£t_bômask_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1416 *
p
 = 
c⁄f
;

1418 
ngx_uöt_t
 *
≈
, 
i
, 
m
;

1419 
ngx_°r_t
 *
vÆue
;

1420 
ngx_c⁄f_bômask_t
 *
mask
;

1423 
≈
 = (
ngx_uöt_t
 *Ë(
p
 + 
cmd
->
off£t
);

1424 
vÆue
 = 
cf
->
¨gs
->
ñts
;

1425 
mask
 = 
cmd
->
po°
;

1427 
i
 = 1; i < 
cf
->
¨gs
->
√…s
; i++) {

1428 
m
 = 0; 
mask
[m].
«me
.
Àn
 != 0; m++) {

1430 i‡(
mask
[
m
].
«me
.
Àn
 !
vÆue
[
i
].len

1431 || 
	`ngx_°rˇ£cmp
(
mask
[
m
].
«me
.
d©a
, 
vÆue
[
i
].data) != 0)

1436 i‡(*
≈
 & 
mask
[
m
].mask) {

1437 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_WARN
, 
cf
, 0,

1438 "du∂iˇã vÆuê\"%s\"", 
vÆue
[
i
].
d©a
);

1441 *
≈
 |
mask
[
m
].mask;

1447 i‡(
mask
[
m
].
«me
.
Àn
 == 0) {

1448 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_WARN
, 
cf
, 0,

1449 "övÆid vÆuê\"%s\"", 
vÆue
[
i
].
d©a
);

1451  
NGX_CONF_ERROR
;

1455  
NGX_CONF_OK
;

1456 
	}
}

1460 
	$ngx_c⁄f_unsuµ‹ãd
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

1463 
	}
}

1467 
	$ngx_c⁄f_dïªˇãd
(
ngx_c⁄f_t
 *
cf
, *
po°
, *
d©a
)

1469 
ngx_c⁄f_dïªˇãd_t
 *
d
 = 
po°
;

1471 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_WARN
, 
cf
, 0,

1474 
d
->
ﬁd_«me
, d->
√w_«me
);

1476  
NGX_CONF_OK
;

1477 
	}
}

1481 
	$ngx_c⁄f_check_num_bounds
(
ngx_c⁄f_t
 *
cf
, *
po°
, *
d©a
)

1483 
ngx_c⁄f_num_bounds_t
 *
bounds
 = 
po°
;

1484 
ngx_öt_t
 *
≈
 = 
d©a
;

1486 i‡(
bounds
->
high
 == -1) {

1487 i‡(*
≈
 >
bounds
->
low
) {

1488  
NGX_CONF_OK
;

1491 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

1492 "vÆuêmu° bêequÆ o∏m‹êth™ %i", 
bounds
->
low
);

1494  
NGX_CONF_ERROR
;

1497 i‡(*
≈
 >
bounds
->
low
 && *≈ <bounds->
high
) {

1498  
NGX_CONF_OK
;

1501 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

1503 
bounds
->
low
, bounds->
high
);

1505  
NGX_CONF_ERROR
;

1506 
	}
}

	@ngx_conf_file.h

8 #i‚de‡
_NGX_HTTP_CONF_FILE_H_INCLUDED_


9 
	#_NGX_HTTP_CONF_FILE_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

22 
	#NGX_CONF_NOARGS
 0x00000001

	)

23 
	#NGX_CONF_TAKE1
 0x00000002

	)

24 
	#NGX_CONF_TAKE2
 0x00000004

	)

25 
	#NGX_CONF_TAKE3
 0x00000008

	)

26 
	#NGX_CONF_TAKE4
 0x00000010

	)

27 
	#NGX_CONF_TAKE5
 0x00000020

	)

28 
	#NGX_CONF_TAKE6
 0x00000040

	)

29 
	#NGX_CONF_TAKE7
 0x00000080

	)

31 
	#NGX_CONF_MAX_ARGS
 8

	)

33 
	#NGX_CONF_TAKE12
 (
NGX_CONF_TAKE1
|
NGX_CONF_TAKE2
)

	)

34 
	#NGX_CONF_TAKE13
 (
NGX_CONF_TAKE1
|
NGX_CONF_TAKE3
)

	)

36 
	#NGX_CONF_TAKE23
 (
NGX_CONF_TAKE2
|
NGX_CONF_TAKE3
)

	)

38 
	#NGX_CONF_TAKE123
 (
NGX_CONF_TAKE1
|
NGX_CONF_TAKE2
|
NGX_CONF_TAKE3
)

	)

39 
	#NGX_CONF_TAKE1234
 (
NGX_CONF_TAKE1
|
NGX_CONF_TAKE2
|
NGX_CONF_TAKE3
 \

40 |
NGX_CONF_TAKE4
)

	)

42 
	#NGX_CONF_ARGS_NUMBER
 0x000000ff

	)

43 
	#NGX_CONF_BLOCK
 0x00000100

	)

44 
	#NGX_CONF_FLAG
 0x00000200

	)

45 
	#NGX_CONF_ANY
 0x00000400

	)

46 
	#NGX_CONF_1MORE
 0x00000800

	)

47 
	#NGX_CONF_2MORE
 0x00001000

	)

48 
	#NGX_CONF_MULTI
 0x00002000

	)

50 
	#NGX_DIRECT_CONF
 0x00010000

	)

52 
	#NGX_MAIN_CONF
 0x01000000

	)

53 
	#NGX_ANY_CONF
 0x0F000000

	)

57 
	#NGX_CONF_UNSET
 -1

	)

58 
	#NGX_CONF_UNSET_UINT
 (
ngx_uöt_t
Ë-1

	)

59 
	#NGX_CONF_UNSET_PTR
 (*Ë-1

	)

60 
	#NGX_CONF_UNSET_SIZE
 (
size_t
Ë-1

	)

61 
	#NGX_CONF_UNSET_MSEC
 (
ngx_m£c_t
Ë-1

	)

64 
	#NGX_CONF_OK
 
NULL


	)

65 
	#NGX_CONF_ERROR
 (*Ë-1

	)

67 
	#NGX_CONF_BLOCK_START
 1

	)

68 
	#NGX_CONF_BLOCK_DONE
 2

	)

69 
	#NGX_CONF_FILE_DONE
 3

	)

71 
	#NGX_CORE_MODULE
 0x45524F43

	)

72 
	#NGX_CONF_MODULE
 0x464E4F43

	)

75 
	#NGX_MAX_CONF_ERRSTR
 1024

	)

78 
	sngx_comm™d_s
 {

79 
ngx_°r_t
 
	m«me
;

80 
ngx_uöt_t
 
	mty≥
;

81 *(*
	m£t
)(
ngx_c⁄f_t
 *
	mcf
, 
ngx_comm™d_t
 *
	mcmd
, *
	mc⁄f
);

82 
ngx_uöt_t
 
	mc⁄f
;

83 
ngx_uöt_t
 
	moff£t
;

84 *
	mpo°
;

87 
	#ngx_nuŒ_comm™d
 { 
ngx_nuŒ_°rög
, 0, 
NULL
, 0, 0, NULL }

	)

90 
	sngx_›í_fûe_s
 {

91 
ngx_fd_t
 
	mfd
;

92 
ngx_°r_t
 
	m«me
;

94 
u_ch¨
 *
	mbuf„r
;

95 
u_ch¨
 *
	mpos
;

96 
u_ch¨
 *
	mœ°
;

100 
ngx_uöt_t
 
	mÊags
;

102 
ngx_uöt_t
 (*
h™dÀr
)(*
	md©a
, 
ngx_›í_fûe_t
 *
	mfûe
);

103 *
	md©a
;

108 
	#NGX_MODULE_V1
 0, 0, 0, 0, 0, 0, 1

	)

109 
	#NGX_MODULE_V1_PADDING
 0, 0, 0, 0, 0, 0, 0, 0

	)

111 
	sngx_moduÀ_s
 {

112 
ngx_uöt_t
 
	m˘x_ödex
;

113 
ngx_uöt_t
 
	mödex
;

115 
ngx_uöt_t
 
	m•¨e0
;

116 
ngx_uöt_t
 
	m•¨e1
;

117 
ngx_uöt_t
 
	m•¨e2
;

118 
ngx_uöt_t
 
	m•¨e3
;

120 
ngx_uöt_t
 
	mvîsi⁄
;

122 *
	m˘x
;

123 
ngx_comm™d_t
 *
	mcomm™ds
;

124 
ngx_uöt_t
 
	mty≥
;

126 
ngx_öt_t
 (*
öô_ma°î
)(
ngx_log_t
 *
	mlog
);

128 
ngx_öt_t
 (*
öô_moduÀ
)(
ngx_cy˛e_t
 *
	mcy˛e
);

130 
ngx_öt_t
 (*
öô_¥o˚ss
)(
ngx_cy˛e_t
 *
	mcy˛e
);

131 
ngx_öt_t
 (*
öô_thªad
)(
ngx_cy˛e_t
 *
	mcy˛e
);

132 (*
	mexô_thªad
)(
ngx_cy˛e_t
 *
	mcy˛e
);

133 (*
	mexô_¥o˚ss
)(
ngx_cy˛e_t
 *
	mcy˛e
);

135 (*
	mexô_ma°î
)(
ngx_cy˛e_t
 *
	mcy˛e
);

137 
uöçå_t
 
	m•¨e_hook0
;

138 
uöçå_t
 
	m•¨e_hook1
;

139 
uöçå_t
 
	m•¨e_hook2
;

140 
uöçå_t
 
	m•¨e_hook3
;

141 
uöçå_t
 
	m•¨e_hook4
;

142 
uöçå_t
 
	m•¨e_hook5
;

143 
uöçå_t
 
	m•¨e_hook6
;

144 
uöçå_t
 
	m•¨e_hook7
;

149 
ngx_°r_t
 
	m«me
;

150 *(*
	m¸óã_c⁄f
)(
ngx_cy˛e_t
 *
	mcy˛e
);

151 *(*
	möô_c⁄f
)(
ngx_cy˛e_t
 *
	mcy˛e
, *
	mc⁄f
);

152 } 
	tngx_c‹e_moduÀ_t
;

156 
ngx_fûe_t
 
	mfûe
;

157 
ngx_buf_t
 *
	mbuf„r
;

158 
ngx_uöt_t
 
	mlöe
;

159 } 
	tngx_c⁄f_fûe_t
;

162 *(*
	tngx_c⁄f_h™dÀr_±
)(
	tngx_c⁄f_t
 *
	tcf
,

163 
	tngx_comm™d_t
 *
	tdummy
, *
	tc⁄f
);

166 
	sngx_c⁄f_s
 {

167 *
	m«me
;

168 
ngx_¨øy_t
 *
	m¨gs
;

170 
ngx_cy˛e_t
 *
	mcy˛e
;

171 
ngx_poﬁ_t
 *
	mpoﬁ
;

172 
ngx_poﬁ_t
 *
	mãmp_poﬁ
;

173 
ngx_c⁄f_fûe_t
 *
	mc⁄f_fûe
;

174 
ngx_log_t
 *
	mlog
;

176 *
	m˘x
;

177 
ngx_uöt_t
 
	mmoduÀ_ty≥
;

178 
ngx_uöt_t
 
	mcmd_ty≥
;

180 
ngx_c⁄f_h™dÀr_±
 
	mh™dÀr
;

181 *
	mh™dÀr_c⁄f
;

185 *(*
	tngx_c⁄f_po°_h™dÀr_±
Ë(
	tngx_c⁄f_t
 *
	tcf
,

186 *
	td©a
, *
	tc⁄f
);

189 
ngx_c⁄f_po°_h™dÀr_±
 
	mpo°_h™dÀr
;

190 } 
	tngx_c⁄f_po°_t
;

194 
ngx_c⁄f_po°_h™dÀr_±
 
	mpo°_h™dÀr
;

195 *
	mﬁd_«me
;

196 *
	m√w_«me
;

197 } 
	tngx_c⁄f_dïªˇãd_t
;

201 
ngx_c⁄f_po°_h™dÀr_±
 
	mpo°_h™dÀr
;

202 
ngx_öt_t
 
	mlow
;

203 
ngx_öt_t
 
	mhigh
;

204 } 
	tngx_c⁄f_num_bounds_t
;

208 
ngx_°r_t
 
	m«me
;

209 
ngx_uöt_t
 
	mvÆue
;

210 } 
	tngx_c⁄f_íum_t
;

213 
	#NGX_CONF_BITMASK_SET
 1

	)

216 
ngx_°r_t
 
	m«me
;

217 
ngx_uöt_t
 
	mmask
;

218 } 
	tngx_c⁄f_bômask_t
;

222 * 
ngx_c⁄f_dïªˇãd
(
ngx_c⁄f_t
 *
cf
, *
po°
, *
d©a
);

223 *
ngx_c⁄f_check_num_bounds
(
ngx_c⁄f_t
 *
cf
, *
po°
, *
d©a
);

226 
	#ngx_gë_c⁄f
(
c⁄f_˘x
, 
moduÀ
Ëc⁄f_˘x[moduÀ.
ödex
]

	)

230 
	#ngx_c⁄f_öô_vÆue
(
c⁄f
, ) \

231 i‡(
c⁄f
 =
NGX_CONF_UNSET
) { \

232 
c⁄f
 = ; \

233 }

	)

235 
	#ngx_c⁄f_öô_±r_vÆue
(
c⁄f
, ) \

236 i‡(
c⁄f
 =
NGX_CONF_UNSET_PTR
) { \

237 
c⁄f
 = ; \

238 }

	)

240 
	#ngx_c⁄f_öô_uöt_vÆue
(
c⁄f
, ) \

241 i‡(
c⁄f
 =
NGX_CONF_UNSET_UINT
) { \

242 
c⁄f
 = ; \

243 }

	)

245 
	#ngx_c⁄f_öô_size_vÆue
(
c⁄f
, ) \

246 i‡(
c⁄f
 =
NGX_CONF_UNSET_SIZE
) { \

247 
c⁄f
 = ; \

248 }

	)

250 
	#ngx_c⁄f_öô_m£c_vÆue
(
c⁄f
, ) \

251 i‡(
c⁄f
 =
NGX_CONF_UNSET_MSEC
) { \

252 
c⁄f
 = ; \

253 }

	)

255 
	#ngx_c⁄f_mîge_vÆue
(
c⁄f
, 
¥ev
, ) \

256 i‡(
c⁄f
 =
NGX_CONF_UNSET
) { \

257 
c⁄f
 = (
¥ev
 =
NGX_CONF_UNSET
) ?  :Örev; \

258 }

	)

260 
	#ngx_c⁄f_mîge_±r_vÆue
(
c⁄f
, 
¥ev
, ) \

261 i‡(
c⁄f
 =
NGX_CONF_UNSET_PTR
) { \

262 
c⁄f
 = (
¥ev
 =
NGX_CONF_UNSET_PTR
) ?  :Örev; \

263 }

	)

265 
	#ngx_c⁄f_mîge_uöt_vÆue
(
c⁄f
, 
¥ev
, ) \

266 i‡(
c⁄f
 =
NGX_CONF_UNSET_UINT
) { \

267 
c⁄f
 = (
¥ev
 =
NGX_CONF_UNSET_UINT
) ?  :Örev; \

268 }

	)

270 
	#ngx_c⁄f_mîge_m£c_vÆue
(
c⁄f
, 
¥ev
, ) \

271 i‡(
c⁄f
 =
NGX_CONF_UNSET_MSEC
) { \

272 
c⁄f
 = (
¥ev
 =
NGX_CONF_UNSET_MSEC
) ?  :Örev; \

273 }

	)

275 
	#ngx_c⁄f_mîge_£c_vÆue
(
c⁄f
, 
¥ev
, ) \

276 i‡(
c⁄f
 =
NGX_CONF_UNSET
) { \

277 
c⁄f
 = (
¥ev
 =
NGX_CONF_UNSET
) ?  :Örev; \

278 }

	)

280 
	#ngx_c⁄f_mîge_size_vÆue
(
c⁄f
, 
¥ev
, ) \

281 i‡(
c⁄f
 =
NGX_CONF_UNSET_SIZE
) { \

282 
c⁄f
 = (
¥ev
 =
NGX_CONF_UNSET_SIZE
) ?  :Örev; \

283 }

	)

285 
	#ngx_c⁄f_mîge_off_vÆue
(
c⁄f
, 
¥ev
, ) \

286 i‡(
c⁄f
 =
NGX_CONF_UNSET
) { \

287 
c⁄f
 = (
¥ev
 =
NGX_CONF_UNSET
) ?  :Örev; \

288 }

	)

290 
	#ngx_c⁄f_mîge_°r_vÆue
(
c⁄f
, 
¥ev
, ) \

291 i‡(
c⁄f
.
d©a
 =
NULL
) { \

292 i‡(
¥ev
.
d©a
) { \

293 
c⁄f
.
Àn
 = 
¥ev
.len; \

294 
c⁄f
.
d©a
 = 
¥ev
.data; \

296 
c⁄f
.
Àn
 = () - 1; \

297 
c⁄f
.
d©a
 = (
u_ch¨
 *) ; \

299 }

	)

301 
	#ngx_c⁄f_mîge_bufs_vÆue
(
c⁄f
, 
¥ev
, 
deÁu…_num
, 
deÁu…_size
) \

302 i‡(
c⁄f
.
num
 == 0) { \

303 i‡(
¥ev
.
num
) { \

304 
c⁄f
.
num
 = 
¥ev
.num; \

305 
c⁄f
.
size
 = 
¥ev
.size; \

307 
c⁄f
.
num
 = 
deÁu…_num
; \

308 
c⁄f
.
size
 = 
deÁu…_size
; \

310 }

	)

312 
	#ngx_c⁄f_mîge_bômask_vÆue
(
c⁄f
, 
¥ev
, ) \

313 i‡(
c⁄f
 == 0) { \

314 
c⁄f
 = (
¥ev
 == 0) ?  :Örev; \

315 }

	)

318 *
ngx_c⁄f_∑øm
(
ngx_c⁄f_t
 *
cf
);

319 *
ngx_c⁄f_∑r£
(
ngx_c⁄f_t
 *
cf
, 
ngx_°r_t
 *
fûíame
);

322 
ngx_öt_t
 
ngx_c⁄f_fuŒ_«me
(
ngx_cy˛e_t
 *
cy˛e
, 
ngx_°r_t
 *
«me
,

323 
ngx_uöt_t
 
c⁄f_¥efix
);

324 
ngx_›í_fûe_t
 *
ngx_c⁄f_›í_fûe
(
ngx_cy˛e_t
 *
cy˛e
, 
ngx_°r_t
 *
«me
);

325 
ngx_cde˛
 
ngx_c⁄f_log_îr‹
(
ngx_uöt_t
 
Àvñ
, 
ngx_c⁄f_t
 *
cf
,

326 
ngx_îr_t
 
îr
, c⁄° *
fmt
, ...);

329 *
ngx_c⁄f_£t_Êag_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

330 *
ngx_c⁄f_£t_°r_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

331 *
ngx_c⁄f_£t_°r_¨øy_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
,

332 *
c⁄f
);

333 *
ngx_c⁄f_£t_keyvÆ_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

334 *
ngx_c⁄f_£t_num_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

335 *
ngx_c⁄f_£t_size_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

336 *
ngx_c⁄f_£t_off_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

337 *
ngx_c⁄f_£t_m£c_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

338 *
ngx_c⁄f_£t_£c_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

339 *
ngx_c⁄f_£t_bufs_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

340 *
ngx_c⁄f_£t_íum_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

341 *
ngx_c⁄f_£t_bômask_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

344 
ngx_uöt_t
 
ngx_max_moduÀ
;

345 
ngx_moduÀ_t
 *
ngx_moduÀs
[];

	@ngx_config.h

8 #i‚de‡
_NGX_CONFIG_H_INCLUDED_


9 
	#_NGX_CONFIG_H_INCLUDED_


	)

12 
	~<ngx_auto_hódîs.h
>

15 #i‡
deföed
 
__Døg⁄Fly__
 && !deföed 
__FªeBSD__


16 
	#__FªeBSD__
 4

	)

17 
	#__FªeBSD_vîsi⁄
 480101

	)

21 #i‡(
NGX_FREEBSD
)

22 
	~<ngx_‰ìbsd_c⁄fig.h
>

25 #ñi‡(
NGX_LINUX
)

26 
	~<ngx_löux_c⁄fig.h
>

29 #ñi‡(
NGX_SOLARIS
)

30 
	~<ngx_sﬁ¨is_c⁄fig.h
>

33 #ñi‡(
NGX_DARWIN
)

34 
	~<ngx_d¨wö_c⁄fig.h
>

37 #ñi‡(
NGX_WIN32
)

38 
	~<ngx_wö32_c⁄fig.h
>

42 
	~<ngx_posix_c⁄fig.h
>

47 #i‚de‡
NGX_HAVE_SO_SNDLOWAT


48 
	#NGX_HAVE_SO_SNDLOWAT
 1

	)

52 #i‡!(
NGX_WIN32
)

54 
	#ngx_sig«l_hñ≥r
(
n
Ë
SIG
##
	)
n

55 
	#ngx_sig«l_vÆue
(
n
Ë
	`ngx_sig«l_hñ≥r
“)

	)

57 
	#ngx_øndom
 
øndom


	)

60 
	#NGX_SHUTDOWN_SIGNAL
 
QUIT


	)

61 
	#NGX_TERMINATE_SIGNAL
 
TERM


	)

62 
	#NGX_NOACCEPT_SIGNAL
 
WINCH


	)

63 
	#NGX_RECONFIGURE_SIGNAL
 
HUP


	)

65 #i‡(
NGX_LINUXTHREADS
)

66 
	#NGX_REOPEN_SIGNAL
 
INFO


	)

67 
	#NGX_CHANGEBIN_SIGNAL
 
XCPU


	)

69 
	#NGX_REOPEN_SIGNAL
 
USR1


	)

70 
	#NGX_CHANGEBIN_SIGNAL
 
USR2


	)

73 
	#ngx_cde˛


	)

74 
	#ngx_libc_cde˛


	)

78 
öçå_t
 
	tngx_öt_t
;

79 
uöçå_t
 
	tngx_uöt_t
;

80 
öçå_t
 
	tngx_Êag_t
;

83 
	#NGX_INT32_LEN
 ("-2147483648"Ë- 1

	)

84 
	#NGX_INT64_LEN
 ("-9223372036854775808"Ë- 1

	)

86 #i‡(
NGX_PTR_SIZE
 == 4)

87 
	#NGX_INT_T_LEN
 
NGX_INT32_LEN


	)

89 
	#NGX_INT_T_LEN
 
NGX_INT64_LEN


	)

93 #i‚de‡
NGX_ALIGNMENT


94 
	#NGX_ALIGNMENT
 (Ë

	)

97 
	#ngx_Æign
(
d
, 
a
Ë(((dË+ (®- 1)Ë& ~◊ - 1))

	)

98 
	#ngx_Æign_±r
(
p
, 
a
) \

99 (
u_ch¨
 *Ë(((
uöçå_t
Ë(
p
Ë+ ((uöçå_tË
a
 - 1)Ë& ~((uöçå_tË®- 1))

	)

102 
	#ngx_ab‹t
 
ab‹t


	)

106 
	#NGX_INVALID_ARRAY_INDEX
 0x80000000

	)

110 #i‚de‡
ngx_ölöe


111 
	#ngx_ölöe
 
ölöe


	)

114 #i‚de‡
INADDR_NONE


115 
	#INADDR_NONE
 ((Ë-1)

	)

118 #ifde‡
MAXHOSTNAMELEN


119 
	#NGX_MAXHOSTNAMELEN
 
MAXHOSTNAMELEN


	)

121 
	#NGX_MAXHOSTNAMELEN
 256

	)

125 #i‡((
__GNU__
 =2Ë&& (
__GNUC_MINOR__
 < 8))

126 
	#NGX_MAX_UINT32_VALUE
 (
uöt32_t
Ë0xffffffffLL

	)

128 
	#NGX_MAX_UINT32_VALUE
 (
uöt32_t
Ë0xffffffff

	)

131 
	#NGX_MAX_INT32_VALUE
 (
uöt32_t
Ë0x7fffffff

	)

	@ngx_connection.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

10 
	~<ngx_evít.h
>

13 
ngx_os_io_t
 
	gngx_io
;

16 
ngx_døö_c⁄√˘i⁄s
();

19 
ngx_li°íög_t
 *

20 
	$ngx_¸óã_li°íög
(
ngx_c⁄f_t
 *
cf
, *
sockaddr
, 
sockÀn_t
 
sockÀn
)

22 
size_t
 
Àn
;

23 
ngx_li°íög_t
 *
ls
;

24 
sockaddr
 *
ß
;

25 
u_ch¨
 
ãxt
[
NGX_SOCKADDR_STRLEN
];

27 
ls
 = 
	`ngx_¨øy_push
(&
cf
->
cy˛e
->
li°íög
);

28 i‡(
ls
 =
NULL
) {

29  
NULL
;

32 
	`ngx_memzîo
(
ls
, (
ngx_li°íög_t
));

34 
ß
 = 
	`ngx_∑Œoc
(
cf
->
poﬁ
, 
sockÀn
);

35 i‡(
ß
 =
NULL
) {

36  
NULL
;

39 
	`ngx_mem˝y
(
ß
, 
sockaddr
, 
sockÀn
);

41 
ls
->
sockaddr
 = 
ß
;

42 
ls
->
sockÀn
 = socklen;

44 
Àn
 = 
	`ngx_sock_¡›
(
ß
, 
ãxt
, 
NGX_SOCKADDR_STRLEN
, 1);

45 
ls
->
addr_ãxt
.
Àn
 =Üen;

47 
ls
->
sockaddr
->
ß_Ámûy
) {

48 #i‡(
NGX_HAVE_INET6
)

49 
AF_INET6
:

50 
ls
->
addr_ãxt_max_Àn
 = 
NGX_INET6_ADDRSTRLEN
;

53 #i‡(
NGX_HAVE_UNIX_DOMAIN
)

54 
AF_UNIX
:

55 
ls
->
addr_ãxt_max_Àn
 = 
NGX_UNIX_ADDRSTRLEN
;

56 
Àn
++;

59 
AF_INET
:

60 
ls
->
addr_ãxt_max_Àn
 = 
NGX_INET_ADDRSTRLEN
;

63 
ls
->
addr_ãxt_max_Àn
 = 
NGX_SOCKADDR_STRLEN
;

67 
ls
->
addr_ãxt
.
d©a
 = 
	`ngx_≤Æloc
(
cf
->
poﬁ
, 
Àn
);

68 i‡(
ls
->
addr_ãxt
.
d©a
 =
NULL
) {

69  
NULL
;

72 
	`ngx_mem˝y
(
ls
->
addr_ãxt
.
d©a
, 
ãxt
, 
Àn
);

74 
ls
->
fd
 = (
ngx_sockë_t
) -1;

75 
ls
->
ty≥
 = 
SOCK_STREAM
;

77 
ls
->
backlog
 = 
NGX_LISTEN_BACKLOG
;

78 
ls
->
rcvbuf
 = -1;

79 
ls
->
¢dbuf
 = -1;

81 #i‡(
NGX_HAVE_SETFIB
)

82 
ls
->
£tfib
 = -1;

85  
ls
;

86 
	}
}

89 
ngx_öt_t


90 
	$ngx_£t_öhîôed_sockës
(
ngx_cy˛e_t
 *
cy˛e
)

92 
size_t
 
Àn
;

93 
ngx_uöt_t
 
i
;

94 
ngx_li°íög_t
 *
ls
;

95 
sockÀn_t
 
ﬁí
;

96 #i‡(
NGX_HAVE_DEFERRED_ACCEPT
 && 
deföed
 
SO_ACCEPTFILTER
)

97 
ngx_îr_t
 
îr
;

98 
ac˚±_fûãr_¨g
 
af
;

100 #i‡(
NGX_HAVE_DEFERRED_ACCEPT
 && 
deföed
 
TCP_DEFER_ACCEPT
)

101 
timeout
;

104 
ls
 = 
cy˛e
->
li°íög
.
ñts
;

105 
i
 = 0; i < 
cy˛e
->
li°íög
.
√…s
; i++) {

107 
ls
[
i
].
sockaddr
 = 
	`ngx_∑Œoc
(
cy˛e
->
poﬁ
, 
NGX_SOCKADDRLEN
);

108 i‡(
ls
[
i
].
sockaddr
 =
NULL
) {

109  
NGX_ERROR
;

112 
ls
[
i
].
sockÀn
 = 
NGX_SOCKADDRLEN
;

113 i‡(
	`gësock«me
(
ls
[
i
].
fd
,Üs[i].
sockaddr
, &ls[i].
sockÀn
) == -1) {

114 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
cy˛e
->
log
, 
ngx_sockë_î∫o
,

116 "sockë #%d faûed", 
ls
[
i
].
fd
);

117 
ls
[
i
].
ign‹e
 = 1;

121 
ls
[
i
].
sockaddr
->
ß_Ámûy
) {

123 #i‡(
NGX_HAVE_INET6
)

124 
AF_INET6
:

125 
ls
[
i
].
addr_ãxt_max_Àn
 = 
NGX_INET6_ADDRSTRLEN
;

126 
Àn
 = 
NGX_INET6_ADDRSTRLEN
 + (":65535") - 1;

130 #i‡(
NGX_HAVE_UNIX_DOMAIN
)

131 
AF_UNIX
:

132 
ls
[
i
].
addr_ãxt_max_Àn
 = 
NGX_UNIX_ADDRSTRLEN
;

133 
Àn
 = 
NGX_UNIX_ADDRSTRLEN
;

137 
AF_INET
:

138 
ls
[
i
].
addr_ãxt_max_Àn
 = 
NGX_INET_ADDRSTRLEN
;

139 
Àn
 = 
NGX_INET_ADDRSTRLEN
 + (":65535") - 1;

143 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
cy˛e
->
log
, 
ngx_sockë_î∫o
,

145 "™ unsuµ‹ãdÖrŸocﬁ famûy", 
ls
[
i
].
fd
);

146 
ls
[
i
].
ign‹e
 = 1;

150 
ls
[
i
].
addr_ãxt
.
d©a
 = 
	`ngx_≤Æloc
(
cy˛e
->
poﬁ
, 
Àn
);

151 i‡(
ls
[
i
].
addr_ãxt
.
d©a
 =
NULL
) {

152  
NGX_ERROR
;

155 
Àn
 = 
	`ngx_sock_¡›
(
ls
[
i
].
sockaddr
,Üs[i].
addr_ãxt
.
d©a
,Üen, 1);

156 i‡(
Àn
 == 0) {

157  
NGX_ERROR
;

160 
ls
[
i
].
addr_ãxt
.
Àn
 =Üen;

162 
ls
[
i
].
backlog
 = 
NGX_LISTEN_BACKLOG
;

164 
ﬁí
 = ();

166 i‡(
	`gësock›t
(
ls
[
i
].
fd
, 
SOL_SOCKET
, 
SO_RCVBUF
, (*Ë&ls[i].
rcvbuf
,

167 &
ﬁí
)

170 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_sockë_î∫o
,

172 &
ls
[
i
].
addr_ãxt
);

174 
ls
[
i
].
rcvbuf
 = -1;

177 
ﬁí
 = ();

179 i‡(
	`gësock›t
(
ls
[
i
].
fd
, 
SOL_SOCKET
, 
SO_SNDBUF
, (*Ë&ls[i].
¢dbuf
,

180 &
ﬁí
)

183 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_sockë_î∫o
,

185 &
ls
[
i
].
addr_ãxt
);

187 
ls
[
i
].
¢dbuf
 = -1;

193 #i‡(
NGX_HAVE_SETFIB
)

195 i‡(
	`gësock›t
(
ls
[
i
].
£tfib
, 
SOL_SOCKET
, 
SO_SETFIB
,

196 (*Ë&
ls
[
i
].
£tfib
, &
ﬁí
)

199 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_sockë_î∫o
,

201 &
ls
[
i
].
addr_ãxt
);

203 
ls
[
i
].
£tfib
 = -1;

209 #i‡(
NGX_HAVE_DEFERRED_ACCEPT
 && 
deföed
 
SO_ACCEPTFILTER
)

211 
	`ngx_memzîo
(&
af
, (
ac˚±_fûãr_¨g
));

212 
ﬁí
 = (
ac˚±_fûãr_¨g
);

214 i‡(
	`gësock›t
(
ls
[
i
].
fd
, 
SOL_SOCKET
, 
SO_ACCEPTFILTER
, &
af
, &
ﬁí
)

217 
îr
 = 
ngx_î∫o
;

219 i‡(
îr
 =
NGX_EINVAL
) {

223 
	`ngx_log_îr‹
(
NGX_LOG_NOTICE
, 
cy˛e
->
log
, 
îr
,

225 &
ls
[
i
].
addr_ãxt
);

229 i‡(
ﬁí
 < (
ac˚±_fûãr_¨g
Ë|| 
af
.
af_«me
[0] == '\0') {

233 
ls
[
i
].
ac˚±_fûãr
 = 
	`ngx_∑Œoc
(
cy˛e
->
poﬁ
, 16);

234 i‡(
ls
[
i
].
ac˚±_fûãr
 =
NULL
) {

235  
NGX_ERROR
;

238 (Ë
	`ngx_˝y°∫
((
u_ch¨
 *Ë
ls
[
i
].
ac˚±_fûãr
,

239 (
u_ch¨
 *Ë
af
.
af_«me
, 16);

242 #i‡(
NGX_HAVE_DEFERRED_ACCEPT
 && 
deföed
 
TCP_DEFER_ACCEPT
)

244 
timeout
 = 0;

245 
ﬁí
 = ();

247 i‡(
	`gësock›t
(
ls
[
i
].
fd
, 
IPPROTO_TCP
, 
TCP_DEFER_ACCEPT
, &
timeout
, &
ﬁí
)

250 
	`ngx_log_îr‹
(
NGX_LOG_NOTICE
, 
cy˛e
->
log
, 
ngx_î∫o
,

252 &
ls
[
i
].
addr_ãxt
);

256 i‡(
ﬁí
 < (Ë|| 
timeout
 == 0) {

260 
ls
[
i
].
de„ºed_ac˚±
 = 1;

264  
NGX_OK
;

265 
	}
}

268 
ngx_öt_t


269 
	$ngx_›í_li°íög_sockës
(
ngx_cy˛e_t
 *
cy˛e
)

271 
ªu£addr
;

272 
ngx_uöt_t
 
i
, 
åõs
, 
Áûed
;

273 
ngx_îr_t
 
îr
;

274 
ngx_log_t
 *
log
;

275 
ngx_sockë_t
 
s
;

276 
ngx_li°íög_t
 *
ls
;

278 
ªu£addr
 = 1;

279 #i‡(
NGX_SUPPRESS_WARN
)

280 
Áûed
 = 0;

283 
log
 = 
cy˛e
->log;

287 
åõs
 = 5;Åries;Åries--) {

288 
Áûed
 = 0;

292 
ls
 = 
cy˛e
->
li°íög
.
ñts
;

293 
i
 = 0; i < 
cy˛e
->
li°íög
.
√…s
; i++) {

295 i‡(
ls
[
i
].
ign‹e
) {

299 i‡(
ls
[
i
].
fd
 != -1) {

303 i‡(
ls
[
i
].
öhîôed
) {

312 
s
 = 
	`ngx_sockë
(
ls
[
i
].
sockaddr
->
ß_Ámûy
,Üs[i].
ty≥
, 0);

314 i‡(
s
 == -1) {

315 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_sockë_î∫o
,

316 
ngx_sockë_n
 " %V faûed", &
ls
[
i
].
addr_ãxt
);

317  
NGX_ERROR
;

320 i‡(
	`£tsock›t
(
s
, 
SOL_SOCKET
, 
SO_REUSEADDR
,

321 (c⁄° *Ë&
ªu£addr
, ())

324 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_sockë_î∫o
,

326 &
ls
[
i
].
addr_ãxt
);

328 i‡(
	`ngx_˛o£_sockë
(
s
) == -1) {

329 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_sockë_î∫o
,

330 
ngx_˛o£_sockë_n
 " %V failed",

331 &
ls
[
i
].
addr_ãxt
);

334  
NGX_ERROR
;

337 #i‡(
NGX_HAVE_INET6
 && 
deföed
 
IPV6_V6ONLY
)

339 i‡(
ls
[
i
].
sockaddr
->
ß_Ámûy
 =
AF_INET6
 &&Üs[i].
ùv6⁄ly
) {

340 
ùv6⁄ly
;

342 
ùv6⁄ly
 = (
ls
[
i
].ipv6only == 1);

344 i‡(
	`£tsock›t
(
s
, 
IPPROTO_IPV6
, 
IPV6_V6ONLY
,

345 (c⁄° *Ë&
ùv6⁄ly
, ())

348 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_sockë_î∫o
,

350 &
ls
[
i
].
addr_ãxt
);

356 i‡(!(
ngx_evít_Êags
 & 
NGX_USE_AIO_EVENT
)) {

357 i‡(
	`ngx_n⁄blockög
(
s
) == -1) {

358 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_sockë_î∫o
,

359 
ngx_n⁄blockög_n
 " %V failed",

360 &
ls
[
i
].
addr_ãxt
);

362 i‡(
	`ngx_˛o£_sockë
(
s
) == -1) {

363 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_sockë_î∫o
,

364 
ngx_˛o£_sockë_n
 " %V failed",

365 &
ls
[
i
].
addr_ãxt
);

368  
NGX_ERROR
;

372 
	`ngx_log_debug2
(
NGX_LOG_DEBUG_CORE
, 
log
, 0,

373 "böd(Ë%V #%d ", &
ls
[
i
].
addr_ãxt
, 
s
);

375 i‡(
	`böd
(
s
, 
ls
[
i
].
sockaddr
,Üs[i].
sockÀn
) == -1) {

376 
îr
 = 
ngx_sockë_î∫o
;

378 i‡(
îr
 =
NGX_EADDRINUSE
 && 
ngx_ã°_c⁄fig
) {

382 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
îr
,

383 "böd(Ëtÿ%V faûed", &
ls
[
i
].
addr_ãxt
);

385 i‡(
	`ngx_˛o£_sockë
(
s
) == -1) {

386 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_sockë_î∫o
,

387 
ngx_˛o£_sockë_n
 " %V failed",

388 &
ls
[
i
].
addr_ãxt
);

391 i‡(
îr
 !
NGX_EADDRINUSE
) {

392  
NGX_ERROR
;

395 
Áûed
 = 1;

400 #i‡(
NGX_HAVE_UNIX_DOMAIN
)

402 i‡(
ls
[
i
].
sockaddr
->
ß_Ámûy
 =
AF_UNIX
) {

403 
mode_t
 
mode
;

404 
u_ch¨
 *
«me
;

406 
«me
 = 
ls
[
i
].
addr_ãxt
.
d©a
 + ("unix:") - 1;

407 
mode
 = (
S_IRUSR
|
S_IWUSR
|
S_IRGRP
|
S_IWGRP
|
S_IROTH
|
S_IWOTH
);

409 i‡(
	`chmod
((*Ë
«me
, 
mode
) == -1) {

410 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

411 "chmod(Ë\"%s\" faûed", 
«me
);

414 i‡(
ngx_ã°_c⁄fig
) {

415 i‡(
	`ngx_dñëe_fûe
(
«me
) == -1) {

416 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

417 
ngx_dñëe_fûe_n
 " %†Áûed", 
«me
);

423 i‡(
	`li°í
(
s
, 
ls
[
i
].
backlog
) == -1) {

424 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_sockë_î∫o
,

426 &
ls
[
i
].
addr_ãxt
,Üs[i].
backlog
);

428 i‡(
	`ngx_˛o£_sockë
(
s
) == -1) {

429 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_sockë_î∫o
,

430 
ngx_˛o£_sockë_n
 " %V failed",

431 &
ls
[
i
].
addr_ãxt
);

434  
NGX_ERROR
;

437 
ls
[
i
].
li°í
 = 1;

439 
ls
[
i
].
fd
 = 
s
;

442 i‡(!
Áûed
) {

448 
	`ngx_log_îr‹
(
NGX_LOG_NOTICE
, 
log
, 0,

451 
	`ngx_m¶ìp
(500);

454 i‡(
Áûed
) {

455 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 0, "still couldÇot bind()");

456  
NGX_ERROR
;

459  
NGX_OK
;

460 
	}
}

464 
	$ngx_c⁄figuª_li°íög_sockës
(
ngx_cy˛e_t
 *
cy˛e
)

466 
ngx_uöt_t
 
i
;

467 
ngx_li°íög_t
 *
ls
;

469 #i‡(
NGX_HAVE_DEFERRED_ACCEPT
 && 
deföed
 
SO_ACCEPTFILTER
)

470 
ac˚±_fûãr_¨g
 
af
;

472 #i‡(
NGX_HAVE_DEFERRED_ACCEPT
 && 
deföed
 
TCP_DEFER_ACCEPT
)

473 
timeout
;

476 
ls
 = 
cy˛e
->
li°íög
.
ñts
;

477 
i
 = 0; i < 
cy˛e
->
li°íög
.
√…s
; i++) {

479 
ls
[
i
].
log
 = *ls[i].
logp
;

481 i‡(
ls
[
i
].
rcvbuf
 != -1) {

482 i‡(
	`£tsock›t
(
ls
[
i
].
fd
, 
SOL_SOCKET
, 
SO_RCVBUF
,

483 (c⁄° *Ë&
ls
[
i
].
rcvbuf
, ())

486 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_sockë_î∫o
,

488 
ls
[
i
].
rcvbuf
, &ls[i].
addr_ãxt
);

492 i‡(
ls
[
i
].
¢dbuf
 != -1) {

493 i‡(
	`£tsock›t
(
ls
[
i
].
fd
, 
SOL_SOCKET
, 
SO_SNDBUF
,

494 (c⁄° *Ë&
ls
[
i
].
¢dbuf
, ())

497 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_sockë_î∫o
,

499 
ls
[
i
].
¢dbuf
, &ls[i].
addr_ãxt
);

503 #i‡(
NGX_HAVE_SETFIB
)

504 i‡(
ls
[
i
].
£tfib
 != -1) {

505 i‡(
	`£tsock›t
(
ls
[
i
].
fd
, 
SOL_SOCKET
, 
SO_SETFIB
,

506 (c⁄° *Ë&
ls
[
i
].
£tfib
, ())

509 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_sockë_î∫o
,

511 
ls
[
i
].
£tfib
, &ls[i].
addr_ãxt
);

518 
t˝_nodñay
 = 1;

520 i‡(
	`£tsock›t
(
ls
[
i
].
fd
, 
IPPROTO_TCP
, 
TCP_NODELAY
,

521 (c⁄° *Ë&
t˝_nodñay
, ())

524 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_sockë_î∫o
,

526 &
ls
[
i
].
addr_ãxt
);

531 i‡(
ls
[
i
].
li°í
) {

535 i‡(
	`li°í
(
ls
[
i
].
fd
,Üs[i].
backlog
) == -1) {

536 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_sockë_î∫o
,

538 &
ls
[
i
].
addr_ãxt
,Üs[i].
backlog
);

547 #i‡(
NGX_HAVE_DEFERRED_ACCEPT
)

549 #ifde‡
SO_ACCEPTFILTER


551 i‡(
ls
[
i
].
dñëe_de„ºed
) {

552 i‡(
	`£tsock›t
(
ls
[
i
].
fd
, 
SOL_SOCKET
, 
SO_ACCEPTFILTER
, 
NULL
, 0)

555 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_î∫o
,

558 &
ls
[
i
].
addr_ãxt
);

560 i‡(
ls
[
i
].
ac˚±_fûãr
) {

561 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 0,

564 
ls
[
i
].
ac˚±_fûãr
, &ls[i].
addr_ãxt
);

570 
ls
[
i
].
de„ºed_ac˚±
 = 0;

573 i‡(
ls
[
i
].
add_de„ºed
) {

574 
	`ngx_memzîo
(&
af
, (
ac˚±_fûãr_¨g
));

575 (Ë
	`ngx_˝y°∫
((
u_ch¨
 *Ë
af
.
af_«me
,

576 (
u_ch¨
 *Ë
ls
[
i
].
ac˚±_fûãr
, 16);

578 i‡(
	`£tsock›t
(
ls
[
i
].
fd
, 
SOL_SOCKET
, 
SO_ACCEPTFILTER
,

579 &
af
, (
ac˚±_fûãr_¨g
))

582 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_î∫o
,

585 
ls
[
i
].
ac˚±_fûãr
, &ls[i].
addr_ãxt
);

589 
ls
[
i
].
de„ºed_ac˚±
 = 1;

594 #ifde‡
TCP_DEFER_ACCEPT


596 i‡(
ls
[
i
].
add_de„ºed
 ||Üs[i].
dñëe_de„ºed
) {

598 i‡(
ls
[
i
].
add_de„ºed
) {

599 
timeout
 = (Ë(
ls
[
i
].
po°_ac˚±_timeout
 / 1000);

602 
timeout
 = 0;

605 i‡(
	`£tsock›t
(
ls
[
i
].
fd
, 
IPPROTO_TCP
, 
TCP_DEFER_ACCEPT
,

606 &
timeout
, ())

609 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_î∫o
,

612 
timeout
, &
ls
[
i
].
addr_ãxt
);

618 i‡(
ls
[
i
].
add_de„ºed
) {

619 
ls
[
i
].
de„ºed_ac˚±
 = 1;

628 
	}
}

632 
	$ngx_˛o£_li°íög_sockës
(
ngx_cy˛e_t
 *
cy˛e
)

634 
ngx_uöt_t
 
i
;

635 
ngx_li°íög_t
 *
ls
;

636 
ngx_c⁄√˘i⁄_t
 *
c
;

638 i‡(
ngx_evít_Êags
 & 
NGX_USE_IOCP_EVENT
) {

642 
ngx_ac˚±_muãx_hñd
 = 0;

643 
ngx_u£_ac˚±_muãx
 = 0;

645 
ls
 = 
cy˛e
->
li°íög
.
ñts
;

646 
i
 = 0; i < 
cy˛e
->
li°íög
.
√…s
; i++) {

648 
c
 = 
ls
[
i
].
c⁄√˘i⁄
;

650 i‡(
c
) {

651 i‡(
c
->
ªad
->
a˘ive
) {

652 i‡(
ngx_evít_Êags
 & 
NGX_USE_RTSIG_EVENT
) {

653 
	`ngx_dñ_c⁄n
(
c
, 
NGX_CLOSE_EVENT
);

655 } i‡(
ngx_evít_Êags
 & 
NGX_USE_EPOLL_EVENT
) {

663 
	`ngx_dñ_evít
(
c
->
ªad
, 
NGX_READ_EVENT
, 0);

666 
	`ngx_dñ_evít
(
c
->
ªad
, 
NGX_READ_EVENT
, 
NGX_CLOSE_EVENT
);

670 
	`ngx_‰ì_c⁄√˘i⁄
(
c
);

672 
c
->
fd
 = (
ngx_sockë_t
) -1;

675 
	`ngx_log_debug2
(
NGX_LOG_DEBUG_CORE
, 
cy˛e
->
log
, 0,

676 "˛o£Üi°íög %V #%d ", &
ls
[
i
].
addr_ãxt
,Üs[i].
fd
);

678 i‡(
	`ngx_˛o£_sockë
(
ls
[
i
].
fd
) == -1) {

679 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_sockë_î∫o
,

680 
ngx_˛o£_sockë_n
 " %V faûed", &
ls
[
i
].
addr_ãxt
);

683 #i‡(
NGX_HAVE_UNIX_DOMAIN
)

685 i‡(
ls
[
i
].
sockaddr
->
ß_Ámûy
 =
AF_UNIX


686 && 
ngx_¥o˚ss
 <
NGX_PROCESS_MASTER


687 && 
ngx_√w_bö¨y
 == 0)

689 
u_ch¨
 *
«me
 = 
ls
[
i
].
addr_ãxt
.
d©a
 + ("unix:") - 1;

691 i‡(
	`ngx_dñëe_fûe
(
«me
) == -1) {

692 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_sockë_î∫o
,

693 
ngx_dñëe_fûe_n
 " %†Áûed", 
«me
);

699 
ls
[
i
].
fd
 = (
ngx_sockë_t
) -1;

701 
	}
}

704 
ngx_c⁄√˘i⁄_t
 *

705 
	$ngx_gë_c⁄√˘i⁄
(
ngx_sockë_t
 
s
, 
ngx_log_t
 *
log
)

707 
ngx_uöt_t
 
ö°™˚
;

708 
ngx_evít_t
 *
ªv
, *
wev
;

709 
ngx_c⁄√˘i⁄_t
 *
c
;

713 i‡(
ngx_cy˛e
->
fûes
 && (
ngx_uöt_t
Ë
s
 >ngx_cy˛e->
fûes_n
) {

714 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
log
, 0,

717 
s
, 
ngx_cy˛e
->
fûes_n
);

718  
NULL
;

723 
c
 = 
ngx_cy˛e
->
‰ì_c⁄√˘i⁄s
;

725 i‡(
c
 =
NULL
) {

726 
	`ngx_døö_c⁄√˘i⁄s
();

727 
c
 = 
ngx_cy˛e
->
‰ì_c⁄√˘i⁄s
;

730 i‡(
c
 =
NULL
) {

731 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
log
, 0,

733 
ngx_cy˛e
->
c⁄√˘i⁄_n
);

737  
NULL
;

740 
ngx_cy˛e
->
‰ì_c⁄√˘i⁄s
 = 
c
->
d©a
;

741 
ngx_cy˛e
->
‰ì_c⁄√˘i⁄_n
--;

745 i‡(
ngx_cy˛e
->
fûes
) {

746 
ngx_cy˛e
->
fûes
[
s
] = 
c
;

749 
ªv
 = 
c
->
ªad
;

750 
wev
 = 
c
->
wrôe
;

752 
	`ngx_memzîo
(
c
, (
ngx_c⁄√˘i⁄_t
));

754 
c
->
ªad
 = 
ªv
;

755 
c
->
wrôe
 = 
wev
;

756 
c
->
fd
 = 
s
;

757 
c
->
log
 =Üog;

759 
ö°™˚
 = 
ªv
->instance;

761 
	`ngx_memzîo
(
ªv
, (
ngx_evít_t
));

762 
	`ngx_memzîo
(
wev
, (
ngx_evít_t
));

764 
ªv
->
ö°™˚
 = !instance;

765 
wev
->
ö°™˚
 = !instance;

767 
ªv
->
ödex
 = 
NGX_INVALID_INDEX
;

768 
wev
->
ödex
 = 
NGX_INVALID_INDEX
;

770 
ªv
->
d©a
 = 
c
;

771 
wev
->
d©a
 = 
c
;

773 
wev
->
wrôe
 = 1;

775  
c
;

776 
	}
}

780 
	$ngx_‰ì_c⁄√˘i⁄
(
ngx_c⁄√˘i⁄_t
 *
c
)

784 
c
->
d©a
 = 
ngx_cy˛e
->
‰ì_c⁄√˘i⁄s
;

785 
ngx_cy˛e
->
‰ì_c⁄√˘i⁄s
 = 
c
;

786 
ngx_cy˛e
->
‰ì_c⁄√˘i⁄_n
++;

790 i‡(
ngx_cy˛e
->
fûes
) {

791 
ngx_cy˛e
->
fûes
[
c
->
fd
] = 
NULL
;

793 
	}
}

797 
	$ngx_˛o£_c⁄√˘i⁄
(
ngx_c⁄√˘i⁄_t
 *
c
)

799 
ngx_îr_t
 
îr
;

800 
ngx_uöt_t
 
log_îr‹
, 
Àvñ
;

801 
ngx_sockë_t
 
fd
;

803 i‡(
c
->
fd
 == -1) {

804 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
c
->
log
, 0, "connectionálready closed");

808 i‡(
c
->
ªad
->
timî_£t
) {

809 
	`ngx_dñ_timî
(
c
->
ªad
);

812 i‡(
c
->
wrôe
->
timî_£t
) {

813 
	`ngx_dñ_timî
(
c
->
wrôe
);

816 i‡(
ngx_dñ_c⁄n
) {

817 
	`ngx_dñ_c⁄n
(
c
, 
NGX_CLOSE_EVENT
);

820 i‡(
c
->
ªad
->
a˘ive
 || c->ªad->
dißbÀd
) {

821 
	`ngx_dñ_evít
(
c
->
ªad
, 
NGX_READ_EVENT
, 
NGX_CLOSE_EVENT
);

824 i‡(
c
->
wrôe
->
a˘ive
 || c->wrôe->
dißbÀd
) {

825 
	`ngx_dñ_evít
(
c
->
wrôe
, 
NGX_WRITE_EVENT
, 
NGX_CLOSE_EVENT
);

829 #i‡(
NGX_THREADS
)

837 
	`ngx_muãx_lock
(
ngx_po°ed_evíts_muãx
);

839 i‡(
c
->
ªad
->
¥ev
) {

840 
	`ngx_dñëe_po°ed_evít
(
c
->
ªad
);

843 i‡(
c
->
wrôe
->
¥ev
) {

844 
	`ngx_dñëe_po°ed_evít
(
c
->
wrôe
);

847 
c
->
ªad
->
˛o£d
 = 1;

848 
c
->
wrôe
->
˛o£d
 = 1;

850 i‡(
c
->
sögÀ_c⁄√˘i⁄
) {

851 
	`ngx_u∆ock
(&
c
->
lock
);

852 
c
->
ªad
->
locked
 = 0;

853 
c
->
wrôe
->
locked
 = 0;

856 
	`ngx_muãx_u∆ock
(
ngx_po°ed_evíts_muãx
);

860 i‡(
c
->
ªad
->
¥ev
) {

861 
	`ngx_dñëe_po°ed_evít
(
c
->
ªad
);

864 i‡(
c
->
wrôe
->
¥ev
) {

865 
	`ngx_dñëe_po°ed_evít
(
c
->
wrôe
);

868 
c
->
ªad
->
˛o£d
 = 1;

869 
c
->
wrôe
->
˛o£d
 = 1;

873 
	`ngx_ªußbÀ_c⁄√˘i⁄
(
c
, 0);

875 
log_îr‹
 = 
c
->log_error;

877 
	`ngx_‰ì_c⁄√˘i⁄
(
c
);

879 
fd
 = 
c
->fd;

880 
c
->
fd
 = (
ngx_sockë_t
) -1;

882 i‡(
	`ngx_˛o£_sockë
(
fd
) == -1) {

884 
îr
 = 
ngx_sockë_î∫o
;

886 i‡(
îr
 =
NGX_ECONNRESET
 ||Éº =
NGX_ENOTCONN
) {

888 
log_îr‹
) {

890 
NGX_ERROR_INFO
:

891 
Àvñ
 = 
NGX_LOG_INFO
;

894 
NGX_ERROR_ERR
:

895 
Àvñ
 = 
NGX_LOG_ERR
;

899 
Àvñ
 = 
NGX_LOG_CRIT
;

903 
Àvñ
 = 
NGX_LOG_CRIT
;

908 
	`ngx_log_îr‹
(
Àvñ
, 
ngx_cy˛e
->
log
, 
îr
,

909 
ngx_˛o£_sockë_n
 " %d faûed", 
fd
);

911 
	}
}

915 
	$ngx_ªußbÀ_c⁄√˘i⁄
(
ngx_c⁄√˘i⁄_t
 *
c
, 
ngx_uöt_t
 
ªußbÀ
)

917 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
c
->
log
, 0,

918 "ªußbÀ c⁄√˘i⁄: %ui", 
ªußbÀ
);

920 i‡(
c
->
ªußbÀ
) {

921 
	`ngx_queue_ªmove
(&
c
->
queue
);

924 
c
->
ªußbÀ
 =Ñeusable;

926 i‡(
ªußbÀ
) {

929 
	`ngx_queue_ö£π_hód
(

930 (
ngx_queue_t
 *Ë&
ngx_cy˛e
->
ªußbÀ_c⁄√˘i⁄s_queue
, &
c
->
queue
);

932 
	}
}

936 
	$ngx_døö_c⁄√˘i⁄s
()

938 
ngx_öt_t
 
i
;

939 
ngx_queue_t
 *
q
;

940 
ngx_c⁄√˘i⁄_t
 *
c
;

942 
i
 = 0; i < 32; i++) {

943 i‡(
	`ngx_queue_em±y
(&
ngx_cy˛e
->
ªußbÀ_c⁄√˘i⁄s_queue
)) {

947 
q
 = 
	`ngx_queue_œ°
(&
ngx_cy˛e
->
ªußbÀ_c⁄√˘i⁄s_queue
);

948 
c
 = 
	`ngx_queue_d©a
(
q
, 
ngx_c⁄√˘i⁄_t
, 
queue
);

950 
	`ngx_log_debug0
(
NGX_LOG_DEBUG_CORE
, 
c
->
log
, 0,

953 
c
->
˛o£
 = 1;

954 
c
->
ªad
->
	`h™dÀr
(c->read);

956 
	}
}

959 
ngx_öt_t


960 
	$ngx_c⁄√˘i⁄_loˇl_sockaddr
(
ngx_c⁄√˘i⁄_t
 *
c
, 
ngx_°r_t
 *
s
,

961 
ngx_uöt_t
 
p‹t
)

963 
sockÀn_t
 
Àn
;

964 
ngx_uöt_t
 
addr
;

965 
u_ch¨
 
ß
[
NGX_SOCKADDRLEN
];

966 
sockaddr_ö
 *
sö
;

967 #i‡(
NGX_HAVE_INET6
)

968 
ngx_uöt_t
 
i
;

969 
sockaddr_ö6
 *
sö6
;

972 
c
->
loˇl_sockaddr
->
ß_Ámûy
) {

974 #i‡(
NGX_HAVE_INET6
)

975 
AF_INET6
:

976 
sö6
 = (
sockaddr_ö6
 *Ë
c
->
loˇl_sockaddr
;

978 
addr
 = 0, 
i
 = 0;áddr == 0 && i < 16; i++) {

979 
addr
 |
sö6
->
sö6_addr
.
s6_addr
[
i
];

986 
sö
 = (
sockaddr_ö
 *Ë
c
->
loˇl_sockaddr
;

987 
addr
 = 
sö
->
sö_addr
.
s_addr
;

991 i‡(
addr
 == 0) {

993 
Àn
 = 
NGX_SOCKADDRLEN
;

995 i‡(
	`gësock«me
(
c
->
fd
, (
sockaddr
 *Ë&
ß
, &
Àn
) == -1) {

996 
	`ngx_c⁄√˘i⁄_îr‹
(
c
, 
ngx_sockë_î∫o
, "getsockname() failed");

997  
NGX_ERROR
;

1000 
c
->
loˇl_sockaddr
 = 
	`ngx_∑Œoc
(c->
poﬁ
, 
Àn
);

1001 i‡(
c
->
loˇl_sockaddr
 =
NULL
) {

1002  
NGX_ERROR
;

1005 
	`ngx_mem˝y
(
c
->
loˇl_sockaddr
, &
ß
, 
Àn
);

1008 i‡(
s
 =
NULL
) {

1009  
NGX_OK
;

1012 
s
->
Àn
 = 
	`ngx_sock_¡›
(
c
->
loˇl_sockaddr
, s->
d©a
, s->Àn, 
p‹t
);

1014  
NGX_OK
;

1015 
	}
}

1018 
ngx_öt_t


1019 
	$ngx_c⁄√˘i⁄_îr‹
(
ngx_c⁄√˘i⁄_t
 *
c
, 
ngx_îr_t
 
îr
, *
ãxt
)

1021 
ngx_uöt_t
 
Àvñ
;

1025 i‡((
îr
 =
NGX_ECONNRESET


1026 #i‡(
NGX_WIN32
)

1027 || 
îr
 =
NGX_ECONNABORTED


1029 Ë&& 
c
->
log_îr‹
 =
NGX_ERROR_IGNORE_ECONNRESET
)

1034 #i‡(
NGX_SOLARIS
)

1035 i‡(
îr
 =
NGX_EINVAL
 && 
c
->
log_îr‹
 =
NGX_ERROR_IGNORE_EINVAL
) {

1040 i‡(
îr
 == 0

1041 || 
îr
 =
NGX_ECONNRESET


1042 #i‡(
NGX_WIN32
)

1043 || 
îr
 =
NGX_ECONNABORTED


1045 || 
îr
 =
NGX_EPIPE


1047 || 
îr
 =
NGX_ENOTCONN


1048 || 
îr
 =
NGX_ETIMEDOUT


1049 || 
îr
 =
NGX_ECONNREFUSED


1050 || 
îr
 =
NGX_ENETDOWN


1051 || 
îr
 =
NGX_ENETUNREACH


1052 || 
îr
 =
NGX_EHOSTDOWN


1053 || 
îr
 =
NGX_EHOSTUNREACH
)

1055 
c
->
log_îr‹
) {

1057 
NGX_ERROR_IGNORE_EINVAL
:

1058 
NGX_ERROR_IGNORE_ECONNRESET
:

1059 
NGX_ERROR_INFO
:

1060 
Àvñ
 = 
NGX_LOG_INFO
;

1064 
Àvñ
 = 
NGX_LOG_ERR
;

1068 
Àvñ
 = 
NGX_LOG_ALERT
;

1071 
	`ngx_log_îr‹
(
Àvñ
, 
c
->
log
, 
îr
, 
ãxt
);

1073  
NGX_ERROR
;

1074 
	}
}

	@ngx_connection.h

8 #i‚de‡
_NGX_CONNECTION_H_INCLUDED_


9 
	#_NGX_CONNECTION_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 
ngx_li°íög_s
 
	tngx_li°íög_t
;

18 
	sngx_li°íög_s
 {

19 
ngx_sockë_t
 
	mfd
;

21 
sockaddr
 *
	msockaddr
;

22 
sockÀn_t
 
	msockÀn
;

23 
size_t
 
	maddr_ãxt_max_Àn
;

24 
ngx_°r_t
 
	maddr_ãxt
;

26 
	mty≥
;

28 
	mbacklog
;

29 
	mrcvbuf
;

30 
	m¢dbuf
;

33 
ngx_c⁄√˘i⁄_h™dÀr_±
 
	mh™dÀr
;

35 *
	m£rvîs
;

37 
ngx_log_t
 
	mlog
;

38 
ngx_log_t
 *
	mlogp
;

40 
size_t
 
	mpoﬁ_size
;

42 
size_t
 
	mpo°_ac˚±_buf„r_size
;

44 
ngx_m£c_t
 
	mpo°_ac˚±_timeout
;

46 
ngx_li°íög_t
 *
	m¥evious
;

47 
ngx_c⁄√˘i⁄_t
 *
	mc⁄√˘i⁄
;

49 
	m›í
:1;

50 
	mªmaö
:1;

51 
	mign‹e
:1;

53 
	mbound
:1;

54 
	möhîôed
:1;

55 
	mn⁄blockög_ac˚±
:1;

56 
	mli°í
:1;

57 
	mn⁄blockög
:1;

58 
	msh¨ed
:1;

59 
	maddr_¡›
:1;

61 #i‡(
NGX_HAVE_INET6
 && 
deföed
 
IPV6_V6ONLY
)

62 
	mùv6⁄ly
:2;

65 #i‡(
NGX_HAVE_DEFERRED_ACCEPT
)

66 
	mde„ºed_ac˚±
:1;

67 
	mdñëe_de„ºed
:1;

68 
	madd_de„ºed
:1;

69 #ifde‡
SO_ACCEPTFILTER


70 *
	mac˚±_fûãr
;

73 #i‡(
NGX_HAVE_SETFIB
)

74 
	m£tfib
;

81 
	mNGX_ERROR_ALERT
 = 0,

82 
	mNGX_ERROR_ERR
,

83 
	mNGX_ERROR_INFO
,

84 
	mNGX_ERROR_IGNORE_ECONNRESET
,

85 
	mNGX_ERROR_IGNORE_EINVAL


86 } 
	tngx_c⁄√˘i⁄_log_îr‹_e
;

90 
	mNGX_TCP_NODELAY_UNSET
 = 0,

91 
	mNGX_TCP_NODELAY_SET
,

92 
	mNGX_TCP_NODELAY_DISABLED


93 } 
	tngx_c⁄√˘i⁄_t˝_nodñay_e
;

97 
	mNGX_TCP_NOPUSH_UNSET
 = 0,

98 
	mNGX_TCP_NOPUSH_SET
,

99 
	mNGX_TCP_NOPUSH_DISABLED


100 } 
	tngx_c⁄√˘i⁄_t˝_n›ush_e
;

103 
	#NGX_LOWLEVEL_BUFFERED
 0x0f

	)

104 
	#NGX_SSL_BUFFERED
 0x01

	)

107 
	sngx_c⁄√˘i⁄_s
 {

108 *
	md©a
;

109 
ngx_evít_t
 *
	mªad
;

110 
ngx_evít_t
 *
	mwrôe
;

112 
ngx_sockë_t
 
	mfd
;

114 
ngx_ªcv_±
 
	mªcv
;

115 
ngx_£nd_±
 
	m£nd
;

116 
ngx_ªcv_chaö_±
 
	mªcv_chaö
;

117 
ngx_£nd_chaö_±
 
	m£nd_chaö
;

119 
ngx_li°íög_t
 *
	mli°íög
;

121 
off_t
 
	m£¡
;

123 
ngx_log_t
 *
	mlog
;

125 
ngx_poﬁ_t
 *
	mpoﬁ
;

127 
sockaddr
 *
	msockaddr
;

128 
sockÀn_t
 
	msockÀn
;

129 
ngx_°r_t
 
	maddr_ãxt
;

131 #i‡(
NGX_SSL
)

132 
ngx_s¶_c⁄√˘i⁄_t
 *
	ms¶
;

135 
sockaddr
 *
	mloˇl_sockaddr
;

137 
ngx_buf_t
 *
	mbuf„r
;

139 
ngx_queue_t
 
	mqueue
;

141 
ngx_©omic_uöt_t
 
	mnumbî
;

143 
ngx_uöt_t
 
	mªque°s
;

145 
	mbuf„ªd
:8;

147 
	mlog_îr‹
:3;

149 
	msögÀ_c⁄√˘i⁄
:1;

150 
	mu√x≥˘ed_eof
:1;

151 
	mtimedout
:1;

152 
	mîr‹
:1;

153 
	mde°royed
:1;

155 
	midÀ
:1;

156 
	mªußbÀ
:1;

157 
	m˛o£
:1;

159 
	m£ndfûe
:1;

160 
	m¢dlow©
:1;

161 
	mt˝_nodñay
:2;

162 
	mt˝_n›ush
:2;

164 #i‡(
NGX_HAVE_IOCP
)

165 
	mac˚±_c⁄ãxt_upd©ed
:1;

168 #i‡(
NGX_HAVE_AIO_SENDFILE
)

169 
	maio_£ndfûe
:1;

170 
ngx_buf_t
 *
	mbusy_£ndfûe
;

173 #i‡(
NGX_THREADS
)

174 
ngx_©omic_t
 
	mlock
;

179 
ngx_li°íög_t
 *
ngx_¸óã_li°íög
(
ngx_c⁄f_t
 *
cf
, *
sockaddr
,

180 
sockÀn_t
 
sockÀn
);

181 
ngx_öt_t
 
ngx_£t_öhîôed_sockës
(
ngx_cy˛e_t
 *
cy˛e
);

182 
ngx_öt_t
 
ngx_›í_li°íög_sockës
(
ngx_cy˛e_t
 *
cy˛e
);

183 
ngx_c⁄figuª_li°íög_sockës
(
ngx_cy˛e_t
 *
cy˛e
);

184 
ngx_˛o£_li°íög_sockës
(
ngx_cy˛e_t
 *
cy˛e
);

185 
ngx_˛o£_c⁄√˘i⁄
(
ngx_c⁄√˘i⁄_t
 *
c
);

186 
ngx_öt_t
 
ngx_c⁄√˘i⁄_loˇl_sockaddr
(
ngx_c⁄√˘i⁄_t
 *
c
, 
ngx_°r_t
 *
s
,

187 
ngx_uöt_t
 
p‹t
);

188 
ngx_öt_t
 
ngx_c⁄√˘i⁄_îr‹
(
ngx_c⁄√˘i⁄_t
 *
c
, 
ngx_îr_t
 
îr
, *
ãxt
);

190 
ngx_c⁄√˘i⁄_t
 *
ngx_gë_c⁄√˘i⁄
(
ngx_sockë_t
 
s
, 
ngx_log_t
 *
log
);

191 
ngx_‰ì_c⁄√˘i⁄
(
ngx_c⁄√˘i⁄_t
 *
c
);

193 
ngx_ªußbÀ_c⁄√˘i⁄
(
ngx_c⁄√˘i⁄_t
 *
c
, 
ngx_uöt_t
 
ªußbÀ
);

	@ngx_core.h

8 #i‚de‡
_NGX_CORE_H_INCLUDED_


9 
	#_NGX_CORE_H_INCLUDED_


	)

12 
ngx_moduÀ_s
 
	tngx_moduÀ_t
;

13 
ngx_c⁄f_s
 
	tngx_c⁄f_t
;

14 
ngx_cy˛e_s
 
	tngx_cy˛e_t
;

15 
ngx_poﬁ_s
 
	tngx_poﬁ_t
;

16 
ngx_chaö_s
 
	tngx_chaö_t
;

17 
ngx_log_s
 
	tngx_log_t
;

18 
ngx_¨øy_s
 
	tngx_¨øy_t
;

19 
ngx_›í_fûe_s
 
	tngx_›í_fûe_t
;

20 
ngx_comm™d_s
 
	tngx_comm™d_t
;

21 
ngx_fûe_s
 
	tngx_fûe_t
;

22 
ngx_evít_s
 
	tngx_evít_t
;

23 
ngx_evít_aio_s
 
	tngx_evít_aio_t
;

24 
ngx_c⁄√˘i⁄_s
 
	tngx_c⁄√˘i⁄_t
;

26 (*
	tngx_evít_h™dÀr_±
)(
	tngx_evít_t
 *
	tev
);

27 (*
	tngx_c⁄√˘i⁄_h™dÀr_±
)(
	tngx_c⁄√˘i⁄_t
 *
	tc
);

30 
	#NGX_OK
 0

	)

31 
	#NGX_ERROR
 -1

	)

32 
	#NGX_AGAIN
 -2

	)

33 
	#NGX_BUSY
 -3

	)

34 
	#NGX_DONE
 -4

	)

35 
	#NGX_DECLINED
 -5

	)

36 
	#NGX_ABORT
 -6

	)

39 
	~<ngx_î∫o.h
>

40 
	~<ngx_©omic.h
>

41 
	~<ngx_thªad.h
>

42 
	~<ngx_rbåì.h
>

43 
	~<ngx_time.h
>

44 
	~<ngx_sockë.h
>

45 
	~<ngx_°rög.h
>

46 
	~<ngx_fûes.h
>

47 
	~<ngx_shmem.h
>

48 
	~<ngx_¥o˚ss.h
>

49 
	~<ngx_u£r.h
>

50 
	~<ngx_∑r£.h
>

51 
	~<ngx_log.h
>

52 
	~<ngx_Æloc.h
>

53 
	~<ngx_∑Œoc.h
>

54 
	~<ngx_buf.h
>

55 
	~<ngx_queue.h
>

56 
	~<ngx_¨øy.h
>

57 
	~<ngx_li°.h
>

58 
	~<ngx_hash.h
>

59 
	~<ngx_fûe.h
>

60 
	~<ngx_¸c.h
>

61 
	~<ngx_¸c32.h
>

62 
	~<ngx_murmurhash.h
>

63 #i‡(
NGX_PCRE
)

64 
	~<ngx_ªgex.h
>

66 
	~<ngx_ødix_åì.h
>

67 
	~<ngx_times.h
>

68 
	~<ngx_shmtx.h
>

69 
	~<ngx_¶ab.h
>

70 
	~<ngx_öë.h
>

71 
	~<ngx_cy˛e.h
>

72 #i‡(
NGX_OPENSSL
)

73 
	~<ngx_evít_›ís¶.h
>

75 
	~<ngx_¥o˚ss_cy˛e.h
>

76 
	~<ngx_c⁄f_fûe.h
>

77 
	~<ngx_ªsﬁvî.h
>

78 
	~<ngx_›í_fûe_ˇche.h
>

79 
	~<ngx_os.h
>

80 
	~<ngx_c⁄√˘i⁄.h
>

83 
	#LF
 (
u_ch¨
Ë10

	)

84 
	#CR
 (
u_ch¨
Ë13

	)

85 
	#CRLF
 "\x0d\x0a"

	)

88 
	#ngx_abs
(
vÆue
Ë(((vÆueË>0Ë? (vÆueË: - (vÆue))

	)

89 
	#ngx_max
(
vÆ1
, 
vÆ2
Ë((vÆ1 < vÆ2Ë? (vÆ2Ë: (vÆ1))

	)

90 
	#ngx_mö
(
vÆ1
, 
vÆ2
Ë((vÆ1 > vÆ2Ë? (vÆ2Ë: (vÆ1))

	)

92 
	`ngx_˝uöfo
();

	@ngx_cpuinfo.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 #i‡(–
__i386__
 || 
__amd64__
 ) && ( 
__GNUC__
 || 
__INTEL_COMPILER
 ))

15 
ngx_ölöe
 
ngx_˝uid
(
uöt32_t
 
i
, uöt32_à*
buf
);

18 #i‡–
__i386__
 )

20 
ngx_ölöe
 

21 
	$ngx_˝uid
(
uöt32_t
 
i
, uöt32_à*
buf
)

30 
	`__asm__
 (

42 : : "a" (
i
), "D" (
buf
) : "ecx", "edx", "esi", "memory" );

43 
	}
}

49 
ngx_ölöe
 

50 
	$ngx_˝uid
(
uöt32_t
 
i
, uöt32_à*
buf
)

52 
uöt32_t
 
óx
, 
ebx
, 
ecx
, 
edx
;

54 
	`__asm__
 (

58 : "˜" (
óx
), "=b" (
ebx
), "=c" (
ecx
), "=d" (
edx
Ë: "a" (
i
) );

60 
buf
[0] = 
óx
;

61 
buf
[1] = 
ebx
;

62 
buf
[2] = 
edx
;

63 
buf
[3] = 
ecx
;

64 
	}
}

73 
	$ngx_˝uöfo
()

75 
u_ch¨
 *
víd‹
;

76 
uöt32_t
 
vbuf
[5], 
˝u
[4], 
modñ
;

78 
vbuf
[0] = 0;

79 
vbuf
[1] = 0;

80 
vbuf
[2] = 0;

81 
vbuf
[3] = 0;

82 
vbuf
[4] = 0;

84 
	`ngx_˝uid
(0, 
vbuf
);

86 
víd‹
 = (
u_ch¨
 *Ë&
vbuf
[1];

88 i‡(
vbuf
[0] == 0) {

92 
	`ngx_˝uid
(1, 
˝u
);

94 i‡(
	`ngx_°rcmp
(
víd‹
, "GenuineIntel") == 0) {

96 (
˝u
[0] & 0xf00) >> 8) {

100 
ngx_ˇchñöe_size
 = 32;

105 
ngx_ˇchñöe_size
 = 32;

107 
modñ
 = ((
˝u
[0] & 0xf0000) >> 8) | (cpu[0] & 0xf0);

109 i‡(
modñ
 >= 0xd0) {

111 
ngx_ˇchñöe_size
 = 64;

121 
ngx_ˇchñöe_size
 = 128;

125 } i‡(
	`ngx_°rcmp
(
víd‹
, "AuthenticAMD") == 0) {

126 
ngx_ˇchñöe_size
 = 64;

128 
	}
}

134 
	$ngx_˝uöfo
()

136 
	}
}

	@ngx_crc.h

8 #i‚de‡
_NGX_CRC_H_INCLUDED_


9 
	#_NGX_CRC_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

18 
ngx_ölöe
 
uöt32_t


19 
	$ngx_¸c
(
u_ch¨
 *
d©a
, 
size_t
 
Àn
)

21 
uöt32_t
 
sum
;

23 
sum
 = 0; 
Àn
;Üen--) {

30 
sum
 = sum >> 1 | sum << 31;

32 
sum
 +*
d©a
++;

35  
sum
;

36 
	}
}

	@ngx_crc32.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

26 
uöt32_t
 
	gngx_¸c32_èbÀ16
[] = {

34 
uöt32_t
 
	gngx_¸c32_èbÀ256
[] = {

102 
uöt32_t
 *
	gngx_¸c32_èbÀ_sh‹t
 = 
ngx_¸c32_èbÀ16
;

105 
ngx_öt_t


106 
	$ngx_¸c32_èbÀ_öô
()

108 *
p
;

110 i‡(((
uöçå_t
Ë
ngx_¸c32_èbÀ_sh‹t


111 & ~((
uöçå_t
Ë
ngx_ˇchñöe_size
 - 1))

112 =(
uöçå_t
Ë
ngx_¸c32_èbÀ_sh‹t
)

114  
NGX_OK
;

117 
p
 = 
	`ngx_Æloc
(16 * (
uöt32_t
Ë+ 
ngx_ˇchñöe_size
, 
ngx_cy˛e
->
log
);

118 i‡(
p
 =
NULL
) {

119  
NGX_ERROR
;

122 
p
 = 
	`ngx_Æign_±r
’, 
ngx_ˇchñöe_size
);

124 
	`ngx_mem˝y
(
p
, 
ngx_¸c32_èbÀ16
, 16 * (
uöt32_t
));

126 
ngx_¸c32_èbÀ_sh‹t
 = 
p
;

128  
NGX_OK
;

129 
	}
}

	@ngx_crc32.h

8 #i‚de‡
_NGX_CRC32_H_INCLUDED_


9 
	#_NGX_CRC32_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 
uöt32_t
 *
ngx_¸c32_èbÀ_sh‹t
;

17 
uöt32_t
 
ngx_¸c32_èbÀ256
[];

20 
ngx_ölöe
 
uöt32_t


21 
	$ngx_¸c32_sh‹t
(
u_ch¨
 *
p
, 
size_t
 
Àn
)

23 
u_ch¨
 
c
;

24 
uöt32_t
 
¸c
;

26 
¸c
 = 0xffffffff;

28 
Àn
--) {

29 
c
 = *
p
++;

30 
¸c
 = 
ngx_¸c32_èbÀ_sh‹t
[(¸¯^ (
c
 & 0xf)) & 0xf] ^ (crc >> 4);

31 
¸c
 = 
ngx_¸c32_èbÀ_sh‹t
[(¸¯^ (
c
 >> 4)) & 0xf] ^ (crc >> 4);

34  
¸c
 ^ 0xffffffff;

35 
	}
}

38 
ngx_ölöe
 
uöt32_t


39 
	$ngx_¸c32_l⁄g
(
u_ch¨
 *
p
, 
size_t
 
Àn
)

41 
uöt32_t
 
¸c
;

43 
¸c
 = 0xffffffff;

45 
Àn
--) {

46 
¸c
 = 
ngx_¸c32_èbÀ256
[(¸¯^ *
p
++) & 0xff] ^ (crc >> 8);

49  
¸c
 ^ 0xffffffff;

50 
	}
}

53 
	#ngx_¸c32_öô
(
¸c
) \

54 
¸c
 = 0xffffffff

	)

57 
ngx_ölöe
 

58 
	$ngx_¸c32_upd©e
(
uöt32_t
 *
¸c
, 
u_ch¨
 *
p
, 
size_t
 
Àn
)

60 
uöt32_t
 
c
;

62 
c
 = *
¸c
;

64 
Àn
--) {

65 
c
 = 
ngx_¸c32_èbÀ256
[(¯^ *
p
++) & 0xff] ^ (c >> 8);

68 *
¸c
 = 
c
;

69 
	}
}

72 
	#ngx_¸c32_föÆ
(
¸c
) \

73 
¸c
 ^0xffffffff

	)

76 
ngx_öt_t
 
ngx_¸c32_èbÀ_öô
();

	@ngx_crypt.c

7 
	~<ngx_c⁄fig.h
>

8 
	~<ngx_c‹e.h
>

9 
	~<ngx_md5.h
>

10 #i‡(
NGX_HAVE_SHA1
)

11 
	~<ngx_sha1.h
>

15 #i‡(
NGX_CRYPT
)

17 
ngx_öt_t
 
ngx_¸y±_≠r1
(
ngx_poﬁ_t
 *
poﬁ
, 
u_ch¨
 *
key
, u_ch¨ *
ß…
,

18 
u_ch¨
 **
í¸y±ed
);

19 
ngx_öt_t
 
ngx_¸y±_∂aö
(
ngx_poﬁ_t
 *
poﬁ
, 
u_ch¨
 *
key
, u_ch¨ *
ß…
,

20 
u_ch¨
 **
í¸y±ed
);

22 #i‡(
NGX_HAVE_SHA1
)

24 
ngx_öt_t
 
ngx_¸y±_ssha
(
ngx_poﬁ_t
 *
poﬁ
, 
u_ch¨
 *
key
, u_ch¨ *
ß…
,

25 
u_ch¨
 **
í¸y±ed
);

30 
u_ch¨
 *
ngx_¸y±_to64
(u_ch¨ *
p
, 
uöt32_t
 
v
, 
size_t
 
n
);

33 
ngx_öt_t


34 
	$ngx_¸y±
(
ngx_poﬁ_t
 *
poﬁ
, 
u_ch¨
 *
key
, u_ch¨ *
ß…
, u_ch¨ **
í¸y±ed
)

36 i‡(
	`ngx_°∫cmp
(
ß…
, "$apr1$", ("$apr1$") - 1) == 0) {

37  
	`ngx_¸y±_≠r1
(
poﬁ
, 
key
, 
ß…
, 
í¸y±ed
);

39 } i‡(
	`ngx_°∫cmp
(
ß…
, "{PLAIN}", ("{PLAIN}") - 1) == 0) {

40  
	`ngx_¸y±_∂aö
(
poﬁ
, 
key
, 
ß…
, 
í¸y±ed
);

42 #i‡(
NGX_HAVE_SHA1
)

43 } i‡(
	`ngx_°∫cmp
(
ß…
, "{SSHA}", ("{SSHA}") - 1) == 0) {

44  
	`ngx_¸y±_ssha
(
poﬁ
, 
key
, 
ß…
, 
í¸y±ed
);

50  
	`ngx_libc_¸y±
(
poﬁ
, 
key
, 
ß…
, 
í¸y±ed
);

51 
	}
}

54 
ngx_öt_t


55 
	$ngx_¸y±_≠r1
(
ngx_poﬁ_t
 *
poﬁ
, 
u_ch¨
 *
key
, u_ch¨ *
ß…
, u_ch¨ **
í¸y±ed
)

57 
ngx_öt_t
 
n
;

58 
ngx_uöt_t
 
i
;

59 
u_ch¨
 *
p
, *
œ°
, 
föÆ
[16];

60 
size_t
 
ß…Àn
, 
keyÀn
;

61 
ngx_md5_t
 
md5
, 
˘x1
;

65 
keyÀn
 = 
	`ngx_°æí
(
key
);

69 
ß…
 += ("$apr1$") - 1;

70 
œ°
 = 
ß…
 + 8;

71 
p
 = 
ß…
; *∞&& *∞!'$' &&Ö < 
œ°
;Ö++) { }

72 
ß…Àn
 = 
p
 - 
ß…
;

76 
	`ngx_md5_öô
(&
md5
);

77 
	`ngx_md5_upd©e
(&
md5
, 
key
, 
keyÀn
);

78 
	`ngx_md5_upd©e
(&
md5
, (
u_ch¨
 *) "$apr1$", ("$apr1$") - 1);

79 
	`ngx_md5_upd©e
(&
md5
, 
ß…
, 
ß…Àn
);

81 
	`ngx_md5_öô
(&
˘x1
);

82 
	`ngx_md5_upd©e
(&
˘x1
, 
key
, 
keyÀn
);

83 
	`ngx_md5_upd©e
(&
˘x1
, 
ß…
, 
ß…Àn
);

84 
	`ngx_md5_upd©e
(&
˘x1
, 
key
, 
keyÀn
);

85 
	`ngx_md5_föÆ
(
föÆ
, &
˘x1
);

87 
n
 = 
keyÀn
;Ç > 0;Ç -= 16) {

88 
	`ngx_md5_upd©e
(&
md5
, 
föÆ
, 
n
 > 16 ? 16 :Ç);

91 
	`ngx_memzîo
(
föÆ
, (final));

93 
i
 = 
keyÀn
; i; i >>= 1) {

94 i‡(
i
 & 1) {

95 
	`ngx_md5_upd©e
(&
md5
, 
föÆ
, 1);

98 
	`ngx_md5_upd©e
(&
md5
, 
key
, 1);

102 
	`ngx_md5_föÆ
(
föÆ
, &
md5
);

104 
i
 = 0; i < 1000; i++) {

105 
	`ngx_md5_öô
(&
˘x1
);

107 i‡(
i
 & 1) {

108 
	`ngx_md5_upd©e
(&
˘x1
, 
key
, 
keyÀn
);

111 
	`ngx_md5_upd©e
(&
˘x1
, 
föÆ
, 16);

114 i‡(
i
 % 3) {

115 
	`ngx_md5_upd©e
(&
˘x1
, 
ß…
, 
ß…Àn
);

118 i‡(
i
 % 7) {

119 
	`ngx_md5_upd©e
(&
˘x1
, 
key
, 
keyÀn
);

122 i‡(
i
 & 1) {

123 
	`ngx_md5_upd©e
(&
˘x1
, 
föÆ
, 16);

126 
	`ngx_md5_upd©e
(&
˘x1
, 
key
, 
keyÀn
);

129 
	`ngx_md5_föÆ
(
föÆ
, &
˘x1
);

134 *
í¸y±ed
 = 
	`ngx_≤Æloc
(
poﬁ
, ("$≠r1$"Ë- 1 + 
ß…Àn
 + 16 + 1);

135 i‡(*
í¸y±ed
 =
NULL
) {

136  
NGX_ERROR
;

139 
p
 = 
	`ngx_˝ymem
(*
í¸y±ed
, "$apr1$", ("$apr1$") - 1);

140 
p
 = 
	`ngx_c›y
’, 
ß…
, 
ß…Àn
);

141 *
p
++ = '$';

143 
p
 = 
	`ngx_¸y±_to64
’, (
föÆ
[ 0]<<16) | (final[ 6]<<8) | final[12], 4);

144 
p
 = 
	`ngx_¸y±_to64
’, (
föÆ
[ 1]<<16) | (final[ 7]<<8) | final[13], 4);

145 
p
 = 
	`ngx_¸y±_to64
’, (
föÆ
[ 2]<<16) | (final[ 8]<<8) | final[14], 4);

146 
p
 = 
	`ngx_¸y±_to64
’, (
föÆ
[ 3]<<16) | (final[ 9]<<8) | final[15], 4);

147 
p
 = 
	`ngx_¸y±_to64
’, (
föÆ
[ 4]<<16) | (final[10]<<8) | final[ 5], 4);

148 
p
 = 
	`ngx_¸y±_to64
’, 
föÆ
[11], 2);

149 *
p
 = '\0';

151  
NGX_OK
;

152 
	}
}

155 
u_ch¨
 *

156 
	$ngx_¸y±_to64
(
u_ch¨
 *
p
, 
uöt32_t
 
v
, 
size_t
 
n
)

158 
u_ch¨
 
ôﬂ64
[] =

161 
n
--) {

162 *
p
++ = 
ôﬂ64
[
v
 & 0x3f];

163 
v
 >>= 6;

166  
p
;

167 
	}
}

170 
ngx_öt_t


171 
	$ngx_¸y±_∂aö
(
ngx_poﬁ_t
 *
poﬁ
, 
u_ch¨
 *
key
, u_ch¨ *
ß…
, u_ch¨ **
í¸y±ed
)

173 
size_t
 
Àn
;

174 
u_ch¨
 *
p
;

176 
Àn
 = 
	`ngx_°æí
(
key
);

178 *
í¸y±ed
 = 
	`ngx_≤Æloc
(
poﬁ
, ("{PLAIN}"Ë- 1 + 
Àn
 + 1);

179 i‡(*
í¸y±ed
 =
NULL
) {

180  
NGX_ERROR
;

183 
p
 = 
	`ngx_˝ymem
(*
í¸y±ed
, "{PLAIN}", ("{PLAIN}") - 1);

184 
	`ngx_mem˝y
(
p
, 
key
, 
Àn
 + 1);

186  
NGX_OK
;

187 
	}
}

190 #i‡(
NGX_HAVE_SHA1
)

192 
ngx_öt_t


193 
	$ngx_¸y±_ssha
(
ngx_poﬁ_t
 *
poﬁ
, 
u_ch¨
 *
key
, u_ch¨ *
ß…
, u_ch¨ **
í¸y±ed
)

195 
size_t
 
Àn
;

196 
ngx_°r_t
 
ícoded
, 
decoded
;

197 
ngx_sha1_t
 
sha1
;

203 
ícoded
.
d©a
 = 
ß…
 + ("{SSHA}") - 1;

204 
ícoded
.
Àn
 = 
	`ngx_°æí
”ncoded.
d©a
);

206 
decoded
.
d©a
 = 
	`ngx_≤Æloc
(
poﬁ
, 
	`ngx_ba£64_decoded_Àngth
(
ícoded
.
Àn
));

207 i‡(
decoded
.
d©a
 =
NULL
) {

208  
NGX_ERROR
;

211 
	`ngx_decode_ba£64
(&
decoded
, &
ícoded
);

215 
	`ngx_sha1_öô
(&
sha1
);

216 
	`ngx_sha1_upd©e
(&
sha1
, 
key
, 
	`ngx_°æí
(key));

217 
	`ngx_sha1_upd©e
(&
sha1
, 
decoded
.
d©a
 + 20, decoded.
Àn
 - 20);

218 
	`ngx_sha1_föÆ
(
decoded
.
d©a
, &
sha1
);

222 
Àn
 = ("{SSHA}"Ë- 1 + 
	`ngx_ba£64_ícoded_Àngth
(
decoded
.len) + 1;

224 *
í¸y±ed
 = 
	`ngx_≤Æloc
(
poﬁ
, 
Àn
);

225 i‡(*
í¸y±ed
 =
NULL
) {

226  
NGX_ERROR
;

229 
ícoded
.
d©a
 = 
	`ngx_˝ymem
(*
í¸y±ed
, "{SSHA}", ("{SSHA}") - 1);

230 
	`ngx_ícode_ba£64
(&
ícoded
, &
decoded
);

231 
ícoded
.
d©a
[ícoded.
Àn
] = '\0';

233  
NGX_OK
;

234 
	}
}

	@ngx_crypt.h

8 #i‚de‡
_NGX_CRYPT_H_INCLUDED_


9 
	#_NGX_CRYPT_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 
ngx_öt_t
 
ngx_¸y±
(
ngx_poﬁ_t
 *
poﬁ
, 
u_ch¨
 *
key
, u_ch¨ *
ß…
,

17 
u_ch¨
 **
í¸y±ed
);

	@ngx_cycle.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

10 
	~<ngx_evít.h
>

13 
ngx_de°roy_cy˛e_poﬁs
(
ngx_c⁄f_t
 *
c⁄f
);

14 
ngx_öt_t
 
ngx_cmp_sockaddr
(
sockaddr
 *
ß1
, sockadd∏*
ß2
);

15 
ngx_öt_t
 
ngx_öô_z⁄e_poﬁ
(
ngx_cy˛e_t
 *
cy˛e
,

16 
ngx_shm_z⁄e_t
 *
shm_z⁄e
);

17 
ngx_öt_t
 
ngx_ã°_lockfûe
(
u_ch¨
 *
fûe
, 
ngx_log_t
 *
log
);

18 
ngx_˛ón_ﬁd_cy˛es
(
ngx_evít_t
 *
ev
);

21 vﬁ©ûê
ngx_cy˛e_t
 *
	gngx_cy˛e
;

22 
ngx_¨øy_t
 
	gngx_ﬁd_cy˛es
;

24 
ngx_poﬁ_t
 *
	gngx_ãmp_poﬁ
;

25 
ngx_evít_t
 
	gngx_˛ó√r_evít
;

27 
ngx_uöt_t
 
	gngx_ã°_c⁄fig
;

28 
ngx_uöt_t
 
	gngx_quõt_mode
;

30 #i‡(
NGX_THREADS
)

31 
ngx_és_key_t
 
	gngx_c‹e_és_key
;

36 
ngx_c⁄√˘i⁄_t
 
	gdumb
;

39 
ngx_°r_t
 
	gîr‹_log
 = 
ngx_°rög
(
NGX_ERROR_LOG_PATH
);

42 
ngx_cy˛e_t
 *

43 
	$ngx_öô_cy˛e
(
ngx_cy˛e_t
 *
ﬁd_cy˛e
)

45 *
rv
;

46 **
£nv
, **
ív
;

47 
ngx_uöt_t
 
i
, 
n
;

48 
ngx_log_t
 *
log
;

49 
ngx_time_t
 *
ç
;

50 
ngx_c⁄f_t
 
c⁄f
;

51 
ngx_poﬁ_t
 *
poﬁ
;

52 
ngx_cy˛e_t
 *
cy˛e
, **
ﬁd
;

53 
ngx_shm_z⁄e_t
 *
shm_z⁄e
, *
oshm_z⁄e
;

54 
ngx_li°_∑π_t
 *
∑π
, *
›¨t
;

55 
ngx_›í_fûe_t
 *
fûe
;

56 
ngx_li°íög_t
 *
ls
, *
∆s
;

57 
ngx_c‹e_c⁄f_t
 *
ccf
, *
ﬁd_ccf
;

58 
ngx_c‹e_moduÀ_t
 *
moduÀ
;

59 
ho°«me
[
NGX_MAXHOSTNAMELEN
];

61 
	`ngx_timez⁄e_upd©e
();

65 
ç
 = 
	`ngx_timeofday
();

66 
ç
->
£c
 = 0;

68 
	`ngx_time_upd©e
();

71 
log
 = 
ﬁd_cy˛e
->log;

73 
poﬁ
 = 
	`ngx_¸óã_poﬁ
(
NGX_CYCLE_POOL_SIZE
, 
log
);

74 i‡(
poﬁ
 =
NULL
) {

75  
NULL
;

77 
poﬁ
->
log
 =Üog;

79 
cy˛e
 = 
	`ngx_pˇŒoc
(
poﬁ
, (
ngx_cy˛e_t
));

80 i‡(
cy˛e
 =
NULL
) {

81 
	`ngx_de°roy_poﬁ
(
poﬁ
);

82  
NULL
;

85 
cy˛e
->
poﬁ
 =Öool;

86 
cy˛e
->
log
 =Üog;

87 
cy˛e
->
√w_log
.
log_Àvñ
 = 
NGX_LOG_ERR
;

88 
cy˛e
->
ﬁd_cy˛e
 = old_cycle;

90 
cy˛e
->
c⁄f_¥efix
.
Àn
 = 
ﬁd_cy˛e
->conf_prefix.len;

91 
cy˛e
->
c⁄f_¥efix
.
d©a
 = 
	`ngx_p°rdup
(
poﬁ
, &
ﬁd_cy˛e
->conf_prefix);

92 i‡(
cy˛e
->
c⁄f_¥efix
.
d©a
 =
NULL
) {

93 
	`ngx_de°roy_poﬁ
(
poﬁ
);

94  
NULL
;

97 
cy˛e
->
¥efix
.
Àn
 = 
ﬁd_cy˛e
->prefix.len;

98 
cy˛e
->
¥efix
.
d©a
 = 
	`ngx_p°rdup
(
poﬁ
, &
ﬁd_cy˛e
->prefix);

99 i‡(
cy˛e
->
¥efix
.
d©a
 =
NULL
) {

100 
	`ngx_de°roy_poﬁ
(
poﬁ
);

101  
NULL
;

104 
cy˛e
->
c⁄f_fûe
.
Àn
 = 
ﬁd_cy˛e
->conf_file.len;

105 
cy˛e
->
c⁄f_fûe
.
d©a
 = 
	`ngx_≤Æloc
(
poﬁ
, 
ﬁd_cy˛e
->c⁄f_fûe.
Àn
 + 1);

106 i‡(
cy˛e
->
c⁄f_fûe
.
d©a
 =
NULL
) {

107 
	`ngx_de°roy_poﬁ
(
poﬁ
);

108  
NULL
;

110 
	`ngx_˝y°∫
(
cy˛e
->
c⁄f_fûe
.
d©a
, 
ﬁd_cy˛e
->conf_file.data,

111 
ﬁd_cy˛e
->
c⁄f_fûe
.
Àn
 + 1);

113 
cy˛e
->
c⁄f_∑øm
.
Àn
 = 
ﬁd_cy˛e
->conf_param.len;

114 
cy˛e
->
c⁄f_∑øm
.
d©a
 = 
	`ngx_p°rdup
(
poﬁ
, &
ﬁd_cy˛e
->conf_param);

115 i‡(
cy˛e
->
c⁄f_∑øm
.
d©a
 =
NULL
) {

116 
	`ngx_de°roy_poﬁ
(
poﬁ
);

117  
NULL
;

121 
n
 = 
ﬁd_cy˛e
->
∑thes
.
√…s
 ? old_cycle->pathes.nelts : 10;

123 
cy˛e
->
∑thes
.
ñts
 = 
	`ngx_pˇŒoc
(
poﬁ
, 
n
 * (
ngx_∑th_t
 *));

124 i‡(
cy˛e
->
∑thes
.
ñts
 =
NULL
) {

125 
	`ngx_de°roy_poﬁ
(
poﬁ
);

126  
NULL
;

129 
cy˛e
->
∑thes
.
√…s
 = 0;

130 
cy˛e
->
∑thes
.
size
 = (
ngx_∑th_t
 *);

131 
cy˛e
->
∑thes
.
«Œoc
 = 
n
;

132 
cy˛e
->
∑thes
.
poﬁ
 =Öool;

135 i‡(
ﬁd_cy˛e
->
›í_fûes
.
∑π
.
√…s
) {

136 
n
 = 
ﬁd_cy˛e
->
›í_fûes
.
∑π
.
√…s
;

137 
∑π
 = 
ﬁd_cy˛e
->
›í_fûes
.∑π.
√xt
;Öart;Öart =Öart->next) {

138 
n
 +
∑π
->
√…s
;

142 
n
 = 20;

145 i‡(
	`ngx_li°_öô
(&
cy˛e
->
›í_fûes
, 
poﬁ
, 
n
, (
ngx_›í_fûe_t
))

146 !
NGX_OK
)

148 
	`ngx_de°roy_poﬁ
(
poﬁ
);

149  
NULL
;

153 i‡(
ﬁd_cy˛e
->
sh¨ed_mem‹y
.
∑π
.
√…s
) {

154 
n
 = 
ﬁd_cy˛e
->
sh¨ed_mem‹y
.
∑π
.
√…s
;

155 
∑π
 = 
ﬁd_cy˛e
->
sh¨ed_mem‹y
.∑π.
√xt
;Öart;Öart =Öart->next)

157 
n
 +
∑π
->
√…s
;

161 
n
 = 1;

164 i‡(
	`ngx_li°_öô
(&
cy˛e
->
sh¨ed_mem‹y
, 
poﬁ
, 
n
, (
ngx_shm_z⁄e_t
))

165 !
NGX_OK
)

167 
	`ngx_de°roy_poﬁ
(
poﬁ
);

168  
NULL
;

171 
n
 = 
ﬁd_cy˛e
->
li°íög
.
√…s
 ? old_cycle->listening.nelts : 10;

173 
cy˛e
->
li°íög
.
ñts
 = 
	`ngx_pˇŒoc
(
poﬁ
, 
n
 * (
ngx_li°íög_t
));

174 i‡(
cy˛e
->
li°íög
.
ñts
 =
NULL
) {

175 
	`ngx_de°roy_poﬁ
(
poﬁ
);

176  
NULL
;

179 
cy˛e
->
li°íög
.
√…s
 = 0;

180 
cy˛e
->
li°íög
.
size
 = (
ngx_li°íög_t
);

181 
cy˛e
->
li°íög
.
«Œoc
 = 
n
;

182 
cy˛e
->
li°íög
.
poﬁ
 =Öool;

185 
	`ngx_queue_öô
(&
cy˛e
->
ªußbÀ_c⁄√˘i⁄s_queue
);

188 
cy˛e
->
c⁄f_˘x
 = 
	`ngx_pˇŒoc
(
poﬁ
, 
ngx_max_moduÀ
 * (*));

189 i‡(
cy˛e
->
c⁄f_˘x
 =
NULL
) {

190 
	`ngx_de°roy_poﬁ
(
poﬁ
);

191  
NULL
;

195 i‡(
	`gëho°«me
(
ho°«me
, 
NGX_MAXHOSTNAMELEN
) == -1) {

196 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_î∫o
, "gethostname() failed");

197 
	`ngx_de°roy_poﬁ
(
poﬁ
);

198  
NULL
;

203 
ho°«me
[
NGX_MAXHOSTNAMELEN
 - 1] = '\0';

204 
cy˛e
->
ho°«me
.
Àn
 = 
	`ngx_°æí
(hostname);

206 
cy˛e
->
ho°«me
.
d©a
 = 
	`ngx_≤Æloc
(
poﬁ
, cy˛e->ho°«me.
Àn
);

207 i‡(
cy˛e
->
ho°«me
.
d©a
 =
NULL
) {

208 
	`ngx_de°roy_poﬁ
(
poﬁ
);

209  
NULL
;

212 
	`ngx_°æow
(
cy˛e
->
ho°«me
.
d©a
, (
u_ch¨
 *Ëho°«me, cy˛e->ho°«me.
Àn
);

215 
i
 = 0; 
ngx_moduÀs
[i]; i++) {

216 i‡(
ngx_moduÀs
[
i
]->
ty≥
 !
NGX_CORE_MODULE
) {

220 
moduÀ
 = 
ngx_moduÀs
[
i
]->
˘x
;

222 i‡(
moduÀ
->
¸óã_c⁄f
) {

223 
rv
 = 
moduÀ
->
	`¸óã_c⁄f
(
cy˛e
);

224 i‡(
rv
 =
NULL
) {

225 
	`ngx_de°roy_poﬁ
(
poﬁ
);

226  
NULL
;

228 
cy˛e
->
c⁄f_˘x
[
ngx_moduÀs
[
i
]->
ödex
] = 
rv
;

233 
£nv
 = 
ívú⁄
;

236 
	`ngx_memzîo
(&
c⁄f
, (
ngx_c⁄f_t
));

238 
c⁄f
.
¨gs
 = 
	`ngx_¨øy_¸óã
(
poﬁ
, 10, (
ngx_°r_t
));

239 i‡(
c⁄f
.
¨gs
 =
NULL
) {

240 
	`ngx_de°roy_poﬁ
(
poﬁ
);

241  
NULL
;

244 
c⁄f
.
ãmp_poﬁ
 = 
	`ngx_¸óã_poﬁ
(
NGX_CYCLE_POOL_SIZE
, 
log
);

245 i‡(
c⁄f
.
ãmp_poﬁ
 =
NULL
) {

246 
	`ngx_de°roy_poﬁ
(
poﬁ
);

247  
NULL
;

251 
c⁄f
.
˘x
 = 
cy˛e
->
c⁄f_˘x
;

252 
c⁄f
.
cy˛e
 = cycle;

253 
c⁄f
.
poﬁ
 =Öool;

254 
c⁄f
.
log
 =Üog;

255 
c⁄f
.
moduÀ_ty≥
 = 
NGX_CORE_MODULE
;

256 
c⁄f
.
cmd_ty≥
 = 
NGX_MAIN_CONF
;

259 
log
->
log_Àvñ
 = 
NGX_LOG_DEBUG_ALL
;

262 i‡(
	`ngx_c⁄f_∑øm
(&
c⁄f
Ë!
NGX_CONF_OK
) {

263 
ívú⁄
 = 
£nv
;

264 
	`ngx_de°roy_cy˛e_poﬁs
(&
c⁄f
);

265  
NULL
;

268 i‡(
	`ngx_c⁄f_∑r£
(&
c⁄f
, &
cy˛e
->
c⁄f_fûe
Ë!
NGX_CONF_OK
) {

269 
ívú⁄
 = 
£nv
;

270 
	`ngx_de°roy_cy˛e_poﬁs
(&
c⁄f
);

271  
NULL
;

274 i‡(
ngx_ã°_c⁄fig
 && !
ngx_quõt_mode
) {

275 
	`ngx_log_°dîr
(0, "the configuration file %s syntax is ok",

276 
cy˛e
->
c⁄f_fûe
.
d©a
);

279 
i
 = 0; 
ngx_moduÀs
[i]; i++) {

280 i‡(
ngx_moduÀs
[
i
]->
ty≥
 !
NGX_CORE_MODULE
) {

284 
moduÀ
 = 
ngx_moduÀs
[
i
]->
˘x
;

286 i‡(
moduÀ
->
öô_c⁄f
) {

287 i‡(
moduÀ
->
	`öô_c⁄f
(
cy˛e
, cy˛e->
c⁄f_˘x
[
ngx_moduÀs
[
i
]->
ödex
])

288 =
NGX_CONF_ERROR
)

290 
ívú⁄
 = 
£nv
;

291 
	`ngx_de°roy_cy˛e_poﬁs
(&
c⁄f
);

292  
NULL
;

297 i‡(
ngx_¥o˚ss
 =
NGX_PROCESS_SIGNALLER
) {

298  
cy˛e
;

301 
ccf
 = (
ngx_c‹e_c⁄f_t
 *Ë
	`ngx_gë_c⁄f
(
cy˛e
->
c⁄f_˘x
, 
ngx_c‹e_moduÀ
);

303 i‡(
ngx_ã°_c⁄fig
) {

305 i‡(
	`ngx_¸óã_pidfûe
(&
ccf
->
pid
, 
log
Ë!
NGX_OK
) {

306 
Áûed
;

309 } i‡(!
	`ngx_is_öô_cy˛e
(
ﬁd_cy˛e
)) {

316 
ﬁd_ccf
 = (
ngx_c‹e_c⁄f_t
 *Ë
	`ngx_gë_c⁄f
(
ﬁd_cy˛e
->
c⁄f_˘x
,

317 
ngx_c‹e_moduÀ
);

318 i‡(
ccf
->
pid
.
Àn
 !
ﬁd_ccf
->pid.len

319 || 
	`ngx_°rcmp
(
ccf
->
pid
.
d©a
, 
ﬁd_ccf
->pid.data) != 0)

323 i‡(
	`ngx_¸óã_pidfûe
(&
ccf
->
pid
, 
log
Ë!
NGX_OK
) {

324 
Áûed
;

327 
	`ngx_dñëe_pidfûe
(
ﬁd_cy˛e
);

332 i‡(
	`ngx_ã°_lockfûe
(
cy˛e
->
lock_fûe
.
d©a
, 
log
Ë!
NGX_OK
) {

333 
Áûed
;

337 i‡(
	`ngx_¸óã_∑thes
(
cy˛e
, 
ccf
->
u£r
Ë!
NGX_OK
) {

338 
Áûed
;

342 i‡(
cy˛e
->
√w_log
.
fûe
 =
NULL
) {

343 
cy˛e
->
√w_log
.
fûe
 = 
	`ngx_c⁄f_›í_fûe
(cy˛e, &
îr‹_log
);

344 i‡(
cy˛e
->
√w_log
.
fûe
 =
NULL
) {

345 
Áûed
;

351 
∑π
 = &
cy˛e
->
›í_fûes
.part;

352 
fûe
 = 
∑π
->
ñts
;

354 
i
 = 0; ; i++) {

356 i‡(
i
 >
∑π
->
√…s
) {

357 i‡(
∑π
->
√xt
 =
NULL
) {

360 
∑π
 =Ö¨t->
√xt
;

361 
fûe
 = 
∑π
->
ñts
;

362 
i
 = 0;

365 i‡(
fûe
[
i
].
«me
.
Àn
 == 0) {

369 
fûe
[
i
].
fd
 = 
	`ngx_›í_fûe
(fûe[i].
«me
.
d©a
,

370 
NGX_FILE_APPEND
,

371 
NGX_FILE_CREATE_OR_OPEN
,

372 
NGX_FILE_DEFAULT_ACCESS
);

374 
	`ngx_log_debug3
(
NGX_LOG_DEBUG_CORE
, 
log
, 0,

376 &
fûe
[
i
], fûe[i].
fd
, fûe[i].
«me
.
d©a
);

378 i‡(
fûe
[
i
].
fd
 =
NGX_INVALID_FILE
) {

379 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_î∫o
,

380 
ngx_›í_fûe_n
 " \"%s\" failed",

381 
fûe
[
i
].
«me
.
d©a
);

382 
Áûed
;

385 #i‡!(
NGX_WIN32
)

386 i‡(
	`f˙é
(
fûe
[
i
].
fd
, 
F_SETFD
, 
FD_CLOEXEC
) == -1) {

387 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_î∫o
,

389 
fûe
[
i
].
«me
.
d©a
);

390 
Áûed
;

395 
cy˛e
->
log
 = &cy˛e->
√w_log
;

396 
poﬁ
->
log
 = &
cy˛e
->
√w_log
;

401 
∑π
 = &
cy˛e
->
sh¨ed_mem‹y
.part;

402 
shm_z⁄e
 = 
∑π
->
ñts
;

404 
i
 = 0; ; i++) {

406 i‡(
i
 >
∑π
->
√…s
) {

407 i‡(
∑π
->
√xt
 =
NULL
) {

410 
∑π
 =Ö¨t->
√xt
;

411 
shm_z⁄e
 = 
∑π
->
ñts
;

412 
i
 = 0;

415 i‡(
shm_z⁄e
[
i
].
shm
.
size
 == 0) {

416 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 0,

418 &
shm_z⁄e
[
i
].
shm
.
«me
);

419 
Áûed
;

422 
shm_z⁄e
[
i
].
shm
.
log
 = 
cy˛e
->log;

424 
›¨t
 = &
ﬁd_cy˛e
->
sh¨ed_mem‹y
.
∑π
;

425 
oshm_z⁄e
 = 
›¨t
->
ñts
;

427 
n
 = 0; ;Ç++) {

429 i‡(
n
 >
›¨t
->
√…s
) {

430 i‡(
›¨t
->
√xt
 =
NULL
) {

433 
›¨t
 = o∑π->
√xt
;

434 
oshm_z⁄e
 = 
›¨t
->
ñts
;

435 
n
 = 0;

438 i‡(
shm_z⁄e
[
i
].
shm
.
«me
.
Àn
 !
oshm_z⁄e
[
n
].shm.name.len) {

442 i‡(
	`ngx_°∫cmp
(
shm_z⁄e
[
i
].
shm
.
«me
.
d©a
,

443 
oshm_z⁄e
[
n
].
shm
.
«me
.
d©a
,

444 
shm_z⁄e
[
i
].
shm
.
«me
.
Àn
)

450 i‡(
shm_z⁄e
[
i
].
shm
.
size
 =
oshm_z⁄e
[
n
].shm.size) {

451 
shm_z⁄e
[
i
].
shm
.
addr
 = 
oshm_z⁄e
[
n
].shm.addr;

453 i‡(
shm_z⁄e
[
i
].
	`öô
(&shm_z⁄e[i], 
oshm_z⁄e
[
n
].
d©a
)

454 !
NGX_OK
)

456 
Áûed
;

459 
shm_z⁄e_found
;

462 
	`ngx_shm_‰ì
(&
oshm_z⁄e
[
n
].
shm
);

467 i‡(
	`ngx_shm_Æloc
(&
shm_z⁄e
[
i
].
shm
Ë!
NGX_OK
) {

468 
Áûed
;

471 i‡(
	`ngx_öô_z⁄e_poﬁ
(
cy˛e
, &
shm_z⁄e
[
i
]Ë!
NGX_OK
) {

472 
Áûed
;

475 i‡(
shm_z⁄e
[
i
].
	`öô
(&shm_z⁄e[i], 
NULL
Ë!
NGX_OK
) {

476 
Áûed
;

479 
shm_z⁄e_found
:

487 i‡(
ﬁd_cy˛e
->
li°íög
.
√…s
) {

488 
ls
 = 
ﬁd_cy˛e
->
li°íög
.
ñts
;

489 
i
 = 0; i < 
ﬁd_cy˛e
->
li°íög
.
√…s
; i++) {

490 
ls
[
i
].
ªmaö
 = 0;

493 
∆s
 = 
cy˛e
->
li°íög
.
ñts
;

494 
n
 = 0;Ç < 
cy˛e
->
li°íög
.
√…s
;Ç++) {

496 
i
 = 0; i < 
ﬁd_cy˛e
->
li°íög
.
√…s
; i++) {

497 i‡(
ls
[
i
].
ign‹e
) {

501 i‡(
	`ngx_cmp_sockaddr
(
∆s
[
n
].
sockaddr
, 
ls
[
i
].sockaddrË=
NGX_OK
)

503 
∆s
[
n
].
fd
 = 
ls
[
i
].fd;

504 
∆s
[
n
].
¥evious
 = &
ls
[
i
];

505 
ls
[
i
].
ªmaö
 = 1;

507 i‡(
ls
[
n
].
backlog
 !
∆s
[
i
].backlog) {

508 
∆s
[
n
].
li°í
 = 1;

511 #i‡(
NGX_HAVE_DEFERRED_ACCEPT
 && 
deföed
 
SO_ACCEPTFILTER
)

517 
∆s
[
n
].
de„ºed_ac˚±
 = 
ls
[
i
].deferred_accept;

519 i‡(
ls
[
i
].
ac˚±_fûãr
 && 
∆s
[
n
].accept_filter) {

520 i‡(
	`ngx_°rcmp
(
ls
[
i
].
ac˚±_fûãr
,

521 
∆s
[
n
].
ac˚±_fûãr
)

524 
∆s
[
n
].
dñëe_de„ºed
 = 1;

525 
∆s
[
n
].
add_de„ºed
 = 1;

528 } i‡(
ls
[
i
].
ac˚±_fûãr
) {

529 
∆s
[
n
].
dñëe_de„ºed
 = 1;

531 } i‡(
∆s
[
n
].
ac˚±_fûãr
) {

532 
∆s
[
n
].
add_de„ºed
 = 1;

536 #i‡(
NGX_HAVE_DEFERRED_ACCEPT
 && 
deföed
 
TCP_DEFER_ACCEPT
)

538 i‡(
ls
[
n
].
de„ºed_ac˚±
 && !
∆s
[n].deferred_accept) {

539 
∆s
[
n
].
dñëe_de„ºed
 = 1;

541 } i‡(
ls
[
i
].
de„ºed_ac˚±
 !
∆s
[
n
].deferred_accept)

543 
∆s
[
n
].
add_de„ºed
 = 1;

550 i‡(
∆s
[
n
].
fd
 == -1) {

551 
∆s
[
n
].
›í
 = 1;

556 
ls
 = 
cy˛e
->
li°íög
.
ñts
;

557 
i
 = 0; i < 
cy˛e
->
li°íög
.
√…s
; i++) {

558 
ls
[
i
].
›í
 = 1;

559 #i‡(
NGX_HAVE_DEFERRED_ACCEPT
 && 
deföed
 
SO_ACCEPTFILTER
)

560 i‡(
ls
[
i
].
ac˚±_fûãr
) {

561 
ls
[
i
].
add_de„ºed
 = 1;

564 #i‡(
NGX_HAVE_DEFERRED_ACCEPT
 && 
deföed
 
TCP_DEFER_ACCEPT
)

565 i‡(
ls
[
i
].
de„ºed_ac˚±
) {

566 
ls
[
i
].
add_de„ºed
 = 1;

572 i‡(
	`ngx_›í_li°íög_sockës
(
cy˛e
Ë!
NGX_OK
) {

573 
Áûed
;

576 i‡(!
ngx_ã°_c⁄fig
) {

577 
	`ngx_c⁄figuª_li°íög_sockës
(
cy˛e
);

583 i‡(!
ngx_u£_°dîr
 && 
cy˛e
->
log
->
fûe
->
fd
 !
ngx_°dîr
) {

585 i‡(
	`ngx_£t_°dîr
(
cy˛e
->
log
->
fûe
->
fd
Ë=
NGX_FILE_ERROR
) {

586 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_î∫o
,

587 
ngx_£t_°dîr_n
 " failed");

591 
poﬁ
->
log
 = 
cy˛e
->log;

593 
i
 = 0; 
ngx_moduÀs
[i]; i++) {

594 i‡(
ngx_moduÀs
[
i
]->
öô_moduÀ
) {

595 i‡(
ngx_moduÀs
[
i
]->
	`öô_moduÀ
(
cy˛e
Ë!
NGX_OK
) {

597 
	`exô
(1);

607 
›¨t
 = &
ﬁd_cy˛e
->
sh¨ed_mem‹y
.
∑π
;

608 
oshm_z⁄e
 = 
›¨t
->
ñts
;

610 
i
 = 0; ; i++) {

612 i‡(
i
 >
›¨t
->
√…s
) {

613 i‡(
›¨t
->
√xt
 =
NULL
) {

614 
ﬁd_shm_z⁄e_d⁄e
;

616 
›¨t
 = o∑π->
√xt
;

617 
oshm_z⁄e
 = 
›¨t
->
ñts
;

618 
i
 = 0;

621 
∑π
 = &
cy˛e
->
sh¨ed_mem‹y
.part;

622 
shm_z⁄e
 = 
∑π
->
ñts
;

624 
n
 = 0; ;Ç++) {

626 i‡(
n
 >
∑π
->
√…s
) {

627 i‡(
∑π
->
√xt
 =
NULL
) {

630 
∑π
 =Ö¨t->
√xt
;

631 
shm_z⁄e
 = 
∑π
->
ñts
;

632 
n
 = 0;

635 i‡(
oshm_z⁄e
[
i
].
shm
.
«me
.
Àn
 =
shm_z⁄e
[
n
].shm.name.len

636 && 
	`ngx_°∫cmp
(
oshm_z⁄e
[
i
].
shm
.
«me
.
d©a
,

637 
shm_z⁄e
[
n
].
shm
.
«me
.
d©a
,

638 
oshm_z⁄e
[
i
].
shm
.
«me
.
Àn
)

641 
live_shm_z⁄e
;

645 
	`ngx_shm_‰ì
(&
oshm_z⁄e
[
i
].
shm
);

647 
live_shm_z⁄e
:

652 
ﬁd_shm_z⁄e_d⁄e
:

657 
ls
 = 
ﬁd_cy˛e
->
li°íög
.
ñts
;

658 
i
 = 0; i < 
ﬁd_cy˛e
->
li°íög
.
√…s
; i++) {

660 i‡(
ls
[
i
].
ªmaö
 ||Üs[i].
fd
 == -1) {

664 i‡(
	`ngx_˛o£_sockë
(
ls
[
i
].
fd
) == -1) {

665 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_sockë_î∫o
,

666 
ngx_˛o£_sockë_n
 "Üistening socket on %V failed",

667 &
ls
[
i
].
addr_ãxt
);

670 #i‡(
NGX_HAVE_UNIX_DOMAIN
)

672 i‡(
ls
[
i
].
sockaddr
->
ß_Ámûy
 =
AF_UNIX
) {

673 
u_ch¨
 *
«me
;

675 
«me
 = 
ls
[
i
].
addr_ãxt
.
d©a
 + ("unix:") - 1;

677 
	`ngx_log_îr‹
(
NGX_LOG_WARN
, 
cy˛e
->
log
, 0,

678 "dñëög sockë %s", 
«me
);

680 i‡(
	`ngx_dñëe_fûe
(
«me
) == -1) {

681 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_sockë_î∫o
,

682 
ngx_dñëe_fûe_n
 " %†Áûed", 
«me
);

692 
∑π
 = &
ﬁd_cy˛e
->
›í_fûes
.part;

693 
fûe
 = 
∑π
->
ñts
;

695 
i
 = 0; ; i++) {

697 i‡(
i
 >
∑π
->
√…s
) {

698 i‡(
∑π
->
√xt
 =
NULL
) {

701 
∑π
 =Ö¨t->
√xt
;

702 
fûe
 = 
∑π
->
ñts
;

703 
i
 = 0;

706 i‡(
fûe
[
i
].
fd
 =
NGX_INVALID_FILE
 || fûe[i].fd =
ngx_°dîr
) {

710 i‡(
	`ngx_˛o£_fûe
(
fûe
[
i
].
fd
Ë=
NGX_FILE_ERROR
) {

711 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_î∫o
,

712 
ngx_˛o£_fûe_n
 " \"%s\" failed",

713 
fûe
[
i
].
«me
.
d©a
);

717 
	`ngx_de°roy_poﬁ
(
c⁄f
.
ãmp_poﬁ
);

719 i‡(
ngx_¥o˚ss
 =
NGX_PROCESS_MASTER
 || 
	`ngx_is_öô_cy˛e
(
ﬁd_cy˛e
)) {

727 
ív
 = 
ívú⁄
;

728 
ívú⁄
 = 
£nv
;

730 
	`ngx_de°roy_poﬁ
(
ﬁd_cy˛e
->
poﬁ
);

731 
cy˛e
->
ﬁd_cy˛e
 = 
NULL
;

733 
ívú⁄
 = 
ív
;

735  
cy˛e
;

739 i‡(
ngx_ãmp_poﬁ
 =
NULL
) {

740 
ngx_ãmp_poﬁ
 = 
	`ngx_¸óã_poﬁ
(128, 
cy˛e
->
log
);

741 i‡(
ngx_ãmp_poﬁ
 =
NULL
) {

742 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 0,

744 
	`exô
(1);

747 
n
 = 10;

748 
ngx_ﬁd_cy˛es
.
ñts
 = 
	`ngx_pˇŒoc
(
ngx_ãmp_poﬁ
,

749 
n
 * (
ngx_cy˛e_t
 *));

750 i‡(
ngx_ﬁd_cy˛es
.
ñts
 =
NULL
) {

751 
	`exô
(1);

753 
ngx_ﬁd_cy˛es
.
√…s
 = 0;

754 
ngx_ﬁd_cy˛es
.
size
 = (
ngx_cy˛e_t
 *);

755 
ngx_ﬁd_cy˛es
.
«Œoc
 = 
n
;

756 
ngx_ﬁd_cy˛es
.
poﬁ
 = 
ngx_ãmp_poﬁ
;

758 
ngx_˛ó√r_evít
.
h™dÀr
 = 
ngx_˛ón_ﬁd_cy˛es
;

759 
ngx_˛ó√r_evít
.
log
 = 
cy˛e
->log;

760 
ngx_˛ó√r_evít
.
d©a
 = &
dumb
;

761 
dumb
.
fd
 = (
ngx_sockë_t
) -1;

764 
ngx_ãmp_poﬁ
->
log
 = 
cy˛e
->log;

766 
ﬁd
 = 
	`ngx_¨øy_push
(&
ngx_ﬁd_cy˛es
);

767 i‡(
ﬁd
 =
NULL
) {

768 
	`exô
(1);

770 *
ﬁd
 = 
ﬁd_cy˛e
;

772 i‡(!
ngx_˛ó√r_evít
.
timî_£t
) {

773 
	`ngx_add_timî
(&
ngx_˛ó√r_evít
, 30000);

774 
ngx_˛ó√r_evít
.
timî_£t
 = 1;

777  
cy˛e
;

780 
Áûed
:

782 i‡(!
	`ngx_is_öô_cy˛e
(
ﬁd_cy˛e
)) {

783 
ﬁd_ccf
 = (
ngx_c‹e_c⁄f_t
 *Ë
	`ngx_gë_c⁄f
(
ﬁd_cy˛e
->
c⁄f_˘x
,

784 
ngx_c‹e_moduÀ
);

785 i‡(
ﬁd_ccf
->
ívú⁄mít
) {

786 
ívú⁄
 = 
ﬁd_ccf
->
ívú⁄mít
;

792 
∑π
 = &
cy˛e
->
›í_fûes
.part;

793 
fûe
 = 
∑π
->
ñts
;

795 
i
 = 0; ; i++) {

797 i‡(
i
 >
∑π
->
√…s
) {

798 i‡(
∑π
->
√xt
 =
NULL
) {

801 
∑π
 =Ö¨t->
√xt
;

802 
fûe
 = 
∑π
->
ñts
;

803 
i
 = 0;

806 i‡(
fûe
[
i
].
fd
 =
NGX_INVALID_FILE
 || fûe[i].fd =
ngx_°dîr
) {

810 i‡(
	`ngx_˛o£_fûe
(
fûe
[
i
].
fd
Ë=
NGX_FILE_ERROR
) {

811 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_î∫o
,

812 
ngx_˛o£_fûe_n
 " \"%s\" failed",

813 
fûe
[
i
].
«me
.
d©a
);

817 i‡(
ngx_ã°_c⁄fig
) {

818 
	`ngx_de°roy_cy˛e_poﬁs
(&
c⁄f
);

819  
NULL
;

822 
ls
 = 
cy˛e
->
li°íög
.
ñts
;

823 
i
 = 0; i < 
cy˛e
->
li°íög
.
√…s
; i++) {

824 i‡(
ls
[
i
].
fd
 =-1 || !ls[i].
›í
) {

828 i‡(
	`ngx_˛o£_sockë
(
ls
[
i
].
fd
) == -1) {

829 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_sockë_î∫o
,

830 
ngx_˛o£_sockë_n
 " %V failed",

831 &
ls
[
i
].
addr_ãxt
);

835 
	`ngx_de°roy_cy˛e_poﬁs
(&
c⁄f
);

837  
NULL
;

838 
	}
}

842 
	$ngx_de°roy_cy˛e_poﬁs
(
ngx_c⁄f_t
 *
c⁄f
)

844 
	`ngx_de°roy_poﬁ
(
c⁄f
->
ãmp_poﬁ
);

845 
	`ngx_de°roy_poﬁ
(
c⁄f
->
poﬁ
);

846 
	}
}

849 
ngx_öt_t


850 
	$ngx_cmp_sockaddr
(
sockaddr
 *
ß1
, sockadd∏*
ß2
)

852 
sockaddr_ö
 *
sö1
, *
sö2
;

853 #i‡(
NGX_HAVE_INET6
)

854 
sockaddr_ö6
 *
sö61
, *
sö62
;

856 #i‡(
NGX_HAVE_UNIX_DOMAIN
)

857 
sockaddr_un
 *
ßun1
, *
ßun2
;

860 i‡(
ß1
->
ß_Ámûy
 !
ß2
->sa_family) {

861  
NGX_DECLINED
;

864 
ß1
->
ß_Ámûy
) {

866 #i‡(
NGX_HAVE_INET6
)

867 
AF_INET6
:

868 
sö61
 = (
sockaddr_ö6
 *Ë
ß1
;

869 
sö62
 = (
sockaddr_ö6
 *Ë
ß2
;

871 i‡(
sö61
->
sö6_p‹t
 !
sö62
->sin6_port) {

872  
NGX_DECLINED
;

875 i‡(
	`ngx_memcmp
(&
sö61
->
sö6_addr
, &
sö62
->sin6_addr, 16) != 0) {

876  
NGX_DECLINED
;

882 #i‡(
NGX_HAVE_UNIX_DOMAIN
)

883 
AF_UNIX
:

884 
ßun1
 = (
sockaddr_un
 *Ë
ß1
;

885 
ßun2
 = (
sockaddr_un
 *Ë
ß2
;

887 i‡(
	`ngx_memcmp
(&
ßun1
->
sun_∑th
, &
ßun2
->sun_path,

888 (
ßun1
->
sun_∑th
))

891  
NGX_DECLINED
;

899 
sö1
 = (
sockaddr_ö
 *Ë
ß1
;

900 
sö2
 = (
sockaddr_ö
 *Ë
ß2
;

902 i‡(
sö1
->
sö_p‹t
 !
sö2
->sin_port) {

903  
NGX_DECLINED
;

906 i‡(
sö1
->
sö_addr
.
s_addr
 !
sö2
->sin_addr.s_addr) {

907  
NGX_DECLINED
;

913  
NGX_OK
;

914 
	}
}

917 
ngx_öt_t


918 
	$ngx_öô_z⁄e_poﬁ
(
ngx_cy˛e_t
 *
cy˛e
, 
ngx_shm_z⁄e_t
 *
zn
)

920 
u_ch¨
 *
fûe
;

921 
ngx_¶ab_poﬁ_t
 *
•
;

923 
•
 = (
ngx_¶ab_poﬁ_t
 *Ë
zn
->
shm
.
addr
;

925 i‡(
zn
->
shm
.
exi°s
) {

927 i‡(
•
 =•->
addr
) {

928  
NGX_OK
;

931 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 0,

933 &
zn
->
shm
.
«me
, 
•
->
addr
, sp);

934  
NGX_ERROR
;

937 
•
->
íd
 = 
zn
->
shm
.
addr
 + zn->shm.
size
;

938 
•
->
mö_shi·
 = 3;

939 
•
->
addr
 = 
zn
->
shm
.addr;

941 #i‡(
NGX_HAVE_ATOMIC_OPS
)

943 
fûe
 = 
NULL
;

947 
fûe
 = 
	`ngx_≤Æloc
(
cy˛e
->
poﬁ
, cy˛e->
lock_fûe
.
Àn
 + 
zn
->
shm
.
«me
.len);

948 i‡(
fûe
 =
NULL
) {

949  
NGX_ERROR
;

952 (Ë
	`ngx_•rötf
(
fûe
, "%V%V%Z", &
cy˛e
->
lock_fûe
, &
zn
->
shm
.
«me
);

956 i‡(
	`ngx_shmtx_¸óã
(&
•
->
muãx
, (*Ë&•->
lock
, 
fûe
Ë!
NGX_OK
) {

957  
NGX_ERROR
;

960 
	`ngx_¶ab_öô
(
•
);

962  
NGX_OK
;

963 
	}
}

966 
ngx_öt_t


967 
	$ngx_¸óã_pidfûe
(
ngx_°r_t
 *
«me
, 
ngx_log_t
 *
log
)

969 
size_t
 
Àn
;

970 
ngx_uöt_t
 
¸óã
;

971 
ngx_fûe_t
 
fûe
;

972 
u_ch¨
 
pid
[
NGX_INT64_LEN
 + 2];

974 i‡(
ngx_¥o˚ss
 > 
NGX_PROCESS_MASTER
) {

975  
NGX_OK
;

978 
	`ngx_memzîo
(&
fûe
, (
ngx_fûe_t
));

980 
fûe
.
«me
 = *name;

981 
fûe
.
log
 =Üog;

983 
¸óã
 = 
ngx_ã°_c⁄fig
 ? 
NGX_FILE_CREATE_OR_OPEN
 : 
NGX_FILE_TRUNCATE
;

985 
fûe
.
fd
 = 
	`ngx_›í_fûe
(fûe.
«me
.
d©a
, 
NGX_FILE_RDWR
,

986 
¸óã
, 
NGX_FILE_DEFAULT_ACCESS
);

988 i‡(
fûe
.
fd
 =
NGX_INVALID_FILE
) {

989 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_î∫o
,

990 
ngx_›í_fûe_n
 " \"%s\" faûed", 
fûe
.
«me
.
d©a
);

991  
NGX_ERROR
;

994 i‡(!
ngx_ã°_c⁄fig
) {

995 
Àn
 = 
	`ngx_¢¥ötf
(
pid
, 
NGX_INT64_LEN
 + 2, "%P%N", 
ngx_pid
) -Öid;

997 i‡(
	`ngx_wrôe_fûe
(&
fûe
, 
pid
, 
Àn
, 0Ë=
NGX_ERROR
) {

998  
NGX_ERROR
;

1002 i‡(
	`ngx_˛o£_fûe
(
fûe
.
fd
Ë=
NGX_FILE_ERROR
) {

1003 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
log
, 
ngx_î∫o
,

1004 
ngx_˛o£_fûe_n
 " \"%s\" faûed", 
fûe
.
«me
.
d©a
);

1007  
NGX_OK
;

1008 
	}
}

1012 
	$ngx_dñëe_pidfûe
(
ngx_cy˛e_t
 *
cy˛e
)

1014 
u_ch¨
 *
«me
;

1015 
ngx_c‹e_c⁄f_t
 *
ccf
;

1017 
ccf
 = (
ngx_c‹e_c⁄f_t
 *Ë
	`ngx_gë_c⁄f
(
cy˛e
->
c⁄f_˘x
, 
ngx_c‹e_moduÀ
);

1019 
«me
 = 
ngx_√w_bö¨y
 ? 
ccf
->
ﬁdpid
.
d©a
 : ccf->
pid
.data;

1021 i‡(
	`ngx_dñëe_fûe
(
«me
Ë=
NGX_FILE_ERROR
) {

1022 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_î∫o
,

1023 
ngx_dñëe_fûe_n
 " \"%s\" faûed", 
«me
);

1025 
	}
}

1028 
ngx_öt_t


1029 
	$ngx_sig«l_¥o˚ss
(
ngx_cy˛e_t
 *
cy˛e
, *
sig
)

1031 
ssize_t
 
n
;

1032 
ngx_öt_t
 
pid
;

1033 
ngx_fûe_t
 
fûe
;

1034 
ngx_c‹e_c⁄f_t
 *
ccf
;

1035 
u_ch¨
 
buf
[
NGX_INT64_LEN
 + 2];

1037 
	`ngx_log_îr‹
(
NGX_LOG_NOTICE
, 
cy˛e
->
log
, 0, "signalÖrocess started");

1039 
ccf
 = (
ngx_c‹e_c⁄f_t
 *Ë
	`ngx_gë_c⁄f
(
cy˛e
->
c⁄f_˘x
, 
ngx_c‹e_moduÀ
);

1041 
fûe
.
«me
 = 
ccf
->
pid
;

1042 
fûe
.
log
 = 
cy˛e
->log;

1044 
fûe
.
fd
 = 
	`ngx_›í_fûe
(fûe.
«me
.
d©a
, 
NGX_FILE_RDONLY
,

1045 
NGX_FILE_OPEN
, 
NGX_FILE_DEFAULT_ACCESS
);

1047 i‡(
fûe
.
fd
 =
NGX_INVALID_FILE
) {

1048 
	`ngx_log_îr‹
(
NGX_LOG_ERR
, 
cy˛e
->
log
, 
ngx_î∫o
,

1049 
ngx_›í_fûe_n
 " \"%s\" faûed", 
fûe
.
«me
.
d©a
);

1053 
n
 = 
	`ngx_ªad_fûe
(&
fûe
, 
buf
, 
NGX_INT64_LEN
 + 2, 0);

1055 i‡(
	`ngx_˛o£_fûe
(
fûe
.
fd
Ë=
NGX_FILE_ERROR
) {

1056 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_î∫o
,

1057 
ngx_˛o£_fûe_n
 " \"%s\" faûed", 
fûe
.
«me
.
d©a
);

1060 i‡(
n
 =
NGX_ERROR
) {

1064 
n
-- && (
buf
[n] =
CR
 || buf[n] =
LF
)) { }

1066 
pid
 = 
	`ngx_©oi
(
buf
, ++
n
);

1068 i‡(
pid
 =
NGX_ERROR
) {

1069 
	`ngx_log_îr‹
(
NGX_LOG_ERR
, 
cy˛e
->
log
, 0,

1071 
n
, 
buf
, 
fûe
.
«me
.
d©a
);

1075  
	`ngx_os_sig«l_¥o˚ss
(
cy˛e
, 
sig
, 
pid
);

1077 
	}
}

1080 
ngx_öt_t


1081 
	$ngx_ã°_lockfûe
(
u_ch¨
 *
fûe
, 
ngx_log_t
 *
log
)

1083 #i‡!(
NGX_HAVE_ATOMIC_OPS
)

1084 
ngx_fd_t
 
fd
;

1086 
fd
 = 
	`ngx_›í_fûe
(
fûe
, 
NGX_FILE_RDWR
, 
NGX_FILE_CREATE_OR_OPEN
,

1087 
NGX_FILE_DEFAULT_ACCESS
);

1089 i‡(
fd
 =
NGX_INVALID_FILE
) {

1090 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
log
, 
ngx_î∫o
,

1091 
ngx_›í_fûe_n
 " \"%s\" faûed", 
fûe
);

1092  
NGX_ERROR
;

1095 i‡(
	`ngx_˛o£_fûe
(
fd
Ë=
NGX_FILE_ERROR
) {

1096 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
log
, 
ngx_î∫o
,

1097 
ngx_˛o£_fûe_n
 " \"%s\" faûed", 
fûe
);

1100 i‡(
	`ngx_dñëe_fûe
(
fûe
Ë=
NGX_FILE_ERROR
) {

1101 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
log
, 
ngx_î∫o
,

1102 
ngx_dñëe_fûe_n
 " \"%s\" faûed", 
fûe
);

1107  
NGX_OK
;

1108 
	}
}

1112 
	$ngx_ª›í_fûes
(
ngx_cy˛e_t
 *
cy˛e
, 
ngx_uid_t
 
u£r
)

1114 
ssize_t
 
n
, 
Àn
;

1115 
ngx_fd_t
 
fd
;

1116 
ngx_uöt_t
 
i
;

1117 
ngx_li°_∑π_t
 *
∑π
;

1118 
ngx_›í_fûe_t
 *
fûe
;

1120 
∑π
 = &
cy˛e
->
›í_fûes
.part;

1121 
fûe
 = 
∑π
->
ñts
;

1123 
i
 = 0; ; i++) {

1125 i‡(
i
 >
∑π
->
√…s
) {

1126 i‡(
∑π
->
√xt
 =
NULL
) {

1129 
∑π
 =Ö¨t->
√xt
;

1130 
fûe
 = 
∑π
->
ñts
;

1131 
i
 = 0;

1134 i‡(
fûe
[
i
].
«me
.
Àn
 == 0) {

1138 
Àn
 = 
fûe
[
i
].
pos
 - fûe[i].
buf„r
;

1140 i‡(
fûe
[
i
].
buf„r
 && 
Àn
 != 0) {

1142 
n
 = 
	`ngx_wrôe_fd
(
fûe
[
i
].
fd
, fûe[i].
buf„r
, 
Àn
);

1144 i‡(
n
 =
NGX_FILE_ERROR
) {

1145 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 
ngx_î∫o
,

1146 
ngx_wrôe_fd_n
 "Åo \"%s\" failed",

1147 
fûe
[
i
].
«me
.
d©a
);

1149 } i‡(
n
 !
Àn
) {

1150 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cy˛e
->
log
, 0,

1151 
ngx_wrôe_fd_n
 "Åo \"%s\" was incomplete: %z of %uz",

1152 
fûe
[
i
].
«me
.
d©a
, 
n
, 
Àn
);

1155 
fûe
[
i
].
pos
 = fûe[i].
buf„r
;

1158 
fd
 = 
	`ngx_›í_fûe
(
fûe
[
i
].
«me
.
d©a
, 
NGX_FILE_APPEND
,

1159 
NGX_FILE_CREATE_OR_OPEN
, 
NGX_FILE_DEFAULT_ACCESS
);

1161 
	`ngx_log_debug3
(
NGX_LOG_DEBUG_EVENT
, 
cy˛e
->
log
, 0,

1163 
fûe
[
i
].
«me
.
d©a
, fûe[i].
fd
, fd);

1165 i‡(
fd
 =
NGX_INVALID_FILE
) {

1166 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

1167 
ngx_›í_fûe_n
 " \"%s\" faûed", 
fûe
[
i
].
«me
.
d©a
);

1171 #i‡!(
NGX_WIN32
)

1172 i‡(
u£r
 !(
ngx_uid_t
Ë
NGX_CONF_UNSET_UINT
) {

1173 
ngx_fûe_öfo_t
 
fi
;

1175 i‡(
	`ngx_fûe_öfo
((c⁄° *Ë
fûe
[
i
].
«me
.
d©a
, &
fi
)

1176 =
NGX_FILE_ERROR
)

1178 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

1179 
ngx_fûe_öfo_n
 " \"%s\" failed",

1180 
fûe
[
i
].
«me
.
d©a
);

1182 i‡(
	`ngx_˛o£_fûe
(
fd
Ë=
NGX_FILE_ERROR
) {

1183 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

1184 
ngx_˛o£_fûe_n
 " \"%s\" failed",

1185 
fûe
[
i
].
«me
.
d©a
);

1189 i‡(
fi
.
°_uid
 !
u£r
) {

1190 i‡(
	`chown
((c⁄° *Ë
fûe
[
i
].
«me
.
d©a
, 
u£r
, -1) == -1) {

1191 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

1193 
fûe
[
i
].
«me
.
d©a
, 
u£r
);

1195 i‡(
	`ngx_˛o£_fûe
(
fd
Ë=
NGX_FILE_ERROR
) {

1196 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

1197 
ngx_˛o£_fûe_n
 " \"%s\" failed",

1198 
fûe
[
i
].
«me
.
d©a
);

1203 i‡((
fi
.
°_mode
 & (
S_IRUSR
|
S_IWUSR
)) != (S_IRUSR|S_IWUSR)) {

1205 
fi
.
°_mode
 |(
S_IRUSR
|
S_IWUSR
);

1207 i‡(
	`chmod
((c⁄° *Ë
fûe
[
i
].
«me
.
d©a
, 
fi
.
°_mode
) == -1) {

1208 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

1209 "chmod(Ë\"%s\" faûed", 
fûe
[
i
].
«me
.
d©a
);

1211 i‡(
	`ngx_˛o£_fûe
(
fd
Ë=
NGX_FILE_ERROR
) {

1212 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

1213 
ngx_˛o£_fûe_n
 " \"%s\" failed",

1214 
fûe
[
i
].
«me
.
d©a
);

1220 i‡(
	`f˙é
(
fd
, 
F_SETFD
, 
FD_CLOEXEC
) == -1) {

1221 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

1223 
fûe
[
i
].
«me
.
d©a
);

1225 i‡(
	`ngx_˛o£_fûe
(
fd
Ë=
NGX_FILE_ERROR
) {

1226 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

1227 
ngx_˛o£_fûe_n
 " \"%s\" failed",

1228 
fûe
[
i
].
«me
.
d©a
);

1235 i‡(
	`ngx_˛o£_fûe
(
fûe
[
i
].
fd
Ë=
NGX_FILE_ERROR
) {

1236 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

1237 
ngx_˛o£_fûe_n
 " \"%s\" failed",

1238 
fûe
[
i
].
«me
.
d©a
);

1241 
fûe
[
i
].
fd
 = fd;

1244 #i‡!(
NGX_WIN32
)

1246 i‡(
cy˛e
->
log
->
fûe
->
fd
 !
STDERR_FILENO
) {

1247 i‡(
	`dup2
(
cy˛e
->
log
->
fûe
->
fd
, 
STDERR_FILENO
) == -1) {

1248 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

1254 
	}
}

1257 
ngx_shm_z⁄e_t
 *

1258 
	$ngx_sh¨ed_mem‹y_add
(
ngx_c⁄f_t
 *
cf
, 
ngx_°r_t
 *
«me
, 
size_t
 
size
, *
èg
)

1260 
ngx_uöt_t
 
i
;

1261 
ngx_shm_z⁄e_t
 *
shm_z⁄e
;

1262 
ngx_li°_∑π_t
 *
∑π
;

1264 
∑π
 = &
cf
->
cy˛e
->
sh¨ed_mem‹y
.part;

1265 
shm_z⁄e
 = 
∑π
->
ñts
;

1267 
i
 = 0; ; i++) {

1269 i‡(
i
 >
∑π
->
√…s
) {

1270 i‡(
∑π
->
√xt
 =
NULL
) {

1273 
∑π
 =Ö¨t->
√xt
;

1274 
shm_z⁄e
 = 
∑π
->
ñts
;

1275 
i
 = 0;

1278 i‡(
«me
->
Àn
 !
shm_z⁄e
[
i
].
shm
.name.len) {

1282 i‡(
	`ngx_°∫cmp
(
«me
->
d©a
, 
shm_z⁄e
[
i
].
shm
.«me.d©a,Çame->
Àn
)

1288 i‡(
size
 && sizê!
shm_z⁄e
[
i
].
shm
.size) {

1289 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

1292 
size
, &
shm_z⁄e
[
i
].
shm
.
«me
, shm_zone[i].shm.size);

1293  
NULL
;

1296 i‡(
èg
 !
shm_z⁄e
[
i
].tag) {

1297 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

1300 &
shm_z⁄e
[
i
].
shm
.
«me
);

1301  
NULL
;

1304  &
shm_z⁄e
[
i
];

1307 
shm_z⁄e
 = 
	`ngx_li°_push
(&
cf
->
cy˛e
->
sh¨ed_mem‹y
);

1309 i‡(
shm_z⁄e
 =
NULL
) {

1310  
NULL
;

1313 
shm_z⁄e
->
d©a
 = 
NULL
;

1314 
shm_z⁄e
->
shm
.
log
 = 
cf
->
cy˛e
->log;

1315 
shm_z⁄e
->
shm
.
size
 = size;

1316 
shm_z⁄e
->
shm
.
«me
 = *name;

1317 
shm_z⁄e
->
shm
.
exi°s
 = 0;

1318 
shm_z⁄e
->
öô
 = 
NULL
;

1319 
shm_z⁄e
->
èg
 =Åag;

1321  
shm_z⁄e
;

1322 
	}
}

1326 
	$ngx_˛ón_ﬁd_cy˛es
(
ngx_evít_t
 *
ev
)

1328 
ngx_uöt_t
 
i
, 
n
, 
found
, 
live
;

1329 
ngx_log_t
 *
log
;

1330 
ngx_cy˛e_t
 **
cy˛e
;

1332 
log
 = 
ngx_cy˛e
->log;

1333 
ngx_ãmp_poﬁ
->
log
 =Üog;

1335 
	`ngx_log_debug0
(
NGX_LOG_DEBUG_CORE
, 
log
, 0, "clean old cycles");

1337 
live
 = 0;

1339 
cy˛e
 = 
ngx_ﬁd_cy˛es
.
ñts
;

1340 
i
 = 0; i < 
ngx_ﬁd_cy˛es
.
√…s
; i++) {

1342 i‡(
cy˛e
[
i
] =
NULL
) {

1346 
found
 = 0;

1348 
n
 = 0;Ç < 
cy˛e
[
i
]->
c⁄√˘i⁄_n
;Ç++) {

1349 i‡(
cy˛e
[
i
]->
c⁄√˘i⁄s
[
n
].
fd
 !(
ngx_sockë_t
) -1) {

1350 
found
 = 1;

1352 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
log
, 0, "livêfd:%d", 
n
);

1358 i‡(
found
) {

1359 
live
 = 1;

1363 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
log
, 0, "˛ó¿ﬁd cy˛e: %d", 
i
);

1365 
	`ngx_de°roy_poﬁ
(
cy˛e
[
i
]->
poﬁ
);

1366 
cy˛e
[
i
] = 
NULL
;

1369 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
log
, 0, "ﬁd cy˛e†°©us: %d", 
live
);

1371 i‡(
live
) {

1372 
	`ngx_add_timî
(
ev
, 30000);

1375 
	`ngx_de°roy_poﬁ
(
ngx_ãmp_poﬁ
);

1376 
ngx_ãmp_poﬁ
 = 
NULL
;

1377 
ngx_ﬁd_cy˛es
.
√…s
 = 0;

1379 
	}
}

	@ngx_cycle.h

8 #i‚de‡
_NGX_CYCLE_H_INCLUDED_


9 
	#_NGX_CYCLE_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 #i‚de‡
NGX_CYCLE_POOL_SIZE


17 
	#NGX_CYCLE_POOL_SIZE
 16384

	)

21 
	#NGX_DEBUG_POINTS_STOP
 1

	)

22 
	#NGX_DEBUG_POINTS_ABORT
 2

	)

25 
ngx_shm_z⁄e_s
 
	tngx_shm_z⁄e_t
;

27 
	$ngx_öt_t
 (*
	tngx_shm_z⁄e_öô_±
Ë(
	tngx_shm_z⁄e_t
 *
	tz⁄e
, *
	td©a
);

29 
	sngx_shm_z⁄e_s
 {

30 *
d©a
;

31 
ngx_shm_t
 
shm
;

32 
ngx_shm_z⁄e_öô_±
 
öô
;

33 *
èg
;

37 
	sngx_cy˛e_s
 {

38 ****
c⁄f_˘x
;

39 
ngx_poﬁ_t
 *
poﬁ
;

41 
ngx_log_t
 *
log
;

42 
ngx_log_t
 
√w_log
;

44 
ngx_c⁄√˘i⁄_t
 **
fûes
;

45 
ngx_c⁄√˘i⁄_t
 *
‰ì_c⁄√˘i⁄s
;

46 
ngx_uöt_t
 
‰ì_c⁄√˘i⁄_n
;

48 
ngx_queue_t
 
ªußbÀ_c⁄√˘i⁄s_queue
;

50 
ngx_¨øy_t
 
li°íög
;

51 
ngx_¨øy_t
 
∑thes
;

52 
ngx_li°_t
 
›í_fûes
;

53 
ngx_li°_t
 
sh¨ed_mem‹y
;

55 
ngx_uöt_t
 
c⁄√˘i⁄_n
;

56 
ngx_uöt_t
 
fûes_n
;

58 
ngx_c⁄√˘i⁄_t
 *
c⁄√˘i⁄s
;

59 
ngx_evít_t
 *
ªad_evíts
;

60 
ngx_evít_t
 *
wrôe_evíts
;

62 
ngx_cy˛e_t
 *
ﬁd_cy˛e
;

64 
ngx_°r_t
 
c⁄f_fûe
;

65 
ngx_°r_t
 
c⁄f_∑øm
;

66 
ngx_°r_t
 
c⁄f_¥efix
;

67 
ngx_°r_t
 
¥efix
;

68 
ngx_°r_t
 
lock_fûe
;

69 
ngx_°r_t
 
ho°«me
;

74 
ngx_Êag_t
 
d´m⁄
;

75 
ngx_Êag_t
 
ma°î
;

77 
ngx_m£c_t
 
timî_ªsﬁuti⁄
;

79 
ngx_öt_t
 
w‹kî_¥o˚s£s
;

80 
ngx_öt_t
 
debug_poöts
;

82 
ngx_öt_t
 
æimô_nofûe
;

83 
ngx_öt_t
 
æimô_sig≥ndög
;

84 
off_t
 
æimô_c‹e
;

86 
¥i‹ôy
;

88 
ngx_uöt_t
 
˝u_afföôy_n
;

89 
u_l⁄g
 *
˝u_afföôy
;

91 *
u£∫ame
;

92 
ngx_uid_t
 
u£r
;

93 
ngx_gid_t
 
group
;

95 
ngx_°r_t
 
w‹kög_dúe˘‹y
;

96 
ngx_°r_t
 
lock_fûe
;

98 
ngx_°r_t
 
pid
;

99 
ngx_°r_t
 
ﬁdpid
;

101 
ngx_¨øy_t
 
ív
;

102 **
ívú⁄mít
;

104 #i‡(
NGX_THREADS
)

105 
ngx_öt_t
 
w‹kî_thªads
;

106 
size_t
 
thªad_°ack_size
;

109 } 
	tngx_c‹e_c⁄f_t
;

113 
ngx_poﬁ_t
 *
poﬁ
;

114 } 
	tngx_c‹e_és_t
;

117 
	#ngx_is_öô_cy˛e
(
cy˛e
Ë(cy˛e->
c⁄f_˘x
 =
NULL
)

	)

120 
ngx_cy˛e_t
 *
	`ngx_öô_cy˛e
“gx_cy˛e_à*
ﬁd_cy˛e
);

121 
ngx_öt_t
 
	`ngx_¸óã_pidfûe
(
ngx_°r_t
 *
«me
, 
ngx_log_t
 *
log
);

122 
	`ngx_dñëe_pidfûe
(
ngx_cy˛e_t
 *
cy˛e
);

123 
ngx_öt_t
 
	`ngx_sig«l_¥o˚ss
(
ngx_cy˛e_t
 *
cy˛e
, *
sig
);

124 
	`ngx_ª›í_fûes
(
ngx_cy˛e_t
 *
cy˛e
, 
ngx_uid_t
 
u£r
);

125 **
	`ngx_£t_ívú⁄mít
(
ngx_cy˛e_t
 *
cy˛e
, 
ngx_uöt_t
 *
œ°
);

126 
ngx_pid_t
 
	`ngx_exec_√w_bö¨y
(
ngx_cy˛e_t
 *
cy˛e
, *c⁄° *
¨gv
);

127 
u_l⁄g
 
	`ngx_gë_˝u_afföôy
(
ngx_uöt_t
 
n
);

128 
ngx_shm_z⁄e_t
 *
	`ngx_sh¨ed_mem‹y_add
(
ngx_c⁄f_t
 *
cf
, 
ngx_°r_t
 *
«me
,

129 
size_t
 
size
, *
èg
);

132 vﬁ©ûê
ngx_cy˛e_t
 *
ngx_cy˛e
;

133 
ngx_¨øy_t
 
ngx_ﬁd_cy˛es
;

134 
ngx_moduÀ_t
 
ngx_c‹e_moduÀ
;

135 
ngx_uöt_t
 
ngx_ã°_c⁄fig
;

136 
ngx_uöt_t
 
ngx_quõt_mode
;

137 #i‡(
NGX_THREADS
)

138 
ngx_és_key_t
 
ngx_c‹e_és_key
;

	@ngx_file.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 
ngx_©omic_t
 
	gãmp_numbî
 = 0;

13 
ngx_©omic_t
 *
	gngx_ãmp_numbî
 = &
ãmp_numbî
;

14 
ngx_©omic_öt_t
 
	gngx_øndom_numbî
 = 123456;

17 
ssize_t


18 
	$ngx_wrôe_chaö_to_ãmp_fûe
(
ngx_ãmp_fûe_t
 *
tf
, 
ngx_chaö_t
 *
chaö
)

20 
ngx_öt_t
 
rc
;

22 i‡(
tf
->
fûe
.
fd
 =
NGX_INVALID_FILE
) {

23 
rc
 = 
	`ngx_¸óã_ãmp_fûe
(&
tf
->
fûe
,Åf->
∑th
,Åf->
poﬁ
,

24 
tf
->
≥rsi°ít
,Åf->
˛ón
,Åf->
ac˚ss
);

26 i‡(
rc
 =
NGX_ERROR
 ||Ñ¯=
NGX_AGAIN
) {

27  
rc
;

30 i‡(
tf
->
log_Àvñ
) {

31 
	`ngx_log_îr‹
(
tf
->
log_Àvñ
,Åf->
fûe
.
log
, 0, "%s %V",

32 
tf
->
w¨n
, &tf->
fûe
.
«me
);

36  
	`ngx_wrôe_chaö_to_fûe
(&
tf
->
fûe
, 
chaö
,Åf->
off£t
,Åf->
poﬁ
);

37 
	}
}

40 
ngx_öt_t


41 
	$ngx_¸óã_ãmp_fûe
(
ngx_fûe_t
 *
fûe
, 
ngx_∑th_t
 *
∑th
, 
ngx_poﬁ_t
 *
poﬁ
,

42 
ngx_uöt_t
 
≥rsi°ít
,Çgx_uöt_à
˛ón
,Çgx_uöt_à
ac˚ss
)

44 
uöt32_t
 
n
;

45 
ngx_îr_t
 
îr
;

46 
ngx_poﬁ_˛ónup_t
 *
˛n
;

47 
ngx_poﬁ_˛ónup_fûe_t
 *
˛nf
;

49 
fûe
->
«me
.
Àn
 = 
∑th
->name.len + 1 +Öath->len + 10;

51 
fûe
->
«me
.
d©a
 = 
	`ngx_≤Æloc
(
poﬁ
, fûe->«me.
Àn
 + 1);

52 i‡(
fûe
->
«me
.
d©a
 =
NULL
) {

53  
NGX_ERROR
;

57 
i
 = 0; i < 
fûe
->
«me
.
Àn
; i++) {

58 
fûe
->
«me
.
d©a
[
i
] = 'X';

62 
	`ngx_mem˝y
(
fûe
->
«me
.
d©a
, 
∑th
->«me.d©a,Ö©h->«me.
Àn
);

64 
n
 = (
uöt32_t
Ë
	`ngx_√xt_ãmp_numbî
(0);

66 
˛n
 = 
	`ngx_poﬁ_˛ónup_add
(
poﬁ
, (
ngx_poﬁ_˛ónup_fûe_t
));

67 i‡(
˛n
 =
NULL
) {

68  
NGX_ERROR
;

72 (Ë
	`ngx_•rötf
(
fûe
->
«me
.
d©a
 + 
∑th
->«me.
Àn
 + 1 +Öath->len,

73 "%010uD%Z", 
n
);

75 
	`ngx_¸óã_hashed_fûíame
(
∑th
, 
fûe
->
«me
.
d©a
, fûe->«me.
Àn
);

77 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
fûe
->
log
, 0,

78 "hashedÖ©h: %s", 
fûe
->
«me
.
d©a
);

80 
fûe
->
fd
 = 
	`ngx_›í_ãmpfûe
(fûe->
«me
.
d©a
, 
≥rsi°ít
, 
ac˚ss
);

82 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
fûe
->
log
, 0,

83 "ãm∞fd:%d", 
fûe
->
fd
);

85 i‡(
fûe
->
fd
 !
NGX_INVALID_FILE
) {

87 
˛n
->
h™dÀr
 = 
˛ón
 ? 
ngx_poﬁ_dñëe_fûe
 : 
ngx_poﬁ_˛ónup_fûe
;

88 
˛nf
 = 
˛n
->
d©a
;

90 
˛nf
->
fd
 = 
fûe
->fd;

91 
˛nf
->
«me
 = 
fûe
->«me.
d©a
;

92 
˛nf
->
log
 = 
poﬁ
->log;

94  
NGX_OK
;

97 
îr
 = 
ngx_î∫o
;

99 i‡(
îr
 =
NGX_EEXIST
) {

100 
n
 = (
uöt32_t
Ë
	`ngx_√xt_ãmp_numbî
(1);

104 i‡((
∑th
->
Àvñ
[0] =0Ë|| (
îr
 !
NGX_ENOPATH
)) {

105 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
fûe
->
log
, 
îr
,

106 
ngx_›í_ãmpfûe_n
 " \"%s\" failed",

107 
fûe
->
«me
.
d©a
);

108  
NGX_ERROR
;

111 i‡(
	`ngx_¸óã_∑th
(
fûe
, 
∑th
Ë=
NGX_ERROR
) {

112  
NGX_ERROR
;

115 
	}
}

119 
	$ngx_¸óã_hashed_fûíame
(
ngx_∑th_t
 *
∑th
, 
u_ch¨
 *
fûe
, 
size_t
 
Àn
)

121 
size_t
 
i
, 
Àvñ
;

122 
ngx_uöt_t
 
n
;

124 
i
 = 
∑th
->
«me
.
Àn
 + 1;

126 
fûe
[
∑th
->
«me
.
Àn
 +Öath->len] = '/';

128 
n
 = 0;Ç < 3;Ç++) {

129 
Àvñ
 = 
∑th
->Àvñ[
n
];

131 i‡(
Àvñ
 == 0) {

135 
Àn
 -
Àvñ
;

136 
fûe
[
i
 - 1] = '/';

137 
	`ngx_mem˝y
(&
fûe
[
i
], &fûe[
Àn
], 
Àvñ
);

138 
i
 +
Àvñ
 + 1;

140 
	}
}

143 
ngx_öt_t


144 
	$ngx_¸óã_∑th
(
ngx_fûe_t
 *
fûe
, 
ngx_∑th_t
 *
∑th
)

146 
size_t
 
pos
;

147 
ngx_îr_t
 
îr
;

148 
ngx_uöt_t
 
i
;

150 
pos
 = 
∑th
->
«me
.
Àn
;

152 
i
 = 0; i < 3; i++) {

153 i‡(
∑th
->
Àvñ
[
i
] == 0) {

157 
pos
 +
∑th
->
Àvñ
[
i
] + 1;

159 
fûe
->
«me
.
d©a
[
pos
] = '\0';

161 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
fûe
->
log
, 0,

162 "ãm∞fûe: \"%s\"", 
fûe
->
«me
.
d©a
);

164 i‡(
	`ngx_¸óã_dú
(
fûe
->
«me
.
d©a
, 0700Ë=
NGX_FILE_ERROR
) {

165 
îr
 = 
ngx_î∫o
;

166 i‡(
îr
 !
NGX_EEXIST
) {

167 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
fûe
->
log
, 
îr
,

168 
ngx_¸óã_dú_n
 " \"%s\" failed",

169 
fûe
->
«me
.
d©a
);

170  
NGX_ERROR
;

174 
fûe
->
«me
.
d©a
[
pos
] = '/';

177  
NGX_OK
;

178 
	}
}

181 
ngx_îr_t


182 
	$ngx_¸óã_fuŒ_∑th
(
u_ch¨
 *
dú
, 
ngx_uöt_t
 
ac˚ss
)

184 
u_ch¨
 *
p
, 
ch
;

185 
ngx_îr_t
 
îr
;

187 
îr
 = 0;

189 #i‡(
NGX_WIN32
)

190 
p
 = 
dú
 + 3;

192 
p
 = 
dú
 + 1;

195  ; *
p
;Ö++) {

196 
ch
 = *
p
;

198 i‡(
ch
 != '/') {

202 *
p
 = '\0';

204 i‡(
	`ngx_¸óã_dú
(
dú
, 
ac˚ss
Ë=
NGX_FILE_ERROR
) {

205 
îr
 = 
ngx_î∫o
;

207 
îr
) {

208 
NGX_EEXIST
:

209 
îr
 = 0;

210 
NGX_EACCES
:

214  
îr
;

218 *
p
 = '/';

221  
îr
;

222 
	}
}

225 
ngx_©omic_uöt_t


226 
	$ngx_√xt_ãmp_numbî
(
ngx_uöt_t
 
cﬁlisi⁄
)

228 
ngx_©omic_uöt_t
 
n
, 
add
;

230 
add
 = 
cﬁlisi⁄
 ? 
ngx_øndom_numbî
 : 1;

232 
n
 = 
	`ngx_©omic_„tch_add
(
ngx_ãmp_numbî
, 
add
);

234  
n
 + 
add
;

235 
	}
}

239 
	$ngx_c⁄f_£t_∑th_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

241 *
p
 = 
c⁄f
;

243 
ssize_t
 
Àvñ
;

244 
ngx_°r_t
 *
vÆue
;

245 
ngx_uöt_t
 
i
, 
n
;

246 
ngx_∑th_t
 *
∑th
, **
¶Ÿ
;

248 
¶Ÿ
 = (
ngx_∑th_t
 **Ë(
p
 + 
cmd
->
off£t
);

250 i‡(*
¶Ÿ
) {

254 
∑th
 = 
	`ngx_pˇŒoc
(
cf
->
poﬁ
, (
ngx_∑th_t
));

255 i‡(
∑th
 =
NULL
) {

256  
NGX_CONF_ERROR
;

259 
vÆue
 = 
cf
->
¨gs
->
ñts
;

261 
∑th
->
«me
 = 
vÆue
[1];

263 i‡(
∑th
->
«me
.
d©a
[∑th->«me.
Àn
 - 1] == '/') {

264 
∑th
->
«me
.
Àn
--;

267 i‡(
	`ngx_c⁄f_fuŒ_«me
(
cf
->
cy˛e
, &
∑th
->
«me
, 0Ë!
NGX_OK
) {

268  
NULL
;

271 
∑th
->
Àn
 = 0;

272 
∑th
->
m™agî
 = 
NULL
;

273 
∑th
->
lﬂdî
 = 
NULL
;

274 
∑th
->
c⁄f_fûe
 = 
cf
->c⁄f_fûe->
fûe
.
«me
.
d©a
;

275 
∑th
->
löe
 = 
cf
->
c⁄f_fûe
->line;

277 
i
 = 0, 
n
 = 2;Ç < 
cf
->
¨gs
->
√…s
; i++,Ç++) {

278 
Àvñ
 = 
	`ngx_©oi
(
vÆue
[
n
].
d©a
, vÆue[n].
Àn
);

279 i‡(
Àvñ
 =
NGX_ERROR
 ||Üevel == 0) {

283 
∑th
->
Àvñ
[
i
] =Üevel;

284 
∑th
->
Àn
 +
Àvñ
 + 1;

287 
i
 < 3) {

288 
∑th
->
Àvñ
[
i
++] = 0;

291 *
¶Ÿ
 = 
∑th
;

293 i‡(
	`ngx_add_∑th
(
cf
, 
¶Ÿ
Ë=
NGX_ERROR
) {

294  
NGX_CONF_ERROR
;

297  
NGX_CONF_OK
;

298 
	}
}

302 
	$ngx_c⁄f_mîge_∑th_vÆue
(
ngx_c⁄f_t
 *
cf
, 
ngx_∑th_t
 **
∑th
,Çgx_∑th_à*
¥ev
,

303 
ngx_∑th_öô_t
 *
öô
)

305 i‡(*
∑th
) {

306  
NGX_CONF_OK
;

309 i‡(
¥ev
) {

310 *
∑th
 = 
¥ev
;

311  
NGX_CONF_OK
;

314 *
∑th
 = 
	`ngx_∑Œoc
(
cf
->
poﬁ
, (
ngx_∑th_t
));

315 i‡(*
∑th
 =
NULL
) {

316  
NGX_CONF_ERROR
;

319 (*
∑th
)->
«me
 = 
öô
->name;

321 i‡(
	`ngx_c⁄f_fuŒ_«me
(
cf
->
cy˛e
, &(*
∑th
)->
«me
, 0Ë!
NGX_OK
) {

322  
NGX_CONF_ERROR
;

325 (*
∑th
)->
Àvñ
[0] = 
öô
->level[0];

326 (*
∑th
)->
Àvñ
[1] = 
öô
->level[1];

327 (*
∑th
)->
Àvñ
[2] = 
öô
->level[2];

329 (*
∑th
)->
Àn
 = 
öô
->
Àvñ
[0] + (init->level[0] ? 1 : 0)

330 + 
öô
->
Àvñ
[1] + (init->level[1] ? 1 : 0)

331 + 
öô
->
Àvñ
[2] + (init->level[2] ? 1 : 0);

333 (*
∑th
)->
m™agî
 = 
NULL
;

334 (*
∑th
)->
lﬂdî
 = 
NULL
;

335 (*
∑th
)->
c⁄f_fûe
 = 
NULL
;

337 i‡(
	`ngx_add_∑th
(
cf
, 
∑th
Ë!
NGX_OK
) {

338  
NGX_CONF_ERROR
;

341  
NGX_CONF_OK
;

342 
	}
}

346 
	$ngx_c⁄f_£t_ac˚ss_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

348 *
c⁄Â
 = 
c⁄f
;

350 
u_ch¨
 *
p
;

351 
ngx_°r_t
 *
vÆue
;

352 
ngx_uöt_t
 
i
, 
right
, 
shi·
, *
ac˚ss
;

354 
ac˚ss
 = (
ngx_uöt_t
 *Ë(
c⁄Â
 + 
cmd
->
off£t
);

356 i‡(*
ac˚ss
 !
NGX_CONF_UNSET_UINT
) {

360 
vÆue
 = 
cf
->
¨gs
->
ñts
;

362 *
ac˚ss
 = 0600;

364 
i
 = 1; i < 
cf
->
¨gs
->
√…s
; i++) {

366 
p
 = 
vÆue
[
i
].
d©a
;

368 i‡(
	`ngx_°∫cmp
(
p
, "user:", ("user:") - 1) == 0) {

369 
shi·
 = 6;

370 
p
 += ("user:") - 1;

372 } i‡(
	`ngx_°∫cmp
(
p
, "group:", ("group:") - 1) == 0) {

373 
shi·
 = 3;

374 
p
 += ("group:") - 1;

376 } i‡(
	`ngx_°∫cmp
(
p
, "all:", ("all:") - 1) == 0) {

377 
shi·
 = 0;

378 
p
 += ("all:") - 1;

381 
övÆid
;

384 i‡(
	`ngx_°rcmp
(
p
, "rw") == 0) {

385 
right
 = 6;

387 } i‡(
	`ngx_°rcmp
(
p
, "r") == 0) {

388 
right
 = 4;

391 
övÆid
;

394 *
ac˚ss
 |
right
 << 
shi·
;

397  
NGX_CONF_OK
;

399 
övÆid
:

401 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0, "övÆid vÆuê\"%V\"", &
vÆue
[
i
]);

403  
NGX_CONF_ERROR
;

404 
	}
}

407 
ngx_öt_t


408 
	$ngx_add_∑th
(
ngx_c⁄f_t
 *
cf
, 
ngx_∑th_t
 **
¶Ÿ
)

410 
ngx_uöt_t
 
i
, 
n
;

411 
ngx_∑th_t
 *
∑th
, **
p
;

413 
∑th
 = *
¶Ÿ
;

415 
p
 = 
cf
->
cy˛e
->
∑thes
.
ñts
;

416 
i
 = 0; i < 
cf
->
cy˛e
->
∑thes
.
√…s
; i++) {

417 i‡(
p
[
i
]->
«me
.
Àn
 =
∑th
->name.len

418 && 
	`ngx_°rcmp
(
p
[
i
]->
«me
.
d©a
, 
∑th
->name.data) == 0)

420 
n
 = 0;Ç < 3;Ç++) {

421 i‡(
p
[
i
]->
Àvñ
[
n
] !
∑th
->level[n]) {

422 i‡(
∑th
->
c⁄f_fûe
 =
NULL
) {

423 i‡(
p
[
i
]->
c⁄f_fûe
 =
NULL
) {

424 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cf
->
log
, 0,

429 &
p
[
i
]->
«me
);

430  
NGX_ERROR
;

433 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cf
->
log
, 0,

438 &
p
[
i
]->
«me
,Ö[i]->
c⁄f_fûe
,Ö[i]->
löe
);

439  
NGX_ERROR
;

442 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

445 &
p
[
i
]->
«me
,Ö[i]->
c⁄f_fûe
,Ö[i]->
löe
);

446  
NGX_ERROR
;

449 i‡(
p
[
i
]->
Àvñ
[
n
] == 0) {

454 *
¶Ÿ
 = 
p
[
i
];

456  
NGX_OK
;

460 
p
 = 
	`ngx_¨øy_push
(&
cf
->
cy˛e
->
∑thes
);

461 i‡(
p
 =
NULL
) {

462  
NGX_ERROR
;

465 *
p
 = 
∑th
;

467  
NGX_OK
;

468 
	}
}

471 
ngx_öt_t


472 
	$ngx_¸óã_∑thes
(
ngx_cy˛e_t
 *
cy˛e
, 
ngx_uid_t
 
u£r
)

474 
ngx_îr_t
 
îr
;

475 
ngx_uöt_t
 
i
;

476 
ngx_∑th_t
 **
∑th
;

478 
∑th
 = 
cy˛e
->
∑thes
.
ñts
;

479 
i
 = 0; i < 
cy˛e
->
∑thes
.
√…s
; i++) {

481 i‡(
	`ngx_¸óã_dú
(
∑th
[
i
]->
«me
.
d©a
, 0700Ë=
NGX_FILE_ERROR
) {

482 
îr
 = 
ngx_î∫o
;

483 i‡(
îr
 !
NGX_EEXIST
) {

484 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
îr
,

485 
ngx_¸óã_dú_n
 " \"%s\" failed",

486 
∑th
[
i
]->
«me
.
d©a
);

487  
NGX_ERROR
;

491 i‡(
u£r
 =(
ngx_uid_t
Ë
NGX_CONF_UNSET_UINT
) {

495 #i‡!(
NGX_WIN32
)

497 
ngx_fûe_öfo_t
 
fi
;

499 i‡(
	`ngx_fûe_öfo
((c⁄° *Ë
∑th
[
i
]->
«me
.
d©a
, &
fi
)

500 =
NGX_FILE_ERROR
)

502 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

503 
ngx_fûe_öfo_n
 " \"%s\" faûed", 
∑th
[
i
]->
«me
.
d©a
);

504  
NGX_ERROR
;

507 i‡(
fi
.
°_uid
 !
u£r
) {

508 i‡(
	`chown
((c⁄° *Ë
∑th
[
i
]->
«me
.
d©a
, 
u£r
, -1) == -1) {

509 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

511 
∑th
[
i
]->
«me
.
d©a
, 
u£r
);

512  
NGX_ERROR
;

516 i‡((
fi
.
°_mode
 & (
S_IRUSR
|
S_IWUSR
|
S_IXUSR
))

517 !(
S_IRUSR
|
S_IWUSR
|
S_IXUSR
))

519 
fi
.
°_mode
 |(
S_IRUSR
|
S_IWUSR
|
S_IXUSR
);

521 i‡(
	`chmod
((c⁄° *Ë
∑th
[
i
]->
«me
.
d©a
, 
fi
.
°_mode
) == -1) {

522 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
cy˛e
->
log
, 
ngx_î∫o
,

523 "chmod(Ë\"%s\" faûed", 
∑th
[
i
]->
«me
.
d©a
);

524  
NGX_ERROR
;

531  
NGX_OK
;

532 
	}
}

535 
ngx_öt_t


536 
	$ngx_ext_ª«me_fûe
(
ngx_°r_t
 *
§c
,Çgx_°r_à*
to
, 
ngx_ext_ª«me_fûe_t
 *
ext
)

538 
u_ch¨
 *
«me
;

539 
ngx_îr_t
 
îr
;

540 
ngx_c›y_fûe_t
 
cf
;

542 #i‡!(
NGX_WIN32
)

544 i‡(
ext
->
ac˚ss
) {

545 i‡(
	`ngx_ch™ge_fûe_ac˚ss
(
§c
->
d©a
, 
ext
->
ac˚ss
Ë=
NGX_FILE_ERROR
) {

546 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
ext
->
log
, 
ngx_î∫o
,

547 
ngx_ch™ge_fûe_ac˚ss_n
 " \"%s\" faûed", 
§c
->
d©a
);

548 
îr
 = 0;

549 
Áûed
;

555 i‡(
ext
->
time
 != -1) {

556 i‡(
	`ngx_£t_fûe_time
(
§c
->
d©a
, 
ext
->
fd
,Éxt->
time
Ë!
NGX_OK
) {

557 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
ext
->
log
, 
ngx_î∫o
,

558 
ngx_£t_fûe_time_n
 " \"%s\" faûed", 
§c
->
d©a
);

559 
îr
 = 0;

560 
Áûed
;

564 i‡(
	`ngx_ª«me_fûe
(
§c
->
d©a
, 
to
->d©aË!
NGX_FILE_ERROR
) {

565  
NGX_OK
;

568 
îr
 = 
ngx_î∫o
;

570 i‡(
îr
 =
NGX_ENOPATH
) {

572 i‡(!
ext
->
¸óã_∑th
) {

573 
Áûed
;

576 
îr
 = 
	`ngx_¸óã_fuŒ_∑th
(
to
->
d©a
, 
	`ngx_dú_ac˚ss
(
ext
->
∑th_ac˚ss
));

578 i‡(
îr
) {

579 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
ext
->
log
, 
îr
,

580 
ngx_¸óã_dú_n
 " \"%s\" faûed", 
to
->
d©a
);

581 
îr
 = 0;

582 
Áûed
;

585 i‡(
	`ngx_ª«me_fûe
(
§c
->
d©a
, 
to
->d©aË!
NGX_FILE_ERROR
) {

586  
NGX_OK
;

589 
îr
 = 
ngx_î∫o
;

592 #i‡(
NGX_WIN32
)

594 i‡(
îr
 =
NGX_EEXIST
) {

595 
îr
 = 
	`ngx_wö32_ª«me_fûe
(
§c
, 
to
, 
ext
->
log
);

597 i‡(
îr
 == 0) {

598  
NGX_OK
;

604 i‡(
îr
 =
NGX_EXDEV
) {

606 
cf
.
size
 = -1;

607 
cf
.
buf_size
 = 0;

608 
cf
.
ac˚ss
 = 
ext
->access;

609 
cf
.
time
 = 
ext
->time;

610 
cf
.
log
 = 
ext
->log;

612 
«me
 = 
	`ngx_Æloc
(
to
->
Àn
 + 1 + 10 + 1, 
ext
->
log
);

613 i‡(
«me
 =
NULL
) {

614  
NGX_ERROR
;

617 (Ë
	`ngx_•rötf
(
«me
, "%*s.%010uD%Z", 
to
->
Àn
,Åo->
d©a
,

618 (
uöt32_t
Ë
	`ngx_√xt_ãmp_numbî
(0));

620 i‡(
	`ngx_c›y_fûe
(
§c
->
d©a
, 
«me
, &
cf
Ë=
NGX_OK
) {

622 i‡(
	`ngx_ª«me_fûe
(
«me
, 
to
->
d©a
Ë!
NGX_FILE_ERROR
) {

623 
	`ngx_‰ì
(
«me
);

625 i‡(
	`ngx_dñëe_fûe
(
§c
->
d©a
Ë=
NGX_FILE_ERROR
) {

626 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
ext
->
log
, 
ngx_î∫o
,

627 
ngx_dñëe_fûe_n
 " \"%s\" failed",

628 
§c
->
d©a
);

629  
NGX_ERROR
;

632  
NGX_OK
;

635 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
ext
->
log
, 
ngx_î∫o
,

636 
ngx_ª«me_fûe_n
 " \"%s\"Åo \"%s\" failed",

637 
«me
, 
to
->
d©a
);

639 i‡(
	`ngx_dñëe_fûe
(
«me
Ë=
NGX_FILE_ERROR
) {

640 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
ext
->
log
, 
ngx_î∫o
,

641 
ngx_dñëe_fûe_n
 " \"%s\" faûed", 
«me
);

646 
	`ngx_‰ì
(
«me
);

648 
îr
 = 0;

651 
Áûed
:

653 i‡(
ext
->
dñëe_fûe
) {

654 i‡(
	`ngx_dñëe_fûe
(
§c
->
d©a
Ë=
NGX_FILE_ERROR
) {

655 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
ext
->
log
, 
ngx_î∫o
,

656 
ngx_dñëe_fûe_n
 " \"%s\" faûed", 
§c
->
d©a
);

660 i‡(
îr
) {

661 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
ext
->
log
, 
îr
,

662 
ngx_ª«me_fûe_n
 " \"%s\"Åo \"%s\" failed",

663 
§c
->
d©a
, 
to
->data);

666  
NGX_ERROR
;

667 
	}
}

670 
ngx_öt_t


671 
	$ngx_c›y_fûe
(
u_ch¨
 *
‰om
, u_ch¨ *
to
, 
ngx_c›y_fûe_t
 *
cf
)

673 *
buf
;

674 
off_t
 
size
;

675 
size_t
 
Àn
;

676 
ssize_t
 
n
;

677 
ngx_fd_t
 
fd
, 
nfd
;

678 
ngx_öt_t
 
rc
;

679 
ngx_fûe_öfo_t
 
fi
;

681 
rc
 = 
NGX_ERROR
;

682 
buf
 = 
NULL
;

683 
nfd
 = 
NGX_INVALID_FILE
;

685 
fd
 = 
	`ngx_›í_fûe
(
‰om
, 
NGX_FILE_RDONLY
, 
NGX_FILE_OPEN
, 0);

687 i‡(
fd
 =
NGX_INVALID_FILE
) {

688 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
cf
->
log
, 
ngx_î∫o
,

689 
ngx_›í_fûe_n
 " \"%s\" faûed", 
‰om
);

690 
Áûed
;

693 i‡(
cf
->
size
 != -1) {

694 
size
 = 
cf
->size;

697 i‡(
	`ngx_fd_öfo
(
fd
, &
fi
Ë=
NGX_FILE_ERROR
) {

698 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cf
->
log
, 
ngx_î∫o
,

699 
ngx_fd_öfo_n
 " \"%s\" faûed", 
‰om
);

701 
Áûed
;

704 
size
 = 
	`ngx_fûe_size
(&
fi
);

707 
Àn
 = 
cf
->
buf_size
 ? cf->buf_size : 65536;

709 i‡((
off_t
Ë
Àn
 > 
size
) {

710 
Àn
 = (
size_t
Ë
size
;

713 
buf
 = 
	`ngx_Æloc
(
Àn
, 
cf
->
log
);

714 i‡(
buf
 =
NULL
) {

715 
Áûed
;

718 
nfd
 = 
	`ngx_›í_fûe
(
to
, 
NGX_FILE_WRONLY
, 
NGX_FILE_CREATE_OR_OPEN
,

719 
cf
->
ac˚ss
);

721 i‡(
nfd
 =
NGX_INVALID_FILE
) {

722 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
cf
->
log
, 
ngx_î∫o
,

723 
ngx_›í_fûe_n
 " \"%s\" faûed", 
to
);

724 
Áûed
;

727 
size
 > 0) {

729 i‡((
off_t
Ë
Àn
 > 
size
) {

730 
Àn
 = (
size_t
Ë
size
;

733 
n
 = 
	`ngx_ªad_fd
(
fd
, 
buf
, 
Àn
);

735 i‡(
n
 =
NGX_FILE_ERROR
) {

736 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cf
->
log
, 
ngx_î∫o
,

737 
ngx_ªad_fd_n
 " \"%s\" faûed", 
‰om
);

738 
Áûed
;

741 i‡((
size_t
Ë
n
 !
Àn
) {

742 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cf
->
log
, 
ngx_î∫o
,

743 
ngx_ªad_fd_n
 " hasÑead only %z of %uz from %s",

744 
n
, 
size
, 
‰om
);

745 
Áûed
;

748 
n
 = 
	`ngx_wrôe_fd
(
nfd
, 
buf
, 
Àn
);

750 i‡(
n
 =
NGX_FILE_ERROR
) {

751 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cf
->
log
, 
ngx_î∫o
,

752 
ngx_wrôe_fd_n
 " \"%s\" faûed", 
to
);

753 
Áûed
;

756 i‡((
size_t
Ë
n
 !
Àn
) {

757 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cf
->
log
, 
ngx_î∫o
,

758 
ngx_wrôe_fd_n
 " has written only %z of %uzÅo %s",

759 
n
, 
size
, 
to
);

760 
Áûed
;

763 
size
 -
n
;

766 i‡(
cf
->
time
 != -1) {

767 i‡(
	`ngx_£t_fûe_time
(
to
, 
nfd
, 
cf
->
time
Ë!
NGX_OK
) {

768 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cf
->
log
, 
ngx_î∫o
,

769 
ngx_£t_fûe_time_n
 " \"%s\" faûed", 
to
);

770 
Áûed
;

774 
rc
 = 
NGX_OK
;

776 
Áûed
:

778 i‡(
nfd
 !
NGX_INVALID_FILE
) {

779 i‡(
	`ngx_˛o£_fûe
(
nfd
Ë=
NGX_FILE_ERROR
) {

780 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cf
->
log
, 
ngx_î∫o
,

781 
ngx_˛o£_fûe_n
 " \"%s\" faûed", 
to
);

785 i‡(
fd
 !
NGX_INVALID_FILE
) {

786 i‡(
	`ngx_˛o£_fûe
(
fd
Ë=
NGX_FILE_ERROR
) {

787 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
cf
->
log
, 
ngx_î∫o
,

788 
ngx_˛o£_fûe_n
 " \"%s\" faûed", 
‰om
);

792 i‡(
buf
) {

793 
	`ngx_‰ì
(
buf
);

796  
rc
;

797 
	}
}

818 
ngx_öt_t


819 
	$ngx_wÆk_åì
(
ngx_åì_˘x_t
 *
˘x
, 
ngx_°r_t
 *
åì
)

821 *
d©a
, *
¥ev
;

822 
u_ch¨
 *
p
, *
«me
;

823 
size_t
 
Àn
;

824 
ngx_öt_t
 
rc
;

825 
ngx_îr_t
 
îr
;

826 
ngx_°r_t
 
fûe
, 
buf
;

827 
ngx_dú_t
 
dú
;

829 
	`ngx_°r_nuŒ
(&
buf
);

831 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
˘x
->
log
, 0,

832 "wÆkÅªê\"%V\"", 
åì
);

834 i‡(
	`ngx_›í_dú
(
åì
, &
dú
Ë=
NGX_ERROR
) {

835 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
˘x
->
log
, 
ngx_î∫o
,

836 
ngx_›í_dú_n
 " \"%s\" faûed", 
åì
->
d©a
);

837  
NGX_ERROR
;

840 
¥ev
 = 
˘x
->
d©a
;

842 i‡(
˘x
->
Æloc
) {

843 
d©a
 = 
	`ngx_Æloc
(
˘x
->
Æloc
, ctx->
log
);

844 i‡(
d©a
 =
NULL
) {

845 
Áûed
;

848 i‡(
˘x
->
	`öô_h™dÀr
(
d©a
, 
¥ev
Ë=
NGX_ABORT
) {

849 
Áûed
;

852 
˘x
->
d©a
 = data;

855 
d©a
 = 
NULL
;

860 
	`ngx_£t_î∫o
(0);

862 i‡(
	`ngx_ªad_dú
(&
dú
Ë=
NGX_ERROR
) {

863 
îr
 = 
ngx_î∫o
;

865 i‡(
îr
 =
NGX_ENOMOREFILES
) {

866 
rc
 = 
NGX_OK
;

869 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
˘x
->
log
, 
îr
,

870 
ngx_ªad_dú_n
 " \"%s\" faûed", 
åì
->
d©a
);

871 
rc
 = 
NGX_ERROR
;

874 
d⁄e
;

877 
Àn
 = 
	`ngx_de_«mñí
(&
dú
);

878 
«me
 = 
	`ngx_de_«me
(&
dú
);

880 
	`ngx_log_debug2
(
NGX_LOG_DEBUG_CORE
, 
˘x
->
log
, 0,

881 "åìÇamê%uz:\"%s\"", 
Àn
, 
«me
);

883 i‡(
Àn
 =1 && 
«me
[0] == '.') {

887 i‡(
Àn
 =2 && 
«me
[0] == '.' &&Çame[1] == '.') {

891 
fûe
.
Àn
 = 
åì
->len + 1 +Üen;

893 i‡(
fûe
.
Àn
 + 
NGX_DIR_MASK_LEN
 > 
buf
.len) {

895 i‡(
buf
.
Àn
) {

896 
	`ngx_‰ì
(
buf
.
d©a
);

899 
buf
.
Àn
 = 
åì
->À¿+ 1 +Üí + 
NGX_DIR_MASK_LEN
;

901 
buf
.
d©a
 = 
	`ngx_Æloc
(buf.
Àn
 + 1, 
˘x
->
log
);

902 i‡(
buf
.
d©a
 =
NULL
) {

903 
Áûed
;

907 
p
 = 
	`ngx_˝ymem
(
buf
.
d©a
, 
åì
->d©a,Åªe->
Àn
);

908 *
p
++ = '/';

909 
	`ngx_mem˝y
(
p
, 
«me
, 
Àn
 + 1);

911 
fûe
.
d©a
 = 
buf
.data;

913 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
˘x
->
log
, 0,

914 "åìÖ©h \"%s\"", 
fûe
.
d©a
);

916 i‡(!
dú
.
vÆid_öfo
) {

917 i‡(
	`ngx_de_öfo
(
fûe
.
d©a
, &
dú
Ë=
NGX_FILE_ERROR
) {

918 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
˘x
->
log
, 
ngx_î∫o
,

919 
ngx_de_öfo_n
 " \"%s\" faûed", 
fûe
.
d©a
);

924 i‡(
	`ngx_de_is_fûe
(&
dú
)) {

926 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
˘x
->
log
, 0,

927 "åì fûê\"%s\"", 
fûe
.
d©a
);

929 
˘x
->
size
 = 
	`ngx_de_size
(&
dú
);

930 
˘x
->
fs_size
 = 
	`ngx_de_fs_size
(&
dú
);

931 
˘x
->
ac˚ss
 = 
	`ngx_de_ac˚ss
(&
dú
);

932 
˘x
->
mtime
 = 
	`ngx_de_mtime
(&
dú
);

934 i‡(
˘x
->
	`fûe_h™dÀr
(˘x, &
fûe
Ë=
NGX_ABORT
) {

935 
Áûed
;

938 } i‡(
	`ngx_de_is_dú
(&
dú
)) {

940 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
˘x
->
log
, 0,

941 "åìÉ¡î dú \"%s\"", 
fûe
.
d©a
);

943 
˘x
->
ac˚ss
 = 
	`ngx_de_ac˚ss
(&
dú
);

944 
˘x
->
mtime
 = 
	`ngx_de_mtime
(&
dú
);

946 i‡(
˘x
->
	`¥e_åì_h™dÀr
(˘x, &
fûe
Ë=
NGX_ABORT
) {

947 
Áûed
;

950 i‡(
	`ngx_wÆk_åì
(
˘x
, &
fûe
Ë=
NGX_ABORT
) {

951 
Áûed
;

954 
˘x
->
ac˚ss
 = 
	`ngx_de_ac˚ss
(&
dú
);

955 
˘x
->
mtime
 = 
	`ngx_de_mtime
(&
dú
);

957 i‡(
˘x
->
	`po°_åì_h™dÀr
(˘x, &
fûe
Ë=
NGX_ABORT
) {

958 
Áûed
;

963 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
˘x
->
log
, 0,

964 "åì s≥cü»\"%s\"", 
fûe
.
d©a
);

966 i‡(
˘x
->
	`•ec_h™dÀr
(˘x, &
fûe
Ë=
NGX_ABORT
) {

967 
Áûed
;

972 
Áûed
:

974 
rc
 = 
NGX_ABORT
;

976 
d⁄e
:

978 i‡(
buf
.
Àn
) {

979 
	`ngx_‰ì
(
buf
.
d©a
);

982 i‡(
d©a
) {

983 
	`ngx_‰ì
(
d©a
);

984 
˘x
->
d©a
 = 
¥ev
;

987 i‡(
	`ngx_˛o£_dú
(&
dú
Ë=
NGX_ERROR
) {

988 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
˘x
->
log
, 
ngx_î∫o
,

989 
ngx_˛o£_dú_n
 " \"%s\" faûed", 
åì
->
d©a
);

992  
rc
;

993 
	}
}

	@ngx_file.h

8 #i‚de‡
_NGX_FILE_H_INCLUDED_


9 
	#_NGX_FILE_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 
	sngx_fûe_s
 {

17 
ngx_fd_t
 
	mfd
;

18 
ngx_°r_t
 
	m«me
;

19 
ngx_fûe_öfo_t
 
	möfo
;

21 
off_t
 
	moff£t
;

22 
off_t
 
	msys_off£t
;

24 
ngx_log_t
 *
	mlog
;

26 #i‡(
NGX_HAVE_FILE_AIO
)

27 
ngx_evít_aio_t
 *
	maio
;

30 
	mvÆid_öfo
:1;

31 
	mdúe˘io
:1;

35 
	#NGX_MAX_PATH_LEVEL
 3

	)

38 
	$time_t
 (*
	tngx_∑th_m™agî_±
Ë(*
	td©a
);

39 (*
	tngx_∑th_lﬂdî_±
Ë(*
	td©a
);

43 
ngx_°r_t
 
«me
;

44 
size_t
 
Àn
;

45 
size_t
 
Àvñ
[3];

47 
ngx_∑th_m™agî_±
 
m™agî
;

48 
ngx_∑th_lﬂdî_±
 
lﬂdî
;

49 *
d©a
;

51 
u_ch¨
 *
c⁄f_fûe
;

52 
ngx_uöt_t
 
löe
;

53 } 
	tngx_∑th_t
;

57 
ngx_°r_t
 
«me
;

58 
size_t
 
Àvñ
[3];

59 } 
	tngx_∑th_öô_t
;

63 
ngx_fûe_t
 
fûe
;

64 
off_t
 
off£t
;

65 
ngx_∑th_t
 *
∑th
;

66 
ngx_poﬁ_t
 *
poﬁ
;

67 *
w¨n
;

69 
ngx_uöt_t
 
ac˚ss
;

71 
log_Àvñ
:8;

72 
≥rsi°ít
:1;

73 
˛ón
:1;

74 } 
	tngx_ãmp_fûe_t
;

78 
ngx_uöt_t
 
ac˚ss
;

79 
ngx_uöt_t
 
∑th_ac˚ss
;

80 
time_t
 
time
;

81 
ngx_fd_t
 
fd
;

83 
¸óã_∑th
:1;

84 
dñëe_fûe
:1;

86 
ngx_log_t
 *
log
;

87 } 
	tngx_ext_ª«me_fûe_t
;

91 
off_t
 
size
;

92 
size_t
 
buf_size
;

94 
ngx_uöt_t
 
ac˚ss
;

95 
time_t
 
time
;

97 
ngx_log_t
 *
log
;

98 } 
	tngx_c›y_fûe_t
;

101 
ngx_åì_˘x_s
 
	tngx_åì_˘x_t
;

103 
	$ngx_öt_t
 (*
	tngx_åì_öô_h™dÀr_±
Ë(*
	t˘x
, *
	t¥ev
);

104 
	$ngx_öt_t
 (*
	tngx_åì_h™dÀr_±
Ë(
	tngx_åì_˘x_t
 *
	t˘x
, 
	tngx_°r_t
 *
	t«me
);

106 
	sngx_åì_˘x_s
 {

107 
off_t
 
size
;

108 
off_t
 
fs_size
;

109 
ngx_uöt_t
 
ac˚ss
;

110 
time_t
 
mtime
;

112 
ngx_åì_öô_h™dÀr_±
 
öô_h™dÀr
;

113 
ngx_åì_h™dÀr_±
 
fûe_h™dÀr
;

114 
ngx_åì_h™dÀr_±
 
¥e_åì_h™dÀr
;

115 
ngx_åì_h™dÀr_±
 
po°_åì_h™dÀr
;

116 
ngx_åì_h™dÀr_±
 
•ec_h™dÀr
;

118 *
d©a
;

119 
size_t
 
Æloc
;

121 
ngx_log_t
 *
log
;

125 
ssize_t
 
	`ngx_wrôe_chaö_to_ãmp_fûe
(
ngx_ãmp_fûe_t
 *
tf
, 
ngx_chaö_t
 *
chaö
);

126 
ngx_öt_t
 
	`ngx_¸óã_ãmp_fûe
(
ngx_fûe_t
 *
fûe
, 
ngx_∑th_t
 *
∑th
,

127 
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uöt_t
 
≥rsi°ít
,Çgx_uöt_à
˛ón
,

128 
ngx_uöt_t
 
ac˚ss
);

129 
	`ngx_¸óã_hashed_fûíame
(
ngx_∑th_t
 *
∑th
, 
u_ch¨
 *
fûe
, 
size_t
 
Àn
);

130 
ngx_öt_t
 
	`ngx_¸óã_∑th
(
ngx_fûe_t
 *
fûe
, 
ngx_∑th_t
 *
∑th
);

131 
ngx_îr_t
 
	`ngx_¸óã_fuŒ_∑th
(
u_ch¨
 *
dú
, 
ngx_uöt_t
 
ac˚ss
);

132 
ngx_öt_t
 
	`ngx_add_∑th
(
ngx_c⁄f_t
 *
cf
, 
ngx_∑th_t
 **
¶Ÿ
);

133 
ngx_öt_t
 
	`ngx_¸óã_∑thes
(
ngx_cy˛e_t
 *
cy˛e
, 
ngx_uid_t
 
u£r
);

134 
ngx_öt_t
 
	`ngx_ext_ª«me_fûe
(
ngx_°r_t
 *
§c
,Çgx_°r_à*
to
,

135 
ngx_ext_ª«me_fûe_t
 *
ext
);

136 
ngx_öt_t
 
	`ngx_c›y_fûe
(
u_ch¨
 *
‰om
, u_ch¨ *
to
, 
ngx_c›y_fûe_t
 *
cf
);

137 
ngx_öt_t
 
	`ngx_wÆk_åì
(
ngx_åì_˘x_t
 *
˘x
, 
ngx_°r_t
 *
åì
);

139 
ngx_©omic_uöt_t
 
	`ngx_√xt_ãmp_numbî
(
ngx_uöt_t
 
cﬁlisi⁄
);

141 *
	`ngx_c⁄f_£t_∑th_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

142 *
	`ngx_c⁄f_mîge_∑th_vÆue
(
ngx_c⁄f_t
 *
cf
, 
ngx_∑th_t
 **
∑th
,

143 
ngx_∑th_t
 *
¥ev
, 
ngx_∑th_öô_t
 *
öô
);

144 *
	`ngx_c⁄f_£t_ac˚ss_¶Ÿ
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

147 
ngx_©omic_t
 *
ngx_ãmp_numbî
;

148 
ngx_©omic_öt_t
 
ngx_øndom_numbî
;

	@ngx_hash.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

13 
	$ngx_hash_föd
(
ngx_hash_t
 *
hash
, 
ngx_uöt_t
 
key
, 
u_ch¨
 *
«me
, 
size_t
 
Àn
)

15 
ngx_uöt_t
 
i
;

16 
ngx_hash_ñt_t
 *
ñt
;

19 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 0, "hf:\"%*s\"", 
Àn
, 
«me
);

22 
ñt
 = 
hash
->
buckës
[
key
 % hash->
size
];

24 i‡(
ñt
 =
NULL
) {

25  
NULL
;

28 
ñt
->
vÆue
) {

29 i‡(
Àn
 !(
size_t
Ë
ñt
->len) {

30 
√xt
;

33 
i
 = 0; i < 
Àn
; i++) {

34 i‡(
«me
[
i
] !
ñt
->name[i]) {

35 
√xt
;

39  
ñt
->
vÆue
;

41 
√xt
:

43 
ñt
 = (
ngx_hash_ñt_t
 *Ë
	`ngx_Æign_±r
(&ñt->
«me
[0] +É…->
Àn
,

48  
NULL
;

49 
	}
}

53 
	$ngx_hash_föd_wc_hód
(
ngx_hash_wûdˇrd_t
 *
hwc
, 
u_ch¨
 *
«me
, 
size_t
 
Àn
)

55 *
vÆue
;

56 
ngx_uöt_t
 
i
, 
n
, 
key
;

59 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 0, "wch:\"%*s\"", 
Àn
, 
«me
);

62 
n
 = 
Àn
;

64 
n
) {

65 i‡(
«me
[
n
 - 1] == '.') {

69 
n
--;

72 
key
 = 0;

74 
i
 = 
n
; i < 
Àn
; i++) {

75 
key
 = 
	`ngx_hash
(key, 
«me
[
i
]);

79 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 0, "key:\"%ui\"", 
key
);

82 
vÆue
 = 
	`ngx_hash_föd
(&
hwc
->
hash
, 
key
, &
«me
[
n
], 
Àn
 -Ç);

85 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 0, "vÆue:\"%p\"", 
vÆue
);

88 i‡(
vÆue
) {

101 i‡((
uöçå_t
Ë
vÆue
 & 2) {

103 i‡(
n
 == 0) {

107 i‡((
uöçå_t
Ë
vÆue
 & 1) {

108  
NULL
;

111 
hwc
 = (
ngx_hash_wûdˇrd_t
 *)

112 ((
uöçå_t
Ë
vÆue
 & (uintptr_t) ~3);

113  
hwc
->
vÆue
;

116 
hwc
 = (
ngx_hash_wûdˇrd_t
 *Ë((
uöçå_t
Ë
vÆue
 & (uintptr_t) ~3);

118 
vÆue
 = 
	`ngx_hash_föd_wc_hód
(
hwc
, 
«me
, 
n
 - 1);

120 i‡(
vÆue
) {

121  
vÆue
;

124  
hwc
->
vÆue
;

127 i‡((
uöçå_t
Ë
vÆue
 & 1) {

129 i‡(
n
 == 0) {

133  
NULL
;

136  (*Ë((
uöçå_t
Ë
vÆue
 & (uintptr_t) ~3);

139  
vÆue
;

142  
hwc
->
vÆue
;

143 
	}
}

147 
	$ngx_hash_föd_wc_èû
(
ngx_hash_wûdˇrd_t
 *
hwc
, 
u_ch¨
 *
«me
, 
size_t
 
Àn
)

149 *
vÆue
;

150 
ngx_uöt_t
 
i
, 
key
;

153 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 0, "w˘:\"%*s\"", 
Àn
, 
«me
);

156 
key
 = 0;

158 
i
 = 0; i < 
Àn
; i++) {

159 i‡(
«me
[
i
] == '.') {

163 
key
 = 
	`ngx_hash
(key, 
«me
[
i
]);

166 i‡(
i
 =
Àn
) {

167  
NULL
;

171 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 0, "key:\"%ui\"", 
key
);

174 
vÆue
 = 
	`ngx_hash_föd
(&
hwc
->
hash
, 
key
, 
«me
, 
i
);

177 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 0, "vÆue:\"%p\"", 
vÆue
);

180 i‡(
vÆue
) {

188 i‡((
uöçå_t
Ë
vÆue
 & 2) {

190 
i
++;

192 
hwc
 = (
ngx_hash_wûdˇrd_t
 *Ë((
uöçå_t
Ë
vÆue
 & (uintptr_t) ~3);

194 
vÆue
 = 
	`ngx_hash_föd_wc_èû
(
hwc
, &
«me
[
i
], 
Àn
 - i);

196 i‡(
vÆue
) {

197  
vÆue
;

200  
hwc
->
vÆue
;

203  
vÆue
;

206  
hwc
->
vÆue
;

207 
	}
}

211 
	$ngx_hash_föd_comböed
(
ngx_hash_comböed_t
 *
hash
, 
ngx_uöt_t
 
key
, 
u_ch¨
 *
«me
,

212 
size_t
 
Àn
)

214 *
vÆue
;

216 i‡(
hash
->hash.
buckës
) {

217 
vÆue
 = 
	`ngx_hash_föd
(&
hash
->hash, 
key
, 
«me
, 
Àn
);

219 i‡(
vÆue
) {

220  
vÆue
;

224 i‡(
Àn
 == 0) {

225  
NULL
;

228 i‡(
hash
->
wc_hód
 && hash->wc_hód->hash.
buckës
) {

229 
vÆue
 = 
	`ngx_hash_föd_wc_hód
(
hash
->
wc_hód
, 
«me
, 
Àn
);

231 i‡(
vÆue
) {

232  
vÆue
;

236 i‡(
hash
->
wc_èû
 && hash->wc_èû->hash.
buckës
) {

237 
vÆue
 = 
	`ngx_hash_föd_wc_èû
(
hash
->
wc_èû
, 
«me
, 
Àn
);

239 i‡(
vÆue
) {

240  
vÆue
;

244  
NULL
;

245 
	}
}

248 
	#NGX_HASH_ELT_SIZE
(
«me
) \

249 ((*Ë+ 
	`ngx_Æign
((
«me
)->
key
.
Àn
 + 2, (*)))

	)

251 
ngx_öt_t


252 
	$ngx_hash_öô
(
ngx_hash_öô_t
 *
höô
, 
ngx_hash_key_t
 *
«mes
, 
ngx_uöt_t
 
√…s
)

254 
u_ch¨
 *
ñts
;

255 
size_t
 
Àn
;

256 
u_sh‹t
 *
ã°
;

257 
ngx_uöt_t
 
i
, 
n
, 
key
, 
size
, 
°¨t
, 
buckë_size
;

258 
ngx_hash_ñt_t
 *
ñt
, **
buckës
;

260 
n
 = 0;Ç < 
√…s
;Ç++) {

261 i‡(
höô
->
buckë_size
 < 
	`NGX_HASH_ELT_SIZE
(&
«mes
[
n
]) + (*))

263 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
höô
->
poﬁ
->
log
, 0,

266 
höô
->
«me
, höô->«me, höô->
buckë_size
);

267  
NGX_ERROR
;

271 
ã°
 = 
	`ngx_Æloc
(
höô
->
max_size
 * (
u_sh‹t
), höô->
poﬁ
->
log
);

272 i‡(
ã°
 =
NULL
) {

273  
NGX_ERROR
;

276 
buckë_size
 = 
höô
->bucket_size - (*);

278 
°¨t
 = 
√…s
 / (
buckë_size
 / (2 * (*)));

279 
°¨t
 = start ? start : 1;

281 i‡(
höô
->
max_size
 > 10000 && 
√…s
 && hinit->max_size /Çelts < 100) {

282 
°¨t
 = 
höô
->
max_size
 - 1000;

285 
size
 = 
°¨t
; sizê< 
höô
->
max_size
; size++) {

287 
	`ngx_memzîo
(
ã°
, 
size
 * (
u_sh‹t
));

289 
n
 = 0;Ç < 
√…s
;Ç++) {

290 i‡(
«mes
[
n
].
key
.
d©a
 =
NULL
) {

294 
key
 = 
«mes
[
n
].
key_hash
 % 
size
;

295 
ã°
[
key
] = (
u_sh‹t
Ë—e°[key] + 
	`NGX_HASH_ELT_SIZE
(&
«mes
[
n
]));

298 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
höô
->
poﬁ
->
log
, 0,

300 
size
, 
key
, 
ã°
[key], &
«mes
[
n
].key);

303 i‡(
ã°
[
key
] > (
u_sh‹t
Ë
buckë_size
) {

304 
√xt
;

308 
found
;

310 
√xt
:

315 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
höô
->
poﬁ
->
log
, 0,

318 
höô
->
«me
, höô->«me, höô->
max_size
,

319 
höô
->
«me
, höô->
buckë_size
);

321 
	`ngx_‰ì
(
ã°
);

323  
NGX_ERROR
;

325 
found
:

327 
i
 = 0; i < 
size
; i++) {

328 
ã°
[
i
] = (*);

331 
n
 = 0;Ç < 
√…s
;Ç++) {

332 i‡(
«mes
[
n
].
key
.
d©a
 =
NULL
) {

336 
key
 = 
«mes
[
n
].
key_hash
 % 
size
;

337 
ã°
[
key
] = (
u_sh‹t
Ë—e°[key] + 
	`NGX_HASH_ELT_SIZE
(&
«mes
[
n
]));

340 
Àn
 = 0;

342 
i
 = 0; i < 
size
; i++) {

343 i‡(
ã°
[
i
] == (*)) {

347 
ã°
[
i
] = (
u_sh‹t
Ë(
	`ngx_Æign
—e°[i], 
ngx_ˇchñöe_size
));

349 
Àn
 +
ã°
[
i
];

352 i‡(
höô
->
hash
 =
NULL
) {

353 
höô
->
hash
 = 
	`ngx_pˇŒoc
(höô->
poﬁ
, (
ngx_hash_wûdˇrd_t
)

354 + 
size
 * (
ngx_hash_ñt_t
 *));

355 i‡(
höô
->
hash
 =
NULL
) {

356 
	`ngx_‰ì
(
ã°
);

357  
NGX_ERROR
;

360 
buckës
 = (
ngx_hash_ñt_t
 **)

361 ((
u_ch¨
 *Ë
höô
->
hash
 + (
ngx_hash_wûdˇrd_t
));

364 
buckës
 = 
	`ngx_pˇŒoc
(
höô
->
poﬁ
, 
size
 * (
ngx_hash_ñt_t
 *));

365 i‡(
buckës
 =
NULL
) {

366 
	`ngx_‰ì
(
ã°
);

367  
NGX_ERROR
;

371 
ñts
 = 
	`ngx_∑Œoc
(
höô
->
poﬁ
, 
Àn
 + 
ngx_ˇchñöe_size
);

372 i‡(
ñts
 =
NULL
) {

373 
	`ngx_‰ì
(
ã°
);

374  
NGX_ERROR
;

377 
ñts
 = 
	`ngx_Æign_±r
”…s, 
ngx_ˇchñöe_size
);

379 
i
 = 0; i < 
size
; i++) {

380 i‡(
ã°
[
i
] == (*)) {

384 
buckës
[
i
] = (
ngx_hash_ñt_t
 *Ë
ñts
;

385 
ñts
 +
ã°
[
i
];

389 
i
 = 0; i < 
size
; i++) {

390 
ã°
[
i
] = 0;

393 
n
 = 0;Ç < 
√…s
;Ç++) {

394 i‡(
«mes
[
n
].
key
.
d©a
 =
NULL
) {

398 
key
 = 
«mes
[
n
].
key_hash
 % 
size
;

399 
ñt
 = (
ngx_hash_ñt_t
 *Ë((
u_ch¨
 *Ë
buckës
[
key
] + 
ã°
[key]);

401 
ñt
->
vÆue
 = 
«mes
[
n
].value;

402 
ñt
->
Àn
 = (
u_sh‹t
Ë
«mes
[
n
].
key
.len;

404 
	`ngx_°æow
(
ñt
->
«me
, 
«mes
[
n
].
key
.
d©a
,Çames[n].key.
Àn
);

406 
ã°
[
key
] = (
u_sh‹t
Ë—e°[key] + 
	`NGX_HASH_ELT_SIZE
(&
«mes
[
n
]));

409 
i
 = 0; i < 
size
; i++) {

410 i‡(
buckës
[
i
] =
NULL
) {

414 
ñt
 = (
ngx_hash_ñt_t
 *Ë((
u_ch¨
 *Ë
buckës
[
i
] + 
ã°
[i]);

416 
ñt
->
vÆue
 = 
NULL
;

419 
	`ngx_‰ì
(
ã°
);

421 
höô
->
hash
->
buckës
 = buckets;

422 
höô
->
hash
->
size
 = size;

426 
i
 = 0; i < 
size
; i++) {

427 
ngx_°r_t
 
vÆ
;

428 
ngx_uöt_t
 
key
;

430 
ñt
 = 
buckës
[
i
];

432 i‡(
ñt
 =
NULL
) {

433 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
höô
->
poﬁ
->
log
, 0,

434 "%ui: NULL", 
i
);

438 
ñt
->
vÆue
) {

439 
vÆ
.
Àn
 = 
ñt
->len;

440 
vÆ
.
d©a
 = &
ñt
->
«me
[0];

442 
key
 = 
höô
->
	`key
(
vÆ
.
d©a
, vÆ.
Àn
);

444 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
höô
->
poﬁ
->
log
, 0,

445 "%ui: %∞\"%V\" %ui", 
i
, 
ñt
, &
vÆ
, 
key
);

447 
ñt
 = (
ngx_hash_ñt_t
 *Ë
	`ngx_Æign_±r
(&ñt->
«me
[0] +É…->
Àn
,

454  
NGX_OK
;

455 
	}
}

458 
ngx_öt_t


459 
	$ngx_hash_wûdˇrd_öô
(
ngx_hash_öô_t
 *
höô
, 
ngx_hash_key_t
 *
«mes
,

460 
ngx_uöt_t
 
√…s
)

462 
size_t
 
Àn
, 
dŸ_Àn
;

463 
ngx_uöt_t
 
i
, 
n
, 
dŸ
;

464 
ngx_¨øy_t
 
cuº_«mes
, 
√xt_«mes
;

465 
ngx_hash_key_t
 *
«me
, *
√xt_«me
;

466 
ngx_hash_öô_t
 
h
;

467 
ngx_hash_wûdˇrd_t
 *
wdc
;

469 i‡(
	`ngx_¨øy_öô
(&
cuº_«mes
, 
höô
->
ãmp_poﬁ
, 
√…s
,

470 (
ngx_hash_key_t
))

471 !
NGX_OK
)

473  
NGX_ERROR
;

476 i‡(
	`ngx_¨øy_öô
(&
√xt_«mes
, 
höô
->
ãmp_poﬁ
, 
√…s
,

477 (
ngx_hash_key_t
))

478 !
NGX_OK
)

480  
NGX_ERROR
;

483 
n
 = 0;Ç < 
√…s
;Ç = 
i
) {

486 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
höô
->
poﬁ
->
log
, 0,

487 "wc0: \"%V\"", &
«mes
[
n
].
key
);

490 
dŸ
 = 0;

492 
Àn
 = 0;Üí < 
«mes
[
n
].
key
.len;Üen++) {

493 i‡(
«mes
[
n
].
key
.
d©a
[
Àn
] == '.') {

494 
dŸ
 = 1;

499 
«me
 = 
	`ngx_¨øy_push
(&
cuº_«mes
);

500 i‡(
«me
 =
NULL
) {

501  
NGX_ERROR
;

504 
«me
->
key
.
Àn
 =Üen;

505 
«me
->
key
.
d©a
 = 
«mes
[
n
].key.data;

506 
«me
->
key_hash
 = 
höô
->
	`key
“ame->
key
.
d©a
,Çame->key.
Àn
);

507 
«me
->
vÆue
 = 
«mes
[
n
].value;

510 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
höô
->
poﬁ
->
log
, 0,

511 "wc1: \"%V\" %ui", &
«me
->
key
, 
dŸ
);

514 
dŸ_Àn
 = 
Àn
 + 1;

516 i‡(
dŸ
) {

517 
Àn
++;

520 
√xt_«mes
.
√…s
 = 0;

522 i‡(
«mes
[
n
].
key
.
Àn
 !=Üen) {

523 
√xt_«me
 = 
	`ngx_¨øy_push
(&
√xt_«mes
);

524 i‡(
√xt_«me
 =
NULL
) {

525  
NGX_ERROR
;

528 
√xt_«me
->
key
.
Àn
 = 
«mes
[
n
].key.len -Üen;

529 
√xt_«me
->
key
.
d©a
 = 
«mes
[
n
].key.d©®+ 
Àn
;

530 
√xt_«me
->
key_hash
 = 0;

531 
√xt_«me
->
vÆue
 = 
«mes
[
n
].value;

534 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
höô
->
poﬁ
->
log
, 0,

535 "wc2: \"%V\"", &
√xt_«me
->
key
);

539 
i
 = 
n
 + 1; i < 
√…s
; i++) {

540 i‡(
	`ngx_°∫cmp
(
«mes
[
n
].
key
.
d©a
,Çames[
i
].key.d©a, 
Àn
) != 0) {

544 i‡(!
dŸ


545 && 
«mes
[
i
].
key
.
Àn
 >Üen

546 && 
«mes
[
i
].
key
.
d©a
[
Àn
] != '.')

551 
√xt_«me
 = 
	`ngx_¨øy_push
(&
√xt_«mes
);

552 i‡(
√xt_«me
 =
NULL
) {

553  
NGX_ERROR
;

556 
√xt_«me
->
key
.
Àn
 = 
«mes
[
i
].key.À¿- 
dŸ_Àn
;

557 
√xt_«me
->
key
.
d©a
 = 
«mes
[
i
].key.d©®+ 
dŸ_Àn
;

558 
√xt_«me
->
key_hash
 = 0;

559 
√xt_«me
->
vÆue
 = 
«mes
[
i
].value;

562 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
höô
->
poﬁ
->
log
, 0,

563 "wc3: \"%V\"", &
√xt_«me
->
key
);

567 i‡(
√xt_«mes
.
√…s
) {

569 
h
 = *
höô
;

570 
h
.
hash
 = 
NULL
;

572 i‡(
	`ngx_hash_wûdˇrd_öô
(&
h
, (
ngx_hash_key_t
 *Ë
√xt_«mes
.
ñts
,

573 
√xt_«mes
.
√…s
)

574 !
NGX_OK
)

576  
NGX_ERROR
;

579 
wdc
 = (
ngx_hash_wûdˇrd_t
 *Ë
h
.
hash
;

581 i‡(
«mes
[
n
].
key
.
Àn
 ==Üen) {

582 
wdc
->
vÆue
 = 
«mes
[
n
].value;

585 
«me
->
vÆue
 = (*Ë((
uöçå_t
Ë
wdc
 | (
dŸ
 ? 3 : 2));

587 } i‡(
dŸ
) {

588 
«me
->
vÆue
 = (*Ë((
uöçå_t
)Çame->value | 1);

592 i‡(
	`ngx_hash_öô
(
höô
, (
ngx_hash_key_t
 *Ë
cuº_«mes
.
ñts
,

593 
cuº_«mes
.
√…s
)

594 !
NGX_OK
)

596  
NGX_ERROR
;

599  
NGX_OK
;

600 
	}
}

603 
ngx_uöt_t


604 
	$ngx_hash_key
(
u_ch¨
 *
d©a
, 
size_t
 
Àn
)

606 
ngx_uöt_t
 
i
, 
key
;

608 
key
 = 0;

610 
i
 = 0; i < 
Àn
; i++) {

611 
key
 = 
	`ngx_hash
(key, 
d©a
[
i
]);

614  
key
;

615 
	}
}

618 
ngx_uöt_t


619 
	$ngx_hash_key_lc
(
u_ch¨
 *
d©a
, 
size_t
 
Àn
)

621 
ngx_uöt_t
 
i
, 
key
;

623 
key
 = 0;

625 
i
 = 0; i < 
Àn
; i++) {

626 
key
 = 
	`ngx_hash
(key, 
	`ngx_tﬁowî
(
d©a
[
i
]));

629  
key
;

630 
	}
}

633 
ngx_uöt_t


634 
	$ngx_hash_°æow
(
u_ch¨
 *
d°
, u_ch¨ *
§c
, 
size_t
 
n
)

636 
ngx_uöt_t
 
key
;

638 
key
 = 0;

640 
n
--) {

641 *
d°
 = 
	`ngx_tﬁowî
(*
§c
);

642 
key
 = 
	`ngx_hash
(key, *
d°
);

643 
d°
++;

644 
§c
++;

647  
key
;

648 
	}
}

651 
ngx_öt_t


652 
	$ngx_hash_keys_¨øy_öô
(
ngx_hash_keys_¨øys_t
 *
ha
, 
ngx_uöt_t
 
ty≥
)

654 
ngx_uöt_t
 
asize
;

656 i‡(
ty≥
 =
NGX_HASH_SMALL
) {

657 
asize
 = 4;

658 
ha
->
hsize
 = 107;

661 
asize
 = 
NGX_HASH_LARGE_ASIZE
;

662 
ha
->
hsize
 = 
NGX_HASH_LARGE_HSIZE
;

665 i‡(
	`ngx_¨øy_öô
(&
ha
->
keys
, ha->
ãmp_poﬁ
, 
asize
, (
ngx_hash_key_t
))

666 !
NGX_OK
)

668  
NGX_ERROR
;

671 i‡(
	`ngx_¨øy_öô
(&
ha
->
dns_wc_hód
, ha->
ãmp_poﬁ
, 
asize
,

672 (
ngx_hash_key_t
))

673 !
NGX_OK
)

675  
NGX_ERROR
;

678 i‡(
	`ngx_¨øy_öô
(&
ha
->
dns_wc_èû
, ha->
ãmp_poﬁ
, 
asize
,

679 (
ngx_hash_key_t
))

680 !
NGX_OK
)

682  
NGX_ERROR
;

685 
ha
->
keys_hash
 = 
	`ngx_pˇŒoc
(ha->
ãmp_poﬁ
, (
ngx_¨øy_t
Ë* ha->
hsize
);

686 i‡(
ha
->
keys_hash
 =
NULL
) {

687  
NGX_ERROR
;

690 
ha
->
dns_wc_hód_hash
 = 
	`ngx_pˇŒoc
(ha->
ãmp_poﬁ
,

691 (
ngx_¨øy_t
Ë* 
ha
->
hsize
);

692 i‡(
ha
->
dns_wc_hód_hash
 =
NULL
) {

693  
NGX_ERROR
;

696 
ha
->
dns_wc_èû_hash
 = 
	`ngx_pˇŒoc
(ha->
ãmp_poﬁ
,

697 (
ngx_¨øy_t
Ë* 
ha
->
hsize
);

698 i‡(
ha
->
dns_wc_èû_hash
 =
NULL
) {

699  
NGX_ERROR
;

702  
NGX_OK
;

703 
	}
}

706 
ngx_öt_t


707 
	$ngx_hash_add_key
(
ngx_hash_keys_¨øys_t
 *
ha
, 
ngx_°r_t
 *
key
, *
vÆue
,

708 
ngx_uöt_t
 
Êags
)

710 
size_t
 
Àn
;

711 
u_ch¨
 *
p
;

712 
ngx_°r_t
 *
«me
;

713 
ngx_uöt_t
 
i
, 
k
, 
n
, 
skù
, 
œ°
;

714 
ngx_¨øy_t
 *
keys
, *
hwc
;

715 
ngx_hash_key_t
 *
hk
;

717 
œ°
 = 
key
->
Àn
;

719 i‡(
Êags
 & 
NGX_HASH_WILDCARD_KEY
) {

726 
n
 = 0;

728 
i
 = 0; i < 
key
->
Àn
; i++) {

730 i‡(
key
->
d©a
[
i
] == '*') {

731 i‡(++
n
 > 1) {

732  
NGX_DECLINED
;

736 i‡(
key
->
d©a
[
i
] == '.' && key->data[i + 1] == '.') {

737  
NGX_DECLINED
;

741 i‡(
key
->
Àn
 > 1 && key->
d©a
[0] == '.') {

742 
skù
 = 1;

743 
wûdˇrd
;

746 i‡(
key
->
Àn
 > 2) {

748 i‡(
key
->
d©a
[0] == '*' && key->data[1] == '.') {

749 
skù
 = 2;

750 
wûdˇrd
;

753 i‡(
key
->
d©a
[
i
 - 2] == '.' && key->data[i - 1] == '*') {

754 
skù
 = 0;

755 
œ°
 -= 2;

756 
wûdˇrd
;

760 i‡(
n
) {

761  
NGX_DECLINED
;

767 
k
 = 0;

769 
i
 = 0; i < 
œ°
; i++) {

770 i‡(!(
Êags
 & 
NGX_HASH_READONLY_KEY
)) {

771 
key
->
d©a
[
i
] = 
	`ngx_tﬁowî
(key->data[i]);

773 
k
 = 
	`ngx_hash
(k, 
key
->
d©a
[
i
]);

776 
k
 %
ha
->
hsize
;

780 
«me
 = 
ha
->
keys_hash
[
k
].
ñts
;

782 i‡(
«me
) {

783 
i
 = 0; i < 
ha
->
keys_hash
[
k
].
√…s
; i++) {

784 i‡(
œ°
 !
«me
[
i
].
Àn
) {

788 i‡(
	`ngx_°∫cmp
(
key
->
d©a
, 
«me
[
i
].d©a, 
œ°
) == 0) {

789  
NGX_BUSY
;

794 i‡(
	`ngx_¨øy_öô
(&
ha
->
keys_hash
[
k
], ha->
ãmp_poﬁ
, 4,

795 (
ngx_°r_t
))

796 !
NGX_OK
)

798  
NGX_ERROR
;

802 
«me
 = 
	`ngx_¨øy_push
(&
ha
->
keys_hash
[
k
]);

803 i‡(
«me
 =
NULL
) {

804  
NGX_ERROR
;

807 *
«me
 = *
key
;

809 
hk
 = 
	`ngx_¨øy_push
(&
ha
->
keys
);

810 i‡(
hk
 =
NULL
) {

811  
NGX_ERROR
;

814 
hk
->
key
 = *key;

815 
hk
->
key_hash
 = 
	`ngx_hash_key
(
key
->
d©a
, 
œ°
);

816 
hk
->
vÆue
 = value;

818  
NGX_OK
;

821 
wûdˇrd
:

825 
k
 = 
	`ngx_hash_°æow
(&
key
->
d©a
[
skù
], &key->d©a[skù], 
œ°
 - skip);

827 
k
 %
ha
->
hsize
;

829 i‡(
skù
 == 1) {

833 
«me
 = 
ha
->
keys_hash
[
k
].
ñts
;

835 i‡(
«me
) {

836 
Àn
 = 
œ°
 - 
skù
;

838 
i
 = 0; i < 
ha
->
keys_hash
[
k
].
√…s
; i++) {

839 i‡(
Àn
 !
«me
[
i
].len) {

843 i‡(
	`ngx_°∫cmp
(&
key
->
d©a
[1], 
«me
[
i
].d©a, 
Àn
) == 0) {

844  
NGX_BUSY
;

849 i‡(
	`ngx_¨øy_öô
(&
ha
->
keys_hash
[
k
], ha->
ãmp_poﬁ
, 4,

850 (
ngx_°r_t
))

851 !
NGX_OK
)

853  
NGX_ERROR
;

857 
«me
 = 
	`ngx_¨øy_push
(&
ha
->
keys_hash
[
k
]);

858 i‡(
«me
 =
NULL
) {

859  
NGX_ERROR
;

862 
«me
->
Àn
 = 
œ°
 - 1;

863 
«me
->
d©a
 = 
	`ngx_≤Æloc
(
ha
->
ãmp_poﬁ
,Çame->
Àn
);

864 i‡(
«me
->
d©a
 =
NULL
) {

865  
NGX_ERROR
;

868 
	`ngx_mem˝y
(
«me
->
d©a
, &
key
->d©a[1],Çame->
Àn
);

872 i‡(
skù
) {

879 
p
 = 
	`ngx_≤Æloc
(
ha
->
ãmp_poﬁ
, 
œ°
);

880 i‡(
p
 =
NULL
) {

881  
NGX_ERROR
;

884 
Àn
 = 0;

885 
n
 = 0;

887 
i
 = 
œ°
 - 1; i; i--) {

888 i‡(
key
->
d©a
[
i
] == '.') {

889 
	`ngx_mem˝y
(&
p
[
n
], &
key
->
d©a
[
i
 + 1], 
Àn
);

890 
n
 +
Àn
;

891 
p
[
n
++] = '.';

892 
Àn
 = 0;

896 
Àn
++;

899 i‡(
Àn
) {

900 
	`ngx_mem˝y
(&
p
[
n
], &
key
->
d©a
[1], 
Àn
);

901 
n
 +
Àn
;

904 
p
[
n
] = '\0';

906 
hwc
 = &
ha
->
dns_wc_hód
;

907 
keys
 = &
ha
->
dns_wc_hód_hash
[
k
];

913 
œ°
++;

915 
p
 = 
	`ngx_≤Æloc
(
ha
->
ãmp_poﬁ
, 
œ°
);

916 i‡(
p
 =
NULL
) {

917  
NGX_ERROR
;

920 
	`ngx_˝y°∫
(
p
, 
key
->
d©a
, 
œ°
);

922 
hwc
 = &
ha
->
dns_wc_èû
;

923 
keys
 = &
ha
->
dns_wc_èû_hash
[
k
];

927 
hk
 = 
	`ngx_¨øy_push
(
hwc
);

928 i‡(
hk
 =
NULL
) {

929  
NGX_ERROR
;

932 
hk
->
key
.
Àn
 = 
œ°
 - 1;

933 
hk
->
key
.
d©a
 = 
p
;

934 
hk
->
key_hash
 = 0;

935 
hk
->
vÆue
 = value;

940 
«me
 = 
keys
->
ñts
;

942 i‡(
«me
) {

943 
Àn
 = 
œ°
 - 
skù
;

945 
i
 = 0; i < 
keys
->
√…s
; i++) {

946 i‡(
Àn
 !
«me
[
i
].len) {

950 i‡(
	`ngx_°∫cmp
(
key
->
d©a
 + 
skù
, 
«me
[
i
].d©a, 
Àn
) == 0) {

951  
NGX_BUSY
;

956 i‡(
	`ngx_¨øy_öô
(
keys
, 
ha
->
ãmp_poﬁ
, 4, (
ngx_°r_t
)Ë!
NGX_OK
)

958  
NGX_ERROR
;

962 
«me
 = 
	`ngx_¨øy_push
(
keys
);

963 i‡(
«me
 =
NULL
) {

964  
NGX_ERROR
;

967 
«me
->
Àn
 = 
œ°
 - 
skù
;

968 
«me
->
d©a
 = 
	`ngx_≤Æloc
(
ha
->
ãmp_poﬁ
,Çame->
Àn
);

969 i‡(
«me
->
d©a
 =
NULL
) {

970  
NGX_ERROR
;

973 
	`ngx_mem˝y
(
«me
->
d©a
, 
key
->d©®+ 
skù
,Çame->
Àn
);

975  
NGX_OK
;

976 
	}
}

	@ngx_hash.h

8 #i‚de‡
_NGX_HASH_H_INCLUDED_


9 
	#_NGX_HASH_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

17 *
	mvÆue
;

18 
u_sh‹t
 
	mÀn
;

19 
u_ch¨
 
	m«me
[1];

20 } 
	tngx_hash_ñt_t
;

24 
ngx_hash_ñt_t
 **
	mbuckës
;

25 
ngx_uöt_t
 
	msize
;

26 } 
	tngx_hash_t
;

30 
ngx_hash_t
 
	mhash
;

31 *
	mvÆue
;

32 } 
	tngx_hash_wûdˇrd_t
;

36 
ngx_°r_t
 
	mkey
;

37 
ngx_uöt_t
 
	mkey_hash
;

38 *
	mvÆue
;

39 } 
	tngx_hash_key_t
;

42 
	$ngx_uöt_t
 (*
	tngx_hash_key_±
Ë(
	tu_ch¨
 *
	td©a
, 
	tsize_t
 
	tÀn
);

46 
ngx_hash_t
 
hash
;

47 
ngx_hash_wûdˇrd_t
 *
wc_hód
;

48 
ngx_hash_wûdˇrd_t
 *
wc_èû
;

49 } 
	tngx_hash_comböed_t
;

53 
ngx_hash_t
 *
hash
;

54 
ngx_hash_key_±
 
key
;

56 
ngx_uöt_t
 
max_size
;

57 
ngx_uöt_t
 
buckë_size
;

59 *
«me
;

60 
ngx_poﬁ_t
 *
poﬁ
;

61 
ngx_poﬁ_t
 *
ãmp_poﬁ
;

62 } 
	tngx_hash_öô_t
;

65 
	#NGX_HASH_SMALL
 1

	)

66 
	#NGX_HASH_LARGE
 2

	)

68 
	#NGX_HASH_LARGE_ASIZE
 16384

	)

69 
	#NGX_HASH_LARGE_HSIZE
 10007

	)

71 
	#NGX_HASH_WILDCARD_KEY
 1

	)

72 
	#NGX_HASH_READONLY_KEY
 2

	)

76 
ngx_uöt_t
 
hsize
;

78 
ngx_poﬁ_t
 *
poﬁ
;

79 
ngx_poﬁ_t
 *
ãmp_poﬁ
;

81 
ngx_¨øy_t
 
keys
;

82 
ngx_¨øy_t
 *
keys_hash
;

84 
ngx_¨øy_t
 
dns_wc_hód
;

85 
ngx_¨øy_t
 *
dns_wc_hód_hash
;

87 
ngx_¨øy_t
 
dns_wc_èû
;

88 
ngx_¨øy_t
 *
dns_wc_èû_hash
;

89 } 
	tngx_hash_keys_¨øys_t
;

93 
ngx_uöt_t
 
hash
;

94 
ngx_°r_t
 
key
;

95 
ngx_°r_t
 
vÆue
;

96 
u_ch¨
 *
lowˇ£_key
;

97 } 
	tngx_èbÀ_ñt_t
;

100 *
	`ngx_hash_föd
(
ngx_hash_t
 *
hash
, 
ngx_uöt_t
 
key
, 
u_ch¨
 *
«me
, 
size_t
 
Àn
);

101 *
	`ngx_hash_föd_wc_hód
(
ngx_hash_wûdˇrd_t
 *
hwc
, 
u_ch¨
 *
«me
, 
size_t
 
Àn
);

102 *
	`ngx_hash_föd_wc_èû
(
ngx_hash_wûdˇrd_t
 *
hwc
, 
u_ch¨
 *
«me
, 
size_t
 
Àn
);

103 *
	`ngx_hash_föd_comböed
(
ngx_hash_comböed_t
 *
hash
, 
ngx_uöt_t
 
key
,

104 
u_ch¨
 *
«me
, 
size_t
 
Àn
);

106 
ngx_öt_t
 
	`ngx_hash_öô
(
ngx_hash_öô_t
 *
höô
, 
ngx_hash_key_t
 *
«mes
,

107 
ngx_uöt_t
 
√…s
);

108 
ngx_öt_t
 
	`ngx_hash_wûdˇrd_öô
(
ngx_hash_öô_t
 *
höô
, 
ngx_hash_key_t
 *
«mes
,

109 
ngx_uöt_t
 
√…s
);

111 
	#ngx_hash
(
key
, 
c
Ë((
ngx_uöt_t
Ëkey * 31 + c)

	)

112 
ngx_uöt_t
 
	`ngx_hash_key
(
u_ch¨
 *
d©a
, 
size_t
 
Àn
);

113 
ngx_uöt_t
 
	`ngx_hash_key_lc
(
u_ch¨
 *
d©a
, 
size_t
 
Àn
);

114 
ngx_uöt_t
 
	`ngx_hash_°æow
(
u_ch¨
 *
d°
, u_ch¨ *
§c
, 
size_t
 
n
);

117 
ngx_öt_t
 
	`ngx_hash_keys_¨øy_öô
(
ngx_hash_keys_¨øys_t
 *
ha
, 
ngx_uöt_t
 
ty≥
);

118 
ngx_öt_t
 
	`ngx_hash_add_key
(
ngx_hash_keys_¨øys_t
 *
ha
, 
ngx_°r_t
 *
key
,

119 *
vÆue
, 
ngx_uöt_t
 
Êags
);

	@ngx_inet.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 
ngx_öt_t
 
ngx_∑r£_unix_domaö_uæ
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uæ_t
 *
u
);

13 
ngx_öt_t
 
ngx_∑r£_öë_uæ
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uæ_t
 *
u
);

14 
ngx_öt_t
 
ngx_∑r£_öë6_uæ
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uæ_t
 *
u
);

17 
ö_addr_t


18 
	$ngx_öë_addr
(
u_ch¨
 *
ãxt
, 
size_t
 
Àn
)

20 
u_ch¨
 *
p
, 
c
;

21 
ö_addr_t
 
addr
;

22 
ngx_uöt_t
 
o˘ë
, 
n
;

24 
addr
 = 0;

25 
o˘ë
 = 0;

26 
n
 = 0;

28 
p
 = 
ãxt
;Ö <Åexà+ 
Àn
;Ö++) {

30 
c
 = *
p
;

32 i‡(
c
 >= '0' && c <= '9') {

33 
o˘ë
 = o˘ë * 10 + (
c
 - '0');

37 i‡(
c
 ='.' && 
o˘ë
 < 256) {

38 
addr
 = (add∏<< 8Ë+ 
o˘ë
;

39 
o˘ë
 = 0;

40 
n
++;

44  
INADDR_NONE
;

47 i‡(
n
 != 3) {

48  
INADDR_NONE
;

51 i‡(
o˘ë
 < 256) {

52 
addr
 = (add∏<< 8Ë+ 
o˘ë
;

53  
	`ht⁄l
(
addr
);

56  
INADDR_NONE
;

57 
	}
}

60 #i‡(
NGX_HAVE_INET6
)

62 
ngx_öt_t


63 
	$ngx_öë6_addr
(
u_ch¨
 *
p
, 
size_t
 
Àn
, u_ch¨ *
addr
)

65 
u_ch¨
 
c
, *
zîo
, *
digô
, *
s
, *
d
;

66 
size_t
 
Àn4
;

67 
ngx_uöt_t
 
n
, 
nibbÀs
, 
w‹d
;

69 i‡(
Àn
 == 0) {

70  
NGX_ERROR
;

73 
zîo
 = 
NULL
;

74 
digô
 = 
NULL
;

75 
Àn4
 = 0;

76 
nibbÀs
 = 0;

77 
w‹d
 = 0;

78 
n
 = 8;

80 i‡(
p
[0] == ':') {

81 
p
++;

82 
Àn
--;

85  ; 
Àn
;Üen--) {

86 
c
 = *
p
++;

88 i‡(
c
 == ':') {

89 i‡(
nibbÀs
) {

90 
digô
 = 
p
;

91 
Àn4
 = 
Àn
;

92 *
addr
++ = (
u_ch¨
Ë(
w‹d
 >> 8);

93 *
addr
++ = (
u_ch¨
Ë(
w‹d
 & 0xff);

95 i‡(--
n
) {

96 
nibbÀs
 = 0;

97 
w‹d
 = 0;

102 i‡(
zîo
 =
NULL
) {

103 
digô
 = 
p
;

104 
Àn4
 = 
Àn
;

105 
zîo
 = 
addr
;

110  
NGX_ERROR
;

113 i‡(
c
 ='.' && 
nibbÀs
) {

114 i‡(
n
 < 2 || 
digô
 =
NULL
) {

115  
NGX_ERROR
;

118 
w‹d
 = 
	`ngx_öë_addr
(
digô
, 
Àn4
 - 1);

119 i‡(
w‹d
 =
INADDR_NONE
) {

120  
NGX_ERROR
;

123 
w‹d
 = 
	`¡ohl
(word);

124 *
addr
++ = (
u_ch¨
Ë((
w‹d
 >> 24) & 0xff);

125 *
addr
++ = (
u_ch¨
Ë((
w‹d
 >> 16) & 0xff);

126 
n
--;

130 i‡(++
nibbÀs
 > 4) {

131  
NGX_ERROR
;

134 i‡(
c
 >= '0' && c <= '9') {

135 
w‹d
 = w‹d * 16 + (
c
 - '0');

139 
c
 |= 0x20;

141 i‡(
c
 >= 'a' && c <= 'f') {

142 
w‹d
 = w‹d * 16 + (
c
 - 'a') + 10;

146  
NGX_ERROR
;

149 i‡(
nibbÀs
 =0 && 
zîo
 =
NULL
) {

150  
NGX_ERROR
;

153 *
addr
++ = (
u_ch¨
Ë(
w‹d
 >> 8);

154 *
addr
++ = (
u_ch¨
Ë(
w‹d
 & 0xff);

156 i‡(--
n
) {

157 i‡(
zîo
) {

158 
n
 *= 2;

159 
s
 = 
addr
 - 1;

160 
d
 = 
s
 + 
n
;

161 
s
 >
zîo
) {

162 *
d
-- = *
s
--;

164 
	`ngx_memzîo
(
zîo
, 
n
);

165  
NGX_OK
;

169 i‡(
zîo
 =
NULL
) {

170  
NGX_OK
;

174  
NGX_ERROR
;

175 
	}
}

180 
size_t


181 
	$ngx_sock_¡›
(
sockaddr
 *
ß
, 
u_ch¨
 *
ãxt
, 
size_t
 
Àn
, 
ngx_uöt_t
 
p‹t
)

183 
u_ch¨
 *
p
;

184 
sockaddr_ö
 *
sö
;

185 #i‡(
NGX_HAVE_INET6
)

186 
size_t
 
n
;

187 
sockaddr_ö6
 *
sö6
;

189 #i‡(
NGX_HAVE_UNIX_DOMAIN
)

190 
sockaddr_un
 *
ßun
;

193 
ß
->
ß_Ámûy
) {

195 
AF_INET
:

197 
sö
 = (
sockaddr_ö
 *Ë
ß
;

198 
p
 = (
u_ch¨
 *Ë&
sö
->
sö_addr
;

200 i‡(
p‹t
) {

201 
p
 = 
	`ngx_¢¥ötf
(
ãxt
, 
Àn
, "%ud.%ud.%ud.%ud:%d",

202 
p
[0],Ö[1],Ö[2],Ö[3], 
	`¡ohs
(
sö
->
sö_p‹t
));

204 
p
 = 
	`ngx_¢¥ötf
(
ãxt
, 
Àn
, "%ud.%ud.%ud.%ud",

205 
p
[0],Ö[1],Ö[2],Ö[3]);

208  (
p
 - 
ãxt
);

210 #i‡(
NGX_HAVE_INET6
)

212 
AF_INET6
:

214 
sö6
 = (
sockaddr_ö6
 *Ë
ß
;

216 
n
 = 0;

218 i‡(
p‹t
) {

219 
ãxt
[
n
++] = '[';

222 
n
 = 
	`ngx_öë6_¡›
(
sö6
->
sö6_addr
.
s6_addr
, &
ãxt
[n], 
Àn
);

224 i‡(
p‹t
) {

225 
n
 = 
	`ngx_•rötf
(&
ãxt
[1 +Ç], "]:%d",

226 
	`¡ohs
(
sö6
->
sö6_p‹t
)Ë- 
ãxt
;

229  
n
;

232 #i‡(
NGX_HAVE_UNIX_DOMAIN
)

234 
AF_UNIX
:

235 
ßun
 = (
sockaddr_un
 *Ë
ß
;

239  
	`ngx_¢¥ötf
(
ãxt
, 
Àn
, "unix:%s%Z", 
ßun
->
sun_∑th
) -Åext - 1;

246 
	}
}

249 
size_t


250 
	$ngx_öë_¡›
(
Ámûy
, *
addr
, 
u_ch¨
 *
ãxt
, 
size_t
 
Àn
)

252 
u_ch¨
 *
p
;

254 
Ámûy
) {

256 
AF_INET
:

258 
p
 = 
addr
;

260  
	`ngx_¢¥ötf
(
ãxt
, 
Àn
, "%ud.%ud.%ud.%ud",

261 
p
[0],Ö[1],Ö[2],Ö[3])

262 - 
ãxt
;

264 #i‡(
NGX_HAVE_INET6
)

266 
AF_INET6
:

267  
	`ngx_öë6_¡›
(
addr
, 
ãxt
, 
Àn
);

274 
	}
}

277 #i‡(
NGX_HAVE_INET6
)

279 
size_t


280 
	$ngx_öë6_¡›
(
u_ch¨
 *
p
, u_ch¨ *
ãxt
, 
size_t
 
Àn
)

282 
u_ch¨
 *
d°
;

283 
size_t
 
max
, 
n
;

284 
ngx_uöt_t
 
i
, 
zîo
, 
œ°
;

286 i‡(
Àn
 < 
NGX_INET6_ADDRSTRLEN
) {

290 
zîo
 = (
ngx_uöt_t
) -1;

291 
œ°
 = (
ngx_uöt_t
) -1;

292 
max
 = 1;

293 
n
 = 0;

295 
i
 = 0; i < 16; i += 2) {

297 i‡(
p
[
i
] ||Ö[i + 1]) {

299 i‡(
max
 < 
n
) {

300 
zîo
 = 
œ°
;

301 
max
 = 
n
;

304 
n
 = 0;

308 i‡(
n
++ == 0) {

309 
œ°
 = 
i
;

313 i‡(
max
 < 
n
) {

314 
zîo
 = 
œ°
;

315 
max
 = 
n
;

318 
d°
 = 
ãxt
;

319 
n
 = 16;

321 i‡(
zîo
 == 0) {

323 i‡((
max
 =5 && 
p
[10] == 0xff &&Ö[11] == 0xff)

324 || (
max
 == 6)

325 || (
max
 =7 && 
p
[14] != 0 &&Ö[15] != 1))

327 
n
 = 12;

330 *
d°
++ = ':';

333 
i
 = 0; i < 
n
; i += 2) {

335 i‡(
i
 =
zîo
) {

336 *
d°
++ = ':';

337 
i
 +(
max
 - 1) * 2;

341 
d°
 = 
	`ngx_•rötf
(d°, "%uxi", 
p
[
i
] * 256 +Ö[i + 1]);

343 i‡(
i
 < 14) {

344 *
d°
++ = ':';

348 i‡(
n
 == 12) {

349 
d°
 = 
	`ngx_•rötf
(d°, "%ud.%ud.%ud.%ud", 
p
[12],Ö[13],Ö[14],Ö[15]);

352  
d°
 - 
ãxt
;

353 
	}
}

358 
ngx_öt_t


359 
	$ngx_±ocidr
(
ngx_°r_t
 *
ãxt
, 
ngx_cidr_t
 *
cidr
)

361 
u_ch¨
 *
addr
, *
mask
, *
œ°
;

362 
size_t
 
Àn
;

363 
ngx_öt_t
 
shi·
;

364 #i‡(
NGX_HAVE_INET6
)

365 
ngx_öt_t
 
rc
;

366 
ngx_uöt_t
 
s
, 
i
;

369 
addr
 = 
ãxt
->
d©a
;

370 
œ°
 = 
addr
 + 
ãxt
->
Àn
;

372 
mask
 = 
	`ngx_°æchr
(
addr
, 
œ°
, '/');

373 
Àn
 = (
mask
 ? mask : 
œ°
Ë- 
addr
;

375 
cidr
->
u
.
ö
.
addr
 = 
	`ngx_öë_addr
◊ddr, 
Àn
);

377 i‡(
cidr
->
u
.
ö
.
addr
 !
INADDR_NONE
) {

378 
cidr
->
Ámûy
 = 
AF_INET
;

380 i‡(
mask
 =
NULL
) {

381 
cidr
->
u
.
ö
.
mask
 = 0xffffffff;

382  
NGX_OK
;

385 #i‡(
NGX_HAVE_INET6
)

386 } i‡(
	`ngx_öë6_addr
(
addr
, 
Àn
, 
cidr
->
u
.
ö6
.addr.
s6_addr
Ë=
NGX_OK
) {

387 
cidr
->
Ámûy
 = 
AF_INET6
;

389 i‡(
mask
 =
NULL
) {

390 
	`ngx_mem£t
(
cidr
->
u
.
ö6
.
mask
.
s6_addr
, 0xff, 16);

391  
NGX_OK
;

396  
NGX_ERROR
;

399 
mask
++;

401 
shi·
 = 
	`ngx_©oi
(
mask
, 
œ°
 - mask);

402 i‡(
shi·
 =
NGX_ERROR
) {

403  
NGX_ERROR
;

406 
cidr
->
Ámûy
) {

408 #i‡(
NGX_HAVE_INET6
)

409 
AF_INET6
:

410 
addr
 = 
cidr
->
u
.
ö6
.addr.
s6_addr
;

411 
mask
 = 
cidr
->
u
.
ö6
.mask.
s6_addr
;

412 
rc
 = 
NGX_OK
;

414 
i
 = 0; i < 16; i++) {

416 
s
 = (
shi·
 > 8) ? 8 : shift;

417 
shi·
 -
s
;

419 
mask
[
i
] = (
u_ch¨
Ë(0 - (1 << (8 - 
s
)));

421 i‡(
addr
[
i
] !◊ddr[i] & 
mask
[i])) {

422 
rc
 = 
NGX_DONE
;

423 
addr
[
i
] &
mask
[i];

427  
rc
;

432 i‡(
shi·
) {

433 
cidr
->
u
.
ö
.
mask
 = 
	`ht⁄l
((
ngx_uöt_t
Ë(0 - (1 << (32 - 
shi·
))));

437 
cidr
->
u
.
ö
.
mask
 = 0;

440 i‡(
cidr
->
u
.
ö
.
addr
 =(cidr->u.ö.add∏& cidr->u.ö.
mask
)) {

441  
NGX_OK
;

444 
cidr
->
u
.
ö
.
addr
 &cidr->u.ö.
mask
;

446  
NGX_DONE
;

448 
	}
}

451 
ngx_öt_t


452 
	$ngx_∑r£_addr
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_addr_t
 *
addr
, 
u_ch¨
 *
ãxt
, 
size_t
 
Àn
)

454 
ö_addr_t
 
öaddr
;

455 
ngx_uöt_t
 
Ámûy
;

456 
sockaddr_ö
 *
sö
;

457 #i‡(
NGX_HAVE_INET6
)

458 
ö6_addr
 
öaddr6
;

459 
sockaddr_ö6
 *
sö6
;

465 
	`ngx_memzîo
(
öaddr6
.
s6_addr
, (
ö6_addr
));

468 
öaddr
 = 
	`ngx_öë_addr
(
ãxt
, 
Àn
);

470 i‡(
öaddr
 !
INADDR_NONE
) {

471 
Ámûy
 = 
AF_INET
;

472 
Àn
 = (
sockaddr_ö
);

474 #i‡(
NGX_HAVE_INET6
)

475 } i‡(
	`ngx_öë6_addr
(
ãxt
, 
Àn
, 
öaddr6
.
s6_addr
Ë=
NGX_OK
) {

476 
Ámûy
 = 
AF_INET6
;

477 
Àn
 = (
sockaddr_ö6
);

481  
NGX_DECLINED
;

484 
addr
->
sockaddr
 = 
	`ngx_pˇŒoc
(
poﬁ
, 
Àn
);

485 i‡(
addr
->
sockaddr
 =
NULL
) {

486  
NGX_ERROR
;

489 
addr
->
sockaddr
->
ß_Ámûy
 = (
u_ch¨
Ë
Ámûy
;

490 
addr
->
sockÀn
 = 
Àn
;

492 
Ámûy
) {

494 #i‡(
NGX_HAVE_INET6
)

495 
AF_INET6
:

496 
sö6
 = (
sockaddr_ö6
 *Ë
addr
->
sockaddr
;

497 
	`ngx_mem˝y
(
sö6
->
sö6_addr
.
s6_addr
, 
öaddr6
.s6_addr, 16);

502 
sö
 = (
sockaddr_ö
 *Ë
addr
->
sockaddr
;

503 
sö
->
sö_addr
.
s_addr
 = 
öaddr
;

507  
NGX_OK
;

508 
	}
}

511 
ngx_öt_t


512 
	$ngx_∑r£_uæ
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uæ_t
 *
u
)

514 
u_ch¨
 *
p
;

516 
p
 = 
u
->
uæ
.
d©a
;

518 i‡(
	`ngx_°∫ˇ£cmp
(
p
, (
u_ch¨
 *) "unix:", 5) == 0) {

519  
	`ngx_∑r£_unix_domaö_uæ
(
poﬁ
, 
u
);

522 i‡((
p
[0] =':' ||Ö[0] ='/'Ë&& !
u
->
li°í
) {

523 
u
->
îr
 = "invalid host";

524  
NGX_ERROR
;

527 i‡(
p
[0] == '[') {

528  
	`ngx_∑r£_öë6_uæ
(
poﬁ
, 
u
);

531  
	`ngx_∑r£_öë_uæ
(
poﬁ
, 
u
);

532 
	}
}

535 
ngx_öt_t


536 
	$ngx_∑r£_unix_domaö_uæ
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uæ_t
 *
u
)

538 #i‡(
NGX_HAVE_UNIX_DOMAIN
)

539 
u_ch¨
 *
∑th
, *
uri
, *
œ°
;

540 
size_t
 
Àn
;

541 
sockaddr_un
 *
ßun
;

543 
Àn
 = 
u
->
uæ
.len;

544 
∑th
 = 
u
->
uæ
.
d©a
;

546 
∑th
 += 5;

547 
Àn
 -= 5;

549 i‡(
u
->
uri_∑π
) {

551 
œ°
 = 
∑th
 + 
Àn
;

552 
uri
 = 
	`ngx_°æchr
(
∑th
, 
œ°
, ':');

554 i‡(
uri
) {

555 
Àn
 = 
uri
 - 
∑th
;

556 
uri
++;

557 
u
->
uri
.
Àn
 = 
œ°
 - uri;

558 
u
->
uri
.
d©a
 = uri;

562 i‡(
Àn
 == 0) {

563 
u
->
îr
 = "noÖath inÅhe unix domain socket";

564  
NGX_ERROR
;

567 
u
->
ho°
.
Àn
 =Üen++;

568 
u
->
ho°
.
d©a
 = 
∑th
;

570 i‡(
Àn
 > (
ßun
->
sun_∑th
)) {

571 
u
->
îr
 = "tooÜongÖath inÅhe unix domain socket";

572  
NGX_ERROR
;

575 
u
->
sockÀn
 = (
sockaddr_un
);

576 
ßun
 = (
sockaddr_un
 *Ë&
u
->
sockaddr
;

577 
ßun
->
sun_Ámûy
 = 
AF_UNIX
;

578 (Ë
	`ngx_˝y°∫
((
u_ch¨
 *Ë
ßun
->
sun_∑th
, 
∑th
, 
Àn
);

580 
u
->
addrs
 = 
	`ngx_pˇŒoc
(
poﬁ
, (
ngx_addr_t
));

581 i‡(
u
->
addrs
 =
NULL
) {

582  
NGX_ERROR
;

585 
ßun
 = 
	`ngx_pˇŒoc
(
poﬁ
, (
sockaddr_un
));

586 i‡(
ßun
 =
NULL
) {

587  
NGX_ERROR
;

590 
u
->
Ámûy
 = 
AF_UNIX
;

591 
u
->
«ddrs
 = 1;

593 
ßun
->
sun_Ámûy
 = 
AF_UNIX
;

594 (Ë
	`ngx_˝y°∫
((
u_ch¨
 *Ë
ßun
->
sun_∑th
, 
∑th
, 
Àn
);

596 
u
->
addrs
[0].
sockaddr
 = (sockadd∏*Ë
ßun
;

597 
u
->
addrs
[0].
sockÀn
 = (
sockaddr_un
);

598 
u
->
addrs
[0].
«me
.
Àn
 =Üen + 4;

599 
u
->
addrs
[0].
«me
.
d©a
 = u->
uæ
.data;

601  
NGX_OK
;

605 
u
->
îr
 = "the unix domain socketsáreÇot supported onÅhisÖlatform";

607  
NGX_ERROR
;

610 
	}
}

613 
ngx_öt_t


614 
	$ngx_∑r£_öë_uæ
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uæ_t
 *
u
)

616 
u_ch¨
 *
p
, *
ho°
, *
p‹t
, *
œ°
, *
uri
, *
¨gs
;

617 
size_t
 
Àn
;

618 
ngx_öt_t
 
n
;

619 
ho°ít
 *
h
;

620 
sockaddr_ö
 *
sö
;

622 
u
->
sockÀn
 = (
sockaddr_ö
);

623 
sö
 = (
sockaddr_ö
 *Ë&
u
->
sockaddr
;

624 
sö
->
sö_Ámûy
 = 
AF_INET
;

626 
u
->
Ámûy
 = 
AF_INET
;

628 
ho°
 = 
u
->
uæ
.
d©a
;

630 
œ°
 = 
ho°
 + 
u
->
uæ
.
Àn
;

632 
p‹t
 = 
	`ngx_°æchr
(
ho°
, 
œ°
, ':');

634 
uri
 = 
	`ngx_°æchr
(
ho°
, 
œ°
, '/');

636 
¨gs
 = 
	`ngx_°æchr
(
ho°
, 
œ°
, '?');

638 i‡(
¨gs
) {

639 i‡(
uri
 =
NULL
) {

640 
uri
 = 
¨gs
;

642 } i‡(
¨gs
 < 
uri
) {

643 
uri
 = 
¨gs
;

647 i‡(
uri
) {

648 i‡(
u
->
li°í
 || !u->
uri_∑π
) {

649 
u
->
îr
 = "invalid host";

650  
NGX_ERROR
;

653 
u
->
uri
.
Àn
 = 
œ°
 - uri;

654 
u
->
uri
.
d©a
 = uri;

656 
œ°
 = 
uri
;

658 i‡(
uri
 < 
p‹t
) {

659 
p‹t
 = 
NULL
;

663 i‡(
p‹t
) {

664 
p‹t
++;

666 
Àn
 = 
œ°
 - 
p‹t
;

668 i‡(
Àn
 == 0) {

669 
u
->
îr
 = "invalidÖort";

670  
NGX_ERROR
;

673 
n
 = 
	`ngx_©oi
(
p‹t
, 
Àn
);

675 i‡(
n
 < 1 ||Ç > 65535) {

676 
u
->
îr
 = "invalidÖort";

677  
NGX_ERROR
;

680 
u
->
p‹t
 = (
ö_p‹t_t
Ë
n
;

681 
sö
->
sö_p‹t
 = 
	`ht⁄s
((
ö_p‹t_t
Ë
n
);

683 
u
->
p‹t_ãxt
.
Àn
 =Üen;

684 
u
->
p‹t_ãxt
.
d©a
 = 
p‹t
;

686 
œ°
 = 
p‹t
 - 1;

689 i‡(
uri
 =
NULL
) {

691 i‡(
u
->
li°í
) {

695 
n
 = 
	`ngx_©oi
(
ho°
, 
œ°
 - host);

697 i‡(
n
 !
NGX_ERROR
) {

699 i‡(
n
 < 1 ||Ç > 65535) {

700 
u
->
îr
 = "invalidÖort";

701  
NGX_ERROR
;

704 
u
->
p‹t
 = (
ö_p‹t_t
Ë
n
;

705 
sö
->
sö_p‹t
 = 
	`ht⁄s
((
ö_p‹t_t
Ë
n
);

707 
u
->
p‹t_ãxt
.
Àn
 = 
œ°
 - 
ho°
;

708 
u
->
p‹t_ãxt
.
d©a
 = 
ho°
;

710 
u
->
wûdˇrd
 = 1;

712  
NGX_OK
;

717 
u
->
no_p‹t
 = 1;

720 
Àn
 = 
œ°
 - 
ho°
;

722 i‡(
Àn
 == 0) {

723 
u
->
îr
 = "no host";

724  
NGX_ERROR
;

727 i‡(
Àn
 =1 && *
ho°
 == '*') {

728 
Àn
 = 0;

731 
u
->
ho°
.
Àn
 =Üen;

732 
u
->
ho°
.
d©a
 = host;

734 i‡(
u
->
no_ªsﬁve
) {

735  
NGX_OK
;

738 i‡(
Àn
) {

739 
sö
->
sö_addr
.
s_addr
 = 
	`ngx_öë_addr
(
ho°
, 
Àn
);

741 i‡(
sö
->
sö_addr
.
s_addr
 =
INADDR_NONE
) {

742 
p
 = 
	`ngx_Æloc
(++
Àn
, 
poﬁ
->
log
);

743 i‡(
p
 =
NULL
) {

744  
NGX_ERROR
;

747 (Ë
	`ngx_˝y°∫
(
p
, 
ho°
, 
Àn
);

749 
h
 = 
	`gëho°by«me
((c⁄° *Ë
p
);

751 
	`ngx_‰ì
(
p
);

753 i‡(
h
 =
NULL
 || h->
h_addr_li°
[0] == NULL) {

754 
u
->
îr
 = "hostÇot found";

755  
NGX_ERROR
;

758 
sö
->
sö_addr
.
s_addr
 = *(
ö_addr_t
 *Ë(
h
->
h_addr_li°
[0]);

761 i‡(
sö
->
sö_addr
.
s_addr
 =
INADDR_ANY
) {

762 
u
->
wûdˇrd
 = 1;

766 
sö
->
sö_addr
.
s_addr
 = 
INADDR_ANY
;

767 
u
->
wûdˇrd
 = 1;

770 i‡(
u
->
no_p‹t
) {

771 
u
->
p‹t
 = u->
deÁu…_p‹t
;

772 
sö
->
sö_p‹t
 = 
	`ht⁄s
(
u
->
deÁu…_p‹t
);

775 i‡(
u
->
li°í
) {

776  
NGX_OK
;

779 i‡(
	`ngx_öë_ªsﬁve_ho°
(
poﬁ
, 
u
Ë!
NGX_OK
) {

780  
NGX_ERROR
;

783  
NGX_OK
;

784 
	}
}

787 
ngx_öt_t


788 
	$ngx_∑r£_öë6_uæ
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uæ_t
 *
u
)

790 #i‡(
NGX_HAVE_INET6
)

791 
u_ch¨
 *
p
, *
ho°
, *
p‹t
, *
œ°
, *
uri
;

792 
size_t
 
Àn
;

793 
ngx_öt_t
 
n
;

794 
sockaddr_ö6
 *
sö6
;

796 
u
->
sockÀn
 = (
sockaddr_ö6
);

797 
sö6
 = (
sockaddr_ö6
 *Ë&
u
->
sockaddr
;

798 
sö6
->
sö6_Ámûy
 = 
AF_INET6
;

800 
ho°
 = 
u
->
uæ
.
d©a
 + 1;

802 
œ°
 = 
u
->
uæ
.
d©a
 + u->uæ.
Àn
;

804 
p
 = 
	`ngx_°æchr
(
ho°
, 
œ°
, ']');

806 i‡(
p
 =
NULL
) {

807 
u
->
îr
 = "invalid host";

808  
NGX_ERROR
;

811 i‡(
œ°
 - 
p
) {

813 
p‹t
 = 
p
 + 1;

815 
uri
 = 
	`ngx_°æchr
(
p‹t
, 
œ°
, '/');

817 i‡(
uri
) {

818 i‡(
u
->
li°í
 || !u->
uri_∑π
) {

819 
u
->
îr
 = "invalid host";

820  
NGX_ERROR
;

823 
u
->
uri
.
Àn
 = 
œ°
 - uri;

824 
u
->
uri
.
d©a
 = uri;

827 i‡(*
p‹t
 == ':') {

828 
p‹t
++;

830 
Àn
 = 
œ°
 - 
p‹t
;

832 i‡(
Àn
 == 0) {

833 
u
->
îr
 = "invalidÖort";

834  
NGX_ERROR
;

837 
n
 = 
	`ngx_©oi
(
p‹t
, 
Àn
);

839 i‡(
n
 < 1 ||Ç > 65535) {

840 
u
->
îr
 = "invalidÖort";

841  
NGX_ERROR
;

844 
u
->
p‹t
 = (
ö_p‹t_t
Ë
n
;

845 
sö6
->
sö6_p‹t
 = 
	`ht⁄s
((
ö_p‹t_t
Ë
n
);

847 
u
->
p‹t_ãxt
.
Àn
 =Üen;

848 
u
->
p‹t_ãxt
.
d©a
 = 
p‹t
;

851 
u
->
no_p‹t
 = 1;

855 
Àn
 = 
p
 - 
ho°
;

857 i‡(
Àn
 == 0) {

858 
u
->
îr
 = "no host";

859  
NGX_ERROR
;

862 
u
->
ho°
.
Àn
 =Üen;

863 
u
->
ho°
.
d©a
 = host;

865 i‡(
	`ngx_öë6_addr
(
ho°
, 
Àn
, 
sö6
->
sö6_addr
.
s6_addr
Ë!
NGX_OK
) {

866 
u
->
îr
 = "invalid IPv6áddress";

867  
NGX_ERROR
;

870 i‡(
	`IN6_IS_ADDR_UNSPECIFIED
(&
sö6
->
sö6_addr
)) {

871 
u
->
wûdˇrd
 = 1;

874 
u
->
Ámûy
 = 
AF_INET6
;

876 i‡(
u
->
no_ªsﬁve
) {

877  
NGX_OK
;

880 i‡(
u
->
no_p‹t
) {

881 
u
->
p‹t
 = u->
deÁu…_p‹t
;

882 
sö6
->
sö6_p‹t
 = 
	`ht⁄s
(
u
->
deÁu…_p‹t
);

885  
NGX_OK
;

889 
u
->
îr
 = "the INET6 socketsáreÇot supported onÅhisÖlatform";

891  
NGX_ERROR
;

894 
	}
}

897 
ngx_öt_t


898 
	$ngx_öë_ªsﬁve_ho°
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uæ_t
 *
u
)

900 
u_ch¨
 *
p
, *
ho°
;

901 
size_t
 
Àn
;

902 
ö_p‹t_t
 
p‹t
;

903 
ö_addr_t
 
ö_addr
;

904 
ngx_uöt_t
 
i
;

905 
ho°ít
 *
h
;

906 
sockaddr_ö
 *
sö
;

910 
p‹t
 = 
	`ht⁄s
(
u
->port);

912 
ö_addr
 = 
	`ngx_öë_addr
(
u
->
ho°
.
d©a
, u->ho°.
Àn
);

914 i‡(
ö_addr
 =
INADDR_NONE
) {

915 
ho°
 = 
	`ngx_Æloc
(
u
->ho°.
Àn
 + 1, 
poﬁ
->
log
);

916 i‡(
ho°
 =
NULL
) {

917  
NGX_ERROR
;

920 (Ë
	`ngx_˝y°∫
(
ho°
, 
u
->ho°.
d©a
, u->ho°.
Àn
 + 1);

922 
h
 = 
	`gëho°by«me
((*Ë
ho°
);

924 
	`ngx_‰ì
(
ho°
);

926 i‡(
h
 =
NULL
 || h->
h_addr_li°
[0] == NULL) {

927 
u
->
îr
 = "hostÇot found";

928  
NGX_ERROR
;

931 i‡(
u
->
⁄e_addr
 == 0) {

932 
i
 = 0; 
h
->
h_addr_li°
[i] !
NULL
; i++) { }

935 
i
 = 1;

940 
u
->
addrs
 = 
	`ngx_pˇŒoc
(
poﬁ
, 
i
 * (
ngx_addr_t
));

941 i‡(
u
->
addrs
 =
NULL
) {

942  
NGX_ERROR
;

945 
u
->
«ddrs
 = 
i
;

947 
i
 = 0; i < 
u
->
«ddrs
; i++) {

949 
sö
 = 
	`ngx_pˇŒoc
(
poﬁ
, (
sockaddr_ö
));

950 i‡(
sö
 =
NULL
) {

951  
NGX_ERROR
;

954 
sö
->
sö_Ámûy
 = 
AF_INET
;

955 
sö
->
sö_p‹t
 = 
p‹t
;

956 
sö
->
sö_addr
.
s_addr
 = *(
ö_addr_t
 *Ë(
h
->
h_addr_li°
[
i
]);

958 
u
->
addrs
[
i
].
sockaddr
 = (sockadd∏*Ë
sö
;

959 
u
->
addrs
[
i
].
sockÀn
 = (
sockaddr_ö
);

961 
Àn
 = 
NGX_INET_ADDRSTRLEN
 + (":65535") - 1;

963 
p
 = 
	`ngx_≤Æloc
(
poﬁ
, 
Àn
);

964 i‡(
p
 =
NULL
) {

965  
NGX_ERROR
;

968 
Àn
 = 
	`ngx_sock_¡›
((
sockaddr
 *Ë
sö
, 
p
,Üen, 1);

970 
u
->
addrs
[
i
].
«me
.
Àn
 =Üen;

971 
u
->
addrs
[
i
].
«me
.
d©a
 = 
p
;

978 
u
->
addrs
 = 
	`ngx_pˇŒoc
(
poﬁ
, (
ngx_addr_t
));

979 i‡(
u
->
addrs
 =
NULL
) {

980  
NGX_ERROR
;

983 
sö
 = 
	`ngx_pˇŒoc
(
poﬁ
, (
sockaddr_ö
));

984 i‡(
sö
 =
NULL
) {

985  
NGX_ERROR
;

988 
u
->
«ddrs
 = 1;

990 
sö
->
sö_Ámûy
 = 
AF_INET
;

991 
sö
->
sö_p‹t
 = 
p‹t
;

992 
sö
->
sö_addr
.
s_addr
 = 
ö_addr
;

994 
u
->
addrs
[0].
sockaddr
 = (sockadd∏*Ë
sö
;

995 
u
->
addrs
[0].
sockÀn
 = (
sockaddr_ö
);

997 
p
 = 
	`ngx_≤Æloc
(
poﬁ
, 
u
->
ho°
.
Àn
 + (":65535") - 1);

998 i‡(
p
 =
NULL
) {

999  
NGX_ERROR
;

1002 
u
->
addrs
[0].
«me
.
Àn
 = 
	`ngx_•rötf
(
p
, "%V:%d",

1003 &
u
->
ho°
, 
	`¡ohs
(
p‹t
)Ë- 
p
;

1004 
u
->
addrs
[0].
«me
.
d©a
 = 
p
;

1007  
NGX_OK
;

1008 
	}
}

	@ngx_inet.h

8 #i‚de‡
_NGX_INET_H_INCLUDED_


9 
	#_NGX_INET_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

24 
	#NGX_INET_ADDRSTRLEN
 (("255.255.255.255"Ë- 1)

	)

25 
	#NGX_INET6_ADDRSTRLEN
 \

26 (("ffff:ffff:ffff:ffff:ffff:ffff:255.255.255.255"Ë- 1)

	)

27 
	#NGX_UNIX_ADDRSTRLEN
 \

28 ((
sockaddr_un
Ë- 
	`off£tof
(sockaddr_un, 
sun_∑th
))

	)

30 #i‡(
NGX_HAVE_UNIX_DOMAIN
)

31 
	#NGX_SOCKADDR_STRLEN
 (("unix:"Ë- 1 + 
NGX_UNIX_ADDRSTRLEN
)

	)

33 
	#NGX_SOCKADDR_STRLEN
 (
NGX_INET6_ADDRSTRLEN
 + (":65535"Ë- 1)

	)

36 #i‡(
NGX_HAVE_UNIX_DOMAIN
)

37 
	#NGX_SOCKADDRLEN
 (
sockaddr_un
)

	)

39 
	#NGX_SOCKADDRLEN
 512

	)

44 
ö_addr_t
 
	maddr
;

45 
ö_addr_t
 
	mmask
;

46 } 
	tngx_ö_cidr_t
;

49 #i‡(
NGX_HAVE_INET6
)

52 
ö6_addr
 
	maddr
;

53 
ö6_addr
 
	mmask
;

54 } 
	tngx_ö6_cidr_t
;

60 
ngx_uöt_t
 
	mÁmûy
;

62 
ngx_ö_cidr_t
 
	mö
;

63 #i‡(
NGX_HAVE_INET6
)

64 
ngx_ö6_cidr_t
 
	mö6
;

66 } 
	mu
;

67 } 
	tngx_cidr_t
;

71 
sockaddr
 *
	msockaddr
;

72 
sockÀn_t
 
	msockÀn
;

73 
ngx_°r_t
 
	m«me
;

74 } 
	tngx_addr_t
;

78 
ngx_°r_t
 
	muæ
;

79 
ngx_°r_t
 
	mho°
;

80 
ngx_°r_t
 
	mp‹t_ãxt
;

81 
ngx_°r_t
 
	muri
;

83 
ö_p‹t_t
 
	mp‹t
;

84 
ö_p‹t_t
 
	mdeÁu…_p‹t
;

85 
	mÁmûy
;

87 
	mli°í
:1;

88 
	muri_∑π
:1;

89 
	mno_ªsﬁve
:1;

90 
	m⁄e_addr
:1;

92 
	mno_p‹t
:1;

93 
	mwûdˇrd
:1;

95 
sockÀn_t
 
	msockÀn
;

96 
u_ch¨
 
	msockaddr
[
NGX_SOCKADDRLEN
];

98 
ngx_addr_t
 *
	maddrs
;

99 
ngx_uöt_t
 
	m«ddrs
;

101 *
	mîr
;

102 } 
	tngx_uæ_t
;

105 
ö_addr_t
 
ngx_öë_addr
(
u_ch¨
 *
ãxt
, 
size_t
 
Àn
);

106 #i‡(
NGX_HAVE_INET6
)

107 
ngx_öt_t
 
ngx_öë6_addr
(
u_ch¨
 *
p
, 
size_t
 
Àn
, u_ch¨ *
addr
);

108 
size_t
 
ngx_öë6_¡›
(
u_ch¨
 *
p
, u_ch¨ *
ãxt
, size_à
Àn
);

110 
size_t
 
ngx_sock_¡›
(
sockaddr
 *
ß
, 
u_ch¨
 *
ãxt
, size_à
Àn
,

111 
ngx_uöt_t
 
p‹t
);

112 
size_t
 
ngx_öë_¡›
(
Ámûy
, *
addr
, 
u_ch¨
 *
ãxt
, size_à
Àn
);

113 
ngx_öt_t
 
ngx_±ocidr
(
ngx_°r_t
 *
ãxt
, 
ngx_cidr_t
 *
cidr
);

114 
ngx_öt_t
 
ngx_∑r£_addr
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_addr_t
 *
addr
, 
u_ch¨
 *
ãxt
,

115 
size_t
 
Àn
);

116 
ngx_öt_t
 
ngx_∑r£_uæ
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uæ_t
 *
u
);

117 
ngx_öt_t
 
ngx_öë_ªsﬁve_ho°
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uæ_t
 *
u
);

	@ngx_list.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 
ngx_li°_t
 *

13 
	$ngx_li°_¸óã
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uöt_t
 
n
, 
size_t
 
size
)

15 
ngx_li°_t
 *
li°
;

17 
li°
 = 
	`ngx_∑Œoc
(
poﬁ
, (
ngx_li°_t
));

18 i‡(
li°
 =
NULL
) {

19  
NULL
;

22 
li°
->
∑π
.
ñts
 = 
	`ngx_∑Œoc
(
poﬁ
, 
n
 * 
size
);

23 i‡(
li°
->
∑π
.
ñts
 =
NULL
) {

24  
NULL
;

27 
li°
->
∑π
.
√…s
 = 0;

28 
li°
->
∑π
.
√xt
 = 
NULL
;

29 
li°
->
œ°
 = &li°->
∑π
;

30 
li°
->
size
 = size;

31 
li°
->
«Œoc
 = 
n
;

32 
li°
->
poﬁ
 =Öool;

34  
li°
;

35 
	}
}

39 
	$ngx_li°_push
(
ngx_li°_t
 *
l
)

41 *
ñt
;

42 
ngx_li°_∑π_t
 *
œ°
;

44 
œ°
 = 
l
->last;

46 i‡(
œ°
->
√…s
 =
l
->
«Œoc
) {

50 
œ°
 = 
	`ngx_∑Œoc
(
l
->
poﬁ
, (
ngx_li°_∑π_t
));

51 i‡(
œ°
 =
NULL
) {

52  
NULL
;

55 
œ°
->
ñts
 = 
	`ngx_∑Œoc
(
l
->
poﬁ
,Ü->
«Œoc
 *Ü->
size
);

56 i‡(
œ°
->
ñts
 =
NULL
) {

57  
NULL
;

60 
œ°
->
√…s
 = 0;

61 
œ°
->
√xt
 = 
NULL
;

63 
l
->
œ°
->
√xt
 =Üast;

64 
l
->
œ°
 =Üast;

67 
ñt
 = (*Ë
œ°
->
ñts
 + 
l
->
size
 *Üa°->
√…s
;

68 
œ°
->
√…s
++;

70  
ñt
;

71 
	}
}

	@ngx_list.h

8 #i‚de‡
_NGX_LIST_H_INCLUDED_


9 
	#_NGX_LIST_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 
ngx_li°_∑π_s
 
	tngx_li°_∑π_t
;

18 
	sngx_li°_∑π_s
 {

19 *
	mñts
;

20 
ngx_uöt_t
 
	m√…s
;

21 
ngx_li°_∑π_t
 *
	m√xt
;

26 
ngx_li°_∑π_t
 *
	mœ°
;

27 
ngx_li°_∑π_t
 
	m∑π
;

28 
size_t
 
	msize
;

29 
ngx_uöt_t
 
	m«Œoc
;

30 
ngx_poﬁ_t
 *
	mpoﬁ
;

31 } 
	tngx_li°_t
;

34 
ngx_li°_t
 *
ngx_li°_¸óã
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uöt_t
 
n
, 
size_t
 
size
);

36 
ngx_ölöe
 
ngx_öt_t


37 
	$ngx_li°_öô
(
ngx_li°_t
 *
li°
, 
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uöt_t
 
n
, 
size_t
 
size
)

39 
li°
->
∑π
.
ñts
 = 
	`ngx_∑Œoc
(
poﬁ
, 
n
 * 
size
);

40 i‡(
li°
->
∑π
.
ñts
 =
NULL
) {

41  
NGX_ERROR
;

44 
li°
->
∑π
.
√…s
 = 0;

45 
li°
->
∑π
.
√xt
 = 
NULL
;

46 
li°
->
œ°
 = &li°->
∑π
;

47 
li°
->
size
 = size;

48 
li°
->
«Œoc
 = 
n
;

49 
li°
->
poﬁ
 =Öool;

51  
NGX_OK
;

52 
	}
}

80 *
ngx_li°_push
(
ngx_li°_t
 *
li°
);

	@ngx_log.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 *
ngx_îr‹_log
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
);

15 
ngx_comm™d_t
 
	gngx_îæog_comm™ds
[] = {

17 {
ngx_°rög
("error_log"),

18 
NGX_MAIN_CONF
|
NGX_CONF_1MORE
,

19 
ngx_îr‹_log
,

22 
NULL
},

24 
ngx_nuŒ_comm™d


28 
ngx_c‹e_moduÀ_t
 
	gngx_îæog_moduÀ_˘x
 = {

29 
ngx_°rög
("errlog"),

30 
NULL
,

31 
NULL


35 
ngx_moduÀ_t
 
	gngx_îæog_moduÀ
 = {

36 
NGX_MODULE_V1
,

37 &
ngx_îæog_moduÀ_˘x
,

38 
ngx_îæog_comm™ds
,

39 
NGX_CORE_MODULE
,

40 
NULL
,

41 
NULL
,

42 
NULL
,

43 
NULL
,

44 
NULL
,

45 
NULL
,

46 
NULL
,

47 
NGX_MODULE_V1_PADDING


51 
ngx_log_t
 
	gngx_log
;

52 
ngx_›í_fûe_t
 
	gngx_log_fûe
;

53 
ngx_uöt_t
 
	gngx_u£_°dîr
 = 1;

56 
ngx_°r_t
 
	gîr_Àvñs
[] = {

57 
ngx_nuŒ_°rög
,

58 
ngx_°rög
("emerg"),

59 
ngx_°rög
("alert"),

60 
ngx_°rög
("crit"),

61 
ngx_°rög
("error"),

62 
ngx_°rög
("warn"),

63 
ngx_°rög
("notice"),

64 
ngx_°rög
("info"),

65 
ngx_°rög
("debug")

68 c⁄° *
	gdebug_Àvñs
[] = {

74 #i‡(
NGX_HAVE_VARIADIC_MACROS
)

77 
	$ngx_log_îr‹_c‹e
(
ngx_uöt_t
 
Àvñ
, 
ngx_log_t
 *
log
, 
ngx_îr_t
 
îr
,

78 c⁄° *
fmt
, ...)

83 
	$ngx_log_îr‹_c‹e
(
ngx_uöt_t
 
Àvñ
, 
ngx_log_t
 *
log
, 
ngx_îr_t
 
îr
,

84 c⁄° *
fmt
, 
va_li°
 
¨gs
)

88 #i‡(
NGX_HAVE_VARIADIC_MACROS
)

89 
va_li°
 
¨gs
;

91 
u_ch¨
 *
p
, *
œ°
, *
msg
;

92 
u_ch¨
 
îr°r
[
NGX_MAX_ERROR_STR
];

94 i‡(
log
->
fûe
->
fd
 =
NGX_INVALID_FILE
) {

98 
œ°
 = 
îr°r
 + 
NGX_MAX_ERROR_STR
;

100 
	`ngx_mem˝y
(
îr°r
, 
ngx_ˇched_îr_log_time
.
d©a
,

101 
ngx_ˇched_îr_log_time
.
Àn
);

103 
p
 = 
îr°r
 + 
ngx_ˇched_îr_log_time
.
Àn
;

105 
p
 = 
	`ngx_¶¥ötf
’, 
œ°
, " [%V] ", &
îr_Àvñs
[
Àvñ
]);

108 
p
 = 
	`ngx_¶¥ötf
’, 
œ°
, "%P#" 
NGX_TID_T_FMT
 ": ",

109 
ngx_log_pid
, 
ngx_log_tid
);

111 i‡(
log
->
c⁄√˘i⁄
) {

112 
p
 = 
	`ngx_¶¥ötf
’, 
œ°
, "*%uA ", 
log
->
c⁄√˘i⁄
);

115 
msg
 = 
p
;

117 #i‡(
NGX_HAVE_VARIADIC_MACROS
)

119 
	`va_°¨t
(
¨gs
, 
fmt
);

120 
p
 = 
	`ngx_v¶¥ötf
’, 
œ°
, 
fmt
, 
¨gs
);

121 
	`va_íd
(
¨gs
);

125 
p
 = 
	`ngx_v¶¥ötf
’, 
œ°
, 
fmt
, 
¨gs
);

129 i‡(
îr
) {

130 
p
 = 
	`ngx_log_î∫o
’, 
œ°
, 
îr
);

133 i‡(
Àvñ
 !
NGX_LOG_DEBUG
 && 
log
->
h™dÀr
) {

134 
p
 = 
log
->
	`h™dÀr
÷og,Ö, 
œ°
 -Ö);

137 i‡(
p
 > 
œ°
 - 
NGX_LINEFEED_SIZE
) {

138 
p
 = 
œ°
 - 
NGX_LINEFEED_SIZE
;

141 
	`ngx_löe„ed
(
p
);

143 (Ë
	`ngx_wrôe_fd
(
log
->
fûe
->
fd
, 
îr°r
, 
p
 -Érrstr);

145 i‡(!
ngx_u£_°dîr


146 || 
Àvñ
 > 
NGX_LOG_WARN


147 || 
log
->
fûe
->
fd
 =
ngx_°dîr
)

152 
msg
 -(7 + 
îr_Àvñs
[
Àvñ
].
Àn
 + 3);

154 (Ë
	`ngx_•rötf
(
msg
, "ngöx: [%V] ", &
îr_Àvñs
[
Àvñ
]);

156 (Ë
	`ngx_wrôe_c⁄sﬁe
(
ngx_°dîr
, 
msg
, 
p
 - msg);

157 
	}
}

160 #i‡!(
NGX_HAVE_VARIADIC_MACROS
)

162 
ngx_cde˛


163 
	$ngx_log_îr‹
(
ngx_uöt_t
 
Àvñ
, 
ngx_log_t
 *
log
, 
ngx_îr_t
 
îr
,

164 c⁄° *
fmt
, ...)

166 
va_li°
 
¨gs
;

168 i‡(
log
->
log_Àvñ
 >
Àvñ
) {

169 
	`va_°¨t
(
¨gs
, 
fmt
);

170 
	`ngx_log_îr‹_c‹e
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨gs
);

171 
	`va_íd
(
¨gs
);

173 
	}
}

176 
ngx_cde˛


177 
	$ngx_log_debug_c‹e
(
ngx_log_t
 *
log
, 
ngx_îr_t
 
îr
, c⁄° *
fmt
, ...)

179 
va_li°
 
¨gs
;

181 
	`va_°¨t
(
¨gs
, 
fmt
);

182 
	`ngx_log_îr‹_c‹e
(
NGX_LOG_DEBUG
, 
log
, 
îr
, 
fmt
, 
¨gs
);

183 
	`va_íd
(
¨gs
);

184 
	}
}

189 
ngx_cde˛


190 
	$ngx_log_ab‹t
(
ngx_îr_t
 
îr
, c⁄° *
fmt
, ...)

192 
u_ch¨
 *
p
;

193 
va_li°
 
¨gs
;

194 
u_ch¨
 
îr°r
[
NGX_MAX_CONF_ERRSTR
];

196 
	`va_°¨t
(
¨gs
, 
fmt
);

197 
p
 = 
	`ngx_v¢¥ötf
(
îr°r
, ”º°rË- 1, 
fmt
, 
¨gs
);

198 
	`va_íd
(
¨gs
);

200 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 
îr
,

201 "%*s", 
p
 - 
îr°r
,Érrstr);

202 
	}
}

205 
ngx_cde˛


206 
	$ngx_log_°dîr
(
ngx_îr_t
 
îr
, c⁄° *
fmt
, ...)

208 
u_ch¨
 *
p
, *
œ°
;

209 
va_li°
 
¨gs
;

210 
u_ch¨
 
îr°r
[
NGX_MAX_ERROR_STR
];

212 
œ°
 = 
îr°r
 + 
NGX_MAX_ERROR_STR
;

213 
p
 = 
îr°r
 + 7;

215 
	`ngx_mem˝y
(
îr°r
, "nginx: ", 7);

217 
	`va_°¨t
(
¨gs
, 
fmt
);

218 
p
 = 
	`ngx_v¶¥ötf
’, 
œ°
, 
fmt
, 
¨gs
);

219 
	`va_íd
(
¨gs
);

221 i‡(
îr
) {

222 
p
 = 
	`ngx_log_î∫o
’, 
œ°
, 
îr
);

225 i‡(
p
 > 
œ°
 - 
NGX_LINEFEED_SIZE
) {

226 
p
 = 
œ°
 - 
NGX_LINEFEED_SIZE
;

229 
	`ngx_löe„ed
(
p
);

231 (Ë
	`ngx_wrôe_c⁄sﬁe
(
ngx_°dîr
, 
îr°r
, 
p
 -Érrstr);

232 
	}
}

235 
u_ch¨
 *

236 
	$ngx_log_î∫o
(
u_ch¨
 *
buf
, u_ch¨ *
œ°
, 
ngx_îr_t
 
îr
)

238 i‡(
buf
 > 
œ°
 - 50) {

242 
buf
 = 
œ°
 - 50;

243 *
buf
++ = '.';

244 *
buf
++ = '.';

245 *
buf
++ = '.';

248 #i‡(
NGX_WIN32
)

249 
buf
 = 
	`ngx_¶¥ötf
(buf, 
œ°
, ((Ë
îr
 < 0x80000000)

250 ? " (%d: " : " (%Xd: ", 
îr
);

252 
buf
 = 
	`ngx_¶¥ötf
(buf, 
œ°
, " (%d: ", 
îr
);

255 
buf
 = 
	`ngx_°ªº‹
(
îr
, buf, 
œ°
 - buf);

257 i‡(
buf
 < 
œ°
) {

258 *
buf
++ = ')';

261  
buf
;

262 
	}
}

265 
ngx_log_t
 *

266 
	$ngx_log_öô
(
u_ch¨
 *
¥efix
)

268 
u_ch¨
 *
p
, *
«me
;

269 
size_t
 
∆í
, 
∂í
;

271 
ngx_log
.
fûe
 = &
ngx_log_fûe
;

272 
ngx_log
.
log_Àvñ
 = 
NGX_LOG_NOTICE
;

274 
«me
 = (
u_ch¨
 *Ë
NGX_ERROR_LOG_PATH
;

281 
∆í
 = 
	`ngx_°æí
(
«me
);

283 i‡(
∆í
 == 0) {

284 
ngx_log_fûe
.
fd
 = 
ngx_°dîr
;

285  &
ngx_log
;

288 
p
 = 
NULL
;

290 #i‡(
NGX_WIN32
)

291 i‡(
«me
[1] != ':') {

293 i‡(
«me
[0] != '/') {

296 i‡(
¥efix
) {

297 
∂í
 = 
	`ngx_°æí
(
¥efix
);

300 #ifde‡
NGX_PREFIX


301 
¥efix
 = (
u_ch¨
 *Ë
NGX_PREFIX
;

302 
∂í
 = 
	`ngx_°æí
(
¥efix
);

304 
∂í
 = 0;

308 i‡(
∂í
) {

309 
«me
 = 
	`mÆloc
(
∂í
 + 
∆í
 + 2);

310 i‡(
«me
 =
NULL
) {

311  
NULL
;

314 
p
 = 
	`ngx_˝ymem
(
«me
, 
¥efix
, 
∂í
);

316 i‡(!
	`ngx_∑th_£∑øt‹
(*(
p
 - 1))) {

317 *
p
++ = '/';

320 
	`ngx_˝y°∫
(
p
, (
u_ch¨
 *Ë
NGX_ERROR_LOG_PATH
, 
∆í
 + 1);

322 
p
 = 
«me
;

326 
ngx_log_fûe
.
fd
 = 
	`ngx_›í_fûe
(
«me
, 
NGX_FILE_APPEND
,

327 
NGX_FILE_CREATE_OR_OPEN
,

328 
NGX_FILE_DEFAULT_ACCESS
);

330 i‡(
ngx_log_fûe
.
fd
 =
NGX_INVALID_FILE
) {

331 
	`ngx_log_°dîr
(
ngx_î∫o
,

333 
ngx_›í_fûe_n
 " \"%s\" faûed", 
«me
);

334 #i‡(
NGX_WIN32
)

335 
	`ngx_evít_log
(
ngx_î∫o
,

337 
ngx_›í_fûe_n
 " \"%s\" faûed", 
«me
);

340 
ngx_log_fûe
.
fd
 = 
ngx_°dîr
;

343 i‡(
p
) {

344 
	`ngx_‰ì
(
p
);

347  &
ngx_log
;

348 
	}
}

351 
ngx_log_t
 *

352 
	$ngx_log_¸óã
(
ngx_cy˛e_t
 *
cy˛e
, 
ngx_°r_t
 *
«me
)

354 
ngx_log_t
 *
log
;

356 
log
 = 
	`ngx_pˇŒoc
(
cy˛e
->
poﬁ
, (
ngx_log_t
));

357 i‡(
log
 =
NULL
) {

358  
NULL
;

361 
log
->
fûe
 = 
	`ngx_c⁄f_›í_fûe
(
cy˛e
, 
«me
);

362 i‡(
log
->
fûe
 =
NULL
) {

363  
NULL
;

366  
log
;

367 
	}
}

371 
	$ngx_log_£t_Àvñs
(
ngx_c⁄f_t
 *
cf
, 
ngx_log_t
 *
log
)

373 
ngx_uöt_t
 
i
, 
n
, 
d
, 
found
;

374 
ngx_°r_t
 *
vÆue
;

376 
vÆue
 = 
cf
->
¨gs
->
ñts
;

378 
i
 = 2; i < 
cf
->
¨gs
->
√…s
; i++) {

379 
found
 = 0;

381 
n
 = 1;Ç <
NGX_LOG_DEBUG
;Ç++) {

382 i‡(
	`ngx_°rcmp
(
vÆue
[
i
].
d©a
, 
îr_Àvñs
[
n
].data) == 0) {

384 i‡(
log
->
log_Àvñ
 != 0) {

385 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

387 &
vÆue
[
i
]);

388  
NGX_CONF_ERROR
;

391 
log
->
log_Àvñ
 = 
n
;

392 
found
 = 1;

397 
n
 = 0, 
d
 = 
NGX_LOG_DEBUG_FIRST
; d <
NGX_LOG_DEBUG_LAST
; d <<= 1) {

398 i‡(
	`ngx_°rcmp
(
vÆue
[
i
].
d©a
, 
debug_Àvñs
[
n
++]) == 0) {

399 i‡(
log
->
log_Àvñ
 & ~
NGX_LOG_DEBUG_ALL
) {

400 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

402 &
vÆue
[
i
]);

403  
NGX_CONF_ERROR
;

406 
log
->
log_Àvñ
 |
d
;

407 
found
 = 1;

413 i‡(!
found
) {

414 
	`ngx_c⁄f_log_îr‹
(
NGX_LOG_EMERG
, 
cf
, 0,

415 "övÆidÜogÜevñ \"%V\"", &
vÆue
[
i
]);

416  
NGX_CONF_ERROR
;

420 i‡(
log
->
log_Àvñ
 =
NGX_LOG_DEBUG
) {

421 
log
->
log_Àvñ
 = 
NGX_LOG_DEBUG_ALL
;

424  
NGX_CONF_OK
;

425 
	}
}

429 
	$ngx_îr‹_log
(
ngx_c⁄f_t
 *
cf
, 
ngx_comm™d_t
 *
cmd
, *
c⁄f
)

431 
ngx_°r_t
 *
vÆue
, 
«me
;

433 i‡(
cf
->
cy˛e
->
√w_log
.
fûe
) {

437 
vÆue
 = 
cf
->
¨gs
->
ñts
;

439 i‡(
	`ngx_°rcmp
(
vÆue
[1].
d©a
, "stderr") == 0) {

440 
	`ngx_°r_nuŒ
(&
«me
);

443 
«me
 = 
vÆue
[1];

446 
cf
->
cy˛e
->
√w_log
.
fûe
 = 
	`ngx_c⁄f_›í_fûe
(cf->cy˛e, &
«me
);

447 i‡(
cf
->
cy˛e
->
√w_log
.
fûe
 =
NULL
) {

448  
NULL
;

451 i‡(
cf
->
¨gs
->
√…s
 == 2) {

452 
cf
->
cy˛e
->
√w_log
.
log_Àvñ
 = 
NGX_LOG_ERR
;

453  
NGX_CONF_OK
;

456 
cf
->
cy˛e
->
√w_log
.
log_Àvñ
 = 0;

458  
	`ngx_log_£t_Àvñs
(
cf
, &cf->
cy˛e
->
√w_log
);

459 
	}
}

	@ngx_log.h

8 #i‚de‡
_NGX_LOG_H_INCLUDED_


9 
	#_NGX_LOG_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 
	#NGX_LOG_STDERR
 0

	)

17 
	#NGX_LOG_EMERG
 1

	)

18 
	#NGX_LOG_ALERT
 2

	)

19 
	#NGX_LOG_CRIT
 3

	)

20 
	#NGX_LOG_ERR
 4

	)

21 
	#NGX_LOG_WARN
 5

	)

22 
	#NGX_LOG_NOTICE
 6

	)

23 
	#NGX_LOG_INFO
 7

	)

24 
	#NGX_LOG_DEBUG
 8

	)

26 
	#NGX_LOG_DEBUG_CORE
 0x010

	)

27 
	#NGX_LOG_DEBUG_ALLOC
 0x020

	)

28 
	#NGX_LOG_DEBUG_MUTEX
 0x040

	)

29 
	#NGX_LOG_DEBUG_EVENT
 0x080

	)

30 
	#NGX_LOG_DEBUG_HTTP
 0x100

	)

31 
	#NGX_LOG_DEBUG_MAIL
 0x200

	)

32 
	#NGX_LOG_DEBUG_MYSQL
 0x400

	)

39 
	#NGX_LOG_DEBUG_FIRST
 
NGX_LOG_DEBUG_CORE


	)

40 
	#NGX_LOG_DEBUG_LAST
 
NGX_LOG_DEBUG_MYSQL


	)

41 
	#NGX_LOG_DEBUG_CONNECTION
 0x80000000

	)

42 
	#NGX_LOG_DEBUG_ALL
 0x7ffffff0

	)

45 
	gu_ch¨
 *(*
	tngx_log_h™dÀr_±
Ë(
	tngx_log_t
 *
	tlog
, 
	tu_ch¨
 *
	tbuf
, 
	tsize_t
 
	tÀn
);

48 
	sngx_log_s
 {

49 
ngx_uöt_t
 
	mlog_Àvñ
;

50 
ngx_›í_fûe_t
 *
	mfûe
;

52 
ngx_©omic_uöt_t
 
	mc⁄√˘i⁄
;

54 
ngx_log_h™dÀr_±
 
	mh™dÀr
;

55 *
	md©a
;

63 *
	ma˘i⁄
;

67 
	#NGX_MAX_ERROR_STR
 2048

	)

72 #i‡(
NGX_HAVE_C99_VARIADIC_MACROS
)

74 
	#NGX_HAVE_VARIADIC_MACROS
 1

	)

76 
	#ngx_log_îr‹
(
Àvñ
, 
log
, ...) \

77 i‡((
log
)->
log_Àvñ
 >
Àvñ
Ë
	`ngx_log_îr‹_c‹e
÷evñ,Üog, 
__VA_ARGS__
)

	)

79 
ngx_log_îr‹_c‹e
(
ngx_uöt_t
 
Àvñ
, 
ngx_log_t
 *
log
, 
ngx_îr_t
 
îr
,

80 c⁄° *
fmt
, ...);

82 
	#ngx_log_debug
(
Àvñ
, 
log
, ...) \

83 i‡((
log
)->
log_Àvñ
 & 
Àvñ
) \

84 
	`ngx_log_îr‹_c‹e
(
NGX_LOG_DEBUG
, 
log
, 
__VA_ARGS__
)

	)

88 #ñi‡(
NGX_HAVE_GCC_VARIADIC_MACROS
)

90 
	#NGX_HAVE_VARIADIC_MACROS
 1

	)

92 
	#ngx_log_îr‹
(
Àvñ
, 
log
, 
¨gs
...) \

93 i‡((
log
)->
log_Àvñ
 >
Àvñ
Ë
	`ngx_log_îr‹_c‹e
÷evñ,Üog, 
¨gs
)

	)

95 
ngx_log_îr‹_c‹e
(
ngx_uöt_t
 
Àvñ
, 
ngx_log_t
 *
log
, 
ngx_îr_t
 
îr
,

96 c⁄° *
fmt
, ...);

98 
	#ngx_log_debug
(
Àvñ
, 
log
, 
¨gs
...) \

99 i‡((
log
)->
log_Àvñ
 & 
Àvñ
) \

100 
	`ngx_log_îr‹_c‹e
(
NGX_LOG_DEBUG
, 
log
, 
¨gs
)

	)

106 
	#NGX_HAVE_VARIADIC_MACROS
 0

	)

108 
ngx_cde˛
 
ngx_log_îr‹
(
ngx_uöt_t
 
Àvñ
, 
ngx_log_t
 *
log
, 
ngx_îr_t
 
îr
,

109 c⁄° *
fmt
, ...);

110 
ngx_log_îr‹_c‹e
(
ngx_uöt_t
 
Àvñ
, 
ngx_log_t
 *
log
, 
ngx_îr_t
 
îr
,

111 c⁄° *
fmt
, 
va_li°
 
¨gs
);

112 
ngx_cde˛
 
ngx_log_debug_c‹e
(
ngx_log_t
 *
log
, 
ngx_îr_t
 
îr
,

113 c⁄° *
fmt
, ...);

121 #i‡(
NGX_DEBUG
)

123 #i‡(
NGX_HAVE_VARIADIC_MACROS
)

125 
	#ngx_log_debug0
(
Àvñ
, 
log
, 
îr
, 
fmt
) \

126 
	`ngx_log_debug
(
Àvñ
, 
log
, 
îr
, 
fmt
)

	)

128 
	#ngx_log_debug1
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
) \

129 
	`ngx_log_debug
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
)

	)

131 
	#ngx_log_debug2
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
) \

132 
	`ngx_log_debug
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
)

	)

134 
	#ngx_log_debug3
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
) \

135 
	`ngx_log_debug
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
)

	)

137 
	#ngx_log_debug4
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
) \

138 
	`ngx_log_debug
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
)

	)

140 
	#ngx_log_debug5
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
) \

141 
	`ngx_log_debug
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
)

	)

143 
	#ngx_log_debug6
(
Àvñ
, 
log
, 
îr
, 
fmt
, \

144 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
, 
¨g6
) \

145 
	`ngx_log_debug
(
Àvñ
, 
log
, 
îr
, 
fmt
, \

146 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
, 
¨g6
)

	)

148 
	#ngx_log_debug7
(
Àvñ
, 
log
, 
îr
, 
fmt
, \

149 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
, 
¨g6
, 
¨g7
) \

150 
	`ngx_log_debug
(
Àvñ
, 
log
, 
îr
, 
fmt
, \

151 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
, 
¨g6
, 
¨g7
)

	)

153 
	#ngx_log_debug8
(
Àvñ
, 
log
, 
îr
, 
fmt
, \

154 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
, 
¨g6
, 
¨g7
, 
¨g8
) \

155 
	`ngx_log_debug
(
Àvñ
, 
log
, 
îr
, 
fmt
, \

156 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
, 
¨g6
, 
¨g7
, 
¨g8
)

	)

161 
	#ngx_log_debug0
(
Àvñ
, 
log
, 
îr
, 
fmt
) \

162 i‡((
log
)->
log_Àvñ
 & 
Àvñ
) \

163 
	`ngx_log_debug_c‹e
(
log
, 
îr
, 
fmt
)

	)

165 
	#ngx_log_debug1
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
) \

166 i‡((
log
)->
log_Àvñ
 & 
Àvñ
) \

167 
	`ngx_log_debug_c‹e
(
log
, 
îr
, 
fmt
, 
¨g1
)

	)

169 
	#ngx_log_debug2
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
) \

170 i‡((
log
)->
log_Àvñ
 & 
Àvñ
) \

171 
	`ngx_log_debug_c‹e
(
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
)

	)

173 
	#ngx_log_debug3
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
) \

174 i‡((
log
)->
log_Àvñ
 & 
Àvñ
) \

175 
	`ngx_log_debug_c‹e
(
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
)

	)

177 
	#ngx_log_debug4
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
) \

178 i‡((
log
)->
log_Àvñ
 & 
Àvñ
) \

179 
	`ngx_log_debug_c‹e
(
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
)

	)

181 
	#ngx_log_debug5
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
) \

182 i‡((
log
)->
log_Àvñ
 & 
Àvñ
) \

183 
	`ngx_log_debug_c‹e
(
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
)

	)

185 
	#ngx_log_debug6
(
Àvñ
, 
log
, 
îr
, 
fmt
, \

186 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
, 
¨g6
) \

187 i‡((
log
)->
log_Àvñ
 & 
Àvñ
) \

188 
	`ngx_log_debug_c‹e
(
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
, 
¨g6
)

	)

190 
	#ngx_log_debug7
(
Àvñ
, 
log
, 
îr
, 
fmt
, \

191 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
, 
¨g6
, 
¨g7
) \

192 i‡((
log
)->
log_Àvñ
 & 
Àvñ
) \

193 
	`ngx_log_debug_c‹e
(
log
, 
îr
, 
fmt
, \

194 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
, 
¨g6
, 
¨g7
)

	)

196 
	#ngx_log_debug8
(
Àvñ
, 
log
, 
îr
, 
fmt
, \

197 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
, 
¨g6
, 
¨g7
, 
¨g8
) \

198 i‡((
log
)->
log_Àvñ
 & 
Àvñ
) \

199 
	`ngx_log_debug_c‹e
(
log
, 
îr
, 
fmt
, \

200 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
, 
¨g6
, 
¨g7
, 
¨g8
)

	)

206 
	#ngx_log_debug0
(
Àvñ
, 
log
, 
îr
, 
fmt
)

	)

207 
	#ngx_log_debug1
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
)

	)

208 
	#ngx_log_debug2
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
)

	)

209 
	#ngx_log_debug3
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
)

	)

210 
	#ngx_log_debug4
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
)

	)

211 
	#ngx_log_debug5
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
)

	)

212 
	#ngx_log_debug6
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
, 
¨g6
)

	)

213 
	#ngx_log_debug7
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
, \

214 
¨g6
, 
¨g7
)

	)

215 
	#ngx_log_debug8
(
Àvñ
, 
log
, 
îr
, 
fmt
, 
¨g1
, 
¨g2
, 
¨g3
, 
¨g4
, 
¨g5
, \

216 
¨g6
, 
¨g7
, 
¨g8
)

	)

222 
ngx_log_t
 *
ngx_log_öô
(
u_ch¨
 *
¥efix
);

223 
ngx_log_t
 *
ngx_log_¸óã
(
ngx_cy˛e_t
 *
cy˛e
, 
ngx_°r_t
 *
«me
);

224 *
ngx_log_£t_Àvñs
(
ngx_c⁄f_t
 *
cf
, 
ngx_log_t
 *
log
);

225 
ngx_cde˛
 
ngx_log_ab‹t
(
ngx_îr_t
 
îr
, c⁄° *
fmt
, ...);

226 
ngx_cde˛
 
ngx_log_°dîr
(
ngx_îr_t
 
îr
, c⁄° *
fmt
, ...);

227 
u_ch¨
 *
ngx_log_î∫o
(u_ch¨ *
buf
, u_ch¨ *
œ°
, 
ngx_îr_t
 
îr
);

239 
ngx_ölöe
 

240 
	$ngx_wrôe_°dîr
(*
ãxt
)

242 (Ë
	`ngx_wrôe_fd
(
ngx_°dîr
, 
ãxt
, 
	`°æí
(text));

243 
	}
}

246 
ngx_moduÀ_t
 
ngx_îæog_moduÀ
;

247 
ngx_uöt_t
 
ngx_u£_°dîr
;

	@ngx_md5.c

11 
	~<ngx_c⁄fig.h
>

12 
	~<ngx_c‹e.h
>

13 
	~<ngx_md5.h
>

16 #i‡!(
NGX_HAVE_MD5
)

18 c⁄° 
u_ch¨
 *
ngx_md5_body
(
ngx_md5_t
 *
˘x
, c⁄° u_ch¨ *
d©a
,

19 
size_t
 
size
);

23 
	$ngx_md5_öô
(
ngx_md5_t
 *
˘x
)

25 
˘x
->
a
 = 0x67452301;

26 
˘x
->
b
 = 0xefcdab89;

27 
˘x
->
c
 = 0x98badcfe;

28 
˘x
->
d
 = 0x10325476;

30 
˘x
->
byãs
 = 0;

31 
	}
}

35 
	$ngx_md5_upd©e
(
ngx_md5_t
 *
˘x
, c⁄° *
d©a
, 
size_t
 
size
)

37 
size_t
 
u£d
, 
‰ì
;

39 
u£d
 = (
size_t
Ë(
˘x
->
byãs
 & 0x3f);

40 
˘x
->
byãs
 +
size
;

42 i‡(
u£d
) {

43 
‰ì
 = 64 - 
u£d
;

45 i‡(
size
 < 
‰ì
) {

46 
	`ngx_mem˝y
(&
˘x
->
buf„r
[
u£d
], 
d©a
, 
size
);

50 
	`ngx_mem˝y
(&
˘x
->
buf„r
[
u£d
], 
d©a
, 
‰ì
);

51 
d©a
 = (
u_ch¨
 *Ëd©®+ 
‰ì
;

52 
size
 -
‰ì
;

53 (Ë
	`ngx_md5_body
(
˘x
, ctx->
buf„r
, 64);

56 i‡(
size
 >= 64) {

57 
d©a
 = 
	`ngx_md5_body
(
˘x
, d©a, 
size
 & ~(
size_t
) 0x3f);

58 
size
 &= 0x3f;

61 
	`ngx_mem˝y
(
˘x
->
buf„r
, 
d©a
, 
size
);

62 
	}
}

66 
ngx_md5_föÆ
(
u_ch¨
 
ªsu…
[16], 
ngx_md5_t
 *
˘x
)

68 
size_t
 
	gu£d
, 
	g‰ì
;

70 
	gu£d
 = (
size_t
Ë(
˘x
->
byãs
 & 0x3f);

72 
	g˘x
->
	gbuf„r
[
u£d
++] = 0x80;

74 
	g‰ì
 = 64 - 
u£d
;

76 i‡(
	g‰ì
 < 8) {

77 
ngx_memzîo
(&
˘x
->
buf„r
[
u£d
], 
‰ì
);

78 (Ë
ngx_md5_body
(
˘x
, ctx->
buf„r
, 64);

79 
	gu£d
 = 0;

80 
	g‰ì
 = 64;

83 
ngx_memzîo
(&
˘x
->
buf„r
[
u£d
], 
‰ì
 - 8);

85 
	g˘x
->
	gbyãs
 <<= 3;

86 
	g˘x
->
	gbuf„r
[56] = (
u_ch¨
Ë
˘x
->
byãs
;

87 
	g˘x
->
	gbuf„r
[57] = (
u_ch¨
Ë(
˘x
->
byãs
 >> 8);

88 
	g˘x
->
	gbuf„r
[58] = (
u_ch¨
Ë(
˘x
->
byãs
 >> 16);

89 
	g˘x
->
	gbuf„r
[59] = (
u_ch¨
Ë(
˘x
->
byãs
 >> 24);

90 
	g˘x
->
	gbuf„r
[60] = (
u_ch¨
Ë(
˘x
->
byãs
 >> 32);

91 
	g˘x
->
	gbuf„r
[61] = (
u_ch¨
Ë(
˘x
->
byãs
 >> 40);

92 
	g˘x
->
	gbuf„r
[62] = (
u_ch¨
Ë(
˘x
->
byãs
 >> 48);

93 
	g˘x
->
	gbuf„r
[63] = (
u_ch¨
Ë(
˘x
->
byãs
 >> 56);

95 (Ë
ngx_md5_body
(
˘x
, ctx->
buf„r
, 64);

97 
	gªsu…
[0] = (
u_ch¨
Ë
˘x
->
a
;

98 
	gªsu…
[1] = (
u_ch¨
Ë(
˘x
->
a
 >> 8);

99 
	gªsu…
[2] = (
u_ch¨
Ë(
˘x
->
a
 >> 16);

100 
	gªsu…
[3] = (
u_ch¨
Ë(
˘x
->
a
 >> 24);

101 
	gªsu…
[4] = (
u_ch¨
Ë
˘x
->
b
;

102 
	gªsu…
[5] = (
u_ch¨
Ë(
˘x
->
b
 >> 8);

103 
	gªsu…
[6] = (
u_ch¨
Ë(
˘x
->
b
 >> 16);

104 
	gªsu…
[7] = (
u_ch¨
Ë(
˘x
->
b
 >> 24);

105 
	gªsu…
[8] = (
u_ch¨
Ë
˘x
->
c
;

106 
	gªsu…
[9] = (
u_ch¨
Ë(
˘x
->
c
 >> 8);

107 
	gªsu…
[10] = (
u_ch¨
Ë(
˘x
->
c
 >> 16);

108 
	gªsu…
[11] = (
u_ch¨
Ë(
˘x
->
c
 >> 24);

109 
	gªsu…
[12] = (
u_ch¨
Ë
˘x
->
d
;

110 
	gªsu…
[13] = (
u_ch¨
Ë(
˘x
->
d
 >> 8);

111 
	gªsu…
[14] = (
u_ch¨
Ë(
˘x
->
d
 >> 16);

112 
	gªsu…
[15] = (
u_ch¨
Ë(
˘x
->
d
 >> 24);

114 
ngx_memzîo
(
˘x
, (*ctx));

126 
	#F
(
x
, 
y
, 
z
Ë((zË^ ((xË& ((yË^ (z))))

	)

127 
	#G
(
x
, 
y
, 
z
Ë((yË^ ((zË& ((xË^ (y))))

	)

128 
	#H
(
x
, 
y
, 
z
Ë((xË^ (yË^ (z))

	)

129 
	#I
(
x
, 
y
, 
z
Ë((yË^ ((xË| ~(z)))

	)

135 
	#STEP
(
f
, 
a
, 
b
, 
c
, 
d
, 
x
, 
t
, 
s
) \

136 (
a
Ë+
	`f
((
b
), (
c
), (
d
)Ë+ (
x
Ë+ (
t
); \

137 (
a
Ë((◊Ë<< (
s
)) | (((a) & 0xffffffff) >> (32 - (s)))); \

138 (
a
Ë+(
b
)

	)

149 #i‡(
NGX_HAVE_LITTLE_ENDIAN
 && 
NGX_HAVE_NONALIGNED
)

151 
	#SET
(
n
Ë(*(
uöt32_t
 *Ë&
p
[¿* 4])

	)

152 
	#GET
(
n
Ë(*(
uöt32_t
 *Ë&
p
[¿* 4])

	)

156 
	#SET
(
n
) \

157 (
block
[
n
] = \

158 (
uöt32_t
Ë
p
[
n
 * 4] | \

159 ((
uöt32_t
Ë
p
[
n
 * 4 + 1] << 8) | \

160 ((
uöt32_t
Ë
p
[
n
 * 4 + 2] << 16) | \

161 ((
uöt32_t
Ë
p
[
n
 * 4 + 3] << 24))

	)

163 
	#GET
(
n
Ë
block
[n]

	)

173 c⁄° 
u_ch¨
 *

174 
	$ngx_md5_body
(
ngx_md5_t
 *
˘x
, c⁄° 
u_ch¨
 *
d©a
, 
size_t
 
size
)

176 
uöt32_t
 
a
, 
b
, 
c
, 
d
;

177 
uöt32_t
 
ßved_a
, 
ßved_b
, 
ßved_c
, 
ßved_d
;

178 c⁄° 
u_ch¨
 *
p
;

179 #i‡!(
NGX_HAVE_LITTLE_ENDIAN
 && 
NGX_HAVE_NONALIGNED
)

180 
uöt32_t
 
block
[16];

183 
p
 = 
d©a
;

185 
a
 = 
˘x
->a;

186 
b
 = 
˘x
->b;

187 
c
 = 
˘x
->c;

188 
d
 = 
˘x
->d;

191 
ßved_a
 = 
a
;

192 
ßved_b
 = 
b
;

193 
ßved_c
 = 
c
;

194 
ßved_d
 = 
d
;

198 
	`STEP
(
F
, 
a
, 
b
, 
c
, 
d
, 
	`SET
(0), 0xd76aa478, 7);

199 
	`STEP
(
F
, 
d
, 
a
, 
b
, 
c
, 
	`SET
(1), 0xe8c7b756, 12);

200 
	`STEP
(
F
, 
c
, 
d
, 
a
, 
b
, 
	`SET
(2), 0x242070db, 17);

201 
	`STEP
(
F
, 
b
, 
c
, 
d
, 
a
, 
	`SET
(3), 0xc1bdceee, 22);

202 
	`STEP
(
F
, 
a
, 
b
, 
c
, 
d
, 
	`SET
(4), 0xf57c0faf, 7);

203 
	`STEP
(
F
, 
d
, 
a
, 
b
, 
c
, 
	`SET
(5), 0x4787c62a, 12);

204 
	`STEP
(
F
, 
c
, 
d
, 
a
, 
b
, 
	`SET
(6), 0xa8304613, 17);

205 
	`STEP
(
F
, 
b
, 
c
, 
d
, 
a
, 
	`SET
(7), 0xfd469501, 22);

206 
	`STEP
(
F
, 
a
, 
b
, 
c
, 
d
, 
	`SET
(8), 0x698098d8, 7);

207 
	`STEP
(
F
, 
d
, 
a
, 
b
, 
c
, 
	`SET
(9), 0x8b44f7af, 12);

208 
	`STEP
(
F
, 
c
, 
d
, 
a
, 
b
, 
	`SET
(10), 0xffff5bb1, 17);

209 
	`STEP
(
F
, 
b
, 
c
, 
d
, 
a
, 
	`SET
(11), 0x895cd7be, 22);

210 
	`STEP
(
F
, 
a
, 
b
, 
c
, 
d
, 
	`SET
(12), 0x6b901122, 7);

211 
	`STEP
(
F
, 
d
, 
a
, 
b
, 
c
, 
	`SET
(13), 0xfd987193, 12);

212 
	`STEP
(
F
, 
c
, 
d
, 
a
, 
b
, 
	`SET
(14), 0xa679438e, 17);

213 
	`STEP
(
F
, 
b
, 
c
, 
d
, 
a
, 
	`SET
(15), 0x49b40821, 22);

217 
	`STEP
(
G
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(1), 0xf61e2562, 5);

218 
	`STEP
(
G
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(6), 0xc040b340, 9);

219 
	`STEP
(
G
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(11), 0x265e5a51, 14);

220 
	`STEP
(
G
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(0), 0xe9b6c7aa, 20);

221 
	`STEP
(
G
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(5), 0xd62f105d, 5);

222 
	`STEP
(
G
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(10), 0x02441453, 9);

223 
	`STEP
(
G
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(15), 0xd8a1e681, 14);

224 
	`STEP
(
G
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(4), 0xe7d3fbc8, 20);

225 
	`STEP
(
G
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(9), 0x21e1cde6, 5);

226 
	`STEP
(
G
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(14), 0xc33707d6, 9);

227 
	`STEP
(
G
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(3), 0xf4d50d87, 14);

228 
	`STEP
(
G
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(8), 0x455a14ed, 20);

229 
	`STEP
(
G
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(13), 0xa9e3e905, 5);

230 
	`STEP
(
G
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(2), 0xfcefa3f8, 9);

231 
	`STEP
(
G
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(7), 0x676f02d9, 14);

232 
	`STEP
(
G
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(12), 0x8d2a4c8a, 20);

236 
	`STEP
(
H
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(5), 0xfffa3942, 4);

237 
	`STEP
(
H
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(8), 0x8771f681, 11);

238 
	`STEP
(
H
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(11), 0x6d9d6122, 16);

239 
	`STEP
(
H
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(14), 0xfde5380c, 23);

240 
	`STEP
(
H
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(1), 0xa4beea44, 4);

241 
	`STEP
(
H
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(4), 0x4bdecfa9, 11);

242 
	`STEP
(
H
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(7), 0xf6bb4b60, 16);

243 
	`STEP
(
H
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(10), 0xbebfbc70, 23);

244 
	`STEP
(
H
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(13), 0x289b7ec6, 4);

245 
	`STEP
(
H
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(0), 0xeaa127fa, 11);

246 
	`STEP
(
H
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(3), 0xd4ef3085, 16);

247 
	`STEP
(
H
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(6), 0x04881d05, 23);

248 
	`STEP
(
H
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(9), 0xd9d4d039, 4);

249 
	`STEP
(
H
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(12), 0xe6db99e5, 11);

250 
	`STEP
(
H
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(15), 0x1fa27cf8, 16);

251 
	`STEP
(
H
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(2), 0xc4ac5665, 23);

255 
	`STEP
(
I
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(0), 0xf4292244, 6);

256 
	`STEP
(
I
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(7), 0x432aff97, 10);

257 
	`STEP
(
I
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(14), 0xab9423a7, 15);

258 
	`STEP
(
I
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(5), 0xfc93a039, 21);

259 
	`STEP
(
I
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(12), 0x655b59c3, 6);

260 
	`STEP
(
I
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(3), 0x8f0ccc92, 10);

261 
	`STEP
(
I
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(10), 0xffeff47d, 15);

262 
	`STEP
(
I
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(1), 0x85845dd1, 21);

263 
	`STEP
(
I
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(8), 0x6fa87e4f, 6);

264 
	`STEP
(
I
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(15), 0xfe2ce6e0, 10);

265 
	`STEP
(
I
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(6), 0xa3014314, 15);

266 
	`STEP
(
I
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(13), 0x4e0811a1, 21);

267 
	`STEP
(
I
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(4), 0xf7537e82, 6);

268 
	`STEP
(
I
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(11), 0xbd3af235, 10);

269 
	`STEP
(
I
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(2), 0x2ad7d2bb, 15);

270 
	`STEP
(
I
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(9), 0xeb86d391, 21);

272 
a
 +
ßved_a
;

273 
b
 +
ßved_b
;

274 
c
 +
ßved_c
;

275 
d
 +
ßved_d
;

277 
p
 += 64;

279 } 
size
 -= 64);

281 
˘x
->
a
 =á;

282 
˘x
->
b
 = b;

283 
˘x
->
c
 = c;

284 
˘x
->
d
 = d;

286  
p
;

287 
	}
}

	@ngx_md5.h

8 #i‚de‡
_NGX_MD5_H_INCLUDED_


9 
	#_NGX_MD5_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 #i‡(
NGX_HAVE_MD5
)

18 #i‡(
NGX_HAVE_OPENSSL_MD5_H
)

19 
	~<›ís¶/md5.h
>

21 
	~<md5.h
>

25 
MD5_CTX
 
	tngx_md5_t
;

28 #i‡(
NGX_OPENSSL_MD5
)

30 
	#ngx_md5_öô
 
MD5_Inô


	)

31 
	#ngx_md5_upd©e
 
MD5_Upd©e


	)

32 
	#ngx_md5_föÆ
 
MD5_FöÆ


	)

36 
	#ngx_md5_öô
 
MD5Inô


	)

37 
	#ngx_md5_upd©e
 
MD5Upd©e


	)

38 
	#ngx_md5_föÆ
 
MD5FöÆ


	)

47 
uöt64_t
 
	mbyãs
;

48 
uöt32_t
 
	ma
, 
	mb
, 
	mc
, 
	md
;

49 
u_ch¨
 
	mbuf„r
[64];

50 } 
	tngx_md5_t
;

53 
ngx_md5_öô
(
ngx_md5_t
 *
˘x
);

54 
ngx_md5_upd©e
(
ngx_md5_t
 *
˘x
, c⁄° *
d©a
, 
size_t
 
size
);

55 
ngx_md5_föÆ
(
u_ch¨
 
ªsu…
[16], 
ngx_md5_t
 *
˘x
);

	@ngx_murmurhash.c

7 
	~<ngx_c⁄fig.h
>

8 
	~<ngx_c‹e.h
>

11 
uöt32_t


12 
	$ngx_murmur_hash2
(
u_ch¨
 *
d©a
, 
size_t
 
Àn
)

14 
uöt32_t
 
h
, 
k
;

16 
h
 = 0 ^ 
Àn
;

18 
Àn
 >= 4) {

19 
k
 = 
d©a
[0];

20 
k
 |
d©a
[1] << 8;

21 
k
 |
d©a
[2] << 16;

22 
k
 |
d©a
[3] << 24;

24 
k
 *= 0x5bd1e995;

25 
k
 ^= k >> 24;

26 
k
 *= 0x5bd1e995;

28 
h
 *= 0x5bd1e995;

29 
h
 ^
k
;

31 
d©a
 += 4;

32 
Àn
 -= 4;

35 
Àn
) {

37 
h
 ^
d©a
[2] << 16;

39 
h
 ^
d©a
[1] << 8;

41 
h
 ^
d©a
[0];

42 
h
 *= 0x5bd1e995;

45 
h
 ^= h >> 13;

46 
h
 *= 0x5bd1e995;

47 
h
 ^= h >> 15;

49  
h
;

50 
	}
}

	@ngx_murmurhash.h

8 #i‚de‡
_NGX_MURMURHASH_H_INCLUDED_


9 
	#_NGX_MURMURHASH_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 
uöt32_t
 
ngx_murmur_hash2
(
u_ch¨
 *
d©a
, 
size_t
 
Àn
);

	@ngx_open_file_cache.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

10 
	~<ngx_evít.h
>

21 
	#NGX_MIN_READ_AHEAD
 (128 * 1024)

	)

24 
ngx_›í_fûe_ˇche_˛ónup
(*
d©a
);

25 
ngx_öt_t
 
ngx_›í_™d_°©_fûe
(
u_ch¨
 *
«me
, 
ngx_›í_fûe_öfo_t
 *
of
,

26 
ngx_log_t
 *
log
);

27 
ngx_›í_fûe_add_evít
(
ngx_›í_fûe_ˇche_t
 *
ˇche
,

28 
ngx_ˇched_›í_fûe_t
 *
fûe
, 
ngx_›í_fûe_öfo_t
 *
of
, 
ngx_log_t
 *
log
);

29 
ngx_›í_fûe_˛ónup
(*
d©a
);

30 
ngx_˛o£_ˇched_fûe
(
ngx_›í_fûe_ˇche_t
 *
ˇche
,

31 
ngx_ˇched_›í_fûe_t
 *
fûe
, 
ngx_uöt_t
 
mö_u£s
, 
ngx_log_t
 *
log
);

32 
ngx_›í_fûe_dñ_evít
(
ngx_ˇched_›í_fûe_t
 *
fûe
);

33 
ngx_expúe_ﬁd_ˇched_fûes
(
ngx_›í_fûe_ˇche_t
 *
ˇche
,

34 
ngx_uöt_t
 
n
, 
ngx_log_t
 *
log
);

35 
ngx_›í_fûe_ˇche_rbåì_ö£π_vÆue
(
ngx_rbåì_node_t
 *
ãmp
,

36 
ngx_rbåì_node_t
 *
node
,Çgx_rbåì_node_à*
£¡öñ
);

37 
ngx_ˇched_›í_fûe_t
 *

38 
ngx_›í_fûe_lookup
(
ngx_›í_fûe_ˇche_t
 *
ˇche
, 
ngx_°r_t
 *
«me
,

39 
uöt32_t
 
hash
);

40 
ngx_›í_fûe_ˇche_ªmove
(
ngx_evít_t
 *
ev
);

43 
ngx_›í_fûe_ˇche_t
 *

44 
	$ngx_›í_fûe_ˇche_öô
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_uöt_t
 
max
, 
time_t
 
öa˘ive
)

46 
ngx_poﬁ_˛ónup_t
 *
˛n
;

47 
ngx_›í_fûe_ˇche_t
 *
ˇche
;

49 
ˇche
 = 
	`ngx_∑Œoc
(
poﬁ
, (
ngx_›í_fûe_ˇche_t
));

50 i‡(
ˇche
 =
NULL
) {

51  
NULL
;

54 
	`ngx_rbåì_öô
(&
ˇche
->
rbåì
, &ˇche->
£¡öñ
,

55 
ngx_›í_fûe_ˇche_rbåì_ö£π_vÆue
);

57 
	`ngx_queue_öô
(&
ˇche
->
expúe_queue
);

59 
ˇche
->
cuºít
 = 0;

60 
ˇche
->
max
 = max;

61 
ˇche
->
öa˘ive
 = inactive;

63 
˛n
 = 
	`ngx_poﬁ_˛ónup_add
(
poﬁ
, 0);

64 i‡(
˛n
 =
NULL
) {

65  
NULL
;

68 
˛n
->
h™dÀr
 = 
ngx_›í_fûe_ˇche_˛ónup
;

69 
˛n
->
d©a
 = 
ˇche
;

71  
ˇche
;

72 
	}
}

76 
	$ngx_›í_fûe_ˇche_˛ónup
(*
d©a
)

78 
ngx_›í_fûe_ˇche_t
 *
ˇche
 = 
d©a
;

80 
ngx_queue_t
 *
q
;

81 
ngx_ˇched_›í_fûe_t
 *
fûe
;

83 
	`ngx_log_debug0
(
NGX_LOG_DEBUG_CORE
, 
ngx_cy˛e
->
log
, 0,

88 i‡(
	`ngx_queue_em±y
(&
ˇche
->
expúe_queue
)) {

92 
q
 = 
	`ngx_queue_œ°
(&
ˇche
->
expúe_queue
);

94 
fûe
 = 
	`ngx_queue_d©a
(
q
, 
ngx_ˇched_›í_fûe_t
, 
queue
);

96 
	`ngx_queue_ªmove
(
q
);

98 
	`ngx_rbåì_dñëe
(&
ˇche
->
rbåì
, &
fûe
->
node
);

100 
ˇche
->
cuºít
--;

102 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
ngx_cy˛e
->
log
, 0,

103 "dñëêˇched o≥¿fûe: %s", 
fûe
->
«me
);

105 i‡(!
fûe
->
îr
 && !fûe->
is_dú
) {

106 
fûe
->
˛o£
 = 1;

107 
fûe
->
cou¡
 = 0;

108 
	`ngx_˛o£_ˇched_fûe
(
ˇche
, 
fûe
, 0, 
ngx_cy˛e
->
log
);

111 
	`ngx_‰ì
(
fûe
->
«me
);

112 
	`ngx_‰ì
(
fûe
);

116 i‡(
ˇche
->
cuºít
) {

117 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 0,

119 
ˇche
->
cuºít
);

122 i‡(
ˇche
->
rbåì
.
roŸ
 !ˇche->rbåì.
£¡öñ
) {

123 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 0,

127 
	}
}

130 
ngx_öt_t


131 
	$ngx_›í_ˇched_fûe
(
ngx_›í_fûe_ˇche_t
 *
ˇche
, 
ngx_°r_t
 *
«me
,

132 
ngx_›í_fûe_öfo_t
 *
of
, 
ngx_poﬁ_t
 *
poﬁ
)

134 
time_t
 
now
;

135 
uöt32_t
 
hash
;

136 
ngx_öt_t
 
rc
;

137 
ngx_fûe_öfo_t
 
fi
;

138 
ngx_poﬁ_˛ónup_t
 *
˛n
;

139 
ngx_ˇched_›í_fûe_t
 *
fûe
;

140 
ngx_poﬁ_˛ónup_fûe_t
 *
˛nf
;

141 
ngx_›í_fûe_ˇche_˛ónup_t
 *
of˛n
;

143 
of
->
fd
 = 
NGX_INVALID_FILE
;

144 
of
->
îr
 = 0;

146 i‡(
ˇche
 =
NULL
) {

148 i‡(
of
->
ã°_⁄ly
) {

150 i‡(
	`ngx_fûe_öfo
(
«me
->
d©a
, &
fi
Ë=
NGX_FILE_ERROR
) {

151 
of
->
îr
 = 
ngx_î∫o
;

152 
of
->
Áûed
 = 
ngx_fûe_öfo_n
;

153  
NGX_ERROR
;

156 
of
->
uniq
 = 
	`ngx_fûe_uniq
(&
fi
);

157 
of
->
mtime
 = 
	`ngx_fûe_mtime
(&
fi
);

158 
of
->
size
 = 
	`ngx_fûe_size
(&
fi
);

159 
of
->
fs_size
 = 
	`ngx_fûe_fs_size
(&
fi
);

160 
of
->
is_dú
 = 
	`ngx_is_dú
(&
fi
);

161 
of
->
is_fûe
 = 
	`ngx_is_fûe
(&
fi
);

162 
of
->
is_lök
 = 
	`ngx_is_lök
(&
fi
);

163 
of
->
is_exec
 = 
	`ngx_is_exec
(&
fi
);

165  
NGX_OK
;

168 
˛n
 = 
	`ngx_poﬁ_˛ónup_add
(
poﬁ
, (
ngx_poﬁ_˛ónup_fûe_t
));

169 i‡(
˛n
 =
NULL
) {

170  
NGX_ERROR
;

173 
rc
 = 
	`ngx_›í_™d_°©_fûe
(
«me
->
d©a
, 
of
, 
poﬁ
->
log
);

175 i‡(
rc
 =
NGX_OK
 && !
of
->
is_dú
) {

176 
˛n
->
h™dÀr
 = 
ngx_poﬁ_˛ónup_fûe
;

177 
˛nf
 = 
˛n
->
d©a
;

179 
˛nf
->
fd
 = 
of
->fd;

180 
˛nf
->
«me
 =Çame->
d©a
;

181 
˛nf
->
log
 = 
poﬁ
->log;

184  
rc
;

187 
˛n
 = 
	`ngx_poﬁ_˛ónup_add
(
poﬁ
, (
ngx_›í_fûe_ˇche_˛ónup_t
));

188 i‡(
˛n
 =
NULL
) {

189  
NGX_ERROR
;

192 
now
 = 
	`ngx_time
();

194 
hash
 = 
	`ngx_¸c32_l⁄g
(
«me
->
d©a
,Çame->
Àn
);

196 
fûe
 = 
	`ngx_›í_fûe_lookup
(
ˇche
, 
«me
, 
hash
);

198 i‡(
fûe
) {

200 
fûe
->
u£s
++;

202 
	`ngx_queue_ªmove
(&
fûe
->
queue
);

204 i‡(
fûe
->
fd
 =
NGX_INVALID_FILE
 && fûe->
îr
 =0 && !fûe->
is_dú
) {

208 
rc
 = 
	`ngx_›í_™d_°©_fûe
(
«me
->
d©a
, 
of
, 
poﬁ
->
log
);

210 i‡(
rc
 !
NGX_OK
 && (
of
->
îr
 =0 || !of->
îr‹s
)) {

211 
Áûed
;

214 
add_evít
;

217 i‡(
fûe
->
u£_evít


218 || (
fûe
->
evít
 =
NULL


219 && (
of
->
uniq
 =0 || of->uniq =
fûe
->uniq)

220 && 
now
 - 
fûe
->
¸óãd
 < 
of
->
vÆid
))

222 i‡(
fûe
->
îr
 == 0) {

224 
of
->
fd
 = 
fûe
->fd;

225 
of
->
uniq
 = 
fûe
->uniq;

226 
of
->
mtime
 = 
fûe
->mtime;

227 
of
->
size
 = 
fûe
->size;

229 
of
->
is_dú
 = 
fûe
->is_dir;

230 
of
->
is_fûe
 = 
fûe
->is_file;

231 
of
->
is_lök
 = 
fûe
->is_link;

232 
of
->
is_exec
 = 
fûe
->is_exec;

233 
of
->
is_dúe˘io
 = 
fûe
->is_directio;

235 i‡(!
fûe
->
is_dú
) {

236 
fûe
->
cou¡
++;

237 
	`ngx_›í_fûe_add_evít
(
ˇche
, 
fûe
, 
of
, 
poﬁ
->
log
);

241 
of
->
îr
 = 
fûe
->err;

242 
of
->
Áûed
 = 
ngx_›í_fûe_n
;

245 
found
;

248 
	`ngx_log_debug4
(
NGX_LOG_DEBUG_CORE
, 
poﬁ
->
log
, 0,

250 
fûe
->
«me
, fûe->
fd
, fûe->
cou¡
, fûe->
îr
);

252 i‡(
fûe
->
is_dú
) {

260 
of
->
ã°_dú
 = 1;

263 
of
->
fd
 = 
fûe
->fd;

264 
of
->
uniq
 = 
fûe
->uniq;

266 
rc
 = 
	`ngx_›í_™d_°©_fûe
(
«me
->
d©a
, 
of
, 
poﬁ
->
log
);

268 i‡(
rc
 !
NGX_OK
 && (
of
->
îr
 =0 || !of->
îr‹s
)) {

269 
Áûed
;

272 i‡(
of
->
is_dú
) {

274 i‡(
fûe
->
is_dú
 || fûe->
îr
) {

275 
upd©e
;

280 } i‡(
of
->
îr
 == 0) {

282 i‡(
fûe
->
is_dú
 || fûe->
îr
) {

283 
add_evít
;

286 i‡(
of
->
uniq
 =
fûe
->uniq) {

288 i‡(
fûe
->
evít
) {

289 
fûe
->
u£_evít
 = 1;

292 
of
->
is_dúe˘io
 = 
fûe
->is_directio;

294 
upd©e
;

301 i‡(
fûe
->
îr
 || fûe->
is_dú
) {

302 
upd©e
;

308 i‡(
fûe
->
cou¡
 == 0) {

310 
	`ngx_›í_fûe_dñ_evít
(
fûe
);

312 i‡(
	`ngx_˛o£_fûe
(
fûe
->
fd
Ë=
NGX_FILE_ERROR
) {

313 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
poﬁ
->
log
, 
ngx_î∫o
,

314 
ngx_˛o£_fûe_n
 " \"%s\" failed",

315 
«me
->
d©a
);

318 
add_evít
;

321 
	`ngx_rbåì_dñëe
(&
ˇche
->
rbåì
, &
fûe
->
node
);

323 
ˇche
->
cuºít
--;

325 
fûe
->
˛o£
 = 1;

327 
¸óã
;

332 
rc
 = 
	`ngx_›í_™d_°©_fûe
(
«me
->
d©a
, 
of
, 
poﬁ
->
log
);

334 i‡(
rc
 !
NGX_OK
 && (
of
->
îr
 =0 || !of->
îr‹s
)) {

335 
Áûed
;

338 
¸óã
:

340 i‡(
ˇche
->
cuºít
 >ˇche->
max
) {

341 
	`ngx_expúe_ﬁd_ˇched_fûes
(
ˇche
, 0, 
poﬁ
->
log
);

344 
fûe
 = 
	`ngx_Æloc
((
ngx_ˇched_›í_fûe_t
), 
poﬁ
->
log
);

346 i‡(
fûe
 =
NULL
) {

347 
Áûed
;

350 
fûe
->
«me
 = 
	`ngx_Æloc
“ame->
Àn
 + 1, 
poﬁ
->
log
);

352 i‡(
fûe
->
«me
 =
NULL
) {

353 
	`ngx_‰ì
(
fûe
);

354 
fûe
 = 
NULL
;

355 
Áûed
;

358 
	`ngx_˝y°∫
(
fûe
->
«me
,Çame->
d©a
,Çame->
Àn
 + 1);

360 
fûe
->
node
.
key
 = 
hash
;

362 
	`ngx_rbåì_ö£π
(&
ˇche
->
rbåì
, &
fûe
->
node
);

364 
ˇche
->
cuºít
++;

366 
fûe
->
u£s
 = 1;

367 
fûe
->
cou¡
 = 0;

368 
fûe
->
u£_evít
 = 0;

369 
fûe
->
evít
 = 
NULL
;

371 
add_evít
:

373 
	`ngx_›í_fûe_add_evít
(
ˇche
, 
fûe
, 
of
, 
poﬁ
->
log
);

375 
upd©e
:

377 
fûe
->
fd
 = 
of
->fd;

378 
fûe
->
îr
 = 
of
->err;

380 i‡(
of
->
îr
 == 0) {

381 
fûe
->
uniq
 = 
of
->uniq;

382 
fûe
->
mtime
 = 
of
->mtime;

383 
fûe
->
size
 = 
of
->size;

385 
fûe
->
˛o£
 = 0;

387 
fûe
->
is_dú
 = 
of
->is_dir;

388 
fûe
->
is_fûe
 = 
of
->is_file;

389 
fûe
->
is_lök
 = 
of
->is_link;

390 
fûe
->
is_exec
 = 
of
->is_exec;

391 
fûe
->
is_dúe˘io
 = 
of
->is_directio;

393 i‡(!
of
->
is_dú
) {

394 
fûe
->
cou¡
++;

398 
fûe
->
¸óãd
 = 
now
;

400 
found
:

402 
fûe
->
ac˚s£d
 = 
now
;

404 
	`ngx_queue_ö£π_hód
(&
ˇche
->
expúe_queue
, &
fûe
->
queue
);

406 
	`ngx_log_debug5
(
NGX_LOG_DEBUG_CORE
, 
poﬁ
->
log
, 0,

408 
fûe
->
«me
, fûe->
fd
, fûe->
cou¡
, fûe->
îr
, fûe->
u£s
);

410 i‡(
of
->
îr
 == 0) {

412 i‡(!
of
->
is_dú
) {

413 
˛n
->
h™dÀr
 = 
ngx_›í_fûe_˛ónup
;

414 
of˛n
 = 
˛n
->
d©a
;

416 
of˛n
->
ˇche
 = cache;

417 
of˛n
->
fûe
 = file;

418 
of˛n
->
mö_u£s
 = 
of
->min_uses;

419 
of˛n
->
log
 = 
poﬁ
->log;

422  
NGX_OK
;

425  
NGX_ERROR
;

427 
Áûed
:

429 i‡(
fûe
) {

430 
	`ngx_rbåì_dñëe
(&
ˇche
->
rbåì
, &
fûe
->
node
);

432 
ˇche
->
cuºít
--;

434 i‡(
fûe
->
cou¡
 == 0) {

436 i‡(
fûe
->
fd
 !
NGX_INVALID_FILE
) {

437 i‡(
	`ngx_˛o£_fûe
(
fûe
->
fd
Ë=
NGX_FILE_ERROR
) {

438 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
poﬁ
->
log
, 
ngx_î∫o
,

439 
ngx_˛o£_fûe_n
 " \"%s\" failed",

440 
fûe
->
«me
);

444 
	`ngx_‰ì
(
fûe
->
«me
);

445 
	`ngx_‰ì
(
fûe
);

448 
fûe
->
˛o£
 = 1;

452 i‡(
of
->
fd
 !
NGX_INVALID_FILE
) {

453 i‡(
	`ngx_˛o£_fûe
(
of
->
fd
Ë=
NGX_FILE_ERROR
) {

454 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
poﬁ
->
log
, 
ngx_î∫o
,

455 
ngx_˛o£_fûe_n
 " \"%s\" faûed", 
«me
->
d©a
);

459  
NGX_ERROR
;

460 
	}
}

463 
ngx_öt_t


464 
	$ngx_›í_™d_°©_fûe
(
u_ch¨
 *
«me
, 
ngx_›í_fûe_öfo_t
 *
of
, 
ngx_log_t
 *
log
)

466 
ngx_fd_t
 
fd
;

467 
ngx_fûe_öfo_t
 
fi
;

469 i‡(
of
->
fd
 !
NGX_INVALID_FILE
) {

471 i‡(
	`ngx_fûe_öfo
(
«me
, &
fi
Ë=
NGX_FILE_ERROR
) {

472 
of
->
Áûed
 = 
ngx_fûe_öfo_n
;

473 
Áûed
;

476 i‡(
of
->
uniq
 =
	`ngx_fûe_uniq
(&
fi
)) {

477 
d⁄e
;

480 } i‡(
of
->
ã°_dú
) {

482 i‡(
	`ngx_fûe_öfo
(
«me
, &
fi
Ë=
NGX_FILE_ERROR
) {

483 
of
->
Áûed
 = 
ngx_fûe_öfo_n
;

484 
Áûed
;

487 i‡(
	`ngx_is_dú
(&
fi
)) {

488 
d⁄e
;

492 i‡(!
of
->
log
) {

499 
fd
 = 
	`ngx_›í_fûe
(
«me
, 
NGX_FILE_RDONLY
|
NGX_FILE_NONBLOCK
,

500 
NGX_FILE_OPEN
, 0);

503 
fd
 = 
	`ngx_›í_fûe
(
«me
, 
NGX_FILE_APPEND
, 
NGX_FILE_CREATE_OR_OPEN
,

504 
NGX_FILE_DEFAULT_ACCESS
);

507 i‡(
fd
 =
NGX_INVALID_FILE
) {

508 
of
->
Áûed
 = 
ngx_›í_fûe_n
;

509 
Áûed
;

512 i‡(
	`ngx_fd_öfo
(
fd
, &
fi
Ë=
NGX_FILE_ERROR
) {

513 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
log
, 
ngx_î∫o
,

514 
ngx_fd_öfo_n
 " \"%s\" faûed", 
«me
);

516 i‡(
	`ngx_˛o£_fûe
(
fd
Ë=
NGX_FILE_ERROR
) {

517 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
log
, 
ngx_î∫o
,

518 
ngx_˛o£_fûe_n
 " \"%s\" faûed", 
«me
);

521 
of
->
fd
 = 
NGX_INVALID_FILE
;

523  
NGX_ERROR
;

526 i‡(
	`ngx_is_dú
(&
fi
)) {

527 i‡(
	`ngx_˛o£_fûe
(
fd
Ë=
NGX_FILE_ERROR
) {

528 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
log
, 
ngx_î∫o
,

529 
ngx_˛o£_fûe_n
 " \"%s\" faûed", 
«me
);

532 
of
->
fd
 = 
NGX_INVALID_FILE
;

535 
of
->
fd
 = fd;

537 i‡(
of
->
ªad_ahód
 && 
	`ngx_fûe_size
(&
fi
Ë> 
NGX_MIN_READ_AHEAD
) {

538 i‡(
	`ngx_ªad_ahód
(
fd
, 
of
->
ªad_ahód
Ë=
NGX_ERROR
) {

539 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
log
, 
ngx_î∫o
,

540 
ngx_ªad_ahód_n
 " \"%s\" faûed", 
«me
);

544 i‡(
of
->
dúe˘io
 <
	`ngx_fûe_size
(&
fi
)) {

545 i‡(
	`ngx_dúe˘io_⁄
(
fd
Ë=
NGX_FILE_ERROR
) {

546 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
log
, 
ngx_î∫o
,

547 
ngx_dúe˘io_⁄_n
 " \"%s\" faûed", 
«me
);

550 
of
->
is_dúe˘io
 = 1;

555 
d⁄e
:

557 
of
->
uniq
 = 
	`ngx_fûe_uniq
(&
fi
);

558 
of
->
mtime
 = 
	`ngx_fûe_mtime
(&
fi
);

559 
of
->
size
 = 
	`ngx_fûe_size
(&
fi
);

560 
of
->
fs_size
 = 
	`ngx_fûe_fs_size
(&
fi
);

561 
of
->
is_dú
 = 
	`ngx_is_dú
(&
fi
);

562 
of
->
is_fûe
 = 
	`ngx_is_fûe
(&
fi
);

563 
of
->
is_lök
 = 
	`ngx_is_lök
(&
fi
);

564 
of
->
is_exec
 = 
	`ngx_is_exec
(&
fi
);

566  
NGX_OK
;

568 
Áûed
:

570 
of
->
fd
 = 
NGX_INVALID_FILE
;

571 
of
->
îr
 = 
ngx_î∫o
;

573  
NGX_ERROR
;

574 
	}
}

583 
	$ngx_›í_fûe_add_evít
(
ngx_›í_fûe_ˇche_t
 *
ˇche
,

584 
ngx_ˇched_›í_fûe_t
 *
fûe
, 
ngx_›í_fûe_öfo_t
 *
of
, 
ngx_log_t
 *
log
)

586 
ngx_›í_fûe_ˇche_evít_t
 *
„v
;

588 i‡(!(
ngx_evít_Êags
 & 
NGX_USE_VNODE_EVENT
)

589 || !
of
->
evíts


590 || 
fûe
->
evít


591 || 
of
->
fd
 =
NGX_INVALID_FILE


592 || 
fûe
->
u£s
 < 
of
->
mö_u£s
)

597 
fûe
->
u£_evít
 = 0;

599 
fûe
->
evít
 = 
	`ngx_ˇŒoc
((
ngx_evít_t
), 
log
);

600 i‡(
fûe
->
evít
=
NULL
) {

604 
„v
 = 
	`ngx_Æloc
((
ngx_›í_fûe_ˇche_evít_t
), 
log
);

605 i‡(
„v
 =
NULL
) {

606 
	`ngx_‰ì
(
fûe
->
evít
);

607 
fûe
->
evít
 = 
NULL
;

611 
„v
->
fd
 = 
of
->fd;

612 
„v
->
fûe
 = file;

613 
„v
->
ˇche
 = cache;

615 
fûe
->
evít
->
h™dÀr
 = 
ngx_›í_fûe_ˇche_ªmove
;

616 
fûe
->
evít
->
d©a
 = 
„v
;

624 
fûe
->
evít
->
log
 = 
ngx_cy˛e
->log;

626 i‡(
	`ngx_add_evít
(
fûe
->
evít
, 
NGX_VNODE_EVENT
, 
NGX_ONESHOT_EVENT
)

627 !
NGX_OK
)

629 
	`ngx_‰ì
(
fûe
->
evít
->
d©a
);

630 
	`ngx_‰ì
(
fûe
->
evít
);

631 
fûe
->
evít
 = 
NULL
;

643 
	}
}

647 
	$ngx_›í_fûe_˛ónup
(*
d©a
)

649 
ngx_›í_fûe_ˇche_˛ónup_t
 *
c
 = 
d©a
;

651 
c
->
fûe
->
cou¡
--;

653 
	`ngx_˛o£_ˇched_fûe
(
c
->
ˇche
, c->
fûe
, c->
mö_u£s
, c->
log
);

656 
	`ngx_expúe_ﬁd_ˇched_fûes
(
c
->
ˇche
, 1, c->
log
);

657 
	}
}

661 
	$ngx_˛o£_ˇched_fûe
(
ngx_›í_fûe_ˇche_t
 *
ˇche
,

662 
ngx_ˇched_›í_fûe_t
 *
fûe
, 
ngx_uöt_t
 
mö_u£s
, 
ngx_log_t
 *
log
)

664 
	`ngx_log_debug5
(
NGX_LOG_DEBUG_CORE
, 
log
, 0,

666 
fûe
->
«me
, fûe->
fd
, fûe->
cou¡
, fûe->
u£s
, fûe->
˛o£
);

668 i‡(!
fûe
->
˛o£
) {

670 
fûe
->
ac˚s£d
 = 
	`ngx_time
();

672 
	`ngx_queue_ªmove
(&
fûe
->
queue
);

674 
	`ngx_queue_ö£π_hód
(&
ˇche
->
expúe_queue
, &
fûe
->
queue
);

676 i‡(
fûe
->
u£s
 >
mö_u£s
 || fûe->
cou¡
) {

681 
	`ngx_›í_fûe_dñ_evít
(
fûe
);

683 i‡(
fûe
->
cou¡
) {

687 i‡(
fûe
->
fd
 !
NGX_INVALID_FILE
) {

689 i‡(
	`ngx_˛o£_fûe
(
fûe
->
fd
Ë=
NGX_FILE_ERROR
) {

690 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
log
, 
ngx_î∫o
,

691 
ngx_˛o£_fûe_n
 " \"%s\" faûed", 
fûe
->
«me
);

694 
fûe
->
fd
 = 
NGX_INVALID_FILE
;

697 i‡(!
fûe
->
˛o£
) {

701 
	`ngx_‰ì
(
fûe
->
«me
);

702 
	`ngx_‰ì
(
fûe
);

703 
	}
}

707 
	$ngx_›í_fûe_dñ_evít
(
ngx_ˇched_›í_fûe_t
 *
fûe
)

709 i‡(
fûe
->
evít
 =
NULL
) {

713 (Ë
	`ngx_dñ_evít
(
fûe
->
evít
, 
NGX_VNODE_EVENT
,

714 
fûe
->
cou¡
 ? 
NGX_FLUSH_EVENT
 : 
NGX_CLOSE_EVENT
);

716 
	`ngx_‰ì
(
fûe
->
evít
->
d©a
);

717 
	`ngx_‰ì
(
fûe
->
evít
);

718 
fûe
->
evít
 = 
NULL
;

719 
fûe
->
u£_evít
 = 0;

720 
	}
}

724 
	$ngx_expúe_ﬁd_ˇched_fûes
(
ngx_›í_fûe_ˇche_t
 *
ˇche
, 
ngx_uöt_t
 
n
,

725 
ngx_log_t
 *
log
)

727 
time_t
 
now
;

728 
ngx_queue_t
 *
q
;

729 
ngx_ˇched_›í_fûe_t
 *
fûe
;

731 
now
 = 
	`ngx_time
();

739 
n
 < 3) {

741 i‡(
	`ngx_queue_em±y
(&
ˇche
->
expúe_queue
)) {

745 
q
 = 
	`ngx_queue_œ°
(&
ˇche
->
expúe_queue
);

747 
fûe
 = 
	`ngx_queue_d©a
(
q
, 
ngx_ˇched_›í_fûe_t
, 
queue
);

749 i‡(
n
++ !0 && 
now
 - 
fûe
->
ac˚s£d
 <
ˇche
->
öa˘ive
) {

753 
	`ngx_queue_ªmove
(
q
);

755 
	`ngx_rbåì_dñëe
(&
ˇche
->
rbåì
, &
fûe
->
node
);

757 
ˇche
->
cuºít
--;

759 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
log
, 0,

760 "expúêˇched o≥¿fûe: %s", 
fûe
->
«me
);

762 i‡(!
fûe
->
îr
 && !fûe->
is_dú
) {

763 
fûe
->
˛o£
 = 1;

764 
	`ngx_˛o£_ˇched_fûe
(
ˇche
, 
fûe
, 0, 
log
);

767 
	`ngx_‰ì
(
fûe
->
«me
);

768 
	`ngx_‰ì
(
fûe
);

771 
	}
}

775 
	$ngx_›í_fûe_ˇche_rbåì_ö£π_vÆue
(
ngx_rbåì_node_t
 *
ãmp
,

776 
ngx_rbåì_node_t
 *
node
,Çgx_rbåì_node_à*
£¡öñ
)

778 
ngx_rbåì_node_t
 **
p
;

779 
ngx_ˇched_›í_fûe_t
 *
fûe
, *
fûe_ãmp
;

783 i‡(
node
->
key
 < 
ãmp
->key) {

785 
p
 = &
ãmp
->
À·
;

787 } i‡(
node
->
key
 > 
ãmp
->key) {

789 
p
 = &
ãmp
->
right
;

793 
fûe
 = (
ngx_ˇched_›í_fûe_t
 *Ë
node
;

794 
fûe_ãmp
 = (
ngx_ˇched_›í_fûe_t
 *Ë
ãmp
;

796 
p
 = (
	`ngx_°rcmp
(
fûe
->
«me
, 
fûe_ãmp
->name) < 0)

797 ? &
ãmp
->
À·
 : &ãmp->
right
;

800 i‡(*
p
 =
£¡öñ
) {

804 
ãmp
 = *
p
;

807 *
p
 = 
node
;

808 
node
->
∑ª¡
 = 
ãmp
;

809 
node
->
À·
 = 
£¡öñ
;

810 
node
->
right
 = 
£¡öñ
;

811 
	`ngx_rbt_ªd
(
node
);

812 
	}
}

815 
ngx_ˇched_›í_fûe_t
 *

816 
	$ngx_›í_fûe_lookup
(
ngx_›í_fûe_ˇche_t
 *
ˇche
, 
ngx_°r_t
 *
«me
,

817 
uöt32_t
 
hash
)

819 
ngx_öt_t
 
rc
;

820 
ngx_rbåì_node_t
 *
node
, *
£¡öñ
;

821 
ngx_ˇched_›í_fûe_t
 *
fûe
;

823 
node
 = 
ˇche
->
rbåì
.
roŸ
;

824 
£¡öñ
 = 
ˇche
->
rbåì
.sentinel;

826 
node
 !
£¡öñ
) {

828 i‡(
hash
 < 
node
->
key
) {

829 
node
 =Çode->
À·
;

833 i‡(
hash
 > 
node
->
key
) {

834 
node
 =Çode->
right
;

840 
fûe
 = (
ngx_ˇched_›í_fûe_t
 *Ë
node
;

842 
rc
 = 
	`ngx_°rcmp
(
«me
->
d©a
, 
fûe
->name);

844 i‡(
rc
 == 0) {

845  
fûe
;

848 
node
 = (
rc
 < 0Ë?Çode->
À·
 :Çode->
right
;

851  
NULL
;

852 
	}
}

856 
	$ngx_›í_fûe_ˇche_ªmove
(
ngx_evít_t
 *
ev
)

858 
ngx_ˇched_›í_fûe_t
 *
fûe
;

859 
ngx_›í_fûe_ˇche_evít_t
 *
„v
;

861 
„v
 = 
ev
->
d©a
;

862 
fûe
 = 
„v
->file;

864 
	`ngx_queue_ªmove
(&
fûe
->
queue
);

866 
	`ngx_rbåì_dñëe
(&
„v
->
ˇche
->
rbåì
, &
fûe
->
node
);

868 
„v
->
ˇche
->
cuºít
--;

871 
fûe
->
evít
 = 
NULL
;

872 
fûe
->
u£_evít
 = 0;

874 
fûe
->
˛o£
 = 1;

876 
	`ngx_˛o£_ˇched_fûe
(
„v
->
ˇche
, 
fûe
, 0, 
ev
->
log
);

880 
	`ngx_‰ì
(
ev
->
d©a
);

881 
	`ngx_‰ì
(
ev
);

882 
	}
}

	@ngx_open_file_cache.h

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 #i‚de‡
_NGX_OPEN_FILE_CACHE_H_INCLUDED_


13 
	#_NGX_OPEN_FILE_CACHE_H_INCLUDED_


	)

16 
	#NGX_OPEN_FILE_DIRECTIO_OFF
 
NGX_MAX_OFF_T_VALUE


	)

20 
ngx_fd_t
 
	mfd
;

21 
ngx_fûe_uniq_t
 
	muniq
;

22 
time_t
 
	mmtime
;

23 
off_t
 
	msize
;

24 
off_t
 
	mfs_size
;

25 
off_t
 
	mdúe˘io
;

26 
size_t
 
	mªad_ahód
;

28 
ngx_îr_t
 
	mîr
;

29 *
	mÁûed
;

31 
time_t
 
	mvÆid
;

33 
ngx_uöt_t
 
	mmö_u£s
;

35 
	mã°_dú
:1;

36 
	mã°_⁄ly
:1;

37 
	mlog
:1;

38 
	mîr‹s
:1;

39 
	mevíts
:1;

41 
	mis_dú
:1;

42 
	mis_fûe
:1;

43 
	mis_lök
:1;

44 
	mis_exec
:1;

45 
	mis_dúe˘io
:1;

46 } 
	tngx_›í_fûe_öfo_t
;

49 
ngx_ˇched_›í_fûe_s
 
	tngx_ˇched_›í_fûe_t
;

51 
	sngx_ˇched_›í_fûe_s
 {

52 
ngx_rbåì_node_t
 
	mnode
;

53 
ngx_queue_t
 
	mqueue
;

55 
u_ch¨
 *
	m«me
;

56 
time_t
 
	m¸óãd
;

57 
time_t
 
	mac˚s£d
;

59 
ngx_fd_t
 
	mfd
;

60 
ngx_fûe_uniq_t
 
	muniq
;

61 
time_t
 
	mmtime
;

62 
off_t
 
	msize
;

63 
ngx_îr_t
 
	mîr
;

65 
uöt32_t
 
	mu£s
;

67 
	mcou¡
:24;

68 
	m˛o£
:1;

69 
	mu£_evít
:1;

71 
	mis_dú
:1;

72 
	mis_fûe
:1;

73 
	mis_lök
:1;

74 
	mis_exec
:1;

75 
	mis_dúe˘io
:1;

77 
ngx_evít_t
 *
	mevít
;

82 
ngx_rbåì_t
 
	mrbåì
;

83 
ngx_rbåì_node_t
 
	m£¡öñ
;

84 
ngx_queue_t
 
	mexpúe_queue
;

86 
ngx_uöt_t
 
	mcuºít
;

87 
ngx_uöt_t
 
	mmax
;

88 
time_t
 
	möa˘ive
;

89 } 
	tngx_›í_fûe_ˇche_t
;

93 
ngx_›í_fûe_ˇche_t
 *
	mˇche
;

94 
ngx_ˇched_›í_fûe_t
 *
	mfûe
;

95 
ngx_uöt_t
 
	mmö_u£s
;

96 
ngx_log_t
 *
	mlog
;

97 } 
	tngx_›í_fûe_ˇche_˛ónup_t
;

103 *
	md©a
;

104 
ngx_evít_t
 *
	mªad
;

105 
ngx_evít_t
 *
	mwrôe
;

106 
ngx_fd_t
 
	mfd
;

108 
ngx_ˇched_›í_fûe_t
 *
	mfûe
;

109 
ngx_›í_fûe_ˇche_t
 *
	mˇche
;

110 } 
	tngx_›í_fûe_ˇche_evít_t
;

113 
ngx_›í_fûe_ˇche_t
 *
ngx_›í_fûe_ˇche_öô
(
ngx_poﬁ_t
 *
poﬁ
,

114 
ngx_uöt_t
 
max
, 
time_t
 
öa˘ive
);

115 
ngx_öt_t
 
ngx_›í_ˇched_fûe
(
ngx_›í_fûe_ˇche_t
 *
ˇche
, 
ngx_°r_t
 *
«me
,

116 
ngx_›í_fûe_öfo_t
 *
of
, 
ngx_poﬁ_t
 *
poﬁ
);

	@ngx_output_chain.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

10 
	~<ngx_evít.h
>

14 
	#NGX_SENDFILE_LIMIT
 4096

	)

27 
	#NGX_NONE
 1

	)

30 
ngx_ölöe
 
ngx_öt_t


31 
ngx_ouçut_chaö_as_is
(
ngx_ouçut_chaö_˘x_t
 *
˘x
, 
ngx_buf_t
 *
buf
);

32 
ngx_öt_t
 
ngx_ouçut_chaö_add_c›y
(
ngx_poﬁ_t
 *
poﬁ
,

33 
ngx_chaö_t
 **
chaö
,Çgx_chaö_à*
ö
);

34 
ngx_öt_t
 
ngx_ouçut_chaö_Æign_fûe_buf
(
ngx_ouçut_chaö_˘x_t
 *
˘x
,

35 
off_t
 
bsize
);

36 
ngx_öt_t
 
ngx_ouçut_chaö_gë_buf
(
ngx_ouçut_chaö_˘x_t
 *
˘x
,

37 
off_t
 
bsize
);

38 
ngx_öt_t
 
ngx_ouçut_chaö_c›y_buf
(
ngx_ouçut_chaö_˘x_t
 *
˘x
);

41 
ngx_öt_t


42 
	$ngx_ouçut_chaö
(
ngx_ouçut_chaö_˘x_t
 *
˘x
, 
ngx_chaö_t
 *
ö
)

44 
off_t
 
bsize
;

45 
ngx_öt_t
 
rc
, 
œ°
;

46 
ngx_chaö_t
 *
˛
, *
out
, **
œ°_out
;

48 i‡(
˘x
->
ö
 =
NULL
 && ctx->
busy
 == NULL) {

56 i‡(
ö
 =
NULL
) {

57  
˘x
->
	`ouçut_fûãr
(˘x->
fûãr_˘x
, 
ö
);

60 i‡(
ö
->
√xt
 =
NULL


61 #i‡(
NGX_SENDFILE_LIMIT
)

62 && !(
ö
->
buf
->
ö_fûe
 && in->buf->
fûe_œ°
 > 
NGX_SENDFILE_LIMIT
)

64 && 
	`ngx_ouçut_chaö_as_is
(
˘x
, 
ö
->
buf
))

66  
˘x
->
	`ouçut_fûãr
(˘x->
fûãr_˘x
, 
ö
);

72 i‡(
ö
) {

73 i‡(
	`ngx_ouçut_chaö_add_c›y
(
˘x
->
poﬁ
, &˘x->
ö
, inË=
NGX_ERROR
) {

74  
NGX_ERROR
;

78 
out
 = 
NULL
;

79 
œ°_out
 = &
out
;

80 
œ°
 = 
NGX_NONE
;

84 #i‡(
NGX_HAVE_FILE_AIO
)

85 i‡(
˘x
->
aio
) {

86  
NGX_AGAIN
;

90 
˘x
->
ö
) {

97 
bsize
 = 
	`ngx_buf_size
(
˘x
->
ö
->
buf
);

99 i‡(
bsize
 =0 && !
	`ngx_buf_•ecül
(
˘x
->
ö
->
buf
)) {

101 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
˘x
->
poﬁ
->
log
, 0,

104 
˘x
->
ö
->
buf
->
ãmp‹¨y
,

105 
˘x
->
ö
->
buf
->
ªcy˛ed
,

106 
˘x
->
ö
->
buf
->
ö_fûe
,

107 
˘x
->
ö
->
buf
->
°¨t
,

108 
˘x
->
ö
->
buf
->
pos
,

109 
˘x
->
ö
->
buf
->
œ°
,

110 
˘x
->
ö
->
buf
->
fûe
,

111 
˘x
->
ö
->
buf
->
fûe_pos
,

112 
˘x
->
ö
->
buf
->
fûe_œ°
);

114 
	`ngx_debug_poöt
();

116 
˘x
->
ö
 = ctx->ö->
√xt
;

121 i‡(
	`ngx_ouçut_chaö_as_is
(
˘x
, ctx->
ö
->
buf
)) {

125 
˛
 = 
˘x
->
ö
;

126 
˘x
->
ö
 = 
˛
->
√xt
;

128 *
œ°_out
 = 
˛
;

129 
œ°_out
 = &
˛
->
√xt
;

130 
˛
->
√xt
 = 
NULL
;

135 i‡(
˘x
->
buf
 =
NULL
) {

137 
rc
 = 
	`ngx_ouçut_chaö_Æign_fûe_buf
(
˘x
, 
bsize
);

139 i‡(
rc
 =
NGX_ERROR
) {

140  
NGX_ERROR
;

143 i‡(
rc
 !
NGX_OK
) {

145 i‡(
˘x
->
‰ì
) {

149 
˛
 = 
˘x
->
‰ì
;

150 
˘x
->
buf
 = 
˛
->buf;

151 
˘x
->
‰ì
 = 
˛
->
√xt
;

153 
	`ngx_‰ì_chaö
(
˘x
->
poﬁ
, 
˛
);

155 } i‡(
out
 || 
˘x
->
Æloˇãd
 =˘x->
bufs
.
num
) {

159 } i‡(
	`ngx_ouçut_chaö_gë_buf
(
˘x
, 
bsize
Ë!
NGX_OK
) {

160  
NGX_ERROR
;

165 
rc
 = 
	`ngx_ouçut_chaö_c›y_buf
(
˘x
);

167 i‡(
rc
 =
NGX_ERROR
) {

168  
rc
;

171 i‡(
rc
 =
NGX_AGAIN
) {

172 i‡(
out
) {

176  
rc
;

181 i‡(
	`ngx_buf_size
(
˘x
->
ö
->
buf
) == 0) {

182 
˘x
->
ö
 = ctx->ö->
√xt
;

185 
˛
 = 
	`ngx_Æloc_chaö_lök
(
˘x
->
poﬁ
);

186 i‡(
˛
 =
NULL
) {

187  
NGX_ERROR
;

190 
˛
->
buf
 = 
˘x
->buf;

191 
˛
->
√xt
 = 
NULL
;

192 *
œ°_out
 = 
˛
;

193 
œ°_out
 = &
˛
->
√xt
;

194 
˘x
->
buf
 = 
NULL
;

197 i‡(
out
 =
NULL
 && 
œ°
 !
NGX_NONE
) {

199 i‡(
˘x
->
ö
) {

200  
NGX_AGAIN
;

203  
œ°
;

206 
œ°
 = 
˘x
->
	`ouçut_fûãr
(˘x->
fûãr_˘x
, 
out
);

208 i‡(
œ°
 =
NGX_ERROR
 ||Üa° =
NGX_DONE
) {

209  
œ°
;

212 
	`ngx_chaö_upd©e_chaös
(&
˘x
->
‰ì
, &˘x->
busy
, &
out
, ctx->
èg
);

213 
œ°_out
 = &
out
;

215 
	}
}

218 
ngx_ölöe
 
ngx_öt_t


219 
	$ngx_ouçut_chaö_as_is
(
ngx_ouçut_chaö_˘x_t
 *
˘x
, 
ngx_buf_t
 *
buf
)

221 
ngx_uöt_t
 
£ndfûe
;

223 i‡(
	`ngx_buf_•ecül
(
buf
)) {

227 i‡(
buf
->
ö_fûe
 && buf->
fûe
->
dúe˘io
) {

231 
£ndfûe
 = 
˘x
->sendfile;

233 #i‡(
NGX_SENDFILE_LIMIT
)

235 i‡(
buf
->
ö_fûe
 && buf->
fûe_pos
 >
NGX_SENDFILE_LIMIT
) {

236 
£ndfûe
 = 0;

241 i‡(!
£ndfûe
) {

243 i‡(!
	`ngx_buf_ö_mem‹y
(
buf
)) {

247 
buf
->
ö_fûe
 = 0;

250 i‡(
˘x
->
√ed_ö_mem‹y
 && !
	`ngx_buf_ö_mem‹y
(
buf
)) {

254 i‡(
˘x
->
√ed_ö_ãmp
 && (
buf
->
mem‹y
 || buf->
mm≠
)) {

259 
	}
}

262 
ngx_öt_t


263 
	$ngx_ouçut_chaö_add_c›y
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_chaö_t
 **
chaö
,

264 
ngx_chaö_t
 *
ö
)

266 
ngx_chaö_t
 *
˛
, **
Œ
;

267 #i‡(
NGX_SENDFILE_LIMIT
)

268 
ngx_buf_t
 *
b
, *
buf
;

271 
Œ
 = 
chaö
;

273 
˛
 = *
chaö
; cl; c»˛->
√xt
) {

274 
Œ
 = &
˛
->
√xt
;

277 
ö
) {

279 
˛
 = 
	`ngx_Æloc_chaö_lök
(
poﬁ
);

280 i‡(
˛
 =
NULL
) {

281  
NGX_ERROR
;

284 #i‡(
NGX_SENDFILE_LIMIT
)

286 
buf
 = 
ö
->buf;

288 i‡(
buf
->
ö_fûe


289 && 
buf
->
fûe_pos
 < 
NGX_SENDFILE_LIMIT


290 && 
buf
->
fûe_œ°
 > 
NGX_SENDFILE_LIMIT
)

294 
b
 = 
	`ngx_ˇŒoc_buf
(
poﬁ
);

295 i‡(
b
 =
NULL
) {

296  
NGX_ERROR
;

299 
	`ngx_mem˝y
(
b
, 
buf
, (
ngx_buf_t
));

301 i‡(
	`ngx_buf_ö_mem‹y
(
buf
)) {

302 
buf
->
pos
 +(
ssize_t
Ë(
NGX_SENDFILE_LIMIT
 - buf->
fûe_pos
);

303 
b
->
œ°
 = 
buf
->
pos
;

306 
buf
->
fûe_pos
 = 
NGX_SENDFILE_LIMIT
;

307 
b
->
fûe_œ°
 = 
NGX_SENDFILE_LIMIT
;

309 
˛
->
buf
 = 
b
;

312 
˛
->
buf
 = buf;

313 
ö
 = in->
√xt
;

317 
˛
->
buf
 = 
ö
->buf;

318 
ö
 = in->
√xt
;

322 
˛
->
√xt
 = 
NULL
;

323 *
Œ
 = 
˛
;

324 
Œ
 = &
˛
->
√xt
;

327  
NGX_OK
;

328 
	}
}

331 
ngx_öt_t


332 
	$ngx_ouçut_chaö_Æign_fûe_buf
(
ngx_ouçut_chaö_˘x_t
 *
˘x
, 
off_t
 
bsize
)

334 
size_t
 
size
;

335 
ngx_buf_t
 *
ö
;

337 
ö
 = 
˘x
->ö->
buf
;

339 i‡(
ö
->
fûe
 =
NULL
 || !ö->fûe->
dúe˘io
) {

340  
NGX_DECLINED
;

343 
˘x
->
dúe˘io
 = 1;

345 
size
 = (
size_t
Ë(
ö
->
fûe_pos
 - (ö->fûe_po†& ~(
˘x
->
Æignmít
 - 1)));

347 i‡(
size
 == 0) {

349 i‡(
bsize
 >(
off_t
Ë
˘x
->
bufs
.
size
) {

350  
NGX_DECLINED
;

353 
size
 = (
size_t
Ë
bsize
;

356 
size
 = (
size_t
Ë
˘x
->
Æignmít
 - size;

358 i‡((
off_t
Ë
size
 > 
bsize
) {

359 
size
 = (
size_t
Ë
bsize
;

363 
˘x
->
buf
 = 
	`ngx_¸óã_ãmp_buf
(˘x->
poﬁ
, 
size
);

364 i‡(
˘x
->
buf
 =
NULL
) {

365  
NGX_ERROR
;

373 #i‡(
NGX_HAVE_ALIGNED_DIRECTIO
)

374 
˘x
->
u«lig√d
 = 1;

377  
NGX_OK
;

378 
	}
}

381 
ngx_öt_t


382 
	$ngx_ouçut_chaö_gë_buf
(
ngx_ouçut_chaö_˘x_t
 *
˘x
, 
off_t
 
bsize
)

384 
size_t
 
size
;

385 
ngx_buf_t
 *
b
, *
ö
;

386 
ngx_uöt_t
 
ªcy˛ed
;

388 
ö
 = 
˘x
->ö->
buf
;

389 
size
 = 
˘x
->
bufs
.size;

390 
ªcy˛ed
 = 1;

392 i‡(
ö
->
œ°_ö_chaö
) {

394 i‡(
bsize
 < (
off_t
Ë
size
) {

401 
size
 = (
size_t
Ë
bsize
;

402 
ªcy˛ed
 = 0;

404 } i‡(!
˘x
->
dúe˘io


405 && 
˘x
->
bufs
.
num
 == 1

406 && (
bsize
 < (
off_t
Ë(
size
 + size / 4)))

414 
size
 = (
size_t
Ë
bsize
;

415 
ªcy˛ed
 = 0;

419 
b
 = 
	`ngx_ˇŒoc_buf
(
˘x
->
poﬁ
);

420 i‡(
b
 =
NULL
) {

421  
NGX_ERROR
;

424 i‡(
˘x
->
dúe˘io
) {

431 
b
->
°¨t
 = 
	`ngx_pmemÆign
(
˘x
->
poﬁ
, 
size
, (
size_t
Ë˘x->
Æignmít
);

432 i‡(
b
->
°¨t
 =
NULL
) {

433  
NGX_ERROR
;

437 
b
->
°¨t
 = 
	`ngx_∑Œoc
(
˘x
->
poﬁ
, 
size
);

438 i‡(
b
->
°¨t
 =
NULL
) {

439  
NGX_ERROR
;

443 
b
->
pos
 = b->
°¨t
;

444 
b
->
œ°
 = b->
°¨t
;

445 
b
->
íd
 = b->
œ°
 + 
size
;

446 
b
->
ãmp‹¨y
 = 1;

447 
b
->
èg
 = 
˘x
->tag;

448 
b
->
ªcy˛ed
 =Ñecycled;

450 
˘x
->
buf
 = 
b
;

451 
˘x
->
Æloˇãd
++;

453  
NGX_OK
;

454 
	}
}

457 
ngx_öt_t


458 
	$ngx_ouçut_chaö_c›y_buf
(
ngx_ouçut_chaö_˘x_t
 *
˘x
)

460 
off_t
 
size
;

461 
ssize_t
 
n
;

462 
ngx_buf_t
 *
§c
, *
d°
;

463 
ngx_uöt_t
 
£ndfûe
;

465 
§c
 = 
˘x
->
ö
->
buf
;

466 
d°
 = 
˘x
->
buf
;

468 
size
 = 
	`ngx_buf_size
(
§c
);

469 
size
 = 
	`ngx_mö
(size, 
d°
->
íd
 - d°->
pos
);

471 
£ndfûe
 = 
˘x
->£ndfûê& !˘x->
dúe˘io
;

473 #i‡(
NGX_SENDFILE_LIMIT
)

475 i‡(
§c
->
ö_fûe
 && src->
fûe_pos
 >
NGX_SENDFILE_LIMIT
) {

476 
£ndfûe
 = 0;

481 i‡(
	`ngx_buf_ö_mem‹y
(
§c
)) {

482 
	`ngx_mem˝y
(
d°
->
pos
, 
§c
->pos, (
size_t
Ë
size
);

483 
§c
->
pos
 +(
size_t
Ë
size
;

484 
d°
->
œ°
 +(
size_t
Ë
size
;

486 i‡(
§c
->
ö_fûe
) {

488 i‡(
£ndfûe
) {

489 
d°
->
ö_fûe
 = 1;

490 
d°
->
fûe
 = 
§c
->file;

491 
d°
->
fûe_pos
 = 
§c
->file_pos;

492 
d°
->
fûe_œ°
 = 
§c
->
fûe_pos
 + 
size
;

495 
d°
->
ö_fûe
 = 0;

498 
§c
->
fûe_pos
 +
size
;

501 
d°
->
ö_fûe
 = 0;

504 i‡(
§c
->
pos
 =§c->
œ°
) {

505 
d°
->
Êush
 = 
§c
->flush;

506 
d°
->
œ°_buf
 = 
§c
->last_buf;

507 
d°
->
œ°_ö_chaö
 = 
§c
->last_in_chain;

512 #i‡(
NGX_HAVE_ALIGNED_DIRECTIO
)

514 i‡(
˘x
->
u«lig√d
) {

515 i‡(
	`ngx_dúe˘io_off
(
§c
->
fûe
->
fd
Ë=
NGX_FILE_ERROR
) {

516 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
˘x
->
poﬁ
->
log
, 
ngx_î∫o
,

517 
ngx_dúe˘io_off_n
 " \"%s\" failed",

518 
§c
->
fûe
->
«me
.
d©a
);

524 #i‡(
NGX_HAVE_FILE_AIO
)

526 i‡(
˘x
->
aio_h™dÀr
) {

527 
n
 = 
	`ngx_fûe_aio_ªad
(
§c
->
fûe
, 
d°
->
pos
, (
size_t
Ë
size
,

528 
§c
->
fûe_pos
, 
˘x
->
poﬁ
);

529 i‡(
n
 =
NGX_AGAIN
) {

530 
˘x
->
	`aio_h™dÀr
(˘x, 
§c
->
fûe
);

531  
NGX_AGAIN
;

535 
n
 = 
	`ngx_ªad_fûe
(
§c
->
fûe
, 
d°
->
pos
, (
size_t
Ë
size
,

536 
§c
->
fûe_pos
);

540 
n
 = 
	`ngx_ªad_fûe
(
§c
->
fûe
, 
d°
->
pos
, (
size_t
Ë
size
, src->
fûe_pos
);

544 #i‡(
NGX_HAVE_ALIGNED_DIRECTIO
)

546 i‡(
˘x
->
u«lig√d
) {

547 
ngx_îr_t
 
îr
;

549 
îr
 = 
ngx_î∫o
;

551 i‡(
	`ngx_dúe˘io_⁄
(
§c
->
fûe
->
fd
Ë=
NGX_FILE_ERROR
) {

552 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
˘x
->
poﬁ
->
log
, 
ngx_î∫o
,

553 
ngx_dúe˘io_⁄_n
 " \"%s\" failed",

554 
§c
->
fûe
->
«me
.
d©a
);

557 
	`ngx_£t_î∫o
(
îr
);

559 
˘x
->
u«lig√d
 = 0;

564 i‡(
n
 =
NGX_ERROR
) {

565  (
ngx_öt_t
Ë
n
;

568 i‡(
n
 !
size
) {

569 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
˘x
->
poﬁ
->
log
, 0,

570 
ngx_ªad_fûe_n
 "Ñead only %z of %O from \"%s\"",

571 
n
, 
size
, 
§c
->
fûe
->
«me
.
d©a
);

572  
NGX_ERROR
;

575 
d°
->
œ°
 +
n
;

577 i‡(
£ndfûe
) {

578 
d°
->
ö_fûe
 = 1;

579 
d°
->
fûe
 = 
§c
->file;

580 
d°
->
fûe_pos
 = 
§c
->file_pos;

581 
d°
->
fûe_œ°
 = 
§c
->
fûe_pos
 + 
n
;

584 
d°
->
ö_fûe
 = 0;

587 
§c
->
fûe_pos
 +
n
;

589 i‡(
§c
->
fûe_pos
 =§c->
fûe_œ°
) {

590 
d°
->
Êush
 = 
§c
->flush;

591 
d°
->
œ°_buf
 = 
§c
->last_buf;

592 
d°
->
œ°_ö_chaö
 = 
§c
->last_in_chain;

596  
NGX_OK
;

597 
	}
}

600 
ngx_öt_t


601 
	$ngx_chaö_wrôî
(*
d©a
, 
ngx_chaö_t
 *
ö
)

603 
ngx_chaö_wrôî_˘x_t
 *
˘x
 = 
d©a
;

605 
off_t
 
size
;

606 
ngx_chaö_t
 *
˛
;

607 
ngx_c⁄√˘i⁄_t
 *
c
;

609 
c
 = 
˘x
->
c⁄√˘i⁄
;

611 
size
 = 0; 
ö
; i¿ö->
√xt
) {

614 i‡(
	`ngx_buf_size
(
ö
->
buf
Ë=0 && !
	`ngx_buf_•ecül
(in->buf)) {

615 
	`ngx_debug_poöt
();

619 
size
 +
	`ngx_buf_size
(
ö
->
buf
);

621 
	`ngx_log_debug2
(
NGX_LOG_DEBUG_CORE
, 
c
->
log
, 0,

623 
ö
->
buf
->
Êush
, 
	`ngx_buf_size
(in->buf));

625 
˛
 = 
	`ngx_Æloc_chaö_lök
(
˘x
->
poﬁ
);

626 i‡(
˛
 =
NULL
) {

627  
NGX_ERROR
;

630 
˛
->
buf
 = 
ö
->buf;

631 
˛
->
√xt
 = 
NULL
;

632 *
˘x
->
œ°
 = 
˛
;

633 
˘x
->
œ°
 = &
˛
->
√xt
;

636 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
c
->
log
, 0,

637 "chaö wrôî in: %p", 
˘x
->
out
);

639 
˛
 = 
˘x
->
out
; cl; c»˛->
√xt
) {

642 i‡(
	`ngx_buf_size
(
˛
->
buf
Ë=0 && !
	`ngx_buf_•ecül
(cl->buf)) {

643 
	`ngx_debug_poöt
();

648 
size
 +
	`ngx_buf_size
(
˛
->
buf
);

651 i‡(
size
 =0 && !
c
->
buf„ªd
) {

652  
NGX_OK
;

655 
˘x
->
out
 = 
c
->
	`£nd_chaö
(c, ctx->out, ctx->
limô
);

657 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
c
->
log
, 0,

658 "chaö wrôî out: %p", 
˘x
->
out
);

660 i‡(
˘x
->
out
 =
NGX_CHAIN_ERROR
) {

661  
NGX_ERROR
;

664 i‡(
˘x
->
out
 =
NULL
) {

665 
˘x
->
œ°
 = &˘x->
out
;

667 i‡(!
c
->
buf„ªd
) {

668  
NGX_OK
;

672  
NGX_AGAIN
;

673 
	}
}

	@ngx_palloc.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 *
ngx_∑Œoc_block
(
ngx_poﬁ_t
 *
poﬁ
, 
size_t
 
size
);

13 *
ngx_∑Œoc_œrge
(
ngx_poﬁ_t
 *
poﬁ
, 
size_t
 
size
);

16 
ngx_poﬁ_t
 *

17 
	$ngx_¸óã_poﬁ
(
size_t
 
size
, 
ngx_log_t
 *
log
)

19 
ngx_poﬁ_t
 *
p
;

21 
p
 = 
	`ngx_memÆign
(
NGX_POOL_ALIGNMENT
, 
size
, 
log
);

22 i‡(
p
 =
NULL
) {

23  
NULL
;

26 
p
->
d
.
œ°
 = (
u_ch¨
 *Ë∞+ (
ngx_poﬁ_t
);

27 
p
->
d
.
íd
 = (
u_ch¨
 *Ë∞+ 
size
;

28 
p
->
d
.
√xt
 = 
NULL
;

29 
p
->
d
.
Áûed
 = 0;

31 
size
 = sizê- (
ngx_poﬁ_t
);

32 
p
->
max
 = (
size
 < 
NGX_MAX_ALLOC_FROM_POOL
) ? size : NGX_MAX_ALLOC_FROM_POOL;

34 
p
->
cuºít
 =Ö;

35 
p
->
chaö
 = 
NULL
;

36 
p
->
œrge
 = 
NULL
;

37 
p
->
˛ónup
 = 
NULL
;

38 
p
->
log
 =Üog;

40  
p
;

41 
	}
}

45 
	$ngx_de°roy_poﬁ
(
ngx_poﬁ_t
 *
poﬁ
)

47 
ngx_poﬁ_t
 *
p
, *
n
;

48 
ngx_poﬁ_œrge_t
 *
l
;

49 
ngx_poﬁ_˛ónup_t
 *
c
;

51 
c
 = 
poﬁ
->
˛ónup
; c; c = c->
√xt
) {

52 i‡(
c
->
h™dÀr
) {

53 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_ALLOC
, 
poﬁ
->
log
, 0,

54 "ru¿˛ónup: %p", 
c
);

55 
c
->
	`h™dÀr
(c->
d©a
);

59 
l
 = 
poﬁ
->
œrge
;Ü;Ü =Ü->
√xt
) {

61 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_ALLOC
, 
poﬁ
->
log
, 0, "‰ì: %p", 
l
->
Æloc
);

63 i‡(
l
->
Æloc
) {

64 
	`ngx_‰ì
(
l
->
Æloc
);

68 #i‡(
NGX_DEBUG
)

75 
p
 = 
poﬁ
, 
n
 =Öoﬁ->
d
.
√xt
; ;Ö =Ç,Ç =Ç->d.next) {

76 
	`ngx_log_debug2
(
NGX_LOG_DEBUG_ALLOC
, 
poﬁ
->
log
, 0,

77 "‰ì: %p, unu£d: %uz", 
p
,Ö->
d
.
íd
 -Ö->d.
œ°
);

79 i‡(
n
 =
NULL
) {

86 
p
 = 
poﬁ
, 
n
 =Öoﬁ->
d
.
√xt
; ;Ö =Ç,Ç =Ç->d.next) {

87 
	`ngx_‰ì
(
p
);

89 i‡(
n
 =
NULL
) {

93 
	}
}

97 
	$ngx_ª£t_poﬁ
(
ngx_poﬁ_t
 *
poﬁ
)

99 
ngx_poﬁ_t
 *
p
;

100 
ngx_poﬁ_œrge_t
 *
l
;

102 
l
 = 
poﬁ
->
œrge
;Ü;Ü =Ü->
√xt
) {

103 i‡(
l
->
Æloc
) {

104 
	`ngx_‰ì
(
l
->
Æloc
);

108 
poﬁ
->
œrge
 = 
NULL
;

110 
p
 = 
poﬁ
;Ö;Ö =Ö->
d
.
√xt
) {

111 
p
->
d
.
œ°
 = (
u_ch¨
 *Ë∞+ (
ngx_poﬁ_t
);

113 
	}
}

117 
	$ngx_∑Œoc
(
ngx_poﬁ_t
 *
poﬁ
, 
size_t
 
size
)

119 
u_ch¨
 *
m
;

120 
ngx_poﬁ_t
 *
p
;

122 i‡(
size
 <
poﬁ
->
max
) {

124 
p
 = 
poﬁ
->
cuºít
;

127 
m
 = 
	`ngx_Æign_±r
(
p
->
d
.
œ°
, 
NGX_ALIGNMENT
);

129 i‡((
size_t
Ë(
p
->
d
.
íd
 - 
m
Ë>
size
) {

130 
p
->
d
.
œ°
 = 
m
 + 
size
;

132  
m
;

135 
p
 =Ö->
d
.
√xt
;

137 } 
p
);

139  
	`ngx_∑Œoc_block
(
poﬁ
, 
size
);

142  
	`ngx_∑Œoc_œrge
(
poﬁ
, 
size
);

143 
	}
}

147 
	$ngx_≤Æloc
(
ngx_poﬁ_t
 *
poﬁ
, 
size_t
 
size
)

149 
u_ch¨
 *
m
;

150 
ngx_poﬁ_t
 *
p
;

152 i‡(
size
 <
poﬁ
->
max
) {

154 
p
 = 
poﬁ
->
cuºít
;

157 
m
 = 
p
->
d
.
œ°
;

159 i‡((
size_t
Ë(
p
->
d
.
íd
 - 
m
Ë>
size
) {

160 
p
->
d
.
œ°
 = 
m
 + 
size
;

162  
m
;

165 
p
 =Ö->
d
.
√xt
;

167 } 
p
);

169  
	`ngx_∑Œoc_block
(
poﬁ
, 
size
);

172  
	`ngx_∑Œoc_œrge
(
poﬁ
, 
size
);

173 
	}
}

177 
	$ngx_∑Œoc_block
(
ngx_poﬁ_t
 *
poﬁ
, 
size_t
 
size
)

179 
u_ch¨
 *
m
;

180 
size_t
 
psize
;

181 
ngx_poﬁ_t
 *
p
, *
√w
, *
cuºít
;

183 
psize
 = (
size_t
Ë(
poﬁ
->
d
.
íd
 - (
u_ch¨
 *)Öool);

185 
m
 = 
	`ngx_memÆign
(
NGX_POOL_ALIGNMENT
, 
psize
, 
poﬁ
->
log
);

186 i‡(
m
 =
NULL
) {

187  
NULL
;

190 
√w
 = (
ngx_poﬁ_t
 *Ë
m
;

192 
√w
->
d
.
íd
 = 
m
 + 
psize
;

193 
√w
->
d
.
√xt
 = 
NULL
;

194 
√w
->
d
.
Áûed
 = 0;

196 
m
 +(
ngx_poﬁ_d©a_t
);

197 
m
 = 
	`ngx_Æign_±r
(m, 
NGX_ALIGNMENT
);

198 
√w
->
d
.
œ°
 = 
m
 + 
size
;

200 
cuºít
 = 
poﬁ
->current;

202 
p
 = 
cuºít
;Ö->
d
.
√xt
;Ö =Ö->d.next) {

203 i‡(
p
->
d
.
Áûed
++ > 4) {

204 
cuºít
 = 
p
->
d
.
√xt
;

208 
p
->
d
.
√xt
 = 
√w
;

210 
poﬁ
->
cuºít
 = cuºíà? cuºíà: 
√w
;

212  
m
;

213 
	}
}

217 
	$ngx_∑Œoc_œrge
(
ngx_poﬁ_t
 *
poﬁ
, 
size_t
 
size
)

219 *
p
;

220 
ngx_uöt_t
 
n
;

221 
ngx_poﬁ_œrge_t
 *
œrge
;

223 
p
 = 
	`ngx_Æloc
(
size
, 
poﬁ
->
log
);

224 i‡(
p
 =
NULL
) {

225  
NULL
;

228 
n
 = 0;

230 
œrge
 = 
poﬁ
->œrge;Ü¨ge;Ü¨gêœrge->
√xt
) {

231 i‡(
œrge
->
Æloc
 =
NULL
) {

232 
œrge
->
Æloc
 = 
p
;

233  
p
;

236 i‡(
n
++ > 3) {

241 
œrge
 = 
	`ngx_∑Œoc
(
poﬁ
, (
ngx_poﬁ_œrge_t
));

242 i‡(
œrge
 =
NULL
) {

243 
	`ngx_‰ì
(
p
);

244  
NULL
;

247 
œrge
->
Æloc
 = 
p
;

248 
œrge
->
√xt
 = 
poﬁ
->large;

249 
poﬁ
->
œrge
 =Üarge;

251  
p
;

252 
	}
}

256 
	$ngx_pmemÆign
(
ngx_poﬁ_t
 *
poﬁ
, 
size_t
 
size
, size_à
Æignmít
)

258 *
p
;

259 
ngx_poﬁ_œrge_t
 *
œrge
;

261 
p
 = 
	`ngx_memÆign
(
Æignmít
, 
size
, 
poﬁ
->
log
);

262 i‡(
p
 =
NULL
) {

263  
NULL
;

266 
œrge
 = 
	`ngx_∑Œoc
(
poﬁ
, (
ngx_poﬁ_œrge_t
));

267 i‡(
œrge
 =
NULL
) {

268 
	`ngx_‰ì
(
p
);

269  
NULL
;

272 
œrge
->
Æloc
 = 
p
;

273 
œrge
->
√xt
 = 
poﬁ
->large;

274 
poﬁ
->
œrge
 =Üarge;

276  
p
;

277 
	}
}

280 
ngx_öt_t


281 
	$ngx_p‰ì
(
ngx_poﬁ_t
 *
poﬁ
, *
p
)

283 
ngx_poﬁ_œrge_t
 *
l
;

285 
l
 = 
poﬁ
->
œrge
;Ü;Ü =Ü->
√xt
) {

286 i‡(
p
 =
l
->
Æloc
) {

287 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_ALLOC
, 
poﬁ
->
log
, 0,

288 "‰ì: %p", 
l
->
Æloc
);

289 
	`ngx_‰ì
(
l
->
Æloc
);

290 
l
->
Æloc
 = 
NULL
;

292  
NGX_OK
;

296  
NGX_DECLINED
;

297 
	}
}

301 
	$ngx_pˇŒoc
(
ngx_poﬁ_t
 *
poﬁ
, 
size_t
 
size
)

303 *
p
;

305 
p
 = 
	`ngx_∑Œoc
(
poﬁ
, 
size
);

306 i‡(
p
) {

307 
	`ngx_memzîo
(
p
, 
size
);

310  
p
;

311 
	}
}

314 
ngx_poﬁ_˛ónup_t
 *

315 
	$ngx_poﬁ_˛ónup_add
(
ngx_poﬁ_t
 *
p
, 
size_t
 
size
)

317 
ngx_poﬁ_˛ónup_t
 *
c
;

319 
c
 = 
	`ngx_∑Œoc
(
p
, (
ngx_poﬁ_˛ónup_t
));

320 i‡(
c
 =
NULL
) {

321  
NULL
;

324 i‡(
size
) {

325 
c
->
d©a
 = 
	`ngx_∑Œoc
(
p
, 
size
);

326 i‡(
c
->
d©a
 =
NULL
) {

327  
NULL
;

331 
c
->
d©a
 = 
NULL
;

334 
c
->
h™dÀr
 = 
NULL
;

335 
c
->
√xt
 = 
p
->
˛ónup
;

337 
p
->
˛ónup
 = 
c
;

339 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_ALLOC
, 
p
->
log
, 0, "add cÀ™up: %p", 
c
);

341  
c
;

342 
	}
}

346 
	$ngx_poﬁ_run_˛ónup_fûe
(
ngx_poﬁ_t
 *
p
, 
ngx_fd_t
 
fd
)

348 
ngx_poﬁ_˛ónup_t
 *
c
;

349 
ngx_poﬁ_˛ónup_fûe_t
 *
cf
;

351 
c
 = 
p
->
˛ónup
; c; c = c->
√xt
) {

352 i‡(
c
->
h™dÀr
 =
ngx_poﬁ_˛ónup_fûe
) {

354 
cf
 = 
c
->
d©a
;

356 i‡(
cf
->
fd
 == fd) {

357 
c
->
	`h™dÀr
(
cf
);

358 
c
->
h™dÀr
 = 
NULL
;

363 
	}
}

367 
	$ngx_poﬁ_˛ónup_fûe
(*
d©a
)

369 
ngx_poﬁ_˛ónup_fûe_t
 *
c
 = 
d©a
;

371 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_ALLOC
, 
c
->
log
, 0, "file cleanup: fd:%d",

372 
c
->
fd
);

374 i‡(
	`ngx_˛o£_fûe
(
c
->
fd
Ë=
NGX_FILE_ERROR
) {

375 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
c
->
log
, 
ngx_î∫o
,

376 
ngx_˛o£_fûe_n
 " \"%s\" faûed", 
c
->
«me
);

378 
	}
}

382 
	$ngx_poﬁ_dñëe_fûe
(*
d©a
)

384 
ngx_poﬁ_˛ónup_fûe_t
 *
c
 = 
d©a
;

386 
ngx_îr_t
 
îr
;

388 
	`ngx_log_debug2
(
NGX_LOG_DEBUG_ALLOC
, 
c
->
log
, 0, "file cleanup: fd:%d %s",

389 
c
->
fd
, c->
«me
);

391 i‡(
	`ngx_dñëe_fûe
(
c
->
«me
Ë=
NGX_FILE_ERROR
) {

392 
îr
 = 
ngx_î∫o
;

394 i‡(
îr
 !
NGX_ENOENT
) {

395 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, 
c
->
log
, 
îr
,

396 
ngx_dñëe_fûe_n
 " \"%s\" faûed", 
c
->
«me
);

400 i‡(
	`ngx_˛o£_fûe
(
c
->
fd
Ë=
NGX_FILE_ERROR
) {

401 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
c
->
log
, 
ngx_î∫o
,

402 
ngx_˛o£_fûe_n
 " \"%s\" faûed", 
c
->
«me
);

404 
	}
}

410 
	$ngx_gë_ˇched_block
(
size_t
 
size
)

412 *
p
;

413 
ngx_ˇched_block_¶Ÿ_t
 *
¶Ÿ
;

415 i‡(
ngx_cy˛e
->
ˇche
 =
NULL
) {

416  
NULL
;

419 
¶Ÿ
 = &
ngx_cy˛e
->
ˇche
[(
size
 + 
ngx_∑gesize
 - 1) /Çgx_pagesize];

421 
¶Ÿ
->
åõs
++;

423 i‡(
¶Ÿ
->
numbî
) {

424 
p
 = 
¶Ÿ
->
block
;

425 
¶Ÿ
->
block
 = slŸ->block->
√xt
;

426 
¶Ÿ
->
numbî
--;

427  
p
;

430  
NULL
;

431 
	}
}

	@ngx_palloc.h

8 #i‚de‡
_NGX_PALLOC_H_INCLUDED_


9 
	#_NGX_PALLOC_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

20 
	#NGX_MAX_ALLOC_FROM_POOL
 (
ngx_∑gesize
 - 1)

	)

22 
	#NGX_DEFAULT_POOL_SIZE
 (16 * 1024)

	)

24 
	#NGX_POOL_ALIGNMENT
 16

	)

25 
	#NGX_MIN_POOL_SIZE
 \

26 
	`ngx_Æign
(((
ngx_poﬁ_t
Ë+ 2 * (
ngx_poﬁ_œrge_t
)), \

27 
NGX_POOL_ALIGNMENT
)

	)

30 (*
	tngx_poﬁ_˛ónup_±
)(*
	td©a
);

32 
ngx_poﬁ_˛ónup_s
 
	tngx_poﬁ_˛ónup_t
;

34 
	sngx_poﬁ_˛ónup_s
 {

35 
ngx_poﬁ_˛ónup_±
 
h™dÀr
;

36 *
d©a
;

37 
ngx_poﬁ_˛ónup_t
 *
√xt
;

41 
ngx_poﬁ_œrge_s
 
	tngx_poﬁ_œrge_t
;

43 
	sngx_poﬁ_œrge_s
 {

44 
ngx_poﬁ_œrge_t
 *
√xt
;

45 *
Æloc
;

50 
u_ch¨
 *
œ°
;

51 
u_ch¨
 *
íd
;

52 
ngx_poﬁ_t
 *
√xt
;

53 
ngx_uöt_t
 
Áûed
;

54 } 
	tngx_poﬁ_d©a_t
;

57 
	sngx_poﬁ_s
 {

58 
ngx_poﬁ_d©a_t
 
d
;

59 
size_t
 
max
;

60 
ngx_poﬁ_t
 *
cuºít
;

61 
ngx_chaö_t
 *
chaö
;

62 
ngx_poﬁ_œrge_t
 *
œrge
;

63 
ngx_poﬁ_˛ónup_t
 *
˛ónup
;

64 
ngx_log_t
 *
log
;

69 
ngx_fd_t
 
fd
;

70 
u_ch¨
 *
«me
;

71 
ngx_log_t
 *
log
;

72 } 
	tngx_poﬁ_˛ónup_fûe_t
;

75 *
	`ngx_Æloc
(
size_t
 
size
, 
ngx_log_t
 *
log
);

76 *
	`ngx_ˇŒoc
(
size_t
 
size
, 
ngx_log_t
 *
log
);

78 
ngx_poﬁ_t
 *
	`ngx_¸óã_poﬁ
(
size_t
 
size
, 
ngx_log_t
 *
log
);

79 
	`ngx_de°roy_poﬁ
(
ngx_poﬁ_t
 *
poﬁ
);

80 
	`ngx_ª£t_poﬁ
(
ngx_poﬁ_t
 *
poﬁ
);

82 *
	`ngx_∑Œoc
(
ngx_poﬁ_t
 *
poﬁ
, 
size_t
 
size
);

83 *
	`ngx_≤Æloc
(
ngx_poﬁ_t
 *
poﬁ
, 
size_t
 
size
);

84 *
	`ngx_pˇŒoc
(
ngx_poﬁ_t
 *
poﬁ
, 
size_t
 
size
);

85 *
	`ngx_pmemÆign
(
ngx_poﬁ_t
 *
poﬁ
, 
size_t
 
size
, size_à
Æignmít
);

86 
ngx_öt_t
 
	`ngx_p‰ì
(
ngx_poﬁ_t
 *
poﬁ
, *
p
);

89 
ngx_poﬁ_˛ónup_t
 *
	`ngx_poﬁ_˛ónup_add
(
ngx_poﬁ_t
 *
p
, 
size_t
 
size
);

90 
	`ngx_poﬁ_run_˛ónup_fûe
(
ngx_poﬁ_t
 *
p
, 
ngx_fd_t
 
fd
);

91 
	`ngx_poﬁ_˛ónup_fûe
(*
d©a
);

92 
	`ngx_poﬁ_dñëe_fûe
(*
d©a
);

	@ngx_parse.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 
ssize_t


13 
	$ngx_∑r£_size
(
ngx_°r_t
 *
löe
)

15 
u_ch¨
 
unô
;

16 
size_t
 
Àn
;

17 
ssize_t
 
size
;

18 
ngx_öt_t
 
sˇÀ
;

20 
Àn
 = 
löe
->len;

21 
unô
 = 
löe
->
d©a
[
Àn
 - 1];

23 
unô
) {

26 
Àn
--;

27 
sˇÀ
 = 1024;

32 
Àn
--;

33 
sˇÀ
 = 1024 * 1024;

37 
sˇÀ
 = 1;

40 
size
 = 
	`ngx_©osz
(
löe
->
d©a
, 
Àn
);

41 i‡(
size
 =
NGX_ERROR
) {

42  
NGX_ERROR
;

45 
size
 *
sˇÀ
;

47  
size
;

48 
	}
}

51 
off_t


52 
	$ngx_∑r£_off£t
(
ngx_°r_t
 *
löe
)

54 
u_ch¨
 
unô
;

55 
off_t
 
off£t
;

56 
size_t
 
Àn
;

57 
ngx_öt_t
 
sˇÀ
;

59 
Àn
 = 
löe
->len;

60 
unô
 = 
löe
->
d©a
[
Àn
 - 1];

62 
unô
) {

65 
Àn
--;

66 
sˇÀ
 = 1024;

71 
Àn
--;

72 
sˇÀ
 = 1024 * 1024;

77 
Àn
--;

78 
sˇÀ
 = 1024 * 1024 * 1024;

82 
sˇÀ
 = 1;

85 
off£t
 = 
	`ngx_©oof
(
löe
->
d©a
, 
Àn
);

86 i‡(
off£t
 =
NGX_ERROR
) {

87  
NGX_ERROR
;

90 
off£t
 *
sˇÀ
;

92  
off£t
;

93 
	}
}

96 
ngx_öt_t


97 
	$ngx_∑r£_time
(
ngx_°r_t
 *
löe
, 
ngx_uöt_t
 
is_£c
)

99 
u_ch¨
 *
p
, *
œ°
;

100 
ngx_öt_t
 
vÆue
, 
tŸÆ
, 
sˇÀ
;

101 
ngx_uöt_t
 
max
, 
vÆid
;

103 
°_°¨t
 = 0,

104 
°_yór
,

105 
°_m⁄th
,

106 
°_wìk
,

107 
°_day
,

108 
°_hour
,

109 
°_mö
,

110 
°_£c
,

111 
°_m£c
,

112 
°_œ°


113 } 
°ï
;

115 
vÆid
 = 0;

116 
vÆue
 = 0;

117 
tŸÆ
 = 0;

118 
°ï
 = 
is_£c
 ? 
°_°¨t
 : 
°_m⁄th
;

119 
sˇÀ
 = 
is_£c
 ? 1 : 1000;

121 
p
 = 
löe
->
d©a
;

122 
œ°
 = 
p
 + 
löe
->
Àn
;

124 
p
 < 
œ°
) {

126 i‡(*
p
 >= '0' && *p <= '9') {

127 
vÆue
 = vÆuê* 10 + (*
p
++ - '0');

128 
vÆid
 = 1;

132 *
p
++) {

135 i‡(
°ï
 > 
°_°¨t
) {

136  
NGX_ERROR
;

138 
°ï
 = 
°_yór
;

139 
max
 = 
NGX_MAX_INT32_VALUE
 / (60 * 60 * 24 * 365);

140 
sˇÀ
 = 60 * 60 * 24 * 365;

144 i‡(
°ï
 >
°_m⁄th
) {

145  
NGX_ERROR
;

147 
°ï
 = 
°_m⁄th
;

148 
max
 = 
NGX_MAX_INT32_VALUE
 / (60 * 60 * 24 * 30);

149 
sˇÀ
 = 60 * 60 * 24 * 30;

153 i‡(
°ï
 >
°_wìk
) {

154  
NGX_ERROR
;

156 
°ï
 = 
°_wìk
;

157 
max
 = 
NGX_MAX_INT32_VALUE
 / (60 * 60 * 24 * 7);

158 
sˇÀ
 = 60 * 60 * 24 * 7;

162 i‡(
°ï
 >
°_day
) {

163  
NGX_ERROR
;

165 
°ï
 = 
°_day
;

166 
max
 = 
NGX_MAX_INT32_VALUE
 / (60 * 60 * 24);

167 
sˇÀ
 = 60 * 60 * 24;

171 i‡(
°ï
 >
°_hour
) {

172  
NGX_ERROR
;

174 
°ï
 = 
°_hour
;

175 
max
 = 
NGX_MAX_INT32_VALUE
 / (60 * 60);

176 
sˇÀ
 = 60 * 60;

180 i‡(*
p
 == 's') {

181 i‡(
is_£c
 || 
°ï
 >
°_m£c
) {

182  
NGX_ERROR
;

184 
p
++;

185 
°ï
 = 
°_m£c
;

186 
max
 = 
NGX_MAX_INT32_VALUE
;

187 
sˇÀ
 = 1;

191 i‡(
°ï
 >
°_mö
) {

192  
NGX_ERROR
;

194 
°ï
 = 
°_mö
;

195 
max
 = 
NGX_MAX_INT32_VALUE
 / 60;

196 
sˇÀ
 = 60;

200 i‡(
°ï
 >
°_£c
) {

201  
NGX_ERROR
;

203 
°ï
 = 
°_£c
;

204 
max
 = 
NGX_MAX_INT32_VALUE
;

205 
sˇÀ
 = 1;

209 i‡(
°ï
 >
°_£c
) {

210  
NGX_ERROR
;

212 
°ï
 = 
°_œ°
;

213 
max
 = 
NGX_MAX_INT32_VALUE
;

214 
sˇÀ
 = 1;

218  
NGX_ERROR
;

221 i‡(
°ï
 !
°_m£c
 && !
is_£c
) {

222 
sˇÀ
 *= 1000;

223 
max
 /= 1000;

226 i‡((
ngx_uöt_t
Ë
vÆue
 > 
max
) {

227  
NGX_ERROR
;

230 
tŸÆ
 +
vÆue
 * 
sˇÀ
;

232 i‡((
ngx_uöt_t
Ë
tŸÆ
 > 
NGX_MAX_INT32_VALUE
) {

233  
NGX_ERROR
;

236 
vÆue
 = 0;

237 
sˇÀ
 = 
is_£c
 ? 1 : 1000;

239 
p
 < 
œ°
 && *p == ' ') {

240 
p
++;

244 i‡(
vÆid
) {

245  
tŸÆ
 + 
vÆue
 * 
sˇÀ
;

248  
NGX_ERROR
;

249 
	}
}

	@ngx_parse.h

8 #i‚de‡
_NGX_PARSE_H_INCLUDED_


9 
	#_NGX_PARSE_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 
	#NGX_PARSE_LARGE_TIME
 -2

	)

19 
ssize_t
 
ngx_∑r£_size
(
ngx_°r_t
 *
löe
);

20 
off_t
 
ngx_∑r£_off£t
(
ngx_°r_t
 *
löe
);

21 
ngx_öt_t
 
ngx_∑r£_time
(
ngx_°r_t
 *
löe
, 
ngx_uöt_t
 
is_£c
);

	@ngx_queue.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

17 
ngx_queue_t
 *

18 
	$ngx_queue_middÀ
(
ngx_queue_t
 *
queue
)

20 
ngx_queue_t
 *
middÀ
, *
√xt
;

22 
middÀ
 = 
	`ngx_queue_hód
(
queue
);

24 i‡(
middÀ
 =
	`ngx_queue_œ°
(
queue
)) {

25  
middÀ
;

28 
√xt
 = 
	`ngx_queue_hód
(
queue
);

31 
middÀ
 = 
	`ngx_queue_√xt
(middle);

33 
√xt
 = 
	`ngx_queue_√xt
(next);

35 i‡(
√xt
 =
	`ngx_queue_œ°
(
queue
)) {

36  
middÀ
;

39 
√xt
 = 
	`ngx_queue_√xt
(next);

41 i‡(
√xt
 =
	`ngx_queue_œ°
(
queue
)) {

42  
middÀ
;

45 
	}
}

51 
ngx_queue_s‹t
(
ngx_queue_t
 *
queue
,

52 
	$ngx_öt_t
 (*
cmp
)(c⁄° 
ngx_queue_t
 *, constÇgx_queue_t *))

54 
ngx_queue_t
 *
q
, *
¥ev
, *
√xt
;

56 
q
 = 
	`ngx_queue_hód
(
queue
);

58 i‡(
q
 =
	`ngx_queue_œ°
(
queue
)) {

62 
q
 = 
	`ngx_queue_√xt
(q); q !
	`ngx_queue_£¡öñ
(
queue
); q = 
√xt
) {

64 
¥ev
 = 
	`ngx_queue_¥ev
(
q
);

65 
√xt
 = 
	`ngx_queue_√xt
(
q
);

67 
	`ngx_queue_ªmove
(
q
);

70 i‡(
	`cmp
(
¥ev
, 
q
) <= 0) {

74 
¥ev
 = 
	`ngx_queue_¥ev
(prev);

76 } 
¥ev
 !
	`ngx_queue_£¡öñ
(
queue
));

78 
	`ngx_queue_ö£π_a·î
(
¥ev
, 
q
);

80 
	}
}

	@ngx_queue.h

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 #i‚de‡
_NGX_QUEUE_H_INCLUDED_


13 
	#_NGX_QUEUE_H_INCLUDED_


	)

16 
ngx_queue_s
 
	tngx_queue_t
;

18 
	sngx_queue_s
 {

19 
ngx_queue_t
 *
	m¥ev
;

20 
ngx_queue_t
 *
	m√xt
;

24 
	#ngx_queue_öô
(
q
) \

25 (
q
)->
¥ev
 = q; \

26 (
q
)->
√xt
 = 
	)
q

29 
	#ngx_queue_em±y
(
h
) \

30 (
h
 =(h)->
¥ev
)

	)

33 
	#ngx_queue_ö£π_hód
(
h
, 
x
) \

34 (
x
)->
√xt
 = (
h
)->next; \

35 (
x
)->
√xt
->
¥ev
 = x; \

36 (
x
)->
¥ev
 = 
h
; \

37 (
h
)->
√xt
 = 
x


	)

40 
	#ngx_queue_ö£π_a·î
 
ngx_queue_ö£π_hód


	)

43 
	#ngx_queue_ö£π_èû
(
h
, 
x
) \

44 (
x
)->
¥ev
 = (
h
)->prev; \

45 (
x
)->
¥ev
->
√xt
 = x; \

46 (
x
)->
√xt
 = 
h
; \

47 (
h
)->
¥ev
 = 
x


	)

50 
	#ngx_queue_hód
(
h
) \

51 (
h
)->
√xt


	)

54 
	#ngx_queue_œ°
(
h
) \

55 (
h
)->
¥ev


	)

58 
	#ngx_queue_£¡öñ
(
h
) \

59 (
h
)

	)

62 
	#ngx_queue_√xt
(
q
) \

63 (
q
)->
√xt


	)

66 
	#ngx_queue_¥ev
(
q
) \

67 (
q
)->
¥ev


	)

70 #i‡(
NGX_DEBUG
)

72 
	#ngx_queue_ªmove
(
x
) \

73 (
x
)->
√xt
->
¥ev
 = (x)->prev; \

74 (
x
)->
¥ev
->
√xt
 = (x)->next; \

75 (
x
)->
¥ev
 = 
NULL
; \

76 (
x
)->
√xt
 = 
NULL


	)

80 
	#ngx_queue_ªmove
(
x
) \

81 (
x
)->
√xt
->
¥ev
 = (x)->prev; \

82 (
x
)->
¥ev
->
√xt
 = (x)->
	)
next

87 
	#ngx_queue_•lô
(
h
, 
q
, 
n
) \

88 (
n
)->
¥ev
 = (
h
)->prev; \

89 (
n
)->
¥ev
->
√xt
 =Ç; \

90 (
n
)->
√xt
 = 
q
; \

91 (
h
)->
¥ev
 = (
q
)->prev; \

92 (
h
)->
¥ev
->
√xt
 = h; \

93 (
q
)->
¥ev
 = 
n
;

	)

96 
	#ngx_queue_add
(
h
, 
n
) \

97 (
h
)->
¥ev
->
√xt
 = (
n
)->next; \

98 (
n
)->
√xt
->
¥ev
 = (
h
)->prev; \

99 (
h
)->
¥ev
 = (
n
)->prev; \

100 (
h
)->
¥ev
->
√xt
 = h;

	)

103 
	#ngx_queue_d©a
(
q
, 
ty≥
, 
lök
) \

104 (
ty≥
 *Ë((
u_ch¨
 *Ë
q
 - 
	`off£tof
—y≥, 
lök
))

	)

107 
ngx_queue_t
 *
ngx_queue_middÀ
“gx_queue_à*
queue
);

108 
ngx_queue_s‹t
(
ngx_queue_t
 *
queue
,

109 
	$ngx_öt_t
 (*
cmp
)(c⁄° 
ngx_queue_t
 *, constÇgx_queue_t *));

	@ngx_radix_tree.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 *
ngx_ødix_Æloc
(
ngx_ødix_åì_t
 *
åì
);

15 
ngx_ødix_åì_t
 *

16 
	$ngx_ødix_åì_¸óã
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_öt_t
 
¥óŒoˇã
)

18 
uöt32_t
 
key
, 
mask
, 
öc
;

19 
ngx_ødix_åì_t
 *
åì
;

21 
åì
 = 
	`ngx_∑Œoc
(
poﬁ
, (
ngx_ødix_åì_t
));

22 i‡(
åì
 =
NULL
) {

23  
NULL
;

26 
åì
->
poﬁ
 =Öool;

27 
åì
->
‰ì
 = 
NULL
;

28 
åì
->
°¨t
 = 
NULL
;

29 
åì
->
size
 = 0;

31 
åì
->
roŸ
 = 
	`ngx_ødix_Æloc
(tree);

32 i‡(
åì
->
roŸ
 =
NULL
) {

33  
NULL
;

36 
åì
->
roŸ
->
right
 = 
NULL
;

37 
åì
->
roŸ
->
À·
 = 
NULL
;

38 
åì
->
roŸ
->
∑ª¡
 = 
NULL
;

39 
åì
->
roŸ
->
vÆue
 = 
NGX_RADIX_NO_VALUE
;

41 i‡(
¥óŒoˇã
 == 0) {

42  
åì
;

62 i‡(
¥óŒoˇã
 == -1) {

63 
ngx_∑gesize
 / (
ngx_ødix_åì_t
)) {

67 
¥óŒoˇã
 = 6;

72 
¥óŒoˇã
 = 7;

77 
¥óŒoˇã
 = 8;

81 
mask
 = 0;

82 
öc
 = 0x80000000;

84 
¥óŒoˇã
--) {

86 
key
 = 0;

87 
mask
 >>= 1;

88 
mask
 |= 0x80000000;

91 i‡(
	`ngx_ødix32åì_ö£π
(
åì
, 
key
, 
mask
, 
NGX_RADIX_NO_VALUE
)

92 !
NGX_OK
)

94  
NULL
;

97 
key
 +
öc
;

99 } 
key
);

101 
öc
 >>= 1;

104  
åì
;

105 
	}
}

108 
ngx_öt_t


109 
	$ngx_ødix32åì_ö£π
(
ngx_ødix_åì_t
 *
åì
, 
uöt32_t
 
key
, uöt32_à
mask
,

110 
uöçå_t
 
vÆue
)

112 
uöt32_t
 
bô
;

113 
ngx_ødix_node_t
 *
node
, *
√xt
;

115 
bô
 = 0x80000000;

117 
node
 = 
åì
->
roŸ
;

118 
√xt
 = 
åì
->
roŸ
;

120 
bô
 & 
mask
) {

121 i‡(
key
 & 
bô
) {

122 
√xt
 = 
node
->
right
;

125 
√xt
 = 
node
->
À·
;

128 i‡(
√xt
 =
NULL
) {

132 
bô
 >>= 1;

133 
node
 = 
√xt
;

136 i‡(
√xt
) {

137 i‡(
node
->
vÆue
 !
NGX_RADIX_NO_VALUE
) {

138  
NGX_BUSY
;

141 
node
->
vÆue
 = value;

142  
NGX_OK
;

145 
bô
 & 
mask
) {

146 
√xt
 = 
	`ngx_ødix_Æloc
(
åì
);

147 i‡(
√xt
 =
NULL
) {

148  
NGX_ERROR
;

151 
√xt
->
right
 = 
NULL
;

152 
√xt
->
À·
 = 
NULL
;

153 
√xt
->
∑ª¡
 = 
node
;

154 
√xt
->
vÆue
 = 
NGX_RADIX_NO_VALUE
;

156 i‡(
key
 & 
bô
) {

157 
node
->
right
 = 
√xt
;

160 
node
->
À·
 = 
√xt
;

163 
bô
 >>= 1;

164 
node
 = 
√xt
;

167 
node
->
vÆue
 = value;

169  
NGX_OK
;

170 
	}
}

173 
ngx_öt_t


174 
	$ngx_ødix32åì_dñëe
(
ngx_ødix_åì_t
 *
åì
, 
uöt32_t
 
key
, uöt32_à
mask
)

176 
uöt32_t
 
bô
;

177 
ngx_ødix_node_t
 *
node
;

179 
bô
 = 0x80000000;

180 
node
 = 
åì
->
roŸ
;

182 
node
 && (
bô
 & 
mask
)) {

183 i‡(
key
 & 
bô
) {

184 
node
 =Çode->
right
;

187 
node
 =Çode->
À·
;

190 
bô
 >>= 1;

193 i‡(
node
 =
NULL
) {

194  
NGX_ERROR
;

197 i‡(
node
->
right
 ||Çode->
À·
) {

198 i‡(
node
->
vÆue
 !
NGX_RADIX_NO_VALUE
) {

199 
node
->
vÆue
 = 
NGX_RADIX_NO_VALUE
;

200  
NGX_OK
;

203  
NGX_ERROR
;

207 i‡(
node
->
∑ª¡
->
right
 ==Çode) {

208 
node
->
∑ª¡
->
right
 = 
NULL
;

211 
node
->
∑ª¡
->
À·
 = 
NULL
;

214 
node
->
right
 = 
åì
->
‰ì
;

215 
åì
->
‰ì
 = 
node
;

217 
node
 =Çode->
∑ª¡
;

219 i‡(
node
->
right
 ||Çode->
À·
) {

223 i‡(
node
->
vÆue
 !
NGX_RADIX_NO_VALUE
) {

227 i‡(
node
->
∑ª¡
 =
NULL
) {

232  
NGX_OK
;

233 
	}
}

236 
uöçå_t


237 
	$ngx_ødix32åì_föd
(
ngx_ødix_åì_t
 *
åì
, 
uöt32_t
 
key
)

239 
uöt32_t
 
bô
;

240 
uöçå_t
 
vÆue
;

241 
ngx_ødix_node_t
 *
node
;

243 
bô
 = 0x80000000;

244 
vÆue
 = 
NGX_RADIX_NO_VALUE
;

245 
node
 = 
åì
->
roŸ
;

247 
node
) {

248 i‡(
node
->
vÆue
 !
NGX_RADIX_NO_VALUE
) {

249 
vÆue
 = 
node
->value;

252 i‡(
key
 & 
bô
) {

253 
node
 =Çode->
right
;

256 
node
 =Çode->
À·
;

259 
bô
 >>= 1;

262  
vÆue
;

263 
	}
}

267 
	$ngx_ødix_Æloc
(
ngx_ødix_åì_t
 *
åì
)

269 *
p
;

271 i‡(
åì
->
‰ì
) {

272 
p
 = (*Ë
åì
->
‰ì
;

273 
åì
->
‰ì
 =Åªe->‰ì->
right
;

274  
p
;

277 i‡(
åì
->
size
 < (
ngx_ødix_node_t
)) {

278 
åì
->
°¨t
 = 
	`ngx_pmemÆign
—ªe->
poﬁ
, 
ngx_∑gesize
,Çgx_pagesize);

279 i‡(
åì
->
°¨t
 =
NULL
) {

280  
NULL
;

283 
åì
->
size
 = 
ngx_∑gesize
;

286 
p
 = 
åì
->
°¨t
;

287 
åì
->
°¨t
 +(
ngx_ødix_node_t
);

288 
åì
->
size
 -(
ngx_ødix_node_t
);

290  
p
;

291 
	}
}

	@ngx_radix_tree.h

8 #i‚de‡
_NGX_RADIX_TREE_H_INCLUDED_


9 
	#_NGX_RADIX_TREE_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 
	#NGX_RADIX_NO_VALUE
 (
uöçå_t
Ë-1

	)

18 
ngx_ødix_node_s
 
	tngx_ødix_node_t
;

20 
	sngx_ødix_node_s
 {

21 
ngx_ødix_node_t
 *
	mright
;

22 
ngx_ødix_node_t
 *
	mÀ·
;

23 
ngx_ødix_node_t
 *
	m∑ª¡
;

24 
uöçå_t
 
	mvÆue
;

29 
ngx_ødix_node_t
 *
	mroŸ
;

30 
ngx_poﬁ_t
 *
	mpoﬁ
;

31 
ngx_ødix_node_t
 *
	m‰ì
;

32 *
	m°¨t
;

33 
size_t
 
	msize
;

34 } 
	tngx_ødix_åì_t
;

37 
ngx_ødix_åì_t
 *
ngx_ødix_åì_¸óã
(
ngx_poﬁ_t
 *
poﬁ
,

38 
ngx_öt_t
 
¥óŒoˇã
);

39 
ngx_öt_t
 
ngx_ødix32åì_ö£π
(
ngx_ødix_åì_t
 *
åì
,

40 
uöt32_t
 
key
, uöt32_à
mask
, 
uöçå_t
 
vÆue
);

41 
ngx_öt_t
 
ngx_ødix32åì_dñëe
(
ngx_ødix_åì_t
 *
åì
,

42 
uöt32_t
 
key
, uöt32_à
mask
);

43 
uöçå_t
 
ngx_ødix32åì_föd
(
ngx_ødix_åì_t
 *
åì
, 
uöt32_t
 
key
);

	@ngx_rbtree.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

18 
ngx_ölöe
 
ngx_rbåì_À·_rŸ©e
(
ngx_rbåì_node_t
 **
roŸ
,

19 
ngx_rbåì_node_t
 *
£¡öñ
,Çgx_rbåì_node_à*
node
);

20 
ngx_ölöe
 
ngx_rbåì_right_rŸ©e
(
ngx_rbåì_node_t
 **
roŸ
,

21 
ngx_rbåì_node_t
 *
£¡öñ
,Çgx_rbåì_node_à*
node
);

25 
	$ngx_rbåì_ö£π
(
ngx_thªad_vﬁ©ûe
 
ngx_rbåì_t
 *
åì
,

26 
ngx_rbåì_node_t
 *
node
)

28 
ngx_rbåì_node_t
 **
roŸ
, *
ãmp
, *
£¡öñ
;

32 
roŸ
 = (
ngx_rbåì_node_t
 **Ë&
åì
->root;

33 
£¡öñ
 = 
åì
->sentinel;

35 i‡(*
roŸ
 =
£¡öñ
) {

36 
node
->
∑ª¡
 = 
NULL
;

37 
node
->
À·
 = 
£¡öñ
;

38 
node
->
right
 = 
£¡öñ
;

39 
	`ngx_rbt_bœck
(
node
);

40 *
roŸ
 = 
node
;

45 
åì
->
	`ö£π
(*
roŸ
, 
node
, 
£¡öñ
);

49 
node
 !*
roŸ
 && 
	`ngx_rbt_is_ªd
“ode->
∑ª¡
)) {

51 i‡(
node
->
∑ª¡
 =node->∑ª¡->∑ª¡->
À·
) {

52 
ãmp
 = 
node
->
∑ª¡
->∑ª¡->
right
;

54 i‡(
	`ngx_rbt_is_ªd
(
ãmp
)) {

55 
	`ngx_rbt_bœck
(
node
->
∑ª¡
);

56 
	`ngx_rbt_bœck
(
ãmp
);

57 
	`ngx_rbt_ªd
(
node
->
∑ª¡
->parent);

58 
node
 =Çode->
∑ª¡
->parent;

61 i‡(
node
 =node->
∑ª¡
->
right
) {

62 
node
 =Çode->
∑ª¡
;

63 
	`ngx_rbåì_À·_rŸ©e
(
roŸ
, 
£¡öñ
, 
node
);

66 
	`ngx_rbt_bœck
(
node
->
∑ª¡
);

67 
	`ngx_rbt_ªd
(
node
->
∑ª¡
->parent);

68 
	`ngx_rbåì_right_rŸ©e
(
roŸ
, 
£¡öñ
, 
node
->
∑ª¡
->parent);

72 
ãmp
 = 
node
->
∑ª¡
->∑ª¡->
À·
;

74 i‡(
	`ngx_rbt_is_ªd
(
ãmp
)) {

75 
	`ngx_rbt_bœck
(
node
->
∑ª¡
);

76 
	`ngx_rbt_bœck
(
ãmp
);

77 
	`ngx_rbt_ªd
(
node
->
∑ª¡
->parent);

78 
node
 =Çode->
∑ª¡
->parent;

81 i‡(
node
 =node->
∑ª¡
->
À·
) {

82 
node
 =Çode->
∑ª¡
;

83 
	`ngx_rbåì_right_rŸ©e
(
roŸ
, 
£¡öñ
, 
node
);

86 
	`ngx_rbt_bœck
(
node
->
∑ª¡
);

87 
	`ngx_rbt_ªd
(
node
->
∑ª¡
->parent);

88 
	`ngx_rbåì_À·_rŸ©e
(
roŸ
, 
£¡öñ
, 
node
->
∑ª¡
->parent);

93 
	`ngx_rbt_bœck
(*
roŸ
);

94 
	}
}

98 
	$ngx_rbåì_ö£π_vÆue
(
ngx_rbåì_node_t
 *
ãmp
,Çgx_rbåì_node_à*
node
,

99 
ngx_rbåì_node_t
 *
£¡öñ
)

101 
ngx_rbåì_node_t
 **
p
;

105 
p
 = (
node
->
key
 < 
ãmp
->keyË? &ãmp->
À·
 : &ãmp->
right
;

107 i‡(*
p
 =
£¡öñ
) {

111 
ãmp
 = *
p
;

114 *
p
 = 
node
;

115 
node
->
∑ª¡
 = 
ãmp
;

116 
node
->
À·
 = 
£¡öñ
;

117 
node
->
right
 = 
£¡öñ
;

118 
	`ngx_rbt_ªd
(
node
);

119 
	}
}

123 
	$ngx_rbåì_ö£π_timî_vÆue
(
ngx_rbåì_node_t
 *
ãmp
,Çgx_rbåì_node_à*
node
,

124 
ngx_rbåì_node_t
 *
£¡öñ
)

126 
ngx_rbåì_node_t
 **
p
;

139 
p
 = ((
ngx_rbåì_key_öt_t
Ë
node
->
key
 - (ngx_rbåì_key_öt_tË
ãmp
->key

141 ? &
ãmp
->
À·
 : &ãmp->
right
;

143 i‡(*
p
 =
£¡öñ
) {

147 
ãmp
 = *
p
;

150 *
p
 = 
node
;

151 
node
->
∑ª¡
 = 
ãmp
;

152 
node
->
À·
 = 
£¡öñ
;

153 
node
->
right
 = 
£¡öñ
;

154 
	`ngx_rbt_ªd
(
node
);

155 
	}
}

159 
	$ngx_rbåì_dñëe
(
ngx_thªad_vﬁ©ûe
 
ngx_rbåì_t
 *
åì
,

160 
ngx_rbåì_node_t
 *
node
)

162 
ngx_uöt_t
 
ªd
;

163 
ngx_rbåì_node_t
 **
roŸ
, *
£¡öñ
, *
sub°
, *
ãmp
, *
w
;

167 
roŸ
 = (
ngx_rbåì_node_t
 **Ë&
åì
->root;

168 
£¡öñ
 = 
åì
->sentinel;

170 i‡(
node
->
À·
 =
£¡öñ
) {

171 
ãmp
 = 
node
->
right
;

172 
sub°
 = 
node
;

174 } i‡(
node
->
right
 =
£¡öñ
) {

175 
ãmp
 = 
node
->
À·
;

176 
sub°
 = 
node
;

179 
sub°
 = 
	`ngx_rbåì_mö
(
node
->
right
, 
£¡öñ
);

181 i‡(
sub°
->
À·
 !
£¡öñ
) {

182 
ãmp
 = 
sub°
->
À·
;

184 
ãmp
 = 
sub°
->
right
;

188 i‡(
sub°
 =*
roŸ
) {

189 *
roŸ
 = 
ãmp
;

190 
	`ngx_rbt_bœck
(
ãmp
);

193 
node
->
À·
 = 
NULL
;

194 
node
->
right
 = 
NULL
;

195 
node
->
∑ª¡
 = 
NULL
;

196 
node
->
key
 = 0;

201 
ªd
 = 
	`ngx_rbt_is_ªd
(
sub°
);

203 i‡(
sub°
 =sub°->
∑ª¡
->
À·
) {

204 
sub°
->
∑ª¡
->
À·
 = 
ãmp
;

207 
sub°
->
∑ª¡
->
right
 = 
ãmp
;

210 i‡(
sub°
 =
node
) {

212 
ãmp
->
∑ª¡
 = 
sub°
->parent;

216 i‡(
sub°
->
∑ª¡
 =
node
) {

217 
ãmp
->
∑ª¡
 = 
sub°
;

220 
ãmp
->
∑ª¡
 = 
sub°
->parent;

223 
sub°
->
À·
 = 
node
->left;

224 
sub°
->
right
 = 
node
->right;

225 
sub°
->
∑ª¡
 = 
node
->parent;

226 
	`ngx_rbt_c›y_cﬁ‹
(
sub°
, 
node
);

228 i‡(
node
 =*
roŸ
) {

229 *
roŸ
 = 
sub°
;

232 i‡(
node
 =node->
∑ª¡
->
À·
) {

233 
node
->
∑ª¡
->
À·
 = 
sub°
;

235 
node
->
∑ª¡
->
right
 = 
sub°
;

239 i‡(
sub°
->
À·
 !
£¡öñ
) {

240 
sub°
->
À·
->
∑ª¡
 = subst;

243 i‡(
sub°
->
right
 !
£¡öñ
) {

244 
sub°
->
right
->
∑ª¡
 = subst;

249 
node
->
À·
 = 
NULL
;

250 
node
->
right
 = 
NULL
;

251 
node
->
∑ª¡
 = 
NULL
;

252 
node
->
key
 = 0;

254 i‡(
ªd
) {

260 
ãmp
 !*
roŸ
 && 
	`ngx_rbt_is_bœck
(temp)) {

262 i‡(
ãmp
 =ãmp->
∑ª¡
->
À·
) {

263 
w
 = 
ãmp
->
∑ª¡
->
right
;

265 i‡(
	`ngx_rbt_is_ªd
(
w
)) {

266 
	`ngx_rbt_bœck
(
w
);

267 
	`ngx_rbt_ªd
(
ãmp
->
∑ª¡
);

268 
	`ngx_rbåì_À·_rŸ©e
(
roŸ
, 
£¡öñ
, 
ãmp
->
∑ª¡
);

269 
w
 = 
ãmp
->
∑ª¡
->
right
;

272 i‡(
	`ngx_rbt_is_bœck
(
w
->
À·
Ë&&Çgx_rbt_is_bœck(w->
right
)) {

273 
	`ngx_rbt_ªd
(
w
);

274 
ãmp
 =Åemp->
∑ª¡
;

277 i‡(
	`ngx_rbt_is_bœck
(
w
->
right
)) {

278 
	`ngx_rbt_bœck
(
w
->
À·
);

279 
	`ngx_rbt_ªd
(
w
);

280 
	`ngx_rbåì_right_rŸ©e
(
roŸ
, 
£¡öñ
, 
w
);

281 
w
 = 
ãmp
->
∑ª¡
->
right
;

284 
	`ngx_rbt_c›y_cﬁ‹
(
w
, 
ãmp
->
∑ª¡
);

285 
	`ngx_rbt_bœck
(
ãmp
->
∑ª¡
);

286 
	`ngx_rbt_bœck
(
w
->
right
);

287 
	`ngx_rbåì_À·_rŸ©e
(
roŸ
, 
£¡öñ
, 
ãmp
->
∑ª¡
);

288 
ãmp
 = *
roŸ
;

292 
w
 = 
ãmp
->
∑ª¡
->
À·
;

294 i‡(
	`ngx_rbt_is_ªd
(
w
)) {

295 
	`ngx_rbt_bœck
(
w
);

296 
	`ngx_rbt_ªd
(
ãmp
->
∑ª¡
);

297 
	`ngx_rbåì_right_rŸ©e
(
roŸ
, 
£¡öñ
, 
ãmp
->
∑ª¡
);

298 
w
 = 
ãmp
->
∑ª¡
->
À·
;

301 i‡(
	`ngx_rbt_is_bœck
(
w
->
À·
Ë&&Çgx_rbt_is_bœck(w->
right
)) {

302 
	`ngx_rbt_ªd
(
w
);

303 
ãmp
 =Åemp->
∑ª¡
;

306 i‡(
	`ngx_rbt_is_bœck
(
w
->
À·
)) {

307 
	`ngx_rbt_bœck
(
w
->
right
);

308 
	`ngx_rbt_ªd
(
w
);

309 
	`ngx_rbåì_À·_rŸ©e
(
roŸ
, 
£¡öñ
, 
w
);

310 
w
 = 
ãmp
->
∑ª¡
->
À·
;

313 
	`ngx_rbt_c›y_cﬁ‹
(
w
, 
ãmp
->
∑ª¡
);

314 
	`ngx_rbt_bœck
(
ãmp
->
∑ª¡
);

315 
	`ngx_rbt_bœck
(
w
->
À·
);

316 
	`ngx_rbåì_right_rŸ©e
(
roŸ
, 
£¡öñ
, 
ãmp
->
∑ª¡
);

317 
ãmp
 = *
roŸ
;

322 
	`ngx_rbt_bœck
(
ãmp
);

323 
	}
}

326 
ngx_ölöe
 

327 
	$ngx_rbåì_À·_rŸ©e
(
ngx_rbåì_node_t
 **
roŸ
,Çgx_rbåì_node_à*
£¡öñ
,

328 
ngx_rbåì_node_t
 *
node
)

330 
ngx_rbåì_node_t
 *
ãmp
;

332 
ãmp
 = 
node
->
right
;

333 
node
->
right
 = 
ãmp
->
À·
;

335 i‡(
ãmp
->
À·
 !
£¡öñ
) {

336 
ãmp
->
À·
->
∑ª¡
 = 
node
;

339 
ãmp
->
∑ª¡
 = 
node
->parent;

341 i‡(
node
 =*
roŸ
) {

342 *
roŸ
 = 
ãmp
;

344 } i‡(
node
 =node->
∑ª¡
->
À·
) {

345 
node
->
∑ª¡
->
À·
 = 
ãmp
;

348 
node
->
∑ª¡
->
right
 = 
ãmp
;

351 
ãmp
->
À·
 = 
node
;

352 
node
->
∑ª¡
 = 
ãmp
;

353 
	}
}

356 
ngx_ölöe
 

357 
	$ngx_rbåì_right_rŸ©e
(
ngx_rbåì_node_t
 **
roŸ
,Çgx_rbåì_node_à*
£¡öñ
,

358 
ngx_rbåì_node_t
 *
node
)

360 
ngx_rbåì_node_t
 *
ãmp
;

362 
ãmp
 = 
node
->
À·
;

363 
node
->
À·
 = 
ãmp
->
right
;

365 i‡(
ãmp
->
right
 !
£¡öñ
) {

366 
ãmp
->
right
->
∑ª¡
 = 
node
;

369 
ãmp
->
∑ª¡
 = 
node
->parent;

371 i‡(
node
 =*
roŸ
) {

372 *
roŸ
 = 
ãmp
;

374 } i‡(
node
 =node->
∑ª¡
->
right
) {

375 
node
->
∑ª¡
->
right
 = 
ãmp
;

378 
node
->
∑ª¡
->
À·
 = 
ãmp
;

381 
ãmp
->
right
 = 
node
;

382 
node
->
∑ª¡
 = 
ãmp
;

383 
	}
}

	@ngx_rbtree.h

8 #i‚de‡
_NGX_RBTREE_H_INCLUDED_


9 
	#_NGX_RBTREE_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 
ngx_uöt_t
 
	tngx_rbåì_key_t
;

17 
ngx_öt_t
 
	tngx_rbåì_key_öt_t
;

20 
ngx_rbåì_node_s
 
	tngx_rbåì_node_t
;

22 
	sngx_rbåì_node_s
 {

23 
ngx_rbåì_key_t
 
	mkey
;

24 
ngx_rbåì_node_t
 *
	mÀ·
;

25 
ngx_rbåì_node_t
 *
	mright
;

26 
ngx_rbåì_node_t
 *
	m∑ª¡
;

27 
u_ch¨
 
	mcﬁ‹
;

28 
u_ch¨
 
	md©a
;

32 
ngx_rbåì_s
 
	tngx_rbåì_t
;

34 (*
	tngx_rbåì_ö£π_±
Ë(
	tngx_rbåì_node_t
 *
	troŸ
,

35 
	tngx_rbåì_node_t
 *
	tnode
,Çgx_rbåì_node_à*
	t£¡öñ
);

37 
	sngx_rbåì_s
 {

38 
ngx_rbåì_node_t
 *
roŸ
;

39 
ngx_rbåì_node_t
 *
£¡öñ
;

40 
ngx_rbåì_ö£π_±
 
ö£π
;

44 
	#ngx_rbåì_öô
(
åì
, 
s
, 
i
) \

45 
	`ngx_rbåì_£¡öñ_öô
(
s
); \

46 (
åì
)->
roŸ
 = 
s
; \

47 (
åì
)->
£¡öñ
 = 
s
; \

48 (
åì
)->
ö£π
 = 
i


	)

51 
	`ngx_rbåì_ö£π
(
ngx_thªad_vﬁ©ûe
 
ngx_rbåì_t
 *
åì
,

52 
ngx_rbåì_node_t
 *
node
);

53 
	`ngx_rbåì_dñëe
(
ngx_thªad_vﬁ©ûe
 
ngx_rbåì_t
 *
åì
,

54 
ngx_rbåì_node_t
 *
node
);

55 
	`ngx_rbåì_ö£π_vÆue
(
ngx_rbåì_node_t
 *
roŸ
,Çgx_rbåì_node_à*
node
,

56 
ngx_rbåì_node_t
 *
£¡öñ
);

57 
	`ngx_rbåì_ö£π_timî_vÆue
(
ngx_rbåì_node_t
 *
roŸ
,

58 
ngx_rbåì_node_t
 *
node
,Çgx_rbåì_node_à*
£¡öñ
);

61 
	#ngx_rbt_ªd
(
node
Ë(“ode)->
cﬁ‹
 = 1)

	)

62 
	#ngx_rbt_bœck
(
node
Ë(“ode)->
cﬁ‹
 = 0)

	)

63 
	#ngx_rbt_is_ªd
(
node
Ë(“ode)->
cﬁ‹
)

	)

64 
	#ngx_rbt_is_bœck
(
node
Ë(!
	`ngx_rbt_is_ªd
“ode))

	)

65 
	#ngx_rbt_c›y_cﬁ‹
(
n1
, 
n2
Ë“1->
cﬁ‹
 =Ç2->cﬁ‹)

	)

70 
	#ngx_rbåì_£¡öñ_öô
(
node
Ë
	`ngx_rbt_bœck
“ode)

	)

73 
ngx_ölöe
 
ngx_rbåì_node_t
 *

74 
	$ngx_rbåì_mö
(
ngx_rbåì_node_t
 *
node
,Çgx_rbåì_node_à*
£¡öñ
)

76 
node
->
À·
 !
£¡öñ
) {

77 
node
 =Çode->
À·
;

80  
node
;

81 
	}
}

	@ngx_regex.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 * 
ngx_libc_cde˛
 
ngx_ªgex_mÆloc
(
size_t
 
size
);

13 
ngx_libc_cde˛
 
ngx_ªgex_‰ì
(*
p
);

16 
ngx_poﬁ_t
 *
	gngx_p¸e_poﬁ
;

20 
	$ngx_ªgex_öô
()

22 
p¸e_mÆloc
 = 
ngx_ªgex_mÆloc
;

23 
p¸e_‰ì
 = 
ngx_ªgex_‰ì
;

24 
	}
}

27 
ngx_ölöe
 

28 
	$ngx_ªgex_mÆloc_öô
(
ngx_poﬁ_t
 *
poﬁ
)

30 #i‡(
NGX_THREADS
)

31 
ngx_c‹e_és_t
 *
és
;

33 i‡(
ngx_thªaded
) {

34 
és
 = 
	`ngx_thªad_gë_és
(
ngx_c‹e_és_key
);

35 
és
->
poﬁ
 =Öool;

41 
ngx_p¸e_poﬁ
 = 
poﬁ
;

42 
	}
}

45 
ngx_ölöe
 

46 
	$ngx_ªgex_mÆloc_d⁄e
()

48 #i‡(
NGX_THREADS
)

49 
ngx_c‹e_és_t
 *
és
;

51 i‡(
ngx_thªaded
) {

52 
és
 = 
	`ngx_thªad_gë_és
(
ngx_c‹e_és_key
);

53 
és
->
poﬁ
 = 
NULL
;

59 
ngx_p¸e_poﬁ
 = 
NULL
;

60 
	}
}

63 
ngx_öt_t


64 
	$ngx_ªgex_compûe
(
ngx_ªgex_compûe_t
 *
rc
)

66 
n
, 
îroff
;

67 *
p
;

68 c⁄° *
îr°r
;

69 
ngx_ªgex_t
 *
ª
;

71 
	`ngx_ªgex_mÆloc_öô
(
rc
->
poﬁ
);

73 
ª
 = 
	`p¸e_compûe
((c⁄° *Ë
rc
->
∑âîn
.
d©a
, (Ërc->
›ti⁄s
,

74 &
îr°r
, &
îroff
, 
NULL
);

77 
	`ngx_ªgex_mÆloc_d⁄e
();

79 i‡(
ª
 =
NULL
) {

80 i‡((
size_t
Ë
îroff
 =
rc
->
∑âîn
.
Àn
) {

81 
rc
->
îr
.
Àn
 = 
	`ngx_¢¥ötf
‘c->îr.
d©a
,Ñc->err.len,

83 
îr°r
, &
rc
->
∑âîn
)

84 - 
rc
->
îr
.
d©a
;

87 
rc
->
îr
.
Àn
 = 
	`ngx_¢¥ötf
‘c->îr.
d©a
,Ñc->err.len,

89 
îr°r
, &
rc
->
∑âîn
,Ñc->∑âîn.
d©a
 + 
îroff
)

90 - 
rc
->
îr
.
d©a
;

93  
NGX_ERROR
;

96 
rc
->
ªgex
 = 
ª
;

98 
n
 = 
	`p¸e_fuŒöfo
(
ª
, 
NULL
, 
PCRE_INFO_CAPTURECOUNT
, &
rc
->
ˇ±uªs
);

99 i‡(
n
 < 0) {

100 
p
 = "pcre_fullinfo(\"%V\", PCRE_INFO_CAPTURECOUNT) failed: %d";

101 
Áûed
;

104 i‡(
rc
->
ˇ±uªs
 == 0) {

105  
NGX_OK
;

108 
n
 = 
	`p¸e_fuŒöfo
(
ª
, 
NULL
, 
PCRE_INFO_NAMECOUNT
, &
rc
->
«med_ˇ±uªs
);

109 i‡(
n
 < 0) {

110 
p
 = "pcre_fullinfo(\"%V\", PCRE_INFO_NAMECOUNT) failed: %d";

111 
Áûed
;

114 i‡(
rc
->
«med_ˇ±uªs
 == 0) {

115  
NGX_OK
;

118 
n
 = 
	`p¸e_fuŒöfo
(
ª
, 
NULL
, 
PCRE_INFO_NAMEENTRYSIZE
, &
rc
->
«me_size
);

119 i‡(
n
 < 0) {

120 
p
 = "pcre_fullinfo(\"%V\", PCRE_INFO_NAMEENTRYSIZE) failed: %d";

121 
Áûed
;

124 
n
 = 
	`p¸e_fuŒöfo
(
ª
, 
NULL
, 
PCRE_INFO_NAMETABLE
, &
rc
->
«mes
);

125 i‡(
n
 < 0) {

126 
p
 = "pcre_fullinfo(\"%V\", PCRE_INFO_NAMETABLE) failed: %d";

127 
Áûed
;

130  
NGX_OK
;

132 
Áûed
:

134 
rc
->
îr
.
Àn
 = 
	`ngx_¢¥ötf
‘c->îr.
d©a
,Ñc->îr.Àn, 
p
, &rc->
∑âîn
, 
n
)

135 - 
rc
->
îr
.
d©a
;

136  
NGX_OK
;

137 
	}
}

140 
ngx_öt_t


141 
	$ngx_ªgex_exec_¨øy
(
ngx_¨øy_t
 *
a
, 
ngx_°r_t
 *
s
, 
ngx_log_t
 *
log
)

143 
ngx_öt_t
 
n
;

144 
ngx_uöt_t
 
i
;

145 
ngx_ªgex_ñt_t
 *
ª
;

147 
ª
 = 
a
->
ñts
;

149 
i
 = 0; i < 
a
->
√…s
; i++) {

151 
n
 = 
	`ngx_ªgex_exec
(
ª
[
i
].
ªgex
, 
s
, 
NULL
, 0);

153 i‡(
n
 =
NGX_REGEX_NO_MATCHED
) {

157 i‡(
n
 < 0) {

158 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
log
, 0,

159 
ngx_ªgex_exec_n
 " failed: %i on \"%V\" using \"%s\"",

160 
n
, 
s
, 
ª
[
i
].
«me
);

161  
NGX_ERROR
;

166  
NGX_OK
;

169  
NGX_DECLINED
;

170 
	}
}

173 * 
ngx_libc_cde˛


174 
	$ngx_ªgex_mÆloc
(
size_t
 
size
)

176 
ngx_poﬁ_t
 *
poﬁ
;

177 #i‡(
NGX_THREADS
)

178 
ngx_c‹e_és_t
 *
és
;

180 i‡(
ngx_thªaded
) {

181 
és
 = 
	`ngx_thªad_gë_és
(
ngx_c‹e_és_key
);

182 
poﬁ
 = 
és
->pool;

185 
poﬁ
 = 
ngx_p¸e_poﬁ
;

190 
poﬁ
 = 
ngx_p¸e_poﬁ
;

194 i‡(
poﬁ
) {

195  
	`ngx_∑Œoc
(
poﬁ
, 
size
);

198  
NULL
;

199 
	}
}

202 
ngx_libc_cde˛


203 
	$ngx_ªgex_‰ì
(*
p
)

206 
	}
}

	@ngx_regex.h

8 #i‚de‡
_NGX_REGEX_H_INCLUDED_


9 
	#_NGX_REGEX_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

15 
	~<p¸e.h
>

18 
	#NGX_REGEX_NO_MATCHED
 
PCRE_ERROR_NOMATCH


	)

20 
	#NGX_REGEX_CASELESS
 
PCRE_CASELESS


	)

22 
p¸e
 
	tngx_ªgex_t
;

26 
ngx_°r_t
 
	m∑âîn
;

27 
ngx_poﬁ_t
 *
	mpoﬁ
;

28 
ngx_öt_t
 
	m›ti⁄s
;

30 
ngx_ªgex_t
 *
	mªgex
;

31 
	mˇ±uªs
;

32 
	m«med_ˇ±uªs
;

33 
	m«me_size
;

34 
u_ch¨
 *
	m«mes
;

35 
ngx_°r_t
 
	mîr
;

36 } 
	tngx_ªgex_compûe_t
;

40 
ngx_ªgex_t
 *
	mªgex
;

41 
u_ch¨
 *
	m«me
;

42 } 
	tngx_ªgex_ñt_t
;

45 
ngx_ªgex_öô
();

46 
ngx_öt_t
 
ngx_ªgex_compûe
(
ngx_ªgex_compûe_t
 *
rc
);

48 
	#ngx_ªgex_exec
(
ª
, 
s
, 
ˇ±uªs
, 
size
) \

49 
	`p¸e_exec
(
ª
, 
NULL
, (c⁄° *Ë(
s
)->
d©a
, (s)->
Àn
, 0, 0, \

50 
ˇ±uªs
, 
size
)

	)

51 
	#ngx_ªgex_exec_n
 "p¸e_exec()"

	)

53 
ngx_öt_t
 
ngx_ªgex_exec_¨øy
(
ngx_¨øy_t
 *
a
, 
ngx_°r_t
 *
s
, 
ngx_log_t
 *
log
);

	@ngx_resolver.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

10 
	~<ngx_evít.h
>

13 
	#NGX_RESOLVER_UDP_SIZE
 4096

	)

17 
u_ch¨
 
	midít_hi
;

18 
u_ch¨
 
	midít_lo
;

19 
u_ch¨
 
	mÊags_hi
;

20 
u_ch¨
 
	mÊags_lo
;

21 
u_ch¨
 
	mnqs_hi
;

22 
u_ch¨
 
	mnqs_lo
;

23 
u_ch¨
 
	m«n_hi
;

24 
u_ch¨
 
	m«n_lo
;

25 
u_ch¨
 
	m¬s_hi
;

26 
u_ch¨
 
	m¬s_lo
;

27 
u_ch¨
 
	m«r_hi
;

28 
u_ch¨
 
	m«r_lo
;

29 } 
	tngx_ªsﬁvî_quîy_t
;

33 
u_ch¨
 
	mty≥_hi
;

34 
u_ch¨
 
	mty≥_lo
;

35 
u_ch¨
 
	m˛ass_hi
;

36 
u_ch¨
 
	m˛ass_lo
;

37 } 
	tngx_ªsﬁvî_qs_t
;

41 
u_ch¨
 
	mty≥_hi
;

42 
u_ch¨
 
	mty≥_lo
;

43 
u_ch¨
 
	m˛ass_hi
;

44 
u_ch¨
 
	m˛ass_lo
;

45 
u_ch¨
 
	mâl
[4];

46 
u_ch¨
 
	mÀn_hi
;

47 
u_ch¨
 
	mÀn_lo
;

48 } 
	tngx_ªsﬁvî_™_t
;

51 
ngx_öt_t
 
ngx_udp_c⁄√˘
(
ngx_udp_c⁄√˘i⁄_t
 *
uc
);

54 
ngx_ªsﬁvî_˛ónup
(*
d©a
);

55 
ngx_ªsﬁvî_˛ónup_åì
(
ngx_ªsﬁvî_t
 *
r
, 
ngx_rbåì_t
 *
åì
);

56 
ngx_öt_t
 
ngx_ªsﬁve_«me_locked
(
ngx_ªsﬁvî_t
 *
r
,

57 
ngx_ªsﬁvî_˘x_t
 *
˘x
);

58 
ngx_ªsﬁvî_expúe
(
ngx_ªsﬁvî_t
 *
r
, 
ngx_rbåì_t
 *
åì
,

59 
ngx_queue_t
 *
queue
);

60 
ngx_öt_t
 
ngx_ªsﬁvî_£nd_quîy
(
ngx_ªsﬁvî_t
 *
r
,

61 
ngx_ªsﬁvî_node_t
 *
∫
);

62 
ngx_öt_t
 
ngx_ªsﬁvî_¸óã_«me_quîy
(
ngx_ªsﬁvî_node_t
 *
∫
,

63 
ngx_ªsﬁvî_˘x_t
 *
˘x
);

64 
ngx_öt_t
 
ngx_ªsﬁvî_¸óã_addr_quîy
(
ngx_ªsﬁvî_node_t
 *
∫
,

65 
ngx_ªsﬁvî_˘x_t
 *
˘x
);

66 
ngx_ªsﬁvî_ª£nd_h™dÀr
(
ngx_evít_t
 *
ev
);

67 
time_t
 
ngx_ªsﬁvî_ª£nd
(
ngx_ªsﬁvî_t
 *
r
, 
ngx_rbåì_t
 *
åì
,

68 
ngx_queue_t
 *
queue
);

69 
ngx_ªsﬁvî_ªad_ª•⁄£
(
ngx_evít_t
 *
ªv
);

70 
ngx_ªsﬁvî_¥o˚ss_ª•⁄£
(
ngx_ªsﬁvî_t
 *
r
, 
u_ch¨
 *
buf
,

71 
size_t
 
n
);

72 
ngx_ªsﬁvî_¥o˚ss_a
(
ngx_ªsﬁvî_t
 *
r
, 
u_ch¨
 *
buf
, 
size_t
 
n
,

73 
ngx_uöt_t
 
idít
,Çgx_uöt_à
code
,Çgx_uöt_à
«n
,Çgx_uöt_à
™s
);

74 
ngx_ªsﬁvî_¥o˚ss_±r
(
ngx_ªsﬁvî_t
 *
r
, 
u_ch¨
 *
buf
, 
size_t
 
n
,

75 
ngx_uöt_t
 
idít
,Çgx_uöt_à
code
,Çgx_uöt_à
«n
);

76 
ngx_ªsﬁvî_node_t
 *
ngx_ªsﬁvî_lookup_«me
(
ngx_ªsﬁvî_t
 *
r
,

77 
ngx_°r_t
 *
«me
, 
uöt32_t
 
hash
);

78 
ngx_ªsﬁvî_node_t
 *
ngx_ªsﬁvî_lookup_addr
(
ngx_ªsﬁvî_t
 *
r
,

79 
ö_addr_t
 
addr
);

80 
ngx_ªsﬁvî_rbåì_ö£π_vÆue
(
ngx_rbåì_node_t
 *
ãmp
,

81 
ngx_rbåì_node_t
 *
node
,Çgx_rbåì_node_à*
£¡öñ
);

82 
ngx_öt_t
 
ngx_ªsﬁvî_c›y
(
ngx_ªsﬁvî_t
 *
r
, 
ngx_°r_t
 *
«me
,

83 
u_ch¨
 *
buf
, u_ch¨ *
§c
, u_ch¨ *
œ°
);

84 
ngx_ªsﬁvî_timeout_h™dÀr
(
ngx_evít_t
 *
ev
);

85 
ngx_ªsﬁvî_‰ì_node
(
ngx_ªsﬁvî_t
 *
r
, 
ngx_ªsﬁvî_node_t
 *
∫
);

86 *
ngx_ªsﬁvî_Æloc
(
ngx_ªsﬁvî_t
 *
r
, 
size_t
 
size
);

87 *
ngx_ªsﬁvî_ˇŒoc
(
ngx_ªsﬁvî_t
 *
r
, 
size_t
 
size
);

88 
ngx_ªsﬁvî_‰ì
(
ngx_ªsﬁvî_t
 *
r
, *
p
);

89 
ngx_ªsﬁvî_‰ì_locked
(
ngx_ªsﬁvî_t
 *
r
, *
p
);

90 *
ngx_ªsﬁvî_dup
(
ngx_ªsﬁvî_t
 *
r
, *
§c
, 
size_t
 
size
);

91 
u_ch¨
 *
ngx_ªsﬁvî_log_îr‹
(
ngx_log_t
 *
log
, u_ch¨ *
buf
, 
size_t
 
Àn
);

94 
ngx_ªsﬁvî_t
 *

95 
	$ngx_ªsﬁvî_¸óã
(
ngx_c⁄f_t
 *
cf
, 
ngx_addr_t
 *
addr
)

97 
ngx_ªsﬁvî_t
 *
r
;

98 
ngx_poﬁ_˛ónup_t
 *
˛n
;

99 
ngx_udp_c⁄√˘i⁄_t
 *
uc
;

101 
˛n
 = 
	`ngx_poﬁ_˛ónup_add
(
cf
->
poﬁ
, 0);

102 i‡(
˛n
 =
NULL
) {

103  
NULL
;

106 
˛n
->
h™dÀr
 = 
ngx_ªsﬁvî_˛ónup
;

108 
r
 = 
	`ngx_ˇŒoc
((
ngx_ªsﬁvî_t
), 
cf
->
log
);

109 i‡(
r
 =
NULL
) {

110  
NULL
;

113 
˛n
->
d©a
 = 
r
;

115 
r
->
evít
 = 
	`ngx_ˇŒoc
((
ngx_evít_t
), 
cf
->
log
);

116 i‡(
r
->
evít
 =
NULL
) {

117  
NULL
;

120 
	`ngx_rbåì_öô
(&
r
->
«me_rbåì
, &r->
«me_£¡öñ
,

121 
ngx_ªsﬁvî_rbåì_ö£π_vÆue
);

123 
	`ngx_rbåì_öô
(&
r
->
addr_rbåì
, &r->
addr_£¡öñ
,

124 
ngx_rbåì_ö£π_vÆue
);

126 
	`ngx_queue_öô
(&
r
->
«me_ª£nd_queue
);

127 
	`ngx_queue_öô
(&
r
->
addr_ª£nd_queue
);

129 
	`ngx_queue_öô
(&
r
->
«me_expúe_queue
);

130 
	`ngx_queue_öô
(&
r
->
addr_expúe_queue
);

132 
r
->
evít
->
h™dÀr
 = 
ngx_ªsﬁvî_ª£nd_h™dÀr
;

133 
r
->
evít
->
d©a
 =Ñ;

134 
r
->
evít
->
log
 = &
cf
->
cy˛e
->
√w_log
;

135 
r
->
idít
 = -1;

137 
r
->
ª£nd_timeout
 = 5;

138 
r
->
expúe
 = 30;

139 
r
->
vÆid
 = 300;

141 
r
->
log
 = &
cf
->
cy˛e
->
√w_log
;

142 
r
->
log_Àvñ
 = 
NGX_LOG_ERR
;

144 i‡(
addr
) {

145 
uc
 = 
	`ngx_ˇŒoc
((
ngx_udp_c⁄√˘i⁄_t
), 
cf
->
log
);

146 i‡(
uc
 =
NULL
) {

147  
NULL
;

150 
r
->
udp_c⁄√˘i⁄
 = 
uc
;

152 
uc
->
sockaddr
 = 
addr
->sockaddr;

153 
uc
->
sockÀn
 = 
addr
->socklen;

154 
uc
->
£rvî
 = 
addr
->
«me
;

157  
r
;

158 
	}
}

162 
	$ngx_ªsﬁvî_˛ónup
(*
d©a
)

164 
ngx_ªsﬁvî_t
 *
r
 = 
d©a
;

166 i‡(
r
) {

167 
	`ngx_log_debug0
(
NGX_LOG_DEBUG_CORE
, 
ngx_cy˛e
->
log
, 0,

170 
	`ngx_ªsﬁvî_˛ónup_åì
(
r
, &r->
«me_rbåì
);

172 
	`ngx_ªsﬁvî_˛ónup_åì
(
r
, &r->
addr_rbåì
);

174 i‡(
r
->
evít
) {

175 
	`ngx_‰ì
(
r
->
evít
);

178 i‡(
r
->
udp_c⁄√˘i⁄
) {

179 i‡(
r
->
udp_c⁄√˘i⁄
->
c⁄√˘i⁄
) {

180 
	`ngx_˛o£_c⁄√˘i⁄
(
r
->
udp_c⁄√˘i⁄
->
c⁄√˘i⁄
);

183 
	`ngx_‰ì
(
r
->
udp_c⁄√˘i⁄
);

186 
	`ngx_‰ì
(
r
);

188 
	}
}

192 
	$ngx_ªsﬁvî_˛ónup_åì
(
ngx_ªsﬁvî_t
 *
r
, 
ngx_rbåì_t
 *
åì
)

194 
ngx_ªsﬁvî_˘x_t
 *
˘x
, *
√xt
;

195 
ngx_ªsﬁvî_node_t
 *
∫
;

197 
åì
->
roŸ
 !åì->
£¡öñ
) {

199 
∫
 = (
ngx_ªsﬁvî_node_t
 *Ë
	`ngx_rbåì_mö
(
åì
->
roŸ
,Åªe->
£¡öñ
);

201 
	`ngx_queue_ªmove
(&
∫
->
queue
);

203 
˘x
 = 
∫
->
waôög
; ctx; ctx = 
√xt
) {

204 
√xt
 = 
˘x
->next;

206 i‡(
˘x
->
evít
) {

207 
	`ngx_ªsﬁvî_‰ì
(
r
, 
˘x
->
evít
);

210 
	`ngx_ªsﬁvî_‰ì
(
r
, 
˘x
);

213 
	`ngx_rbåì_dñëe
(
åì
, &
∫
->
node
);

215 
	`ngx_ªsﬁvî_‰ì_node
(
r
, 
∫
);

217 
	}
}

220 
ngx_ªsﬁvî_˘x_t
 *

221 
	$ngx_ªsﬁve_°¨t
(
ngx_ªsﬁvî_t
 *
r
, 
ngx_ªsﬁvî_˘x_t
 *
ãmp
)

223 
ö_addr_t
 
addr
;

224 
ngx_ªsﬁvî_˘x_t
 *
˘x
;

226 i‡(
ãmp
) {

227 
addr
 = 
	`ngx_öë_addr
(
ãmp
->
«me
.
d©a
,Åemp->«me.
Àn
);

229 i‡(
addr
 !
INADDR_NONE
) {

230 
ãmp
->
ªsﬁvî
 = 
r
;

231 
ãmp
->
°©e
 = 
NGX_OK
;

232 
ãmp
->
«ddrs
 = 1;

233 
ãmp
->
addrs
 = &ãmp->
addr
;

234 
ãmp
->
addr
 =áddr;

235 
ãmp
->
quick
 = 1;

237  
ãmp
;

241 i‡(
r
->
udp_c⁄√˘i⁄
 =
NULL
) {

242  
NGX_NO_RESOLVER
;

245 
˘x
 = 
	`ngx_ªsﬁvî_ˇŒoc
(
r
, (
ngx_ªsﬁvî_˘x_t
));

247 i‡(
˘x
) {

248 
˘x
->
ªsﬁvî
 = 
r
;

251  
˘x
;

252 
	}
}

255 
ngx_öt_t


256 
	$ngx_ªsﬁve_«me
(
ngx_ªsﬁvî_˘x_t
 *
˘x
)

258 
ngx_öt_t
 
rc
;

259 
ngx_ªsﬁvî_t
 *
r
;

261 
r
 = 
˘x
->
ªsﬁvî
;

263 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0,

264 "ªsﬁve: \"%V\"", &
˘x
->
«me
);

266 i‡(
˘x
->
quick
) {

267 
˘x
->
	`h™dÀr
(ctx);

268  
NGX_OK
;

273 
rc
 = 
	`ngx_ªsﬁve_«me_locked
(
r
, 
˘x
);

275 i‡(
rc
 =
NGX_OK
) {

276  
NGX_OK
;

281 i‡(
rc
 =
NGX_AGAIN
) {

282  
NGX_OK
;

287 i‡(
˘x
->
evít
) {

288 
	`ngx_ªsﬁvî_‰ì
(
r
, 
˘x
->
evít
);

291 
	`ngx_ªsﬁvî_‰ì
(
r
, 
˘x
);

293  
NGX_ERROR
;

294 
	}
}

298 
	$ngx_ªsﬁve_«me_d⁄e
(
ngx_ªsﬁvî_˘x_t
 *
˘x
)

300 
uöt32_t
 
hash
;

301 
ngx_ªsﬁvî_t
 *
r
;

302 
ngx_ªsﬁvî_˘x_t
 *
w
, **
p
;

303 
ngx_ªsﬁvî_node_t
 *
∫
;

305 
r
 = 
˘x
->
ªsﬁvî
;

307 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0,

308 "ªsﬁvê«mêd⁄e: %i", 
˘x
->
°©e
);

310 i‡(
˘x
->
quick
) {

314 i‡(
˘x
->
evít
 && ctx->evít->
timî_£t
) {

315 
	`ngx_dñ_timî
(
˘x
->
evít
);

320 i‡(
˘x
->
°©e
 =
NGX_AGAIN
 || ctx->°©ê=
NGX_RESOLVE_TIMEDOUT
) {

322 
hash
 = 
	`ngx_¸c32_sh‹t
(
˘x
->
«me
.
d©a
, ctx->«me.
Àn
);

324 
∫
 = 
	`ngx_ªsﬁvî_lookup_«me
(
r
, &
˘x
->
«me
, 
hash
);

326 i‡(
∫
) {

327 
p
 = &
∫
->
waôög
;

328 
w
 = 
∫
->
waôög
;

330 
w
) {

331 i‡(
w
 =
˘x
) {

332 *
p
 = 
w
->
√xt
;

334 
d⁄e
;

337 
p
 = &
w
->
√xt
;

338 
w
 = w->
√xt
;

342 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
r
->
log
, 0,

343 "couldÇŸ c™˚»%VÑesﬁvög", &
˘x
->
«me
);

346 
d⁄e
:

348 
	`ngx_ªsﬁvî_expúe
(
r
, &r->
«me_rbåì
, &r->
«me_expúe_queue
);

354 i‡(
˘x
->
evít
) {

355 
	`ngx_ªsﬁvî_‰ì_locked
(
r
, 
˘x
->
evít
);

358 
	`ngx_ªsﬁvî_‰ì_locked
(
r
, 
˘x
);

361 
	}
}

366 
ngx_öt_t


367 
	$ngx_ªsﬁve_«me_locked
(
ngx_ªsﬁvî_t
 *
r
, 
ngx_ªsﬁvî_˘x_t
 *
˘x
)

369 
uöt32_t
 
hash
;

370 
ö_addr_t
 
addr
, *
addrs
;

371 
ngx_öt_t
 
rc
;

372 
ngx_uöt_t
 
«ddrs
;

373 
ngx_ªsﬁvî_˘x_t
 *
√xt
;

374 
ngx_ªsﬁvî_node_t
 *
∫
;

376 
hash
 = 
	`ngx_¸c32_sh‹t
(
˘x
->
«me
.
d©a
, ctx->«me.
Àn
);

378 
∫
 = 
	`ngx_ªsﬁvî_lookup_«me
(
r
, &
˘x
->
«me
, 
hash
);

380 i‡(
∫
) {

382 i‡(
∫
->
vÆid
 >
	`ngx_time
()) {

384 
	`ngx_log_debug0
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0, "resolve cached");

386 
	`ngx_queue_ªmove
(&
∫
->
queue
);

388 
∫
->
expúe
 = 
	`ngx_time
(Ë+ 
r
->expire;

390 
	`ngx_queue_ö£π_hód
(&
r
->
«me_expúe_queue
, &
∫
->
queue
);

392 
«ddrs
 = 
∫
->naddrs;

394 i‡(
«ddrs
) {

398 i‡(
«ddrs
 != 1) {

399 
addr
 = 0;

400 
addrs
 = 
	`ngx_ªsﬁvî_dup
(
r
, 
∫
->
u
.addrs,

401 
«ddrs
 * (
ö_addr_t
));

402 i‡(
addrs
 =
NULL
) {

403  
NGX_ERROR
;

407 
addr
 = 
∫
->
u
.addr;

408 
addrs
 = 
NULL
;

411 
˘x
->
√xt
 = 
∫
->
waôög
;

412 
∫
->
waôög
 = 
NULL
;

417 
˘x
->
°©e
 = 
NGX_OK
;

418 
˘x
->
«ddrs
 =Çaddrs;

419 
˘x
->
addrs
 = (
«ddrs
 =1Ë? &˘x->
addr
 :áddrs;

420 
˘x
->
addr
 =áddr;

421 
√xt
 = 
˘x
->next;

423 
˘x
->
	`h™dÀr
(ctx);

425 
˘x
 = 
√xt
;

426 } 
˘x
);

428 i‡(
addrs
) {

429 
	`ngx_ªsﬁvî_‰ì
(
r
, 
addrs
);

432  
NGX_OK
;

437 i‡(
˘x
->
ªcursi⁄
++ < 
NGX_RESOLVER_MAX_RECURSION
) {

439 
˘x
->
«me
.
Àn
 = 
∫
->
˙Àn
;

440 
˘x
->
«me
.
d©a
 = 
∫
->
u
.
˙ame
;

442  
	`ngx_ªsﬁve_«me_locked
(
r
, 
˘x
);

445 
˘x
->
√xt
 = 
∫
->
waôög
;

446 
∫
->
waôög
 = 
NULL
;

451 
˘x
->
°©e
 = 
NGX_RESOLVE_NXDOMAIN
;

452 
√xt
 = 
˘x
->next;

454 
˘x
->
	`h™dÀr
(ctx);

456 
˘x
 = 
√xt
;

457 } 
˘x
);

459  
NGX_OK
;

462 i‡(
∫
->
waôög
) {

464 
˘x
->
√xt
 = 
∫
->
waôög
;

465 
∫
->
waôög
 = 
˘x
;

466 
˘x
->
°©e
 = 
NGX_AGAIN
;

468  
NGX_AGAIN
;

471 
	`ngx_queue_ªmove
(&
∫
->
queue
);

475 
	`ngx_ªsﬁvî_‰ì_locked
(
r
, 
∫
->
quîy
);

476 
∫
->
quîy
 = 
NULL
;

478 i‡(
∫
->
˙Àn
) {

479 
	`ngx_ªsﬁvî_‰ì_locked
(
r
, 
∫
->
u
.
˙ame
);

482 i‡(
∫
->
«ddrs
 > 1) {

483 
	`ngx_ªsﬁvî_‰ì_locked
(
r
, 
∫
->
u
.
addrs
);

490 
∫
 = 
	`ngx_ªsﬁvî_Æloc
(
r
, (
ngx_ªsﬁvî_node_t
));

491 i‡(
∫
 =
NULL
) {

492  
NGX_ERROR
;

495 
∫
->
«me
 = 
	`ngx_ªsﬁvî_dup
(
r
, 
˘x
->«me.
d©a
, ctx->«me.
Àn
);

496 i‡(
∫
->
«me
 =
NULL
) {

497 
	`ngx_ªsﬁvî_‰ì
(
r
, 
∫
);

498  
NGX_ERROR
;

501 
∫
->
node
.
key
 = 
hash
;

502 
∫
->
∆í
 = (
u_sh‹t
Ë
˘x
->
«me
.
Àn
;

503 
∫
->
quîy
 = 
NULL
;

505 
	`ngx_rbåì_ö£π
(&
r
->
«me_rbåì
, &
∫
->
node
);

508 
rc
 = 
	`ngx_ªsﬁvî_¸óã_«me_quîy
(
∫
, 
˘x
);

510 i‡(
rc
 =
NGX_ERROR
) {

511 
Áûed
;

514 i‡(
rc
 =
NGX_DECLINED
) {

515 
	`ngx_rbåì_dñëe
(&
r
->
«me_rbåì
, &
∫
->
node
);

517 
	`ngx_ªsﬁvî_‰ì
(
r
, 
∫
->
quîy
);

518 
	`ngx_ªsﬁvî_‰ì
(
r
, 
∫
->
«me
);

519 
	`ngx_ªsﬁvî_‰ì
(
r
, 
∫
);

521 
˘x
->
°©e
 = 
NGX_RESOLVE_NXDOMAIN
;

522 
˘x
->
	`h™dÀr
(ctx);

524  
NGX_OK
;

527 i‡(
	`ngx_ªsﬁvî_£nd_quîy
(
r
, 
∫
Ë!
NGX_OK
) {

528 
Áûed
;

531 i‡(
˘x
->
evít
 =
NULL
) {

532 
˘x
->
evít
 = 
	`ngx_ªsﬁvî_ˇŒoc
(
r
, (
ngx_evít_t
));

533 i‡(
˘x
->
evít
 =
NULL
) {

534 
Áûed
;

537 
˘x
->
evít
->
h™dÀr
 = 
ngx_ªsﬁvî_timeout_h™dÀr
;

538 
˘x
->
evít
->
d©a
 = ctx;

539 
˘x
->
evít
->
log
 = 
r
->log;

540 
˘x
->
idít
 = -1;

542 
	`ngx_add_timî
(
˘x
->
evít
, ctx->
timeout
);

545 i‡(
	`ngx_queue_em±y
(&
r
->
«me_ª£nd_queue
)) {

546 
	`ngx_add_timî
(
r
->
evít
, (
ngx_m£c_t
Ë‘->
ª£nd_timeout
 * 1000));

549 
∫
->
expúe
 = 
	`ngx_time
(Ë+ 
r
->
ª£nd_timeout
;

551 
	`ngx_queue_ö£π_hód
(&
r
->
«me_ª£nd_queue
, &
∫
->
queue
);

553 
∫
->
˙Àn
 = 0;

554 
∫
->
«ddrs
 = 0;

555 
∫
->
vÆid
 = 0;

556 
∫
->
waôög
 = 
˘x
;

558 
˘x
->
°©e
 = 
NGX_AGAIN
;

560  
NGX_AGAIN
;

562 
Áûed
:

564 
	`ngx_rbåì_dñëe
(&
r
->
«me_rbåì
, &
∫
->
node
);

566 i‡(
∫
->
quîy
) {

567 
	`ngx_ªsﬁvî_‰ì
(
r
, 
∫
->
quîy
);

570 
	`ngx_ªsﬁvî_‰ì
(
r
, 
∫
->
«me
);

572 
	`ngx_ªsﬁvî_‰ì
(
r
, 
∫
);

574  
NGX_ERROR
;

575 
	}
}

578 
ngx_öt_t


579 
	$ngx_ªsﬁve_addr
(
ngx_ªsﬁvî_˘x_t
 *
˘x
)

581 
u_ch¨
 *
«me
;

582 
ngx_ªsﬁvî_t
 *
r
;

583 
ngx_ªsﬁvî_node_t
 *
∫
;

585 
r
 = 
˘x
->
ªsﬁvî
;

587 
˘x
->
addr
 = 
	`¡ohl
(ctx->addr);

591 
∫
 = 
	`ngx_ªsﬁvî_lookup_addr
(
r
, 
˘x
->
addr
);

593 i‡(
∫
) {

595 i‡(
∫
->
vÆid
 >
	`ngx_time
()) {

597 
	`ngx_log_debug0
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0, "resolve cached");

599 
	`ngx_queue_ªmove
(&
∫
->
queue
);

601 
∫
->
expúe
 = 
	`ngx_time
(Ë+ 
r
->expire;

603 
	`ngx_queue_ö£π_hód
(&
r
->
addr_expúe_queue
, &
∫
->
queue
);

605 
«me
 = 
	`ngx_ªsﬁvî_dup
(
r
, 
∫
->«me,Ñn->
∆í
);

606 i‡(
«me
 =
NULL
) {

607 
Áûed
;

610 
˘x
->
«me
.
Àn
 = 
∫
->
∆í
;

611 
˘x
->
«me
.
d©a
 =Çame;

615 
˘x
->
°©e
 = 
NGX_OK
;

617 
˘x
->
	`h™dÀr
(ctx);

619 
	`ngx_ªsﬁvî_‰ì
(
r
, 
«me
);

621  
NGX_OK
;

624 i‡(
∫
->
waôög
) {

626 
˘x
->
√xt
 = 
∫
->
waôög
;

627 
∫
->
waôög
 = 
˘x
;

628 
˘x
->
°©e
 = 
NGX_AGAIN
;

632  
NGX_OK
;

635 
	`ngx_queue_ªmove
(&
∫
->
queue
);

637 
	`ngx_ªsﬁvî_‰ì
(
r
, 
∫
->
quîy
);

638 
∫
->
quîy
 = 
NULL
;

641 
∫
 = 
	`ngx_ªsﬁvî_Æloc
(
r
, (
ngx_ªsﬁvî_node_t
));

642 i‡(
∫
 =
NULL
) {

643 
Áûed
;

646 
∫
->
node
.
key
 = 
˘x
->
addr
;

647 
∫
->
quîy
 = 
NULL
;

649 
	`ngx_rbåì_ö£π
(&
r
->
addr_rbåì
, &
∫
->
node
);

652 i‡(
	`ngx_ªsﬁvî_¸óã_addr_quîy
(
∫
, 
˘x
Ë!
NGX_OK
) {

653 
Áûed
;

656 i‡(
	`ngx_ªsﬁvî_£nd_quîy
(
r
, 
∫
Ë!
NGX_OK
) {

657 
Áûed
;

660 
˘x
->
evít
 = 
	`ngx_ªsﬁvî_ˇŒoc
(
r
, (
ngx_evít_t
));

661 i‡(
˘x
->
evít
 =
NULL
) {

662 
Áûed
;

665 
˘x
->
evít
->
h™dÀr
 = 
ngx_ªsﬁvî_timeout_h™dÀr
;

666 
˘x
->
evít
->
d©a
 = ctx;

667 
˘x
->
evít
->
log
 = 
r
->log;

668 
˘x
->
idít
 = -1;

670 
	`ngx_add_timî
(
˘x
->
evít
, ctx->
timeout
);

672 i‡(
	`ngx_queue_em±y
(&
r
->
addr_ª£nd_queue
)) {

673 
	`ngx_add_timî
(
r
->
evít
, (
ngx_m£c_t
Ë‘->
ª£nd_timeout
 * 1000));

676 
∫
->
expúe
 = 
	`ngx_time
(Ë+ 
r
->
ª£nd_timeout
;

678 
	`ngx_queue_ö£π_hód
(&
r
->
addr_ª£nd_queue
, &
∫
->
queue
);

680 
∫
->
˙Àn
 = 0;

681 
∫
->
«ddrs
 = 0;

682 
∫
->
«me
 = 
NULL
;

683 
∫
->
∆í
 = 0;

684 
∫
->
vÆid
 = 0;

685 
∫
->
waôög
 = 
˘x
;

689 
˘x
->
°©e
 = 
NGX_AGAIN
;

691  
NGX_OK
;

693 
Áûed
:

695 i‡(
∫
) {

696 
	`ngx_rbåì_dñëe
(&
r
->
addr_rbåì
, &
∫
->
node
);

698 i‡(
∫
->
quîy
) {

699 
	`ngx_ªsﬁvî_‰ì
(
r
, 
∫
->
quîy
);

702 
	`ngx_ªsﬁvî_‰ì
(
r
, 
∫
);

707 i‡(
˘x
->
evít
) {

708 
	`ngx_ªsﬁvî_‰ì
(
r
, 
˘x
->
evít
);

711 
	`ngx_ªsﬁvî_‰ì
(
r
, 
˘x
);

713  
NGX_ERROR
;

714 
	}
}

718 
	$ngx_ªsﬁve_addr_d⁄e
(
ngx_ªsﬁvî_˘x_t
 *
˘x
)

720 
ö_addr_t
 
addr
;

721 
ngx_ªsﬁvî_t
 *
r
;

722 
ngx_ªsﬁvî_˘x_t
 *
w
, **
p
;

723 
ngx_ªsﬁvî_node_t
 *
∫
;

725 
r
 = 
˘x
->
ªsﬁvî
;

727 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0,

728 "ªsﬁvêadd∏d⁄e: %i", 
˘x
->
°©e
);

730 i‡(
˘x
->
evít
 && ctx->evít->
timî_£t
) {

731 
	`ngx_dñ_timî
(
˘x
->
evít
);

736 i‡(
˘x
->
°©e
 =
NGX_AGAIN
 || ctx->°©ê=
NGX_RESOLVE_TIMEDOUT
) {

738 
∫
 = 
	`ngx_ªsﬁvî_lookup_addr
(
r
, 
˘x
->
addr
);

740 i‡(
∫
) {

741 
p
 = &
∫
->
waôög
;

742 
w
 = 
∫
->
waôög
;

744 
w
) {

745 i‡(
w
 =
˘x
) {

746 *
p
 = 
w
->
√xt
;

748 
d⁄e
;

751 
p
 = &
w
->
√xt
;

752 
w
 = w->
√xt
;

756 
addr
 = 
	`¡ohl
(
˘x
->addr);

758 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
r
->
log
, 0,

760 (
addr
 >> 24) & 0xff, (addr >> 16) & 0xff,

761 (
addr
 >> 8) & 0xff,áddr & 0xff);

764 
d⁄e
:

766 
	`ngx_ªsﬁvî_expúe
(
r
, &r->
addr_rbåì
, &r->
addr_expúe_queue
);

772 i‡(
˘x
->
evít
) {

773 
	`ngx_ªsﬁvî_‰ì_locked
(
r
, 
˘x
->
evít
);

776 
	`ngx_ªsﬁvî_‰ì_locked
(
r
, 
˘x
);

779 
	}
}

783 
	$ngx_ªsﬁvî_expúe
(
ngx_ªsﬁvî_t
 *
r
, 
ngx_rbåì_t
 *
åì
, 
ngx_queue_t
 *
queue
)

785 
time_t
 
now
;

786 
ngx_uöt_t
 
i
;

787 
ngx_queue_t
 *
q
;

788 
ngx_ªsﬁvî_node_t
 *
∫
;

790 
	`ngx_log_debug0
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0, "resolverÉxpire");

792 
now
 = 
	`ngx_time
();

794 
i
 = 0; i < 2; i++) {

795 i‡(
	`ngx_queue_em±y
(
queue
)) {

799 
q
 = 
	`ngx_queue_œ°
(
queue
);

801 
∫
 = 
	`ngx_queue_d©a
(
q
, 
ngx_ªsﬁvî_node_t
, 
queue
);

803 i‡(
now
 <
∫
->
expúe
) {

807 
	`ngx_log_debug2
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0,

808 "ªsﬁvîÉxpúê\"%*s\"", (
size_t
Ë
∫
->
∆í
,Ñn->
«me
);

810 
	`ngx_queue_ªmove
(
q
);

812 
	`ngx_rbåì_dñëe
(
åì
, &
∫
->
node
);

814 
	`ngx_ªsﬁvî_‰ì_node
(
r
, 
∫
);

816 
	}
}

819 
ngx_öt_t


820 
	$ngx_ªsﬁvî_£nd_quîy
(
ngx_ªsﬁvî_t
 *
r
, 
ngx_ªsﬁvî_node_t
 *
∫
)

822 
ssize_t
 
n
;

823 
ngx_udp_c⁄√˘i⁄_t
 *
uc
;

825 
uc
 = 
r
->
udp_c⁄√˘i⁄
;

827 i‡(
uc
->
c⁄√˘i⁄
 =
NULL
) {

829 
uc
->
log
 = *
r
->log;

830 
uc
->
log
.
h™dÀr
 = 
ngx_ªsﬁvî_log_îr‹
;

831 
uc
->
log
.
d©a
 = uc;

832 
uc
->
log
.
a˘i⁄
 = "resolving";

834 i‡(
	`ngx_udp_c⁄√˘
(
uc
Ë!
NGX_OK
) {

835  
NGX_ERROR
;

838 
uc
->
c⁄√˘i⁄
->
d©a
 = 
r
;

839 
uc
->
c⁄√˘i⁄
->
ªad
->
h™dÀr
 = 
ngx_ªsﬁvî_ªad_ª•⁄£
;

840 
uc
->
c⁄√˘i⁄
->
ªad
->
ªsﬁvî
 = 1;

843 
n
 = 
	`ngx_£nd
(
uc
->
c⁄√˘i⁄
, 
∫
->
quîy
,Ñn->
qÀn
);

845 i‡(
n
 == -1) {

846  
NGX_ERROR
;

849 i‡((
size_t
Ë
n
 !(size_tË
∫
->
qÀn
) {

850 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, &
uc
->
log
, 0, "send() incomplete");

851  
NGX_ERROR
;

854  
NGX_OK
;

855 
	}
}

859 
	$ngx_ªsﬁvî_ª£nd_h™dÀr
(
ngx_evít_t
 *
ev
)

861 
time_t
 
timî
, 
©imî
, 
¡imî
;

862 
ngx_ªsﬁvî_t
 *
r
;

864 
r
 = 
ev
->
d©a
;

866 
	`ngx_log_debug0
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0,

871 
¡imî
 = 
	`ngx_ªsﬁvî_ª£nd
(
r
, &r->
«me_rbåì
, &r->
«me_ª£nd_queue
);

877 
©imî
 = 
	`ngx_ªsﬁvî_ª£nd
(
r
, &r->
addr_rbåì
, &r->
addr_ª£nd_queue
);

881 i‡(
¡imî
 == 0) {

882 
timî
 = 
©imî
;

884 } i‡(
©imî
 == 0) {

885 
timî
 = 
¡imî
;

888 
timî
 = (
©imî
 < 
¡imî
) ?átimer :Çtimer;

891 i‡(
timî
) {

892 
	`ngx_add_timî
(
r
->
evít
, (
ngx_m£c_t
Ë(
timî
 * 1000));

894 
	}
}

897 
time_t


898 
	$ngx_ªsﬁvî_ª£nd
(
ngx_ªsﬁvî_t
 *
r
, 
ngx_rbåì_t
 *
åì
, 
ngx_queue_t
 *
queue
)

900 
time_t
 
now
;

901 
ngx_queue_t
 *
q
;

902 
ngx_ªsﬁvî_node_t
 *
∫
;

904 
now
 = 
	`ngx_time
();

907 i‡(
	`ngx_queue_em±y
(
queue
)) {

911 
q
 = 
	`ngx_queue_œ°
(
queue
);

913 
∫
 = 
	`ngx_queue_d©a
(
q
, 
ngx_ªsﬁvî_node_t
, 
queue
);

915 i‡(
now
 < 
∫
->
expúe
) {

916  
∫
->
expúe
 - 
now
;

919 
	`ngx_log_debug3
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0,

921 (
size_t
Ë
∫
->
∆í
,Ñn->
«me
,Ñn->
waôög
);

923 
	`ngx_queue_ªmove
(
q
);

925 i‡(
∫
->
waôög
) {

927 i‡(
	`ngx_ªsﬁvî_£nd_quîy
(
r
, 
∫
Ë=
NGX_OK
) {

929 
∫
->
expúe
 = 
now
 + 
r
->
ª£nd_timeout
;

931 
	`ngx_queue_ö£π_hód
(
queue
, &
∫
->queue);

937 
	`ngx_rbåì_dñëe
(
åì
, &
∫
->
node
);

939 
	`ngx_ªsﬁvî_‰ì_node
(
r
, 
∫
);

941 
	}
}

945 
	$ngx_ªsﬁvî_ªad_ª•⁄£
(
ngx_evít_t
 *
ªv
)

947 
ssize_t
 
n
;

948 
ngx_c⁄√˘i⁄_t
 *
c
;

949 
u_ch¨
 
buf
[
NGX_RESOLVER_UDP_SIZE
];

951 
c
 = 
ªv
->
d©a
;

954 
n
 = 
	`ngx_udp_ªcv
(
c
, 
buf
, 
NGX_RESOLVER_UDP_SIZE
);

956 i‡(
n
 < 0) {

960 
	`ngx_ªsﬁvî_¥o˚ss_ª•⁄£
(
c
->
d©a
, 
buf
, 
n
);

962 } 
ªv
->
ªady
);

963 
	}
}

967 
	$ngx_ªsﬁvî_¥o˚ss_ª•⁄£
(
ngx_ªsﬁvî_t
 *
r
, 
u_ch¨
 *
buf
, 
size_t
 
n
)

969 *
îr
;

970 
size_t
 
Àn
;

971 
ngx_uöt_t
 
i
, 
times
, 
idít
, 
qidít
, 
Êags
, 
code
, 
nqs
, 
«n
,

972 
qty≥
, 
q˛ass
;

973 
ngx_queue_t
 *
q
;

974 
ngx_ªsﬁvî_qs_t
 *
qs
;

975 
ngx_ªsﬁvî_node_t
 *
∫
;

976 
ngx_ªsﬁvî_quîy_t
 *
quîy
;

978 i‡((
size_t
Ë
n
 < (
ngx_ªsﬁvî_quîy_t
)) {

979 
sh‹t_ª•⁄£
;

982 
quîy
 = (
ngx_ªsﬁvî_quîy_t
 *Ë
buf
;

984 
idít
 = (
quîy
->
idít_hi
 << 8Ë+ quîy->
idít_lo
;

985 
Êags
 = (
quîy
->
Êags_hi
 << 8Ë+ quîy->
Êags_lo
;

986 
nqs
 = (
quîy
->
nqs_hi
 << 8Ë+ quîy->
nqs_lo
;

987 
«n
 = (
quîy
->
«n_hi
 << 8Ë+ quîy->
«n_lo
;

989 
	`ngx_log_debug6
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0,

991 
idít
, 
Êags
, 
nqs
, 
«n
,

992 (
quîy
->
¬s_hi
 << 8Ë+ quîy->
¬s_lo
,

993 (
quîy
->
«r_hi
 << 8Ë+ quîy->
«r_lo
);

995 i‡(!(
Êags
 & 0x8000)) {

996 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0,

997 "övÆid DNSÑe•⁄£ %uòÊ:%04Xui", 
idít
, 
Êags
);

1001 
code
 = 
Êags
 & 0x7f;

1003 i‡(
code
 =
NGX_RESOLVE_FORMERR
) {

1005 
times
 = 0;

1007 
q
 = 
	`ngx_queue_hód
(&
r
->
«me_ª£nd_queue
);

1008 
q
 !
	`ngx_queue_£¡öñ
(&
r
->
«me_ª£nd_queue
Ë|| 
times
++ < 100;

1009 
q
 = 
	`ngx_queue_√xt
(q))

1011 
∫
 = 
	`ngx_queue_d©a
(
q
, 
ngx_ªsﬁvî_node_t
, 
queue
);

1012 
qidít
 = (
∫
->
quîy
[0] << 8) +Ñn->query[1];

1014 i‡(
qidít
 =
idít
) {

1015 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0,

1017 
code
, 
	`ngx_ªsﬁvî_°ªº‹
(code), 
idít
,

1018 
∫
->
∆í
,Ñn->
«me
);

1023 
dns_îr‹
;

1026 i‡(
code
 > 
NGX_RESOLVE_REFUSED
) {

1027 
dns_îr‹
;

1030 i‡(
nqs
 != 1) {

1031 
îr
 = "invalidÇumber of questions in DNSÑesponse";

1032 
d⁄e
;

1035 
i
 = (
ngx_ªsﬁvî_quîy_t
);

1037 
i
 < (
ngx_uöt_t
Ë
n
) {

1038 i‡(
buf
[
i
] == '\0') {

1039 
found
;

1042 
Àn
 = 
buf
[
i
];

1043 
i
 +1 + 
Àn
;

1046 
sh‹t_ª•⁄£
;

1048 
found
:

1050 i‡(
i
++ == 0) {

1051 
îr
 = "zero-length domainÇame in DNSÑesponse";

1052 
d⁄e
;

1055 i‡(
i
 + (
ngx_ªsﬁvî_qs_t
Ë+ 
«n
 * (2 + (
ngx_ªsﬁvî_™_t
))

1056 > (
ngx_uöt_t
Ë
n
)

1058 
sh‹t_ª•⁄£
;

1061 
qs
 = (
ngx_ªsﬁvî_qs_t
 *Ë&
buf
[
i
];

1063 
qty≥
 = (
qs
->
ty≥_hi
 << 8Ë+ qs->
ty≥_lo
;

1064 
q˛ass
 = (
qs
->
˛ass_hi
 << 8Ë+ qs->
˛ass_lo
;

1066 
	`ngx_log_debug2
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0,

1067 "ªsﬁvî DNSÑe•⁄£ qt:%uò˛:%ui", 
qty≥
, 
q˛ass
);

1069 i‡(
q˛ass
 != 1) {

1070 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0,

1071 "unknow¿quîy cœs†%uòö DNSÑe•⁄£", 
q˛ass
);

1075 
qty≥
) {

1077 
NGX_RESOLVE_A
:

1079 
	`ngx_ªsﬁvî_¥o˚ss_a
(
r
, 
buf
, 
n
, 
idít
, 
code
, 
«n
,

1080 
i
 + (
ngx_ªsﬁvî_qs_t
));

1084 
NGX_RESOLVE_PTR
:

1086 
	`ngx_ªsﬁvî_¥o˚ss_±r
(
r
, 
buf
, 
n
, 
idít
, 
code
, 
«n
);

1091 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0,

1092 "unknow¿quîyÅy≥ %uòö DNSÑe•⁄£", 
qty≥
);

1098 
sh‹t_ª•⁄£
:

1100 
îr
 = "short dnsÑesponse";

1102 
d⁄e
:

1104 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0, 
îr
);

1108 
dns_îr‹
:

1110 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0,

1112 
code
, 
	`ngx_ªsﬁvî_°ªº‹
(code), 
idít
);

1114 
	}
}

1118 
	$ngx_ªsﬁvî_¥o˚ss_a
(
ngx_ªsﬁvî_t
 *
r
, 
u_ch¨
 *
buf
, 
size_t
 
œ°
,

1119 
ngx_uöt_t
 
idít
,Çgx_uöt_à
code
,Çgx_uöt_à
«n
,Çgx_uöt_à
™s
)

1121 *
îr
;

1122 
u_ch¨
 *
˙ame
;

1123 
size_t
 
Àn
;

1124 
uöt32_t
 
hash
;

1125 
ö_addr_t
 
addr
, *
addrs
;

1126 
ngx_°r_t
 
«me
;

1127 
ngx_uöt_t
 
qty≥
, 
qidít
, 
«ddrs
, 
a
, 
i
, 
n
, 
°¨t
;

1128 
ngx_ªsﬁvî_™_t
 *
™
;

1129 
ngx_ªsﬁvî_˘x_t
 *
˘x
, *
√xt
;

1130 
ngx_ªsﬁvî_node_t
 *
∫
;

1132 i‡(
	`ngx_ªsﬁvî_c›y
(
r
, &
«me
, 
buf
, &buf[12], &buf[
œ°
]Ë!
NGX_OK
) {

1136 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0, "ªsﬁvî qs:%V", &
«me
);

1138 
hash
 = 
	`ngx_¸c32_sh‹t
(
«me
.
d©a
,Çame.
Àn
);

1142 
∫
 = 
	`ngx_ªsﬁvî_lookup_«me
(
r
, &
«me
, 
hash
);

1144 i‡(
∫
 =
NULL
 ||Ñn->
quîy
 == NULL) {

1145 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0,

1146 "u√x≥˘edÑe•⁄£ f‹ %V", &
«me
);

1147 
Áûed
;

1150 
qidít
 = (
∫
->
quîy
[0] << 8) +Ñn->query[1];

1152 i‡(
idít
 !
qidít
) {

1153 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0,

1155 
idít
, &
«me
, 
qidít
);

1156 
Áûed
;

1159 
	`ngx_ªsﬁvî_‰ì
(
r
, 
«me
.
d©a
);

1161 i‡(
code
 =0 && 
«n
 == 0) {

1162 
code
 = 3;

1165 i‡(
code
) {

1166 
√xt
 = 
∫
->
waôög
;

1167 
∫
->
waôög
 = 
NULL
;

1169 
	`ngx_queue_ªmove
(&
∫
->
queue
);

1171 
	`ngx_rbåì_dñëe
(&
r
->
«me_rbåì
, &
∫
->
node
);

1173 
	`ngx_ªsﬁvî_‰ì_node
(
r
, 
∫
);

1177 
√xt
) {

1178 
˘x
 = 
√xt
;

1179 
˘x
->
°©e
 = 
code
;

1180 
√xt
 = 
˘x
->next;

1182 
˘x
->
	`h™dÀr
(ctx);

1188 
i
 = 
™s
;

1189 
«ddrs
 = 0;

1190 
addr
 = 0;

1191 
addrs
 = 
NULL
;

1192 
˙ame
 = 
NULL
;

1193 
qty≥
 = 0;

1195 
a
 = 0;á < 
«n
;á++) {

1197 
°¨t
 = 
i
;

1199 
i
 < 
œ°
) {

1201 i‡(
buf
[
i
] & 0xc0) {

1202 
i
 += 2;

1203 
found
;

1206 i‡(
buf
[
i
] == 0) {

1207 
i
++;

1208 
ã°_Àngth
;

1211 
i
 +1 + 
buf
[i];

1214 
sh‹t_ª•⁄£
;

1216 
ã°_Àngth
:

1218 i‡(
i
 - 
°¨t
 < 2) {

1219 
îr
 = "invalidÇame in dnsÑesponse";

1220 
övÆid
;

1223 
found
:

1225 i‡(
i
 + (
ngx_ªsﬁvî_™_t
Ë>
œ°
) {

1226 
sh‹t_ª•⁄£
;

1229 
™
 = (
ngx_ªsﬁvî_™_t
 *Ë&
buf
[
i
];

1231 
qty≥
 = (
™
->
ty≥_hi
 << 8Ë+án->
ty≥_lo
;

1232 
Àn
 = (
™
->
Àn_hi
 << 8Ë+án->
Àn_lo
;

1234 i‡(
qty≥
 =
NGX_RESOLVE_A
) {

1236 
i
 +(
ngx_ªsﬁvî_™_t
);

1238 i‡(
i
 + 
Àn
 > 
œ°
) {

1239 
sh‹t_ª•⁄£
;

1242 
addr
 = 
	`ht⁄l
((
buf
[
i
] << 24) + (buf[i + 1] << 16)

1243 + (
buf
[
i
 + 2] << 8) + (buf[i + 3]));

1245 
«ddrs
++;

1247 
i
 +
Àn
;

1249 } i‡(
qty≥
 =
NGX_RESOLVE_CNAME
) {

1250 
˙ame
 = &
buf
[
i
] + (
ngx_ªsﬁvî_™_t
);

1251 
i
 +(
ngx_ªsﬁvî_™_t
Ë+ 
Àn
;

1253 } i‡(
qty≥
 =
NGX_RESOLVE_DNAME
) {

1254 
i
 +(
ngx_ªsﬁvî_™_t
Ë+ 
Àn
;

1257 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0,

1258 "u√x≥˘ed qty≥ %ui", 
qty≥
);

1262 
	`ngx_log_debug2
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0,

1263 "ªsﬁvîÇaddrs:%uò˙ame:%p", 
«ddrs
, 
˙ame
);

1265 i‡(
«ddrs
) {

1267 i‡(
«ddrs
 == 1) {

1268 
∫
->
u
.
addr
 =áddr;

1272 
addrs
 = 
	`ngx_ªsﬁvî_Æloc
(
r
, 
«ddrs
 * (
ö_addr_t
));

1273 i‡(
addrs
 =
NULL
) {

1277 
n
 = 0;

1278 
i
 = 
™s
;

1280 
a
 = 0;á < 
«n
;á++) {

1284 i‡(
buf
[
i
] & 0xc0) {

1285 
i
 += 2;

1286 
ok
;

1289 i‡(
buf
[
i
] == 0) {

1290 
i
++;

1291 
ok
;

1294 
i
 +1 + 
buf
[i];

1297 
ok
:

1299 
™
 = (
ngx_ªsﬁvî_™_t
 *Ë&
buf
[
i
];

1301 
qty≥
 = (
™
->
ty≥_hi
 << 8Ë+án->
ty≥_lo
;

1302 
Àn
 = (
™
->
Àn_hi
 << 8Ë+án->
Àn_lo
;

1304 
i
 +(
ngx_ªsﬁvî_™_t
);

1306 i‡(
qty≥
 =
NGX_RESOLVE_A
) {

1308 
addrs
[
n
++] = 
	`ht⁄l
((
buf
[
i
] << 24) + (buf[i + 1] << 16)

1309 + (
buf
[
i
 + 2] << 8) + (buf[i + 3]));

1311 i‡(
n
 =
«ddrs
) {

1316 
i
 +
Àn
;

1319 
∫
->
u
.
addrs
 =áddrs;

1321 
addrs
 = 
	`ngx_ªsﬁvî_dup
(
r
, 
∫
->
u
.addrs,

1322 
«ddrs
 * (
ö_addr_t
));

1323 i‡(
addrs
 =
NULL
) {

1328 
∫
->
«ddrs
 = (
u_sh‹t
)Çaddrs;

1330 
	`ngx_queue_ªmove
(&
∫
->
queue
);

1332 
∫
->
vÆid
 = 
	`ngx_time
(Ë+ 
r
->valid;

1333 
∫
->
expúe
 = 
	`ngx_time
(Ë+ 
r
->expire;

1335 
	`ngx_queue_ö£π_hód
(&
r
->
«me_expúe_queue
, &
∫
->
queue
);

1337 
√xt
 = 
∫
->
waôög
;

1338 
∫
->
waôög
 = 
NULL
;

1342 
√xt
) {

1343 
˘x
 = 
√xt
;

1344 
˘x
->
°©e
 = 
NGX_OK
;

1345 
˘x
->
«ddrs
 =Çaddrs;

1346 
˘x
->
addrs
 = (
«ddrs
 =1Ë? &˘x->
addr
 :áddrs;

1347 
˘x
->
addr
 =áddr;

1348 
√xt
 = 
˘x
->next;

1350 
˘x
->
	`h™dÀr
(ctx);

1353 i‡(
«ddrs
 > 1) {

1354 
	`ngx_ªsﬁvî_‰ì
(
r
, 
addrs
);

1359 } i‡(
˙ame
) {

1363 i‡(
	`ngx_ªsﬁvî_c›y
(
r
, &
«me
, 
buf
, 
˙ame
, &buf[
œ°
]Ë!
NGX_OK
) {

1367 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0,

1368 "ªsﬁvî c«me:\"%V\"", &
«me
);

1370 
	`ngx_queue_ªmove
(&
∫
->
queue
);

1372 
∫
->
˙Àn
 = (
u_sh‹t
Ë
«me
.
Àn
;

1373 
∫
->
u
.
˙ame
 = 
«me
.
d©a
;

1374 
∫
->
vÆid
 = 
	`ngx_time
(Ë+ 
r
->valid;

1375 
∫
->
expúe
 = 
	`ngx_time
(Ë+ 
r
->expire;

1377 
	`ngx_queue_ö£π_hód
(&
r
->
«me_expúe_queue
, &
∫
->
queue
);

1379 
˘x
 = 
∫
->
waôög
;

1380 
∫
->
waôög
 = 
NULL
;

1382 i‡(
˘x
) {

1383 
˘x
->
«me
 =Çame;

1385 (Ë
	`ngx_ªsﬁve_«me_locked
(
r
, 
˘x
);

1391 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0,

1393 
qty≥
);

1396 
sh‹t_ª•⁄£
:

1398 
îr
 = "short dnsÑesponse";

1400 
övÆid
:

1404 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0, 
îr
);

1408 
Áûed
:

1412 
	`ngx_ªsﬁvî_‰ì
(
r
, 
«me
.
d©a
);

1415 
	}
}

1419 
	$ngx_ªsﬁvî_¥o˚ss_±r
(
ngx_ªsﬁvî_t
 *
r
, 
u_ch¨
 *
buf
, 
size_t
 
n
,

1420 
ngx_uöt_t
 
idít
,Çgx_uöt_à
code
,Çgx_uöt_à
«n
)

1422 *
îr
;

1423 
size_t
 
Àn
;

1424 
ö_addr_t
 
addr
;

1425 
ngx_öt_t
 
digô
;

1426 
ngx_°r_t
 
«me
;

1427 
ngx_uöt_t
 
i
, 
mask
, 
qidít
;

1428 
ngx_ªsﬁvî_™_t
 *
™
;

1429 
ngx_ªsﬁvî_˘x_t
 *
˘x
, *
√xt
;

1430 
ngx_ªsﬁvî_node_t
 *
∫
;

1432 i‡(
	`ngx_ªsﬁvî_c›y
(
r
, 
NULL
, 
buf
, &buf[12], &buf[
n
]Ë!
NGX_OK
) {

1433 
övÆid_ö_addr_¨∑
;

1436 
addr
 = 0;

1437 
i
 = 12;

1439 
mask
 = 0; mask < 32; mask += 8) {

1440 
Àn
 = 
buf
[
i
++];

1442 
digô
 = 
	`ngx_©oi
(&
buf
[
i
], 
Àn
);

1443 i‡(
digô
 =
NGX_ERROR
 || digit > 255) {

1444 
övÆid_ö_addr_¨∑
;

1447 
addr
 +
digô
 << 
mask
;

1448 
i
 +
Àn
;

1451 i‡(
	`ngx_°rcmp
(&
buf
[
i
], "\7in-addr\4arpa") != 0) {

1452 
övÆid_ö_addr_¨∑
;

1457 
∫
 = 
	`ngx_ªsﬁvî_lookup_addr
(
r
, 
addr
);

1459 i‡(
∫
 =
NULL
 ||Ñn->
quîy
 == NULL) {

1460 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0,

1462 (
addr
 >> 24) & 0xff, (addr >> 16) & 0xff,

1463 (
addr
 >> 8) & 0xff,áddr & 0xff);

1464 
Áûed
;

1467 
qidít
 = (
∫
->
quîy
[0] << 8) +Ñn->query[1];

1469 i‡(
idít
 !
qidít
) {

1470 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0,

1472 
idít
, (
addr
 >> 24) & 0xff, (addr >> 16) & 0xff,

1473 (
addr
 >> 8Ë& 0xff,ádd∏& 0xff, 
qidít
);

1474 
Áûed
;

1477 i‡(
code
 =0 && 
«n
 == 0) {

1478 
code
 = 3;

1481 i‡(
code
) {

1482 
√xt
 = 
∫
->
waôög
;

1483 
∫
->
waôög
 = 
NULL
;

1485 
	`ngx_queue_ªmove
(&
∫
->
queue
);

1487 
	`ngx_rbåì_dñëe
(&
r
->
addr_rbåì
, &
∫
->
node
);

1489 
	`ngx_ªsﬁvî_‰ì_node
(
r
, 
∫
);

1493 
√xt
) {

1494 
˘x
 = 
√xt
;

1495 
˘x
->
°©e
 = 
code
;

1496 
√xt
 = 
˘x
->next;

1498 
˘x
->
	`h™dÀr
(ctx);

1504 
i
 +("\7ö-addr\4¨∑"Ë+ (
ngx_ªsﬁvî_qs_t
);

1506 i‡(
i
 + 2 + (
ngx_ªsﬁvî_™_t
Ë> (
ngx_uöt_t
Ë
n
) {

1507 
sh‹t_ª•⁄£
;

1512 i‡(
buf
[
i
] != 0xc0 || buf[i + 1] != 0x0c) {

1513 
îr
 = "invalid in-addr.arpaÇame in DNSÑesponse";

1514 
övÆid
;

1517 
™
 = (
ngx_ªsﬁvî_™_t
 *Ë&
buf
[
i
 + 2];

1519 
Àn
 = (
™
->
Àn_hi
 << 8Ë+án->
Àn_lo
;

1521 
	`ngx_log_debug3
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0,

1523 (
™
->
ty≥_hi
 << 8Ë+án->
ty≥_lo
,

1524 (
™
->
˛ass_hi
 << 8Ë+án->
˛ass_lo
, 
Àn
);

1526 
i
 +2 + (
ngx_ªsﬁvî_™_t
);

1528 i‡(
i
 + 
Àn
 > (
ngx_uöt_t
Ë
n
) {

1529 
sh‹t_ª•⁄£
;

1532 i‡(
	`ngx_ªsﬁvî_c›y
(
r
, &
«me
, 
buf
, &buf[
i
], &buf[
n
]Ë!
NGX_OK
) {

1536 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
r
->
log
, 0, "ªsﬁvîán:%V", &
«me
);

1538 i‡(
«me
.
Àn
 !(
size_t
Ë
∫
->
∆í


1539 || 
	`ngx_°∫cmp
(
«me
.
d©a
, 
∫
->«me,Çame.
Àn
) != 0)

1541 i‡(
∫
->
∆í
) {

1542 
	`ngx_ªsﬁvî_‰ì
(
r
, 
∫
->
«me
);

1545 
∫
->
∆í
 = (
u_sh‹t
Ë
«me
.
Àn
;

1546 
∫
->
«me
 =Çame.
d©a
;

1548 
«me
.
d©a
 = 
	`ngx_ªsﬁvî_dup
(
r
, 
∫
->«me,Çame.
Àn
);

1549 i‡(
«me
.
d©a
 =
NULL
) {

1550 
Áûed
;

1554 
	`ngx_queue_ªmove
(&
∫
->
queue
);

1556 
∫
->
vÆid
 = 
	`ngx_time
(Ë+ 
r
->valid;

1557 
∫
->
expúe
 = 
	`ngx_time
(Ë+ 
r
->expire;

1559 
	`ngx_queue_ö£π_hód
(&
r
->
addr_expúe_queue
, &
∫
->
queue
);

1561 
√xt
 = 
∫
->
waôög
;

1562 
∫
->
waôög
 = 
NULL
;

1566 
√xt
) {

1567 
˘x
 = 
√xt
;

1568 
˘x
->
°©e
 = 
NGX_OK
;

1569 
˘x
->
«me
 =Çame;

1570 
√xt
 = 
˘x
->next;

1572 
˘x
->
	`h™dÀr
(ctx);

1575 
	`ngx_ªsﬁvî_‰ì
(
r
, 
«me
.
d©a
);

1579 
övÆid_ö_addr_¨∑
:

1581 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0,

1585 
sh‹t_ª•⁄£
:

1587 
îr
 = "short DNSÑesponse";

1589 
övÆid
:

1593 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0, 
îr
);

1597 
Áûed
:

1602 
	}
}

1605 
ngx_ªsﬁvî_node_t
 *

1606 
	$ngx_ªsﬁvî_lookup_«me
(
ngx_ªsﬁvî_t
 *
r
, 
ngx_°r_t
 *
«me
, 
uöt32_t
 
hash
)

1608 
ngx_öt_t
 
rc
;

1609 
ngx_rbåì_node_t
 *
node
, *
£¡öñ
;

1610 
ngx_ªsﬁvî_node_t
 *
∫
;

1612 
node
 = 
r
->
«me_rbåì
.
roŸ
;

1613 
£¡öñ
 = 
r
->
«me_rbåì
.sentinel;

1615 
node
 !
£¡öñ
) {

1617 i‡(
hash
 < 
node
->
key
) {

1618 
node
 =Çode->
À·
;

1622 i‡(
hash
 > 
node
->
key
) {

1623 
node
 =Çode->
right
;

1629 
∫
 = (
ngx_ªsﬁvî_node_t
 *Ë
node
;

1631 
rc
 = 
	`ngx_memn2cmp
(
«me
->
d©a
, 
∫
->«me,Çame->
Àn
,Ñn->
∆í
);

1633 i‡(
rc
 == 0) {

1634  
∫
;

1637 
node
 = (
rc
 < 0Ë?Çode->
À·
 :Çode->
right
;

1642  
NULL
;

1643 
	}
}

1646 
ngx_ªsﬁvî_node_t
 *

1647 
	$ngx_ªsﬁvî_lookup_addr
(
ngx_ªsﬁvî_t
 *
r
, 
ö_addr_t
 
addr
)

1649 
ngx_rbåì_node_t
 *
node
, *
£¡öñ
;

1651 
node
 = 
r
->
addr_rbåì
.
roŸ
;

1652 
£¡öñ
 = 
r
->
addr_rbåì
.sentinel;

1654 
node
 !
£¡öñ
) {

1656 i‡(
addr
 < 
node
->
key
) {

1657 
node
 =Çode->
À·
;

1661 i‡(
addr
 > 
node
->
key
) {

1662 
node
 =Çode->
right
;

1668  (
ngx_ªsﬁvî_node_t
 *Ë
node
;

1673  
NULL
;

1674 
	}
}

1678 
	$ngx_ªsﬁvî_rbåì_ö£π_vÆue
(
ngx_rbåì_node_t
 *
ãmp
,

1679 
ngx_rbåì_node_t
 *
node
,Çgx_rbåì_node_à*
£¡öñ
)

1681 
ngx_rbåì_node_t
 **
p
;

1682 
ngx_ªsﬁvî_node_t
 *
∫
, *
∫_ãmp
;

1686 i‡(
node
->
key
 < 
ãmp
->key) {

1688 
p
 = &
ãmp
->
À·
;

1690 } i‡(
node
->
key
 > 
ãmp
->key) {

1692 
p
 = &
ãmp
->
right
;

1696 
∫
 = (
ngx_ªsﬁvî_node_t
 *Ë
node
;

1697 
∫_ãmp
 = (
ngx_ªsﬁvî_node_t
 *Ë
ãmp
;

1699 
p
 = (
	`ngx_memn2cmp
(
∫
->
«me
, 
∫_ãmp
->«me,Ñn->
∆í
,Ñn_temp->nlen)

1700 < 0Ë? &
ãmp
->
À·
 : &ãmp->
right
;

1703 i‡(*
p
 =
£¡öñ
) {

1707 
ãmp
 = *
p
;

1710 *
p
 = 
node
;

1711 
node
->
∑ª¡
 = 
ãmp
;

1712 
node
->
À·
 = 
£¡öñ
;

1713 
node
->
right
 = 
£¡öñ
;

1714 
	`ngx_rbt_ªd
(
node
);

1715 
	}
}

1718 
ngx_öt_t


1719 
	$ngx_ªsﬁvî_¸óã_«me_quîy
(
ngx_ªsﬁvî_node_t
 *
∫
, 
ngx_ªsﬁvî_˘x_t
 *
˘x
)

1721 
u_ch¨
 *
p
, *
s
;

1722 
size_t
 
Àn
, 
∆í
;

1723 
ngx_uöt_t
 
idít
;

1724 
ngx_ªsﬁvî_qs_t
 *
qs
;

1725 
ngx_ªsﬁvî_quîy_t
 *
quîy
;

1727 
∆í
 = 
˘x
->
«me
.
Àn
 ? (1 + ctx->name.len + 1) : 1;

1729 
Àn
 = (
ngx_ªsﬁvî_quîy_t
Ë+ 
∆í
 + (
ngx_ªsﬁvî_qs_t
);

1731 
p
 = 
	`ngx_ªsﬁvî_Æloc
(
˘x
->
ªsﬁvî
, 
Àn
);

1732 i‡(
p
 =
NULL
) {

1733  
NGX_ERROR
;

1736 
∫
->
qÀn
 = (
u_sh‹t
Ë
Àn
;

1737 
∫
->
quîy
 = 
p
;

1739 
quîy
 = (
ngx_ªsﬁvî_quîy_t
 *Ë
p
;

1741 
idít
 = 
	`ngx_øndom
();

1743 
	`ngx_log_debug2
(
NGX_LOG_DEBUG_CORE
, 
˘x
->
ªsﬁvî
->
log
, 0,

1744 "ªsﬁve: \"%V\" %i", &
˘x
->
«me
, 
idít
 & 0xffff);

1746 
quîy
->
idít_hi
 = (
u_ch¨
Ë((
idít
 >> 8) & 0xff);

1747 
quîy
->
idít_lo
 = (
u_ch¨
Ë(
idít
 & 0xff);

1750 
quîy
->
Êags_hi
 = 1; quîy->
Êags_lo
 = 0;

1753 
quîy
->
nqs_hi
 = 0; quîy->
nqs_lo
 = 1;

1754 
quîy
->
«n_hi
 = 0; quîy->
«n_lo
 = 0;

1755 
quîy
->
¬s_hi
 = 0; quîy->
¬s_lo
 = 0;

1756 
quîy
->
«r_hi
 = 0; quîy->
«r_lo
 = 0;

1758 
p
 +(
ngx_ªsﬁvî_quîy_t
Ë+ 
∆í
;

1760 
qs
 = (
ngx_ªsﬁvî_qs_t
 *Ë
p
;

1763 
qs
->
ty≥_hi
 = 0; qs->
ty≥_lo
 = (
u_ch¨
Ë
˘x
->
ty≥
;

1766 
qs
->
˛ass_hi
 = 0; qs->
˛ass_lo
 = 1;

1770 
Àn
 = 0;

1771 
p
--;

1772 *
p
-- = '\0';

1774 
s
 = 
˘x
->
«me
.
d©a
 + ctx->«me.
Àn
 - 1; s >= ctx->name.data; s--) {

1775 i‡(*
s
 != '.') {

1776 *
p
 = *
s
;

1777 
Àn
++;

1780 i‡(
Àn
 == 0) {

1781  
NGX_DECLINED
;

1784 *
p
 = (
u_ch¨
Ë
Àn
;

1785 
Àn
 = 0;

1788 
p
--;

1791 *
p
 = (
u_ch¨
Ë
Àn
;

1793  
NGX_OK
;

1794 
	}
}

1799 
ngx_öt_t


1800 
	$ngx_ªsﬁvî_¸óã_addr_quîy
(
ngx_ªsﬁvî_node_t
 *
∫
, 
ngx_ªsﬁvî_˘x_t
 *
˘x
)

1802 
u_ch¨
 *
p
, *
d
;

1803 
size_t
 
Àn
;

1804 
ngx_öt_t
 
n
;

1805 
ngx_uöt_t
 
idít
;

1806 
ngx_ªsﬁvî_quîy_t
 *
quîy
;

1808 
Àn
 = (
ngx_ªsﬁvî_quîy_t
)

1810 + (
ngx_ªsﬁvî_qs_t
);

1812 
p
 = 
	`ngx_ªsﬁvî_Æloc
(
˘x
->
ªsﬁvî
, 
Àn
);

1813 i‡(
p
 =
NULL
) {

1814  
NGX_ERROR
;

1817 
∫
->
quîy
 = 
p
;

1818 
quîy
 = (
ngx_ªsﬁvî_quîy_t
 *Ë
p
;

1820 
idít
 = 
	`ngx_øndom
();

1822 
quîy
->
idít_hi
 = (
u_ch¨
Ë((
idít
 >> 8) & 0xff);

1823 
quîy
->
idít_lo
 = (
u_ch¨
Ë(
idít
 & 0xff);

1826 
quîy
->
Êags_hi
 = 1; quîy->
Êags_lo
 = 0;

1829 
quîy
->
nqs_hi
 = 0; quîy->
nqs_lo
 = 1;

1830 
quîy
->
«n_hi
 = 0; quîy->
«n_lo
 = 0;

1831 
quîy
->
¬s_hi
 = 0; quîy->
¬s_lo
 = 0;

1832 
quîy
->
«r_hi
 = 0; quîy->
«r_lo
 = 0;

1834 
p
 +(
ngx_ªsﬁvî_quîy_t
);

1836 
n
 = 0;Ç < 32;Ç += 8) {

1837 
d
 = 
	`ngx_•rötf
(&
p
[1], "%ud", (
˘x
->
addr
 >> 
n
) & 0xff);

1838 *
p
 = (
u_ch¨
Ë(
d
 - &p[1]);

1839 
p
 = 
d
;

1843 
	`ngx_mem˝y
(
p
, "\7in-addr\4arpa\0\0\14\0\1", 18);

1845 
∫
->
qÀn
 = (
u_sh‹t
)

1846 (
p
 + ("\7ö-addr\4¨∑"Ë+ (
ngx_ªsﬁvî_qs_t
)

1847 - 
∫
->
quîy
);

1849  
NGX_OK
;

1850 
	}
}

1853 
ngx_öt_t


1854 
	$ngx_ªsﬁvî_c›y
(
ngx_ªsﬁvî_t
 *
r
, 
ngx_°r_t
 *
«me
, 
u_ch¨
 *
buf
, u_ch¨ *
§c
,

1855 
u_ch¨
 *
œ°
)

1857 *
îr
;

1858 
u_ch¨
 *
p
, *
d°
;

1859 
ssize_t
 
Àn
;

1860 
ngx_uöt_t
 
i
, 
n
;

1862 
p
 = 
§c
;

1863 
Àn
 = -1;

1870 
i
 = 0; i < 128; i++) {

1871 
n
 = *
p
++;

1873 i‡(
n
 == 0) {

1874 
d⁄e
;

1877 i‡(
n
 & 0xc0) {

1878 
n
 = (“ & 0x3fË<< 8Ë+ *
p
;

1879 
p
 = &
buf
[
n
];

1882 
Àn
 +1 + 
n
;

1883 
p
 = &p[
n
];

1886 i‡(
p
 >
œ°
) {

1887 
îr
 = "name is out ofÑesponse";

1888 
övÆid
;

1892 
îr
 = "compressionÖointersÜoop";

1894 
övÆid
:

1896 
	`ngx_log_îr‹
(
r
->
log_Àvñ
,Ñ->
log
, 0, 
îr
);

1898  
NGX_ERROR
;

1900 
d⁄e
:

1902 i‡(
«me
 =
NULL
) {

1903  
NGX_OK
;

1906 i‡(
Àn
 == -1) {

1907 
«me
->
Àn
 = 0;

1908 
«me
->
d©a
 = 
NULL
;

1909  
NGX_OK
;

1912 
d°
 = 
	`ngx_ªsﬁvî_Æloc
(
r
, 
Àn
);

1913 i‡(
d°
 =
NULL
) {

1914  
NGX_ERROR
;

1917 
«me
->
d©a
 = 
d°
;

1919 
n
 = *
§c
++;

1922 i‡(
n
 & 0xc0) {

1923 
n
 = (“ & 0x3fË<< 8Ë+ *
§c
;

1924 
§c
 = &
buf
[
n
];

1926 
n
 = *
§c
++;

1929 
	`ngx_mem˝y
(
d°
, 
§c
, 
n
);

1930 
d°
 +
n
;

1931 
§c
 +
n
;

1933 
n
 = *
§c
++;

1935 i‡(
n
 != 0) {

1936 *
d°
++ = '.';

1940 i‡(
n
 == 0) {

1941 
«me
->
Àn
 = 
d°
 -Çame->
d©a
;

1942  
NGX_OK
;

1945 
	}
}

1949 
	$ngx_ªsﬁvî_timeout_h™dÀr
(
ngx_evít_t
 *
ev
)

1951 
ngx_ªsﬁvî_˘x_t
 *
˘x
;

1953 
˘x
 = 
ev
->
d©a
;

1955 
˘x
->
°©e
 = 
NGX_RESOLVE_TIMEDOUT
;

1957 
˘x
->
	`h™dÀr
(ctx);

1958 
	}
}

1962 
	$ngx_ªsﬁvî_‰ì_node
(
ngx_ªsﬁvî_t
 *
r
, 
ngx_ªsﬁvî_node_t
 *
∫
)

1966 i‡(
∫
->
quîy
) {

1967 
	`ngx_ªsﬁvî_‰ì_locked
(
r
, 
∫
->
quîy
);

1970 i‡(
∫
->
«me
) {

1971 
	`ngx_ªsﬁvî_‰ì_locked
(
r
, 
∫
->
«me
);

1974 i‡(
∫
->
˙Àn
) {

1975 
	`ngx_ªsﬁvî_‰ì_locked
(
r
, 
∫
->
u
.
˙ame
);

1978 i‡(
∫
->
«ddrs
 > 1) {

1979 
	`ngx_ªsﬁvî_‰ì_locked
(
r
, 
∫
->
u
.
addrs
);

1982 
	`ngx_ªsﬁvî_‰ì_locked
(
r
, 
∫
);

1985 
	}
}

1989 
	$ngx_ªsﬁvî_Æloc
(
ngx_ªsﬁvî_t
 *
r
, 
size_t
 
size
)

1991 
u_ch¨
 *
p
;

1995 
p
 = 
	`ngx_Æloc
(
size
, 
r
->
log
);

1999  
p
;

2000 
	}
}

2004 
	$ngx_ªsﬁvî_ˇŒoc
(
ngx_ªsﬁvî_t
 *
r
, 
size_t
 
size
)

2006 
u_ch¨
 *
p
;

2008 
p
 = 
	`ngx_ªsﬁvî_Æloc
(
r
, 
size
);

2010 i‡(
p
) {

2011 
	`ngx_memzîo
(
p
, 
size
);

2014  
p
;

2015 
	}
}

2019 
	$ngx_ªsﬁvî_‰ì
(
ngx_ªsﬁvî_t
 *
r
, *
p
)

2023 
	`ngx_‰ì
(
p
);

2026 
	}
}

2030 
	$ngx_ªsﬁvî_‰ì_locked
(
ngx_ªsﬁvî_t
 *
r
, *
p
)

2032 
	`ngx_‰ì
(
p
);

2033 
	}
}

2037 
	$ngx_ªsﬁvî_dup
(
ngx_ªsﬁvî_t
 *
r
, *
§c
, 
size_t
 
size
)

2039 *
d°
;

2041 
d°
 = 
	`ngx_ªsﬁvî_Æloc
(
r
, 
size
);

2043 i‡(
d°
 =
NULL
) {

2044  
d°
;

2047 
	`ngx_mem˝y
(
d°
, 
§c
, 
size
);

2049  
d°
;

2050 
	}
}

2054 
	$ngx_ªsﬁvî_°ªº‹
(
ngx_öt_t
 
îr
)

2056 *
îr‹s
[] = {

2064 i‡(
îr
 > 0 &&Érr < 6) {

2065  
îr‹s
[
îr
 - 1];

2068 i‡(
îr
 =
NGX_RESOLVE_TIMEDOUT
) {

2073 
	}
}

2076 
u_ch¨
 *

2077 
	$ngx_ªsﬁvî_log_îr‹
(
ngx_log_t
 *
log
, 
u_ch¨
 *
buf
, 
size_t
 
Àn
)

2079 
u_ch¨
 *
p
;

2080 
ngx_udp_c⁄√˘i⁄_t
 *
uc
;

2082 
p
 = 
buf
;

2084 i‡(
log
->
a˘i⁄
) {

2085 
p
 = 
	`ngx_¢¥ötf
(
buf
, 
Àn
, " whûê%s", 
log
->
a˘i⁄
);

2086 
Àn
 -
p
 - 
buf
;

2089 
uc
 = 
log
->
d©a
;

2091 i‡(
uc
) {

2092 
p
 = 
	`ngx_¢¥ötf
’, 
Àn
, ",Ñesﬁvî: %V", &
uc
->
£rvî
);

2095  
p
;

2096 
	}
}

2099 
ngx_öt_t


2100 
	$ngx_udp_c⁄√˘
(
ngx_udp_c⁄√˘i⁄_t
 *
uc
)

2102 
rc
;

2103 
ngx_öt_t
 
evít
;

2104 
ngx_evít_t
 *
ªv
, *
wev
;

2105 
ngx_sockë_t
 
s
;

2106 
ngx_c⁄√˘i⁄_t
 *
c
;

2108 
s
 = 
	`ngx_sockë
(
AF_INET
, 
SOCK_DGRAM
, 0);

2110 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_EVENT
, &
uc
->
log
, 0, "UDP sockë %d", 
s
);

2112 i‡(
s
 == -1) {

2113 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, &
uc
->
log
, 
ngx_sockë_î∫o
,

2114 
ngx_sockë_n
 " failed");

2115  
NGX_ERROR
;

2118 
c
 = 
	`ngx_gë_c⁄√˘i⁄
(
s
, &
uc
->
log
);

2120 i‡(
c
 =
NULL
) {

2121 i‡(
	`ngx_˛o£_sockë
(
s
) == -1) {

2122 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, &
uc
->
log
, 
ngx_sockë_î∫o
,

2123 
ngx_˛o£_sockë_n
 "failed");

2126  
NGX_ERROR
;

2129 i‡(
	`ngx_n⁄blockög
(
s
) == -1) {

2130 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, &
uc
->
log
, 
ngx_sockë_î∫o
,

2131 
ngx_n⁄blockög_n
 " failed");

2133 
	`ngx_‰ì_c⁄√˘i⁄
(
c
);

2135 i‡(
	`ngx_˛o£_sockë
(
s
) == -1) {

2136 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, &
uc
->
log
, 
ngx_sockë_î∫o
,

2137 
ngx_˛o£_sockë_n
 " failed");

2140  
NGX_ERROR
;

2143 
ªv
 = 
c
->
ªad
;

2144 
wev
 = 
c
->
wrôe
;

2146 
ªv
->
log
 = &
uc
->log;

2147 
wev
->
log
 = &
uc
->log;

2149 
uc
->
c⁄√˘i⁄
 = 
c
;

2151 
c
->
numbî
 = 
	`ngx_©omic_„tch_add
(
ngx_c⁄√˘i⁄_cou¡î
, 1);

2153 #i‡(
NGX_THREADS
)

2157 
ªv
->
lock
 = &
c
->lock;

2158 
wev
->
lock
 = &
c
->lock;

2159 
ªv
->
own_lock
 = &
c
->
lock
;

2160 
wev
->
own_lock
 = &
c
->
lock
;

2164 
	`ngx_log_debug3
(
NGX_LOG_DEBUG_EVENT
, &
uc
->
log
, 0,

2165 "c⁄√˘Åÿ%V, fd:%d #%d", &
uc
->
£rvî
, 
s
, 
c
->
numbî
);

2167 
rc
 = 
	`c⁄√˘
(
s
, 
uc
->
sockaddr
, uc->
sockÀn
);

2171 i‡(
rc
 == -1) {

2172 
	`ngx_log_îr‹
(
NGX_LOG_CRIT
, &
uc
->
log
, 
ngx_sockë_î∫o
,

2175  
NGX_ERROR
;

2179 
wev
->
ªady
 = 1;

2181 i‡(
ngx_add_evít
) {

2183 
evít
 = (
ngx_evít_Êags
 & 
NGX_USE_CLEAR_EVENT
) ?

2184  
NGX_CLEAR_EVENT
:

2185  
NGX_LEVEL_EVENT
;

2188 i‡(
	`ngx_add_evít
(
ªv
, 
NGX_READ_EVENT
, 
evít
Ë!
NGX_OK
) {

2189  
NGX_ERROR
;

2195 i‡(
	`ngx_add_c⁄n
(
c
Ë=
NGX_ERROR
) {

2196  
NGX_ERROR
;

2200  
NGX_OK
;

2201 
	}
}

	@ngx_resolver.h

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 #i‚de‡
_NGX_RESOLVER_H_INCLUDED_


13 
	#_NGX_RESOLVER_H_INCLUDED_


	)

16 
	#NGX_RESOLVE_A
 1

	)

17 
	#NGX_RESOLVE_CNAME
 5

	)

18 
	#NGX_RESOLVE_PTR
 12

	)

19 
	#NGX_RESOLVE_MX
 15

	)

20 
	#NGX_RESOLVE_TXT
 16

	)

21 
	#NGX_RESOLVE_DNAME
 39

	)

23 
	#NGX_RESOLVE_FORMERR
 1

	)

24 
	#NGX_RESOLVE_SERVFAIL
 2

	)

25 
	#NGX_RESOLVE_NXDOMAIN
 3

	)

26 
	#NGX_RESOLVE_NOTIMP
 4

	)

27 
	#NGX_RESOLVE_REFUSED
 5

	)

28 
	#NGX_RESOLVE_TIMEDOUT
 
NGX_ETIMEDOUT


	)

31 
	#NGX_NO_RESOLVER
 (*Ë-1

	)

33 
	#NGX_RESOLVER_MAX_RECURSION
 50

	)

37 
ngx_c⁄√˘i⁄_t
 *
	mc⁄√˘i⁄
;

38 
sockaddr
 *
	msockaddr
;

39 
sockÀn_t
 
	msockÀn
;

40 
ngx_°r_t
 
	m£rvî
;

41 
ngx_log_t
 
	mlog
;

42 } 
	tngx_udp_c⁄√˘i⁄_t
;

45 
ngx_ªsﬁvî_˘x_s
 
	tngx_ªsﬁvî_˘x_t
;

47 (*
	tngx_ªsﬁvî_h™dÀr_±
)(
	tngx_ªsﬁvî_˘x_t
 *
	t˘x
);

51 
ngx_rbåì_node_t
 
node
;

52 
ngx_queue_t
 
queue
;

55 
u_ch¨
 *
«me
;

57 
u_sh‹t
 
∆í
;

58 
u_sh‹t
 
qÀn
;

60 
u_ch¨
 *
quîy
;

63 
ö_addr_t
 
addr
;

64 
ö_addr_t
 *
addrs
;

65 
u_ch¨
 *
˙ame
;

66 } 
u
;

68 
u_sh‹t
 
«ddrs
;

69 
u_sh‹t
 
˙Àn
;

71 
time_t
 
expúe
;

72 
time_t
 
vÆid
;

74 
ngx_ªsﬁvî_˘x_t
 *
waôög
;

75 } 
	tngx_ªsﬁvî_node_t
;

80 
ngx_evít_t
 *
evít
;

84 
ngx_udp_c⁄√˘i⁄_t
 *
udp_c⁄√˘i⁄
;

86 
ngx_log_t
 *
log
;

89 
ngx_öt_t
 
idít
;

91 
ngx_rbåì_t
 
«me_rbåì
;

92 
ngx_rbåì_node_t
 
«me_£¡öñ
;

94 
ngx_rbåì_t
 
addr_rbåì
;

95 
ngx_rbåì_node_t
 
addr_£¡öñ
;

97 
ngx_queue_t
 
«me_ª£nd_queue
;

98 
ngx_queue_t
 
addr_ª£nd_queue
;

100 
ngx_queue_t
 
«me_expúe_queue
;

101 
ngx_queue_t
 
addr_expúe_queue
;

103 
time_t
 
ª£nd_timeout
;

104 
time_t
 
expúe
;

105 
time_t
 
vÆid
;

107 
ngx_uöt_t
 
log_Àvñ
;

108 } 
	tngx_ªsﬁvî_t
;

111 
	sngx_ªsﬁvî_˘x_s
 {

112 
ngx_ªsﬁvî_˘x_t
 *
√xt
;

113 
ngx_ªsﬁvî_t
 *
ªsﬁvî
;

114 
ngx_udp_c⁄√˘i⁄_t
 *
udp_c⁄√˘i⁄
;

117 
ngx_öt_t
 
idít
;

119 
ngx_öt_t
 
°©e
;

120 
ngx_öt_t
 
ty≥
;

121 
ngx_°r_t
 
«me
;

123 
ngx_uöt_t
 
«ddrs
;

124 
ö_addr_t
 *
addrs
;

125 
ö_addr_t
 
addr
;

129 
ngx_ªsﬁvî_h™dÀr_±
 
h™dÀr
;

130 *
d©a
;

131 
ngx_m£c_t
 
timeout
;

133 
ngx_uöt_t
 
quick
;

134 
ngx_uöt_t
 
ªcursi⁄
;

135 
ngx_evít_t
 *
evít
;

139 
ngx_ªsﬁvî_t
 *
	`ngx_ªsﬁvî_¸óã
(
ngx_c⁄f_t
 *
cf
, 
ngx_addr_t
 *
addr
);

140 
ngx_ªsﬁvî_˘x_t
 *
	`ngx_ªsﬁve_°¨t
(
ngx_ªsﬁvî_t
 *
r
,

141 
ngx_ªsﬁvî_˘x_t
 *
ãmp
);

142 
ngx_öt_t
 
	`ngx_ªsﬁve_«me
(
ngx_ªsﬁvî_˘x_t
 *
˘x
);

143 
	`ngx_ªsﬁve_«me_d⁄e
(
ngx_ªsﬁvî_˘x_t
 *
˘x
);

144 
ngx_öt_t
 
	`ngx_ªsﬁve_addr
(
ngx_ªsﬁvî_˘x_t
 *
˘x
);

145 
	`ngx_ªsﬁve_addr_d⁄e
(
ngx_ªsﬁvî_˘x_t
 *
˘x
);

146 *
	`ngx_ªsﬁvî_°ªº‹
(
ngx_öt_t
 
îr
);

	@ngx_sha1.h

8 #i‚de‡
_NGX_SHA1_H_INCLUDED_


9 
	#_NGX_SHA1_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 #i‡(
NGX_HAVE_OPENSSL_SHA1_H
)

17 
	~<›ís¶/sha.h
>

19 
	~<sha.h
>

23 
SHA_CTX
 
	tngx_sha1_t
;

26 
	#ngx_sha1_öô
 
SHA1_Inô


	)

27 
	#ngx_sha1_upd©e
 
SHA1_Upd©e


	)

28 
	#ngx_sha1_föÆ
 
SHA1_FöÆ


	)

	@ngx_shmtx.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 #i‡(
NGX_HAVE_ATOMIC_OPS
)

15 
ngx_öt_t


16 
	$ngx_shmtx_¸óã
(
ngx_shmtx_t
 *
mtx
, *
addr
, 
u_ch¨
 *
«me
)

18 
mtx
->
lock
 = 
addr
;

20 i‡(
mtx
->
•ö
 =(
ngx_uöt_t
) -1) {

21  
NGX_OK
;

24 
mtx
->
•ö
 = 2048;

26 #i‡(
NGX_HAVE_POSIX_SEM
)

28 i‡(
	`£m_öô
(&
mtx
->
£m
, 1, 0) == -1) {

29 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 
ngx_î∫o
,

32 
mtx
->
£m≠h‹e
 = 1;

37  
NGX_OK
;

38 
	}
}

42 
	$ngx_shmtx_de°‹y
(
ngx_shmtx_t
 *
mtx
)

44 #i‡(
NGX_HAVE_POSIX_SEM
)

46 i‡(
mtx
->
£m≠h‹e
) {

47 i‡(
	`£m_de°roy
(&
mtx
->
£m
) == -1) {

48 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 
ngx_î∫o
,

54 
	}
}

57 
ngx_uöt_t


58 
	$ngx_shmtx_åylock
(
ngx_shmtx_t
 *
mtx
)

60 
ngx_©omic_uöt_t
 
vÆ
;

62 
vÆ
 = *
mtx
->
lock
;

64  ((
vÆ
 & 0x80000000) == 0

65 && 
	`ngx_©omic_cmp_£t
(
mtx
->
lock
, 
vÆ
, val | 0x80000000));

66 
	}
}

70 
	$ngx_shmtx_lock
(
ngx_shmtx_t
 *
mtx
)

72 
ngx_uöt_t
 
i
, 
n
;

73 
ngx_©omic_uöt_t
 
vÆ
;

75 
	`ngx_log_debug0
(
NGX_LOG_DEBUG_CORE
, 
ngx_cy˛e
->
log
, 0, "shmtxÜock");

79 
vÆ
 = *
mtx
->
lock
;

81 i‡((
vÆ
 & 0x80000000) == 0

82 && 
	`ngx_©omic_cmp_£t
(
mtx
->
lock
, 
vÆ
, val | 0x80000000))

87 i‡(
ngx_n˝u
 > 1) {

89 
n
 = 1;Ç < 
mtx
->
•ö
;Ç <<= 1) {

91 
i
 = 0; i < 
n
; i++) {

92 
	`ngx_˝u_∑u£
();

95 
vÆ
 = *
mtx
->
lock
;

97 i‡((
vÆ
 & 0x80000000) == 0

98 && 
	`ngx_©omic_cmp_£t
(
mtx
->
lock
, 
vÆ
, val | 0x80000000))

105 #i‡(
NGX_HAVE_POSIX_SEM
)

107 i‡(
mtx
->
£m≠h‹e
) {

108 
vÆ
 = *
mtx
->
lock
;

110 i‡((
vÆ
 & 0x80000000)

111 && 
	`ngx_©omic_cmp_£t
(
mtx
->
lock
, 
vÆ
, val + 1))

113 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
ngx_cy˛e
->
log
, 0,

114 "shmtx waô %XA", 
vÆ
);

116 
	`£m_waô
(&
mtx
->
£m
) == -1) {

117 
ngx_îr_t
 
îr
;

119 
îr
 = 
ngx_î∫o
;

121 i‡(
îr
 !
NGX_EINTR
) {

122 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 
îr
,

128 
	`ngx_log_debug0
(
NGX_LOG_DEBUG_CORE
, 
ngx_cy˛e
->
log
, 0,

137 
	`ngx_sched_yõld
();

139 
	}
}

143 
	$ngx_shmtx_u∆ock
(
ngx_shmtx_t
 *
mtx
)

145 
ngx_©omic_uöt_t
 
vÆ
, 
ﬁd
, 
waô
;

147 i‡(
mtx
->
•ö
 !(
ngx_uöt_t
) -1) {

148 
	`ngx_log_debug0
(
NGX_LOG_DEBUG_CORE
, 
ngx_cy˛e
->
log
, 0, "shmtx unlock");

153 
ﬁd
 = *
mtx
->
lock
;

154 
waô
 = 
ﬁd
 & 0x7fffffff;

155 
vÆ
 = 
waô
 ? wait - 1 : 0;

157 i‡(
	`ngx_©omic_cmp_£t
(
mtx
->
lock
, 
ﬁd
, 
vÆ
)) {

162 #i‡(
NGX_HAVE_POSIX_SEM
)

164 i‡(
waô
 =0 || !
mtx
->
£m≠h‹e
) {

168 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_CORE
, 
ngx_cy˛e
->
log
, 0,

169 "shmtx wakê%XA", 
ﬁd
);

171 i‡(
	`£m_po°
(&
mtx
->
£m
) == -1) {

172 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 
ngx_î∫o
,

177 
	}
}

183 
ngx_öt_t


184 
	$ngx_shmtx_¸óã
(
ngx_shmtx_t
 *
mtx
, *
addr
, 
u_ch¨
 *
«me
)

186 i‡(
mtx
->
«me
) {

188 i‡(
	`ngx_°rcmp
(
«me
, 
mtx
->name) == 0) {

189 
mtx
->
«me
 =Çame;

190  
NGX_OK
;

193 
	`ngx_shmtx_de°‹y
(
mtx
);

196 
mtx
->
fd
 = 
	`ngx_›í_fûe
(
«me
, 
NGX_FILE_RDWR
, 
NGX_FILE_CREATE_OR_OPEN
,

197 
NGX_FILE_DEFAULT_ACCESS
);

199 i‡(
mtx
->
fd
 =
NGX_INVALID_FILE
) {

200 
	`ngx_log_îr‹
(
NGX_LOG_EMERG
, 
ngx_cy˛e
->
log
, 
ngx_î∫o
,

201 
ngx_›í_fûe_n
 " \"%s\" faûed", 
«me
);

202  
NGX_ERROR
;

205 i‡(
	`ngx_dñëe_fûe
(
«me
Ë=
NGX_FILE_ERROR
) {

206 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 
ngx_î∫o
,

207 
ngx_dñëe_fûe_n
 " \"%s\" faûed", 
«me
);

210 
mtx
->
«me
 =Çame;

212  
NGX_OK
;

213 
	}
}

217 
	$ngx_shmtx_de°‹y
(
ngx_shmtx_t
 *
mtx
)

219 i‡(
	`ngx_˛o£_fûe
(
mtx
->
fd
Ë=
NGX_FILE_ERROR
) {

220 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 
ngx_î∫o
,

221 
ngx_˛o£_fûe_n
 " \"%s\" faûed", 
mtx
->
«me
);

223 
	}
}

226 
ngx_uöt_t


227 
	$ngx_shmtx_åylock
(
ngx_shmtx_t
 *
mtx
)

229 
ngx_îr_t
 
îr
;

231 
îr
 = 
	`ngx_åylock_fd
(
mtx
->
fd
);

233 i‡(
îr
 == 0) {

237 i‡(
îr
 =
NGX_EAGAIN
) {

241 #i‡
__osf__


243 i‡(
îr
 =
NGX_EACCESS
) {

249 
	`ngx_log_ab‹t
(
îr
, 
ngx_åylock_fd_n
 " %†Áûed", 
mtx
->
«me
);

252 
	}
}

256 
	$ngx_shmtx_lock
(
ngx_shmtx_t
 *
mtx
)

258 
ngx_îr_t
 
îr
;

260 
îr
 = 
	`ngx_lock_fd
(
mtx
->
fd
);

262 i‡(
îr
 == 0) {

266 
	`ngx_log_ab‹t
(
îr
, 
ngx_lock_fd_n
 " %†Áûed", 
mtx
->
«me
);

267 
	}
}

271 
	$ngx_shmtx_u∆ock
(
ngx_shmtx_t
 *
mtx
)

273 
ngx_îr_t
 
îr
;

275 
îr
 = 
	`ngx_u∆ock_fd
(
mtx
->
fd
);

277 i‡(
îr
 == 0) {

281 
	`ngx_log_ab‹t
(
îr
, 
ngx_u∆ock_fd_n
 " %†Áûed", 
mtx
->
«me
);

282 
	}
}

	@ngx_shmtx.h

8 #i‚de‡
_NGX_SHMTX_H_INCLUDED_


9 
	#_NGX_SHMTX_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

17 #i‡(
NGX_HAVE_ATOMIC_OPS
)

18 
ngx_©omic_t
 *
	mlock
;

19 #i‡(
NGX_HAVE_POSIX_SEM
)

20 
ngx_uöt_t
 
	m£m≠h‹e
;

21 
£m_t
 
	m£m
;

24 
ngx_fd_t
 
	mfd
;

25 
u_ch¨
 *
	m«me
;

27 
ngx_uöt_t
 
	m•ö
;

28 } 
	tngx_shmtx_t
;

31 
ngx_öt_t
 
ngx_shmtx_¸óã
(
ngx_shmtx_t
 *
mtx
, *
addr
, 
u_ch¨
 *
«me
);

32 
ngx_shmtx_de°‹y
(
ngx_shmtx_t
 *
mtx
);

33 
ngx_uöt_t
 
ngx_shmtx_åylock
(
ngx_shmtx_t
 *
mtx
);

34 
ngx_shmtx_lock
(
ngx_shmtx_t
 *
mtx
);

35 
ngx_shmtx_u∆ock
(
ngx_shmtx_t
 *
mtx
);

	@ngx_slab.c

7 
	~<ngx_c⁄fig.h
>

8 
	~<ngx_c‹e.h
>

11 
	#NGX_SLAB_PAGE_MASK
 3

	)

12 
	#NGX_SLAB_PAGE
 0

	)

13 
	#NGX_SLAB_BIG
 1

	)

14 
	#NGX_SLAB_EXACT
 2

	)

15 
	#NGX_SLAB_SMALL
 3

	)

17 #i‡(
NGX_PTR_SIZE
 == 4)

19 
	#NGX_SLAB_PAGE_FREE
 0

	)

20 
	#NGX_SLAB_PAGE_BUSY
 0xffffffff

	)

21 
	#NGX_SLAB_PAGE_START
 0x80000000

	)

23 
	#NGX_SLAB_SHIFT_MASK
 0x0000000f

	)

24 
	#NGX_SLAB_MAP_MASK
 0xffff0000

	)

25 
	#NGX_SLAB_MAP_SHIFT
 16

	)

27 
	#NGX_SLAB_BUSY
 0xffffffff

	)

31 
	#NGX_SLAB_PAGE_FREE
 0

	)

32 
	#NGX_SLAB_PAGE_BUSY
 0xffffffffffffffff

	)

33 
	#NGX_SLAB_PAGE_START
 0x8000000000000000

	)

35 
	#NGX_SLAB_SHIFT_MASK
 0x000000000000000f

	)

36 
	#NGX_SLAB_MAP_MASK
 0xffffffff00000000

	)

37 
	#NGX_SLAB_MAP_SHIFT
 32

	)

39 
	#NGX_SLAB_BUSY
 0xffffffffffffffff

	)

44 #i‡(
NGX_DEBUG_MALLOC
)

46 
	#ngx_¶ab_junk
(
p
, 
size
Ë
	`ngx_mem£t
’, 0xD0, size)

	)

50 #i‡(
NGX_FREEBSD
)

52 
	#ngx_¶ab_junk
(
p
, 
size
) \

53 i‡(
ngx_‰ìbsd_debug_mÆloc
Ë
	`ngx_mem£t
(
p
, 0xD0, 
size
)

	)

57 
	#ngx_¶ab_junk
(
p
, 
size
)

	)

63 
ngx_¶ab_∑ge_t
 *
ngx_¶ab_Æloc_∑ges
(
ngx_¶ab_poﬁ_t
 *
poﬁ
,

64 
ngx_uöt_t
 
∑ges
);

65 
ngx_¶ab_‰ì_∑ges
(
ngx_¶ab_poﬁ_t
 *
poﬁ
, 
ngx_¶ab_∑ge_t
 *
∑ge
,

66 
ngx_uöt_t
 
∑ges
);

67 
ngx_¶ab_îr‹
(
ngx_¶ab_poﬁ_t
 *
poﬁ
, 
ngx_uöt_t
 
Àvñ
,

68 *
ãxt
);

71 
ngx_uöt_t
 
	gngx_¶ab_max_size
;

72 
ngx_uöt_t
 
	gngx_¶ab_exa˘_size
;

73 
ngx_uöt_t
 
	gngx_¶ab_exa˘_shi·
;

77 
	$ngx_¶ab_öô
(
ngx_¶ab_poﬁ_t
 *
poﬁ
)

79 
u_ch¨
 *
p
;

80 
size_t
 
size
;

81 
ngx_öt_t
 
m
;

82 
ngx_uöt_t
 
i
, 
n
, 
∑ges
;

83 
ngx_¶ab_∑ge_t
 *
¶Ÿs
;

86 i‡(
ngx_¶ab_max_size
 == 0) {

87 
ngx_¶ab_max_size
 = 
ngx_∑gesize
 / 2;

88 
ngx_¶ab_exa˘_size
 = 
ngx_∑gesize
 / (8 * (
uöçå_t
));

89 
n
 = 
ngx_¶ab_exa˘_size
;Ç >>1; 
ngx_¶ab_exa˘_shi·
++) {

95 
poﬁ
->
mö_size
 = 1 <<Öoﬁ->
mö_shi·
;

97 
p
 = (
u_ch¨
 *Ë
poﬁ
 + (
ngx_¶ab_poﬁ_t
);

98 
size
 = 
poﬁ
->
íd
 - 
p
;

100 
	`ngx_¶ab_junk
(
p
, 
size
);

102 
¶Ÿs
 = (
ngx_¶ab_∑ge_t
 *Ë
p
;

103 
n
 = 
ngx_∑gesize_shi·
 - 
poﬁ
->
mö_shi·
;

105 
i
 = 0; i < 
n
; i++) {

106 
¶Ÿs
[
i
].
¶ab
 = 0;

107 
¶Ÿs
[
i
].
√xt
 = &slots[i];

108 
¶Ÿs
[
i
].
¥ev
 = 0;

111 
p
 +
n
 * (
ngx_¶ab_∑ge_t
);

113 
∑ges
 = (
ngx_uöt_t
Ë(
size
 / (
ngx_∑gesize
 + (
ngx_¶ab_∑ge_t
)));

115 
	`ngx_memzîo
(
p
, 
∑ges
 * (
ngx_¶ab_∑ge_t
));

117 
poﬁ
->
∑ges
 = (
ngx_¶ab_∑ge_t
 *Ë
p
;

119 
poﬁ
->
‰ì
.
¥ev
 = 0;

120 
poﬁ
->
‰ì
.
√xt
 = (
ngx_¶ab_∑ge_t
 *Ë
p
;

122 
poﬁ
->
∑ges
->
¶ab
 =Öages;

123 
poﬁ
->
∑ges
->
√xt
 = &poﬁ->
‰ì
;

124 
poﬁ
->
∑ges
->
¥ev
 = (
uöçå_t
Ë&poﬁ->
‰ì
;

126 
poﬁ
->
°¨t
 = (
u_ch¨
 *)

127 
	`ngx_Æign_±r
((
uöçå_t
Ë
p
 + 
∑ges
 * (
ngx_¶ab_∑ge_t
),

128 
ngx_∑gesize
);

130 
m
 = 
∑ges
 - (
poﬁ
->
íd
 -Öoﬁ->
°¨t
Ë/ 
ngx_∑gesize
;

131 i‡(
m
 > 0) {

132 
∑ges
 -
m
;

133 
poﬁ
->
∑ges
->
¶ab
 =Öages;

136 
poﬁ
->
log_˘x
 = &poﬁ->
zîo
;

137 
poﬁ
->
zîo
 = '\0';

138 
	}
}

142 
	$ngx_¶ab_Æloc
(
ngx_¶ab_poﬁ_t
 *
poﬁ
, 
size_t
 
size
)

144 *
p
;

146 
	`ngx_shmtx_lock
(&
poﬁ
->
muãx
);

148 
p
 = 
	`ngx_¶ab_Æloc_locked
(
poﬁ
, 
size
);

150 
	`ngx_shmtx_u∆ock
(&
poﬁ
->
muãx
);

152  
p
;

153 
	}
}

157 
	$ngx_¶ab_Æloc_locked
(
ngx_¶ab_poﬁ_t
 *
poﬁ
, 
size_t
 
size
)

159 
size_t
 
s
;

160 
uöçå_t
 
p
, 
n
, 
m
, 
mask
, *
bôm≠
;

161 
ngx_uöt_t
 
i
, 
¶Ÿ
, 
shi·
, 
m≠
;

162 
ngx_¶ab_∑ge_t
 *
∑ge
, *
¥ev
, *
¶Ÿs
;

164 i‡(
size
 >
ngx_¶ab_max_size
) {

166 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_ALLOC
, 
ngx_cy˛e
->
log
, 0,

167 "¶abáŒoc: %uz", 
size
);

169 
∑ge
 = 
	`ngx_¶ab_Æloc_∑ges
(
poﬁ
, (
size
 + 
ngx_∑gesize
 - 1)

170 >> 
ngx_∑gesize_shi·
);

171 i‡(
∑ge
) {

172 
p
 = (
∑ge
 - 
poﬁ
->
∑ges
Ë<< 
ngx_∑gesize_shi·
;

173 
p
 +(
uöçå_t
Ë
poﬁ
->
°¨t
;

176 
p
 = 0;

179 
d⁄e
;

182 i‡(
size
 > 
poﬁ
->
mö_size
) {

183 
shi·
 = 1;

184 
s
 = 
size
 - 1; s >>1; 
shi·
++) { }

185 
¶Ÿ
 = 
shi·
 - 
poﬁ
->
mö_shi·
;

188 
size
 = 
poﬁ
->
mö_size
;

189 
shi·
 = 
poﬁ
->
mö_shi·
;

190 
¶Ÿ
 = 0;

193 
	`ngx_log_debug2
(
NGX_LOG_DEBUG_ALLOC
, 
ngx_cy˛e
->
log
, 0,

194 "¶abáŒoc: %uz slŸ: %ui", 
size
, 
¶Ÿ
);

196 
¶Ÿs
 = (
ngx_¶ab_∑ge_t
 *Ë((
u_ch¨
 *Ë
poﬁ
 + (
ngx_¶ab_poﬁ_t
));

197 
∑ge
 = 
¶Ÿs
[
¶Ÿ
].
√xt
;

199 i‡(
∑ge
->
√xt
 !=Öage) {

201 i‡(
shi·
 < 
ngx_¶ab_exa˘_shi·
) {

204 
p
 = (
∑ge
 - 
poﬁ
->
∑ges
Ë<< 
ngx_∑gesize_shi·
;

205 
bôm≠
 = (
uöçå_t
 *Ë(
poﬁ
->
°¨t
 + 
p
);

207 
m≠
 = (1 << (
ngx_∑gesize_shi·
 - 
shi·
))

208 / ((
uöçå_t
) * 8);

210 
n
 = 0;Ç < 
m≠
;Ç++) {

212 i‡(
bôm≠
[
n
] !
NGX_SLAB_BUSY
) {

214 
m
 = 1, 
i
 = 0; m; m <<= 1, i++) {

215 i‡((
bôm≠
[
n
] & 
m
)) {

219 
bôm≠
[
n
] |
m
;

221 
i
 = ((
n
 * (
uöçå_t
Ë* 8Ë<< 
shi·
)

222 + (
i
 << 
shi·
);

224 i‡(
bôm≠
[
n
] =
NGX_SLAB_BUSY
) {

225 
n
 =Ç + 1;Ç < 
m≠
;Ç++) {

226 i‡(
bôm≠
[
n
] !
NGX_SLAB_BUSY
) {

227 
p
 = (
uöçå_t
Ë
bôm≠
 + 
i
;

229 
d⁄e
;

233 
¥ev
 = (
ngx_¶ab_∑ge_t
 *)

234 (
∑ge
->
¥ev
 & ~
NGX_SLAB_PAGE_MASK
);

235 
¥ev
->
√xt
 = 
∑ge
->next;

236 
∑ge
->
√xt
->
¥ev
 =Öage->prev;

238 
∑ge
->
√xt
 = 
NULL
;

239 
∑ge
->
¥ev
 = 
NGX_SLAB_SMALL
;

242 
p
 = (
uöçå_t
Ë
bôm≠
 + 
i
;

244 
d⁄e
;

249 
∑ge
 =Öage->
√xt
;

251 } 
∑ge
);

253 } i‡(
shi·
 =
ngx_¶ab_exa˘_shi·
) {

256 i‡(
∑ge
->
¶ab
 !
NGX_SLAB_BUSY
) {

258 
m
 = 1, 
i
 = 0; m; m <<= 1, i++) {

259 i‡((
∑ge
->
¶ab
 & 
m
)) {

263 
∑ge
->
¶ab
 |
m
;

265 i‡(
∑ge
->
¶ab
 =
NGX_SLAB_BUSY
) {

266 
¥ev
 = (
ngx_¶ab_∑ge_t
 *)

267 (
∑ge
->
¥ev
 & ~
NGX_SLAB_PAGE_MASK
);

268 
¥ev
->
√xt
 = 
∑ge
->next;

269 
∑ge
->
√xt
->
¥ev
 =Öage->prev;

271 
∑ge
->
√xt
 = 
NULL
;

272 
∑ge
->
¥ev
 = 
NGX_SLAB_EXACT
;

275 
p
 = (
∑ge
 - 
poﬁ
->
∑ges
Ë<< 
ngx_∑gesize_shi·
;

276 
p
 +
i
 << 
shi·
;

277 
p
 +(
uöçå_t
Ë
poﬁ
->
°¨t
;

279 
d⁄e
;

283 
∑ge
 =Öage->
√xt
;

285 } 
∑ge
);

289 
n
 = 
ngx_∑gesize_shi·
 - (
∑ge
->
¶ab
 & 
NGX_SLAB_SHIFT_MASK
);

290 
n
 = 1 <<Ç;

291 
n
 = ((
uöçå_t
) 1 <<Ç) - 1;

292 
mask
 = 
n
 << 
NGX_SLAB_MAP_SHIFT
;

295 i‡((
∑ge
->
¶ab
 & 
NGX_SLAB_MAP_MASK
Ë!
mask
) {

297 
m
 = (
uöçå_t
Ë1 << 
NGX_SLAB_MAP_SHIFT
, 
i
 = 0;

298 
m
 & 
mask
;

299 
m
 <<1, 
i
++)

301 i‡((
∑ge
->
¶ab
 & 
m
)) {

305 
∑ge
->
¶ab
 |
m
;

307 i‡((
∑ge
->
¶ab
 & 
NGX_SLAB_MAP_MASK
Ë=
mask
) {

308 
¥ev
 = (
ngx_¶ab_∑ge_t
 *)

309 (
∑ge
->
¥ev
 & ~
NGX_SLAB_PAGE_MASK
);

310 
¥ev
->
√xt
 = 
∑ge
->next;

311 
∑ge
->
√xt
->
¥ev
 =Öage->prev;

313 
∑ge
->
√xt
 = 
NULL
;

314 
∑ge
->
¥ev
 = 
NGX_SLAB_BIG
;

317 
p
 = (
∑ge
 - 
poﬁ
->
∑ges
Ë<< 
ngx_∑gesize_shi·
;

318 
p
 +
i
 << 
shi·
;

319 
p
 +(
uöçå_t
Ë
poﬁ
->
°¨t
;

321 
d⁄e
;

325 
∑ge
 =Öage->
√xt
;

327 } 
∑ge
);

331 
∑ge
 = 
	`ngx_¶ab_Æloc_∑ges
(
poﬁ
, 1);

333 i‡(
∑ge
) {

334 i‡(
shi·
 < 
ngx_¶ab_exa˘_shi·
) {

335 
p
 = (
∑ge
 - 
poﬁ
->
∑ges
Ë<< 
ngx_∑gesize_shi·
;

336 
bôm≠
 = (
uöçå_t
 *Ë(
poﬁ
->
°¨t
 + 
p
);

338 
s
 = 1 << 
shi·
;

339 
n
 = (1 << (
ngx_∑gesize_shi·
 - 
shi·
)Ë/ 8 / 
s
;

341 i‡(
n
 == 0) {

342 
n
 = 1;

345 
bôm≠
[0] = (2 << 
n
) - 1;

347 
m≠
 = (1 << (
ngx_∑gesize_shi·
 - 
shi·
)Ë/ ((
uöçå_t
) * 8);

349 
i
 = 1; i < 
m≠
; i++) {

350 
bôm≠
[
i
] = 0;

353 
∑ge
->
¶ab
 = 
shi·
;

354 
∑ge
->
√xt
 = &
¶Ÿs
[
¶Ÿ
];

355 
∑ge
->
¥ev
 = (
uöçå_t
Ë&
¶Ÿs
[
¶Ÿ
] | 
NGX_SLAB_SMALL
;

357 
¶Ÿs
[
¶Ÿ
].
√xt
 = 
∑ge
;

359 
p
 = ((
∑ge
 - 
poﬁ
->
∑ges
Ë<< 
ngx_∑gesize_shi·
Ë+ 
s
 * 
n
;

360 
p
 +(
uöçå_t
Ë
poﬁ
->
°¨t
;

362 
d⁄e
;

364 } i‡(
shi·
 =
ngx_¶ab_exa˘_shi·
) {

366 
∑ge
->
¶ab
 = 1;

367 
∑ge
->
√xt
 = &
¶Ÿs
[
¶Ÿ
];

368 
∑ge
->
¥ev
 = (
uöçå_t
Ë&
¶Ÿs
[
¶Ÿ
] | 
NGX_SLAB_EXACT
;

370 
¶Ÿs
[
¶Ÿ
].
√xt
 = 
∑ge
;

372 
p
 = (
∑ge
 - 
poﬁ
->
∑ges
Ë<< 
ngx_∑gesize_shi·
;

373 
p
 +(
uöçå_t
Ë
poﬁ
->
°¨t
;

375 
d⁄e
;

379 
∑ge
->
¶ab
 = ((
uöçå_t
Ë1 << 
NGX_SLAB_MAP_SHIFT
Ë| 
shi·
;

380 
∑ge
->
√xt
 = &
¶Ÿs
[
¶Ÿ
];

381 
∑ge
->
¥ev
 = (
uöçå_t
Ë&
¶Ÿs
[
¶Ÿ
] | 
NGX_SLAB_BIG
;

383 
¶Ÿs
[
¶Ÿ
].
√xt
 = 
∑ge
;

385 
p
 = (
∑ge
 - 
poﬁ
->
∑ges
Ë<< 
ngx_∑gesize_shi·
;

386 
p
 +(
uöçå_t
Ë
poﬁ
->
°¨t
;

388 
d⁄e
;

392 
p
 = 0;

394 
d⁄e
:

396 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_ALLOC
, 
ngx_cy˛e
->
log
, 0, "¶abáŒoc: %p", 
p
);

398  (*Ë
p
;

399 
	}
}

403 
	$ngx_¶ab_‰ì
(
ngx_¶ab_poﬁ_t
 *
poﬁ
, *
p
)

405 
	`ngx_shmtx_lock
(&
poﬁ
->
muãx
);

407 
	`ngx_¶ab_‰ì_locked
(
poﬁ
, 
p
);

409 
	`ngx_shmtx_u∆ock
(&
poﬁ
->
muãx
);

410 
	}
}

414 
	$ngx_¶ab_‰ì_locked
(
ngx_¶ab_poﬁ_t
 *
poﬁ
, *
p
)

416 
size_t
 
size
;

417 
uöçå_t
 
¶ab
, 
m
, *
bôm≠
;

418 
ngx_uöt_t
 
n
, 
ty≥
, 
¶Ÿ
, 
shi·
, 
m≠
;

419 
ngx_¶ab_∑ge_t
 *
¶Ÿs
, *
∑ge
;

421 
	`ngx_log_debug1
(
NGX_LOG_DEBUG_ALLOC
, 
ngx_cy˛e
->
log
, 0, "¶ab fªe: %p", 
p
);

423 i‡((
u_ch¨
 *Ë
p
 < 
poﬁ
->
°¨t
 || (u_ch¨ *Ë∞>Öoﬁ->
íd
) {

424 
	`ngx_¶ab_îr‹
(
poﬁ
, 
NGX_LOG_ALERT
, "ngx_slab_free(): outside ofÖool");

425 
Áû
;

428 
n
 = ((
u_ch¨
 *Ë
p
 - 
poﬁ
->
°¨t
Ë>> 
ngx_∑gesize_shi·
;

429 
∑ge
 = &
poﬁ
->
∑ges
[
n
];

430 
¶ab
 = 
∑ge
->slab;

431 
ty≥
 = 
∑ge
->
¥ev
 & 
NGX_SLAB_PAGE_MASK
;

433 
ty≥
) {

435 
NGX_SLAB_SMALL
:

437 
shi·
 = 
¶ab
 & 
NGX_SLAB_SHIFT_MASK
;

438 
size
 = 1 << 
shi·
;

440 i‡((
uöçå_t
Ë
p
 & (
size
 - 1)) {

441 
wr⁄g_chunk
;

444 
n
 = ((
uöçå_t
Ë
p
 & (
ngx_∑gesize
 - 1)Ë>> 
shi·
;

445 
m
 = (
uöçå_t
Ë1 << (
n
 & ((uintptr_t) * 8 - 1));

446 
n
 /((
uöçå_t
) * 8);

447 
bôm≠
 = (
uöçå_t
 *Ë((uöçå_tË
p
 & ~(
ngx_∑gesize
 - 1));

449 i‡(
bôm≠
[
n
] & 
m
) {

451 i‡(
∑ge
->
√xt
 =
NULL
) {

452 
¶Ÿs
 = (
ngx_¶ab_∑ge_t
 *)

453 ((
u_ch¨
 *Ë
poﬁ
 + (
ngx_¶ab_poﬁ_t
));

454 
¶Ÿ
 = 
shi·
 - 
poﬁ
->
mö_shi·
;

456 
∑ge
->
√xt
 = 
¶Ÿs
[
¶Ÿ
].next;

457 
¶Ÿs
[
¶Ÿ
].
√xt
 = 
∑ge
;

459 
∑ge
->
¥ev
 = (
uöçå_t
Ë&
¶Ÿs
[
¶Ÿ
] | 
NGX_SLAB_SMALL
;

460 
∑ge
->
√xt
->
¥ev
 = (
uöçå_t
Ë∑gê| 
NGX_SLAB_SMALL
;

463 
bôm≠
[
n
] &~
m
;

465 
n
 = (1 << (
ngx_∑gesize_shi·
 - 
shi·
)) / 8 / (1 << shift);

467 i‡(
n
 == 0) {

468 
n
 = 1;

471 i‡(
bôm≠
[0] & ~(((
uöçå_t
Ë1 << 
n
) - 1)) {

472 
d⁄e
;

475 
m≠
 = (1 << (
ngx_∑gesize_shi·
 - 
shi·
)Ë/ ((
uöçå_t
) * 8);

477 
n
 = 1;Ç < 
m≠
;Ç++) {

478 i‡(
bôm≠
[
n
]) {

479 
d⁄e
;

483 
	`ngx_¶ab_‰ì_∑ges
(
poﬁ
, 
∑ge
, 1);

485 
d⁄e
;

488 
chunk_Æªady_‰ì
;

490 
NGX_SLAB_EXACT
:

492 
m
 = (
uöçå_t
) 1 <<

493 (((
uöçå_t
Ë
p
 & (
ngx_∑gesize
 - 1)Ë>> 
ngx_¶ab_exa˘_shi·
);

494 
size
 = 
ngx_¶ab_exa˘_size
;

496 i‡((
uöçå_t
Ë
p
 & (
size
 - 1)) {

497 
wr⁄g_chunk
;

500 i‡(
¶ab
 & 
m
) {

501 i‡(
¶ab
 =
NGX_SLAB_BUSY
) {

502 
¶Ÿs
 = (
ngx_¶ab_∑ge_t
 *)

503 ((
u_ch¨
 *Ë
poﬁ
 + (
ngx_¶ab_poﬁ_t
));

504 
¶Ÿ
 = 
ngx_¶ab_exa˘_shi·
 - 
poﬁ
->
mö_shi·
;

506 
∑ge
->
√xt
 = 
¶Ÿs
[
¶Ÿ
].next;

507 
¶Ÿs
[
¶Ÿ
].
√xt
 = 
∑ge
;

509 
∑ge
->
¥ev
 = (
uöçå_t
Ë&
¶Ÿs
[
¶Ÿ
] | 
NGX_SLAB_EXACT
;

510 
∑ge
->
√xt
->
¥ev
 = (
uöçå_t
Ë∑gê| 
NGX_SLAB_EXACT
;

513 
∑ge
->
¶ab
 &~
m
;

515 i‡(
∑ge
->
¶ab
) {

516 
d⁄e
;

519 
	`ngx_¶ab_‰ì_∑ges
(
poﬁ
, 
∑ge
, 1);

521 
d⁄e
;

524 
chunk_Æªady_‰ì
;

526 
NGX_SLAB_BIG
:

528 
shi·
 = 
¶ab
 & 
NGX_SLAB_SHIFT_MASK
;

529 
size
 = 1 << 
shi·
;

531 i‡((
uöçå_t
Ë
p
 & (
size
 - 1)) {

532 
wr⁄g_chunk
;

535 
m
 = (
uöçå_t
Ë1 << ((((uöçå_tË
p
 & (
ngx_∑gesize
 - 1)Ë>> 
shi·
)

536 + 
NGX_SLAB_MAP_SHIFT
);

538 i‡(
¶ab
 & 
m
) {

540 i‡(
∑ge
->
√xt
 =
NULL
) {

541 
¶Ÿs
 = (
ngx_¶ab_∑ge_t
 *)

542 ((
u_ch¨
 *Ë
poﬁ
 + (
ngx_¶ab_poﬁ_t
));

543 
¶Ÿ
 = 
shi·
 - 
poﬁ
->
mö_shi·
;

545 
∑ge
->
√xt
 = 
¶Ÿs
[
¶Ÿ
].next;

546 
¶Ÿs
[
¶Ÿ
].
√xt
 = 
∑ge
;

548 
∑ge
->
¥ev
 = (
uöçå_t
Ë&
¶Ÿs
[
¶Ÿ
] | 
NGX_SLAB_BIG
;

549 
∑ge
->
√xt
->
¥ev
 = (
uöçå_t
Ë∑gê| 
NGX_SLAB_BIG
;

552 
∑ge
->
¶ab
 &~
m
;

554 i‡(
∑ge
->
¶ab
 & 
NGX_SLAB_MAP_MASK
) {

555 
d⁄e
;

558 
	`ngx_¶ab_‰ì_∑ges
(
poﬁ
, 
∑ge
, 1);

560 
d⁄e
;

563 
chunk_Æªady_‰ì
;

565 
NGX_SLAB_PAGE
:

567 i‡((
uöçå_t
Ë
p
 & (
ngx_∑gesize
 - 1)) {

568 
wr⁄g_chunk
;

571 i‡(
¶ab
 =
NGX_SLAB_PAGE_FREE
) {

572 
	`ngx_¶ab_îr‹
(
poﬁ
, 
NGX_LOG_ALERT
,

574 
Áû
;

577 i‡(
¶ab
 =
NGX_SLAB_PAGE_BUSY
) {

578 
	`ngx_¶ab_îr‹
(
poﬁ
, 
NGX_LOG_ALERT
,

580 
Áû
;

583 
n
 = ((
u_ch¨
 *Ë
p
 - 
poﬁ
->
°¨t
Ë>> 
ngx_∑gesize_shi·
;

584 
size
 = 
¶ab
 & ~
NGX_SLAB_PAGE_START
;

586 
	`ngx_¶ab_‰ì_∑ges
(
poﬁ
, &poﬁ->
∑ges
[
n
], 
size
);

588 
	`ngx_¶ab_junk
(
p
, 
size
 << 
ngx_∑gesize_shi·
);

597 
d⁄e
:

599 
	`ngx_¶ab_junk
(
p
, 
size
);

603 
wr⁄g_chunk
:

605 
	`ngx_¶ab_îr‹
(
poﬁ
, 
NGX_LOG_ALERT
,

608 
Áû
;

610 
chunk_Æªady_‰ì
:

612 
	`ngx_¶ab_îr‹
(
poﬁ
, 
NGX_LOG_ALERT
,

615 
Áû
:

618 
	}
}

621 
ngx_¶ab_∑ge_t
 *

622 
	$ngx_¶ab_Æloc_∑ges
(
ngx_¶ab_poﬁ_t
 *
poﬁ
, 
ngx_uöt_t
 
∑ges
)

624 
ngx_¶ab_∑ge_t
 *
∑ge
, *
p
;

626 
∑ge
 = 
poﬁ
->
‰ì
.
√xt
;Öage != &pool->free;Öage =Öage->next) {

628 i‡(
∑ge
->
¶ab
 >
∑ges
) {

630 i‡(
∑ge
->
¶ab
 > 
∑ges
) {

631 
∑ge
[
∑ges
].
¶ab
 =Öage->slab -Öages;

632 
∑ge
[
∑ges
].
√xt
 =Öage->next;

633 
∑ge
[
∑ges
].
¥ev
 =Öage->prev;

635 
p
 = (
ngx_¶ab_∑ge_t
 *Ë
∑ge
->
¥ev
;

636 
p
->
√xt
 = &
∑ge
[
∑ges
];

637 
∑ge
->
√xt
->
¥ev
 = (
uöçå_t
Ë&∑ge[
∑ges
];

640 
p
 = (
ngx_¶ab_∑ge_t
 *Ë
∑ge
->
¥ev
;

641 
p
->
√xt
 = 
∑ge
->next;

642 
∑ge
->
√xt
->
¥ev
 =Öage->prev;

645 
∑ge
->
¶ab
 = 
∑ges
 | 
NGX_SLAB_PAGE_START
;

646 
∑ge
->
√xt
 = 
NULL
;

647 
∑ge
->
¥ev
 = 
NGX_SLAB_PAGE
;

649 i‡(--
∑ges
 == 0) {

650  
∑ge
;

653 
p
 = 
∑ge
 + 1; 
∑ges
;Öages--) {

654 
p
->
¶ab
 = 
NGX_SLAB_PAGE_BUSY
;

655 
p
->
√xt
 = 
NULL
;

656 
p
->
¥ev
 = 
NGX_SLAB_PAGE
;

657 
p
++;

660  
∑ge
;

664 
	`ngx_¶ab_îr‹
(
poﬁ
, 
NGX_LOG_CRIT
, "ngx_slab_alloc() failed:Ço memory");

666  
NULL
;

667 
	}
}

671 
	$ngx_¶ab_‰ì_∑ges
(
ngx_¶ab_poﬁ_t
 *
poﬁ
, 
ngx_¶ab_∑ge_t
 *
∑ge
,

672 
ngx_uöt_t
 
∑ges
)

674 
ngx_¶ab_∑ge_t
 *
¥ev
;

676 
∑ge
->
¶ab
 = 
∑ges
--;

678 i‡(
∑ges
) {

679 
	`ngx_memzîo
(&
∑ge
[1], 
∑ges
 * (
ngx_¶ab_∑ge_t
));

682 i‡(
∑ge
->
√xt
) {

683 
¥ev
 = (
ngx_¶ab_∑ge_t
 *Ë(
∑ge
->¥ev & ~
NGX_SLAB_PAGE_MASK
);

684 
¥ev
->
√xt
 = 
∑ge
->next;

685 
∑ge
->
√xt
->
¥ev
 =Öage->prev;

688 
∑ge
->
¥ev
 = (
uöçå_t
Ë&
poﬁ
->
‰ì
;

689 
∑ge
->
√xt
 = 
poﬁ
->
‰ì
.next;

691 
∑ge
->
√xt
->
¥ev
 = (
uöçå_t
)Öage;

693 
poﬁ
->
‰ì
.
√xt
 = 
∑ge
;

694 
	}
}

698 
	$ngx_¶ab_îr‹
(
ngx_¶ab_poﬁ_t
 *
poﬁ
, 
ngx_uöt_t
 
Àvñ
, *
ãxt
)

700 
	`ngx_log_îr‹
(
Àvñ
, 
ngx_cy˛e
->
log
, 0, "%s%s", 
ãxt
, 
poﬁ
->
log_˘x
);

701 
	}
}

	@ngx_slab.h

8 #i‚de‡
_NGX_SLAB_H_INCLUDED_


9 
	#_NGX_SLAB_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

16 
ngx_¶ab_∑ge_s
 
	tngx_¶ab_∑ge_t
;

18 
	sngx_¶ab_∑ge_s
 {

19 
uöçå_t
 
	m¶ab
;

20 
ngx_¶ab_∑ge_t
 *
	m√xt
;

21 
uöçå_t
 
	m¥ev
;

26 
ngx_©omic_t
 
	mlock
;

28 
size_t
 
	mmö_size
;

29 
size_t
 
	mmö_shi·
;

31 
ngx_¶ab_∑ge_t
 *
	m∑ges
;

32 
ngx_¶ab_∑ge_t
 
	m‰ì
;

34 
u_ch¨
 *
	m°¨t
;

35 
u_ch¨
 *
	míd
;

37 
ngx_shmtx_t
 
	mmuãx
;

39 
u_ch¨
 *
	mlog_˘x
;

40 
u_ch¨
 
	mzîo
;

42 *
	md©a
;

43 *
	maddr
;

44 } 
	tngx_¶ab_poﬁ_t
;

47 
ngx_¶ab_öô
(
ngx_¶ab_poﬁ_t
 *
poﬁ
);

48 *
ngx_¶ab_Æloc
(
ngx_¶ab_poﬁ_t
 *
poﬁ
, 
size_t
 
size
);

49 *
ngx_¶ab_Æloc_locked
(
ngx_¶ab_poﬁ_t
 *
poﬁ
, 
size_t
 
size
);

50 
ngx_¶ab_‰ì
(
ngx_¶ab_poﬁ_t
 *
poﬁ
, *
p
);

51 
ngx_¶ab_‰ì_locked
(
ngx_¶ab_poﬁ_t
 *
poﬁ
, *
p
);

	@ngx_spinlock.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

13 
	$ngx_•ölock
(
ngx_©omic_t
 *
lock
, 
ngx_©omic_öt_t
 
vÆue
, 
ngx_uöt_t
 
•ö
)

16 #i‡(
NGX_HAVE_ATOMIC_OPS
)

18 
ngx_uöt_t
 
i
, 
n
;

22 i‡(*
lock
 =0 && 
	`ngx_©omic_cmp_£t
÷ock, 0, 
vÆue
)) {

26 i‡(
ngx_n˝u
 > 1) {

28 
n
 = 1;Ç < 
•ö
;Ç <<= 1) {

30 
i
 = 0; i < 
n
; i++) {

31 
	`ngx_˝u_∑u£
();

34 i‡(*
lock
 =0 && 
	`ngx_©omic_cmp_£t
÷ock, 0, 
vÆue
)) {

40 
	`ngx_sched_yõld
();

45 #i‡(
NGX_THREADS
)

47 #îr‹ 
	`ngx_•ölock
(Ë
‹
 
	`ngx_©omic_cmp_£t
(Ë
¨e
 
nŸ
 
deföed
 !

53 
	}
}

	@ngx_string.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

12 
u_ch¨
 *
ngx_•rötf_num
(u_ch¨ *
buf
, u_ch¨ *
œ°
, 
uöt64_t
 
ui64
,

13 
u_ch¨
 
zîo
, 
ngx_uöt_t
 
hexadecimÆ
,Çgx_uöt_à
width
);

14 
ngx_öt_t
 
ngx_decode_ba£64_öã∫Æ
(
ngx_°r_t
 *
d°
,Çgx_°r_à*
§c
,

15 c⁄° 
u_ch¨
 *
basis
);

19 
	$ngx_°æow
(
u_ch¨
 *
d°
, u_ch¨ *
§c
, 
size_t
 
n
)

21 
n
) {

22 *
d°
 = 
	`ngx_tﬁowî
(*
§c
);

23 
d°
++;

24 
§c
++;

25 
n
--;

27 
	}
}

30 
u_ch¨
 *

31 
	$ngx_˝y°∫
(
u_ch¨
 *
d°
, u_ch¨ *
§c
, 
size_t
 
n
)

33 i‡(
n
 == 0) {

34  
d°
;

37 --
n
) {

38 *
d°
 = *
§c
;

40 i‡(*
d°
 == '\0') {

41  
d°
;

44 
d°
++;

45 
§c
++;

48 *
d°
 = '\0';

50  
d°
;

51 
	}
}

54 
u_ch¨
 *

55 
	$ngx_p°rdup
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_°r_t
 *
§c
)

57 
u_ch¨
 *
d°
;

59 
d°
 = 
	`ngx_≤Æloc
(
poﬁ
, 
§c
->
Àn
);

60 i‡(
d°
 =
NULL
) {

61  
NULL
;

64 
	`ngx_mem˝y
(
d°
, 
§c
->
d©a
, src->
Àn
);

66  
d°
;

67 
	}
}

102 
u_ch¨
 * 
ngx_cde˛


103 
	$ngx_•rötf
(
u_ch¨
 *
buf
, c⁄° *
fmt
, ...)

105 
u_ch¨
 *
p
;

106 
va_li°
 
¨gs
;

108 
	`va_°¨t
(
¨gs
, 
fmt
);

109 
p
 = 
	`ngx_v¶¥ötf
(
buf
, (*Ë-1, 
fmt
, 
¨gs
);

110 
	`va_íd
(
¨gs
);

112  
p
;

113 
	}
}

116 
u_ch¨
 * 
ngx_cde˛


117 
	$ngx_¢¥ötf
(
u_ch¨
 *
buf
, 
size_t
 
max
, c⁄° *
fmt
, ...)

119 
u_ch¨
 *
p
;

120 
va_li°
 
¨gs
;

122 
	`va_°¨t
(
¨gs
, 
fmt
);

123 
p
 = 
	`ngx_v¶¥ötf
(
buf
, bu‡+ 
max
, 
fmt
, 
¨gs
);

124 
	`va_íd
(
¨gs
);

126  
p
;

127 
	}
}

130 
u_ch¨
 * 
ngx_cde˛


131 
	$ngx_¶¥ötf
(
u_ch¨
 *
buf
, u_ch¨ *
œ°
, c⁄° *
fmt
, ...)

133 
u_ch¨
 *
p
;

134 
va_li°
 
¨gs
;

136 
	`va_°¨t
(
¨gs
, 
fmt
);

137 
p
 = 
	`ngx_v¶¥ötf
(
buf
, 
œ°
, 
fmt
, 
¨gs
);

138 
	`va_íd
(
¨gs
);

140  
p
;

141 
	}
}

144 
u_ch¨
 *

145 
	$ngx_v¶¥ötf
(
u_ch¨
 *
buf
, u_ch¨ *
œ°
, c⁄° *
fmt
, 
va_li°
 
¨gs
)

147 
u_ch¨
 *
p
, 
zîo
;

148 
d
;

149 
f
, 
sˇÀ
;

150 
size_t
 
Àn
, 
¶í
;

151 
öt64_t
 
i64
;

152 
uöt64_t
 
ui64
;

153 
ngx_m£c_t
 
ms
;

154 
ngx_uöt_t
 
width
, 
sign
, 
hex
, 
max_width
, 
‰ac_width
, 
n
;

155 
ngx_°r_t
 *
v
;

156 
ngx_v¨übÀ_vÆue_t
 *
vv
;

158 *
fmt
 && 
buf
 < 
œ°
) {

165 i‡(*
fmt
 == '%') {

167 
i64
 = 0;

168 
ui64
 = 0;

170 
zîo
 = (
u_ch¨
Ë((*++
fmt
 == '0') ? '0' : ' ');

171 
width
 = 0;

172 
sign
 = 1;

173 
hex
 = 0;

174 
max_width
 = 0;

175 
‰ac_width
 = 0;

176 
¶í
 = (
size_t
) -1;

178 *
fmt
 >= '0' && *fmt <= '9') {

179 
width
 = width * 10 + *
fmt
++ - '0';

184 *
fmt
) {

187 
sign
 = 0;

188 
fmt
++;

192 
max_width
 = 1;

193 
fmt
++;

197 
hex
 = 2;

198 
sign
 = 0;

199 
fmt
++;

203 
hex
 = 1;

204 
sign
 = 0;

205 
fmt
++;

209 
fmt
++;

211 *
fmt
 >= '0' && *fmt <= '9') {

212 
‰ac_width
 = føc_width * 10 + *
fmt
++ - '0';

218 
¶í
 = 
	`va_¨g
(
¨gs
, 
size_t
);

219 
fmt
++;

230 *
fmt
) {

233 
v
 = 
	`va_¨g
(
¨gs
, 
ngx_°r_t
 *);

235 
Àn
 = 
	`ngx_mö
(((
size_t
Ë(
œ°
 - 
buf
)), 
v
->len);

236 
buf
 = 
	`ngx_˝ymem
(buf, 
v
->
d©a
, 
Àn
);

237 
fmt
++;

242 
vv
 = 
	`va_¨g
(
¨gs
, 
ngx_v¨übÀ_vÆue_t
 *);

244 
Àn
 = 
	`ngx_mö
(((
size_t
Ë(
œ°
 - 
buf
)), 
vv
->len);

245 
buf
 = 
	`ngx_˝ymem
(buf, 
vv
->
d©a
, 
Àn
);

246 
fmt
++;

251 
p
 = 
	`va_¨g
(
¨gs
, 
u_ch¨
 *);

253 i‡(
¶í
 =(
size_t
) -1) {

254 *
p
 && 
buf
 < 
œ°
) {

255 *
buf
++ = *
p
++;

259 
Àn
 = 
	`ngx_mö
(((
size_t
Ë(
œ°
 - 
buf
)), 
¶í
);

260 
buf
 = 
	`ngx_˝ymem
(buf, 
p
, 
Àn
);

263 
fmt
++;

268 
i64
 = (
öt64_t
Ë
	`va_¨g
(
¨gs
, 
off_t
);

269 
sign
 = 1;

273 
i64
 = (
öt64_t
Ë
	`va_¨g
(
¨gs
, 
ngx_pid_t
);

274 
sign
 = 1;

278 
i64
 = (
öt64_t
Ë
	`va_¨g
(
¨gs
, 
time_t
);

279 
sign
 = 1;

283 
ms
 = (
ngx_m£c_t
Ë
	`va_¨g
(
¨gs
,Çgx_msec_t);

284 i‡((
ngx_m£c_öt_t
Ë
ms
 == -1) {

285 
sign
 = 1;

286 
i64
 = -1;

288 
sign
 = 0;

289 
ui64
 = (
uöt64_t
Ë
ms
;

294 i‡(
sign
) {

295 
i64
 = (
öt64_t
Ë
	`va_¨g
(
¨gs
, 
ssize_t
);

297 
ui64
 = (
uöt64_t
Ë
	`va_¨g
(
¨gs
, 
size_t
);

302 i‡(
sign
) {

303 
i64
 = (
öt64_t
Ë
	`va_¨g
(
¨gs
, 
ngx_öt_t
);

305 
ui64
 = (
uöt64_t
Ë
	`va_¨g
(
¨gs
, 
ngx_uöt_t
);

308 i‡(
max_width
) {

309 
width
 = 
NGX_INT_T_LEN
;

315 i‡(
sign
) {

316 
i64
 = (
öt64_t
Ë
	`va_¨g
(
¨gs
, );

318 
ui64
 = (
uöt64_t
Ë
	`va_¨g
(
¨gs
, 
u_öt
);

323 i‡(
sign
) {

324 
i64
 = (
öt64_t
Ë
	`va_¨g
(
¨gs
, );

326 
ui64
 = (
uöt64_t
Ë
	`va_¨g
(
¨gs
, 
u_l⁄g
);

331 i‡(
sign
) {

332 
i64
 = (
öt64_t
Ë
	`va_¨g
(
¨gs
, 
öt32_t
);

334 
ui64
 = (
uöt64_t
Ë
	`va_¨g
(
¨gs
, 
uöt32_t
);

339 i‡(
sign
) {

340 
i64
 = 
	`va_¨g
(
¨gs
, 
öt64_t
);

342 
ui64
 = 
	`va_¨g
(
¨gs
, 
uöt64_t
);

347 i‡(
sign
) {

348 
i64
 = (
öt64_t
Ë
	`va_¨g
(
¨gs
, 
ngx_©omic_öt_t
);

350 
ui64
 = (
uöt64_t
Ë
	`va_¨g
(
¨gs
, 
ngx_©omic_uöt_t
);

353 i‡(
max_width
) {

354 
width
 = 
NGX_ATOMIC_T_LEN
;

360 
f
 = 
	`va_¨g
(
¨gs
, );

362 i‡(
f
 < 0) {

363 *
buf
++ = '-';

364 
f
 = -f;

367 
ui64
 = (
öt64_t
Ë
f
;

369 
buf
 = 
	`ngx_•rötf_num
(buf, 
œ°
, 
ui64
, 
zîo
, 0, 
width
);

371 i‡(
‰ac_width
) {

373 i‡(
buf
 < 
œ°
) {

374 *
buf
++ = '.';

377 
sˇÀ
 = 1.0;

379 
n
 = 
‰ac_width
;Ç;Ç--) {

380 
sˇÀ
 *= 10.0;

387 
ui64
 = (
uöt64_t
Ë((
f
 - (
öt64_t
Ëui64Ë* 
sˇÀ
 + 0.5);

389 
buf
 = 
	`ngx_•rötf_num
(buf, 
œ°
, 
ui64
, '0', 0, 
‰ac_width
);

392 
fmt
++;

396 #i‡!(
NGX_WIN32
)

398 
i64
 = (
öt64_t
Ë
	`va_¨g
(
¨gs
, 
æim_t
);

399 
sign
 = 1;

404 
ui64
 = (
uöçå_t
Ë
	`va_¨g
(
¨gs
, *);

405 
hex
 = 2;

406 
sign
 = 0;

407 
zîo
 = '0';

408 
width
 = 
NGX_PTR_SIZE
 * 2;

412 
d
 = 
	`va_¨g
(
¨gs
, );

413 *
buf
++ = (
u_ch¨
Ë(
d
 & 0xff);

414 
fmt
++;

419 *
buf
++ = '\0';

420 
fmt
++;

425 #i‡(
NGX_WIN32
)

426 *
buf
++ = 
CR
;

428 *
buf
++ = 
LF
;

429 
fmt
++;

434 *
buf
++ = '%';

435 
fmt
++;

440 *
buf
++ = *
fmt
++;

445 i‡(
sign
) {

446 i‡(
i64
 < 0) {

447 *
buf
++ = '-';

448 
ui64
 = (
uöt64_t
Ë-
i64
;

451 
ui64
 = (
uöt64_t
Ë
i64
;

455 
buf
 = 
	`ngx_•rötf_num
(buf, 
œ°
, 
ui64
, 
zîo
, 
hex
, 
width
);

457 
fmt
++;

460 *
buf
++ = *
fmt
++;

464  
buf
;

465 
	}
}

468 
u_ch¨
 *

469 
	$ngx_•rötf_num
(
u_ch¨
 *
buf
, u_ch¨ *
œ°
, 
uöt64_t
 
ui64
, u_ch¨ 
zîo
,

470 
ngx_uöt_t
 
hexadecimÆ
,Çgx_uöt_à
width
)

472 
u_ch¨
 *
p
, 
ãmp
[
NGX_INT64_LEN
 + 1];

477 
size_t
 
Àn
;

478 
uöt32_t
 
ui32
;

479 
u_ch¨
 
hex
[] = "0123456789abcdef";

480 
u_ch¨
 
HEX
[] = "0123456789ABCDEF";

482 
p
 = 
ãmp
 + 
NGX_INT64_LEN
;

484 i‡(
hexadecimÆ
 == 0) {

486 i‡(
ui64
 <
NGX_MAX_UINT32_VALUE
) {

503 
ui32
 = (
uöt32_t
Ë
ui64
;

506 *--
p
 = (
u_ch¨
Ë(
ui32
 % 10 + '0');

507 } 
ui32
 /= 10);

511 *--
p
 = (
u_ch¨
Ë(
ui64
 % 10 + '0');

512 } 
ui64
 /= 10);

515 } i‡(
hexadecimÆ
 == 1) {

520 *--
p
 = 
hex
[(
uöt32_t
Ë(
ui64
 & 0xf)];

522 } 
ui64
 >>= 4);

529 *--
p
 = 
HEX
[(
uöt32_t
Ë(
ui64
 & 0xf)];

531 } 
ui64
 >>= 4);

536 
Àn
 = (
ãmp
 + 
NGX_INT64_LEN
Ë- 
p
;

538 
Àn
++ < 
width
 && 
buf
 < 
œ°
) {

539 *
buf
++ = 
zîo
;

544 
Àn
 = (
ãmp
 + 
NGX_INT64_LEN
Ë- 
p
;

546 i‡(
buf
 + 
Àn
 > 
œ°
) {

547 
Àn
 = 
œ°
 - 
buf
;

550  
	`ngx_˝ymem
(
buf
, 
p
, 
Àn
);

551 
	}
}

561 
ngx_öt_t


562 
	$ngx_°rˇ£cmp
(
u_ch¨
 *
s1
, u_ch¨ *
s2
)

564 
ngx_uöt_t
 
c1
, 
c2
;

567 
c1
 = (
ngx_uöt_t
Ë*
s1
++;

568 
c2
 = (
ngx_uöt_t
Ë*
s2
++;

570 
c1
 = (c1 >= 'A' && c1 <= 'Z') ? (c1 | 0x20) : c1;

571 
c2
 = (c2 >= 'A' && c2 <= 'Z') ? (c2 | 0x20) : c2;

573 i‡(
c1
 =
c2
) {

575 i‡(
c1
) {

582  
c1
 - 
c2
;

584 
	}
}

587 
ngx_öt_t


588 
	$ngx_°∫ˇ£cmp
(
u_ch¨
 *
s1
, u_ch¨ *
s2
, 
size_t
 
n
)

590 
ngx_uöt_t
 
c1
, 
c2
;

592 
n
) {

593 
c1
 = (
ngx_uöt_t
Ë*
s1
++;

594 
c2
 = (
ngx_uöt_t
Ë*
s2
++;

596 
c1
 = (c1 >= 'A' && c1 <= 'Z') ? (c1 | 0x20) : c1;

597 
c2
 = (c2 >= 'A' && c2 <= 'Z') ? (c2 | 0x20) : c2;

599 i‡(
c1
 =
c2
) {

601 i‡(
c1
) {

602 
n
--;

609  
c1
 - 
c2
;

613 
	}
}

616 
u_ch¨
 *

617 
	$ngx_°∫°r
(
u_ch¨
 *
s1
, *
s2
, 
size_t
 
Àn
)

619 
u_ch¨
 
c1
, 
c2
;

620 
size_t
 
n
;

622 
c2
 = *(
u_ch¨
 *Ë
s2
++;

624 
n
 = 
	`ngx_°æí
(
s2
);

628 i‡(
Àn
-- == 0) {

629  
NULL
;

632 
c1
 = *
s1
++;

634 i‡(
c1
 == 0) {

635  
NULL
;

638 } 
c1
 !
c2
);

640 i‡(
n
 > 
Àn
) {

641  
NULL
;

644 } 
	`ngx_°∫cmp
(
s1
, (
u_ch¨
 *Ë
s2
, 
n
) != 0);

646  --
s1
;

647 
	}
}

656 
u_ch¨
 *

657 
	$ngx_°r°∫
(
u_ch¨
 *
s1
, *
s2
, 
size_t
 
n
)

659 
u_ch¨
 
c1
, 
c2
;

661 
c2
 = *(
u_ch¨
 *Ë
s2
++;

665 
c1
 = *
s1
++;

667 i‡(
c1
 == 0) {

668  
NULL
;

671 } 
c1
 !
c2
);

673 } 
	`ngx_°∫cmp
(
s1
, (
u_ch¨
 *Ë
s2
, 
n
) != 0);

675  --
s1
;

676 
	}
}

679 
u_ch¨
 *

680 
	$ngx_°rˇ£°∫
(
u_ch¨
 *
s1
, *
s2
, 
size_t
 
n
)

682 
ngx_uöt_t
 
c1
, 
c2
;

684 
c2
 = (
ngx_uöt_t
Ë*
s2
++;

685 
c2
 = (c2 >= 'A' && c2 <= 'Z') ? (c2 | 0x20) : c2;

689 
c1
 = (
ngx_uöt_t
Ë*
s1
++;

691 i‡(
c1
 == 0) {

692  
NULL
;

695 
c1
 = (c1 >= 'A' && c1 <= 'Z') ? (c1 | 0x20) : c1;

697 } 
c1
 !
c2
);

699 } 
	`ngx_°∫ˇ£cmp
(
s1
, (
u_ch¨
 *Ë
s2
, 
n
) != 0);

701  --
s1
;

702 
	}
}

711 
u_ch¨
 *

712 
	$ngx_°æˇ£°∫
(
u_ch¨
 *
s1
, u_ch¨ *
œ°
, u_ch¨ *
s2
, 
size_t
 
n
)

714 
ngx_uöt_t
 
c1
, 
c2
;

716 
c2
 = (
ngx_uöt_t
Ë*
s2
++;

717 
c2
 = (c2 >= 'A' && c2 <= 'Z') ? (c2 | 0x20) : c2;

718 
œ°
 -
n
;

722 i‡(
s1
 >
œ°
) {

723  
NULL
;

726 
c1
 = (
ngx_uöt_t
Ë*
s1
++;

728 
c1
 = (c1 >= 'A' && c1 <= 'Z') ? (c1 | 0x20) : c1;

730 } 
c1
 !
c2
);

732 } 
	`ngx_°∫ˇ£cmp
(
s1
, 
s2
, 
n
) != 0);

734  --
s1
;

735 
	}
}

738 
ngx_öt_t


739 
	$ngx_r°∫cmp
(
u_ch¨
 *
s1
, u_ch¨ *
s2
, 
size_t
 
n
)

741 i‡(
n
 == 0) {

745 
n
--;

748 i‡(
s1
[
n
] !
s2
[n]) {

749  
s1
[
n
] - 
s2
[n];

752 i‡(
n
 == 0) {

756 
n
--;

758 
	}
}

761 
ngx_öt_t


762 
	$ngx_r°∫ˇ£cmp
(
u_ch¨
 *
s1
, u_ch¨ *
s2
, 
size_t
 
n
)

764 
u_ch¨
 
c1
, 
c2
;

766 i‡(
n
 == 0) {

770 
n
--;

773 
c1
 = 
s1
[
n
];

774 i‡(
c1
 >= 'a' && c1 <= 'z') {

775 
c1
 -= 'a' - 'A';

778 
c2
 = 
s2
[
n
];

779 i‡(
c2
 >= 'a' && c2 <= 'z') {

780 
c2
 -= 'a' - 'A';

783 i‡(
c1
 !
c2
) {

784  
c1
 - 
c2
;

787 i‡(
n
 == 0) {

791 
n
--;

793 
	}
}

796 
ngx_öt_t


797 
	$ngx_memn2cmp
(
u_ch¨
 *
s1
, u_ch¨ *
s2
, 
size_t
 
n1
, size_à
n2
)

799 
size_t
 
n
;

800 
ngx_öt_t
 
m
, 
z
;

802 i‡(
n1
 <
n2
) {

803 
n
 = 
n1
;

804 
z
 = -1;

807 
n
 = 
n2
;

808 
z
 = 1;

811 
m
 = 
	`ngx_memcmp
(
s1
, 
s2
, 
n
);

813 i‡(
m
 || 
n1
 =
n2
) {

814  
m
;

817  
z
;

818 
	}
}

821 
ngx_öt_t


822 
	$ngx_dns_°rcmp
(
u_ch¨
 *
s1
, u_ch¨ *
s2
)

824 
ngx_uöt_t
 
c1
, 
c2
;

827 
c1
 = (
ngx_uöt_t
Ë*
s1
++;

828 
c2
 = (
ngx_uöt_t
Ë*
s2
++;

830 
c1
 = (c1 >= 'A' && c1 <= 'Z') ? (c1 | 0x20) : c1;

831 
c2
 = (c2 >= 'A' && c2 <= 'Z') ? (c2 | 0x20) : c2;

833 i‡(
c1
 =
c2
) {

835 i‡(
c1
) {

844 
c1
 = (c1 == '.') ? ' ' : c1;

845 
c2
 = (c2 == '.') ? ' ' : c2;

847  
c1
 - 
c2
;

849 
	}
}

852 
ngx_öt_t


853 
	$ngx_©oi
(
u_ch¨
 *
löe
, 
size_t
 
n
)

855 
ngx_öt_t
 
vÆue
;

857 i‡(
n
 == 0) {

858  
NGX_ERROR
;

861 
vÆue
 = 0; 
n
--; 
löe
++) {

862 i‡(*
löe
 < '0' || *line > '9') {

863  
NGX_ERROR
;

866 
vÆue
 = vÆuê* 10 + (*
löe
 - '0');

869 i‡(
vÆue
 < 0) {

870  
NGX_ERROR
;

873  
vÆue
;

875 
	}
}

880 
ngx_öt_t


881 
	$ngx_©oÂ
(
u_ch¨
 *
löe
, 
size_t
 
n
, size_à
poöt
)

883 
ngx_öt_t
 
vÆue
;

884 
ngx_uöt_t
 
dŸ
;

886 i‡(
n
 == 0) {

887  
NGX_ERROR
;

890 
dŸ
 = 0;

892 
vÆue
 = 0; 
n
--; 
löe
++) {

894 i‡(
poöt
 == 0) {

895  
NGX_ERROR
;

898 i‡(*
löe
 == '.') {

899 i‡(
dŸ
) {

900  
NGX_ERROR
;

903 
dŸ
 = 1;

907 i‡(*
löe
 < '0' || *line > '9') {

908  
NGX_ERROR
;

911 
vÆue
 = vÆuê* 10 + (*
löe
 - '0');

912 
poöt
 -
dŸ
;

915 
poöt
--) {

916 
vÆue
 = value * 10;

919 i‡(
vÆue
 < 0) {

920  
NGX_ERROR
;

923  
vÆue
;

925 
	}
}

928 
ssize_t


929 
	$ngx_©osz
(
u_ch¨
 *
löe
, 
size_t
 
n
)

931 
ssize_t
 
vÆue
;

933 i‡(
n
 == 0) {

934  
NGX_ERROR
;

937 
vÆue
 = 0; 
n
--; 
löe
++) {

938 i‡(*
löe
 < '0' || *line > '9') {

939  
NGX_ERROR
;

942 
vÆue
 = vÆuê* 10 + (*
löe
 - '0');

945 i‡(
vÆue
 < 0) {

946  
NGX_ERROR
;

949  
vÆue
;

951 
	}
}

954 
off_t


955 
	$ngx_©oof
(
u_ch¨
 *
löe
, 
size_t
 
n
)

957 
off_t
 
vÆue
;

959 i‡(
n
 == 0) {

960  
NGX_ERROR
;

963 
vÆue
 = 0; 
n
--; 
löe
++) {

964 i‡(*
löe
 < '0' || *line > '9') {

965  
NGX_ERROR
;

968 
vÆue
 = vÆuê* 10 + (*
löe
 - '0');

971 i‡(
vÆue
 < 0) {

972  
NGX_ERROR
;

975  
vÆue
;

977 
	}
}

980 
time_t


981 
	$ngx_©Ÿm
(
u_ch¨
 *
löe
, 
size_t
 
n
)

983 
time_t
 
vÆue
;

985 i‡(
n
 == 0) {

986  
NGX_ERROR
;

989 
vÆue
 = 0; 
n
--; 
löe
++) {

990 i‡(*
löe
 < '0' || *line > '9') {

991  
NGX_ERROR
;

994 
vÆue
 = vÆuê* 10 + (*
löe
 - '0');

997 i‡(
vÆue
 < 0) {

998  
NGX_ERROR
;

1001  
vÆue
;

1003 
	}
}

1006 
ngx_öt_t


1007 
	$ngx_hextoi
(
u_ch¨
 *
löe
, 
size_t
 
n
)

1009 
u_ch¨
 
c
, 
ch
;

1010 
ngx_öt_t
 
vÆue
;

1012 i‡(
n
 == 0) {

1013  
NGX_ERROR
;

1016 
vÆue
 = 0; 
n
--; 
löe
++) {

1017 
ch
 = *
löe
;

1019 i‡(
ch
 >= '0' && ch <= '9') {

1020 
vÆue
 = vÆuê* 16 + (
ch
 - '0');

1024 
c
 = (
u_ch¨
Ë(
ch
 | 0x20);

1026 i‡(
c
 >= 'a' && c <= 'f') {

1027 
vÆue
 = vÆuê* 16 + (
c
 - 'a' + 10);

1031  
NGX_ERROR
;

1034 i‡(
vÆue
 < 0) {

1035  
NGX_ERROR
;

1038  
vÆue
;

1040 
	}
}

1043 
u_ch¨
 *

1044 
	$ngx_hex_dump
(
u_ch¨
 *
d°
, u_ch¨ *
§c
, 
size_t
 
Àn
)

1046 
u_ch¨
 
hex
[] = "0123456789abcdef";

1048 
Àn
--) {

1049 *
d°
++ = 
hex
[*
§c
 >> 4];

1050 *
d°
++ = 
hex
[*
§c
++ & 0xf];

1053  
d°
;

1054 
	}
}

1058 
	$ngx_ícode_ba£64
(
ngx_°r_t
 *
d°
,Çgx_°r_à*
§c
)

1060 
u_ch¨
 *
d
, *
s
;

1061 
size_t
 
Àn
;

1062 
u_ch¨
 
basis64
[] =

1065 
Àn
 = 
§c
->len;

1066 
s
 = 
§c
->
d©a
;

1067 
d
 = 
d°
->
d©a
;

1069 
Àn
 > 2) {

1070 *
d
++ = 
basis64
[(
s
[0] >> 2) & 0x3f];

1071 *
d
++ = 
basis64
[((
s
[0] & 3) << 4) | (s[1] >> 4)];

1072 *
d
++ = 
basis64
[((
s
[1] & 0x0f) << 2) | (s[2] >> 6)];

1073 *
d
++ = 
basis64
[
s
[2] & 0x3f];

1075 
s
 += 3;

1076 
Àn
 -= 3;

1079 i‡(
Àn
) {

1080 *
d
++ = 
basis64
[(
s
[0] >> 2) & 0x3f];

1082 i‡(
Àn
 == 1) {

1083 *
d
++ = 
basis64
[(
s
[0] & 3) << 4];

1084 *
d
++ = '=';

1087 *
d
++ = 
basis64
[((
s
[0] & 3) << 4) | (s[1] >> 4)];

1088 *
d
++ = 
basis64
[(
s
[1] & 0x0f) << 2];

1091 *
d
++ = '=';

1094 
d°
->
Àn
 = 
d
 - d°->
d©a
;

1095 
	}
}

1098 
ngx_öt_t


1099 
	$ngx_decode_ba£64
(
ngx_°r_t
 *
d°
,Çgx_°r_à*
§c
)

1101 
u_ch¨
 
basis64
[] = {

1121  
	`ngx_decode_ba£64_öã∫Æ
(
d°
, 
§c
, 
basis64
);

1122 
	}
}

1125 
ngx_öt_t


1126 
	$ngx_decode_ba£64uæ
(
ngx_°r_t
 *
d°
,Çgx_°r_à*
§c
)

1128 
u_ch¨
 
basis64
[] = {

1148  
	`ngx_decode_ba£64_öã∫Æ
(
d°
, 
§c
, 
basis64
);

1149 
	}
}

1152 
ngx_öt_t


1153 
	$ngx_decode_ba£64_öã∫Æ
(
ngx_°r_t
 *
d°
,Çgx_°r_à*
§c
, c⁄° 
u_ch¨
 *
basis
)

1155 
size_t
 
Àn
;

1156 
u_ch¨
 *
d
, *
s
;

1158 
Àn
 = 0;Üí < 
§c
->len;Üen++) {

1159 i‡(
§c
->
d©a
[
Àn
] == '=') {

1163 i‡(
basis
[
§c
->
d©a
[
Àn
]] == 77) {

1164  
NGX_ERROR
;

1168 i‡(
Àn
 % 4 == 1) {

1169  
NGX_ERROR
;

1172 
s
 = 
§c
->
d©a
;

1173 
d
 = 
d°
->
d©a
;

1175 
Àn
 > 3) {

1176 *
d
++ = (
u_ch¨
Ë(
basis
[
s
[0]] << 2 | basis[s[1]] >> 4);

1177 *
d
++ = (
u_ch¨
Ë(
basis
[
s
[1]] << 4 | basis[s[2]] >> 2);

1178 *
d
++ = (
u_ch¨
Ë(
basis
[
s
[2]] << 6 | basis[s[3]]);

1180 
s
 += 4;

1181 
Àn
 -= 4;

1184 i‡(
Àn
 > 1) {

1185 *
d
++ = (
u_ch¨
Ë(
basis
[
s
[0]] << 2 | basis[s[1]] >> 4);

1188 i‡(
Àn
 > 2) {

1189 *
d
++ = (
u_ch¨
Ë(
basis
[
s
[1]] << 4 | basis[s[2]] >> 2);

1192 
d°
->
Àn
 = 
d
 - d°->
d©a
;

1194  
NGX_OK
;

1195 
	}
}

1207 
uöt32_t


1208 
	$ngx_utf8_decode
(
u_ch¨
 **
p
, 
size_t
 
n
)

1210 
size_t
 
Àn
;

1211 
uöt32_t
 
u
, 
i
, 
vÆid
;

1213 
u
 = **
p
;

1215 i‡(
u
 >= 0xf0) {

1217 
u
 &= 0x07;

1218 
vÆid
 = 0xffff;

1219 
Àn
 = 3;

1221 } i‡(
u
 >= 0xe0) {

1223 
u
 &= 0x0f;

1224 
vÆid
 = 0x7ff;

1225 
Àn
 = 2;

1227 } i‡(
u
 >= 0xc2) {

1229 
u
 &= 0x1f;

1230 
vÆid
 = 0x7f;

1231 
Àn
 = 1;

1234 (*
p
)++;

1238 i‡(
n
 - 1 < 
Àn
) {

1242 (*
p
)++;

1244 
Àn
) {

1245 
i
 = *(*
p
)++;

1247 i‡(
i
 < 0x80) {

1251 
u
 = (u << 6Ë| (
i
 & 0x3f);

1253 
Àn
--;

1256 i‡(
u
 > 
vÆid
) {

1257  
u
;

1261 
	}
}

1264 
size_t


1265 
	$ngx_utf8_Àngth
(
u_ch¨
 *
p
, 
size_t
 
n
)

1267 
u_ch¨
 
c
, *
œ°
;

1268 
size_t
 
Àn
;

1270 
œ°
 = 
p
 + 
n
;

1272 
Àn
 = 0; 
p
 < 
œ°
;Üen++) {

1274 
c
 = *
p
;

1276 i‡(
c
 < 0x80) {

1277 
p
++;

1281 i‡(
	`ngx_utf8_decode
(&
p
, 
n
) > 0x10ffff) {

1283  
n
;

1287  
Àn
;

1288 
	}
}

1291 
u_ch¨
 *

1292 
	$ngx_utf8_˝y°∫
(
u_ch¨
 *
d°
, u_ch¨ *
§c
, 
size_t
 
n
, size_à
Àn
)

1294 
u_ch¨
 
c
, *
√xt
;

1296 i‡(
n
 == 0) {

1297  
d°
;

1300 --
n
) {

1302 
c
 = *
§c
;

1303 *
d°
 = 
c
;

1305 i‡(
c
 < 0x80) {

1307 i‡(
c
 != '\0') {

1308 
d°
++;

1309 
§c
++;

1310 
Àn
--;

1315  
d°
;

1318 
√xt
 = 
§c
;

1320 i‡(
	`ngx_utf8_decode
(&
√xt
, 
Àn
) > 0x10ffff) {

1325 
§c
 < 
√xt
) {

1326 *
d°
++ = *
§c
++;

1327 
Àn
--;

1331 *
d°
 = '\0';

1333  
d°
;

1334 
	}
}

1337 
uöçå_t


1338 
	$ngx_esˇ≥_uri
(
u_ch¨
 *
d°
, u_ch¨ *
§c
, 
size_t
 
size
, 
ngx_uöt_t
 
ty≥
)

1340 
ngx_uöt_t
 
n
;

1341 
uöt32_t
 *
esˇ≥
;

1342 
u_ch¨
 
hex
[] = "0123456789abcdef";

1346 
uöt32_t
 
uri
[] = {

1366 
uöt32_t
 
¨gs
[] = {

1386 
uöt32_t
 
uri_comp⁄ít
[] = {

1406 
uöt32_t
 
html
[] = {

1426 
uöt32_t
 
ª‰esh
[] = {

1446 
uöt32_t
 
memˇched
[] = {

1466 
uöt32_t
 *
m≠
[] =

1467 { 
uri
, 
¨gs
, 
uri_comp⁄ít
, 
html
, 
ª‰esh
, 
memˇched
, memcached };

1470 
esˇ≥
 = 
m≠
[
ty≥
];

1472 i‡(
d°
 =
NULL
) {

1476 
n
 = 0;

1478 
size
) {

1479 i‡(
esˇ≥
[*
§c
 >> 5] & (1 << (*src & 0x1f))) {

1480 
n
++;

1482 
§c
++;

1483 
size
--;

1486  (
uöçå_t
Ë
n
;

1489 
size
) {

1490 i‡(
esˇ≥
[*
§c
 >> 5] & (1 << (*src & 0x1f))) {

1491 *
d°
++ = '%';

1492 *
d°
++ = 
hex
[*
§c
 >> 4];

1493 *
d°
++ = 
hex
[*
§c
 & 0xf];

1494 
§c
++;

1497 *
d°
++ = *
§c
++;

1499 
size
--;

1502  (
uöçå_t
Ë
d°
;

1503 
	}
}

1507 
	$ngx_u√sˇ≥_uri
(
u_ch¨
 **
d°
, u_ch¨ **
§c
, 
size_t
 
size
, 
ngx_uöt_t
 
ty≥
)

1509 
u_ch¨
 *
d
, *
s
, 
ch
, 
c
, 
decoded
;

1511 
sw_usuÆ
 = 0,

1512 
sw_quŸed
,

1513 
sw_quŸed_£c⁄d


1514 } 
°©e
;

1516 
d
 = *
d°
;

1517 
s
 = *
§c
;

1519 
°©e
 = 0;

1520 
decoded
 = 0;

1522 
size
--) {

1524 
ch
 = *
s
++;

1526 
°©e
) {

1527 
sw_usuÆ
:

1528 i‡(
ch
 == '?'

1529 && (
ty≥
 & (
NGX_UNESCAPE_URI
|
NGX_UNESCAPE_REDIRECT
)))

1531 *
d
++ = 
ch
;

1532 
d⁄e
;

1535 i‡(
ch
 == '%') {

1536 
°©e
 = 
sw_quŸed
;

1540 *
d
++ = 
ch
;

1543 
sw_quŸed
:

1545 i‡(
ch
 >= '0' && ch <= '9') {

1546 
decoded
 = (
u_ch¨
Ë(
ch
 - '0');

1547 
°©e
 = 
sw_quŸed_£c⁄d
;

1551 
c
 = (
u_ch¨
Ë(
ch
 | 0x20);

1552 i‡(
c
 >= 'a' && c <= 'f') {

1553 
decoded
 = (
u_ch¨
Ë(
c
 - 'a' + 10);

1554 
°©e
 = 
sw_quŸed_£c⁄d
;

1560 
°©e
 = 
sw_usuÆ
;

1562 *
d
++ = 
ch
;

1566 
sw_quŸed_£c⁄d
:

1568 
°©e
 = 
sw_usuÆ
;

1570 i‡(
ch
 >= '0' && ch <= '9') {

1571 
ch
 = (
u_ch¨
Ë((
decoded
 << 4) + ch - '0');

1573 i‡(
ty≥
 & 
NGX_UNESCAPE_REDIRECT
) {

1574 i‡(
ch
 > '%' && ch < 0x7f) {

1575 *
d
++ = 
ch
;

1579 *
d
++ = '%'; *d++ = *(
s
 - 2); *d++ = *(s - 1);

1584 *
d
++ = 
ch
;

1589 
c
 = (
u_ch¨
Ë(
ch
 | 0x20);

1590 i‡(
c
 >= 'a' && c <= 'f') {

1591 
ch
 = (
u_ch¨
Ë((
decoded
 << 4Ë+ 
c
 - 'a' + 10);

1593 i‡(
ty≥
 & 
NGX_UNESCAPE_URI
) {

1594 i‡(
ch
 == '?') {

1595 *
d
++ = 
ch
;

1596 
d⁄e
;

1599 *
d
++ = 
ch
;

1603 i‡(
ty≥
 & 
NGX_UNESCAPE_REDIRECT
) {

1604 i‡(
ch
 == '?') {

1605 *
d
++ = 
ch
;

1606 
d⁄e
;

1609 i‡(
ch
 > '%' && ch < 0x7f) {

1610 *
d
++ = 
ch
;

1614 *
d
++ = '%'; *d++ = *(
s
 - 2); *d++ = *(s - 1);

1618 *
d
++ = 
ch
;

1629 
d⁄e
:

1631 *
d°
 = 
d
;

1632 *
§c
 = 
s
;

1633 
	}
}

1636 
uöçå_t


1637 
	$ngx_esˇ≥_html
(
u_ch¨
 *
d°
, u_ch¨ *
§c
, 
size_t
 
size
)

1639 
u_ch¨
 
ch
;

1640 
ngx_uöt_t
 
Àn
;

1642 i‡(
d°
 =
NULL
) {

1644 
Àn
 = 0;

1646 
size
) {

1647 *
§c
++) {

1650 
Àn
 += ("&lt;") - 2;

1654 
Àn
 += ("&gt;") - 2;

1658 
Àn
 += ("&amp;") - 2;

1662 
Àn
 += ("&quot;") - 2;

1668 
size
--;

1671  (
uöçå_t
Ë
Àn
;

1674 
size
) {

1675 
ch
 = *
§c
++;

1677 
ch
) {

1680 *
d°
++ = '&'; *dst++ = 'l'; *dst++ = 't'; *dst++ = ';';

1684 *
d°
++ = '&'; *dst++ = 'g'; *dst++ = 't'; *dst++ = ';';

1688 *
d°
++ = '&'; *dst++ = 'a'; *dst++ = 'm'; *dst++ = 'p';

1689 *
d°
++ = ';';

1693 *
d°
++ = '&'; *dst++ = 'q'; *dst++ = 'u'; *dst++ = 'o';

1694 *
d°
++ = 't'; *dst++ = ';';

1698 *
d°
++ = 
ch
;

1701 
size
--;

1704  (
uöçå_t
Ë
d°
;

1705 
	}
}

1709 
	$ngx_°r_rbåì_ö£π_vÆue
(
ngx_rbåì_node_t
 *
ãmp
,

1710 
ngx_rbåì_node_t
 *
node
,Çgx_rbåì_node_à*
£¡öñ
)

1712 
ngx_°r_node_t
 *
n
, *
t
;

1713 
ngx_rbåì_node_t
 **
p
;

1717 
n
 = (
ngx_°r_node_t
 *Ë
node
;

1718 
t
 = (
ngx_°r_node_t
 *Ë
ãmp
;

1720 i‡(
node
->
key
 !
ãmp
->key) {

1722 
p
 = (
node
->
key
 < 
ãmp
->keyË? &ãmp->
À·
 : &ãmp->
right
;

1724 } i‡(
n
->
°r
.
Àn
 !
t
->str.len) {

1726 
p
 = (
n
->
°r
.
Àn
 < 
t
->°r.ÀnË? &
ãmp
->
À·
 : &ãmp->
right
;

1729 
p
 = (
	`ngx_memcmp
(
n
->
°r
.
d©a
, 
t
->°r.d©a,Ç->°r.
Àn
) < 0)

1730 ? &
ãmp
->
À·
 : &ãmp->
right
;

1733 i‡(*
p
 =
£¡öñ
) {

1737 
ãmp
 = *
p
;

1740 *
p
 = 
node
;

1741 
node
->
∑ª¡
 = 
ãmp
;

1742 
node
->
À·
 = 
£¡öñ
;

1743 
node
->
right
 = 
£¡öñ
;

1744 
	`ngx_rbt_ªd
(
node
);

1745 
	}
}

1748 
ngx_°r_node_t
 *

1749 
	$ngx_°r_rbåì_lookup
(
ngx_rbåì_t
 *
rbåì
, 
ngx_°r_t
 *
vÆ
, 
uöt32_t
 
hash
)

1751 
ngx_öt_t
 
rc
;

1752 
ngx_°r_node_t
 *
n
;

1753 
ngx_rbåì_node_t
 *
node
, *
£¡öñ
;

1755 
node
 = 
rbåì
->
roŸ
;

1756 
£¡öñ
 = 
rbåì
->sentinel;

1758 
node
 !
£¡öñ
) {

1760 
n
 = (
ngx_°r_node_t
 *Ë
node
;

1762 i‡(
hash
 !
node
->
key
) {

1763 
node
 = (
hash
 <Çode->
key
Ë?Çode->
À·
 :Çode->
right
;

1767 i‡(
vÆ
->
Àn
 !
n
->
°r
.len) {

1768 
node
 = (
vÆ
->
Àn
 < 
n
->
°r
.ÀnË?Çode->
À·
 :Çode->
right
;

1772 
rc
 = 
	`ngx_memcmp
(
vÆ
->
d©a
, 
n
->
°r
.d©a, vÆ->
Àn
);

1774 i‡(
rc
 < 0) {

1775 
node
 =Çode->
À·
;

1779 i‡(
rc
 > 0) {

1780 
node
 =Çode->
right
;

1784  
n
;

1787  
NULL
;

1788 
	}
}

1794 
ngx_s‹t
(*
ba£
, 
size_t
 
n
, size_à
size
,

1795 
	$ngx_öt_t
 (*
cmp
)(const *, const *))

1797 
u_ch¨
 *
p1
, *
p2
, *
p
;

1799 
p
 = 
	`ngx_Æloc
(
size
, 
ngx_cy˛e
->
log
);

1800 i‡(
p
 =
NULL
) {

1804 
p1
 = (
u_ch¨
 *Ë
ba£
 + 
size
;

1805 
p1
 < (
u_ch¨
 *Ë
ba£
 + 
n
 * 
size
;

1806 
p1
 +
size
)

1808 
	`ngx_mem˝y
(
p
, 
p1
, 
size
);

1810 
p2
 = 
p1
;

1811 
p2
 > (
u_ch¨
 *Ë
ba£
 && 
	`cmp
’2 - 
size
, 
p
) > 0;

1812 
p2
 -
size
)

1814 
	`ngx_mem˝y
(
p2
,Ö2 - 
size
, size);

1817 
	`ngx_mem˝y
(
p2
, 
p
, 
size
);

1820 
	`ngx_‰ì
(
p
);

1821 
	}
}

1824 #i‡(
NGX_MEMCPY_LIMIT
)

1827 
	$ngx_mem˝y
(*
d°
, *
§c
, 
size_t
 
n
)

1829 i‡(
n
 > 
NGX_MEMCPY_LIMIT
) {

1830 
	`ngx_log_îr‹
(
NGX_LOG_ALERT
, 
ngx_cy˛e
->
log
, 0, "mem˝y %uz byãs", 
n
);

1831 
	`ngx_debug_poöt
();

1834  
	`mem˝y
(
d°
, 
§c
, 
n
);

1835 
	}
}

	@ngx_string.h

8 #i‚de‡
_NGX_STRING_H_INCLUDED_


9 
	#_NGX_STRING_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

17 
size_t
 
	mÀn
;

18 
u_ch¨
 *
	md©a
;

19 } 
	tngx_°r_t
;

23 
ngx_°r_t
 
	mkey
;

24 
ngx_°r_t
 
	mvÆue
;

25 } 
	tngx_keyvÆ_t
;

29 
	mÀn
:28;

31 
	mvÆid
:1;

32 
	mno_ˇchóbÀ
:1;

33 
	mnŸ_found
:1;

34 
	mesˇ≥
:1;

36 
u_ch¨
 *
	md©a
;

37 } 
	tngx_v¨übÀ_vÆue_t
;

40 
	#ngx_°rög
(
°r
Ë{ (°rË- 1, (
u_ch¨
 *Ë°∏}

	)

41 
	#ngx_nuŒ_°rög
 { 0, 
NULL
 }

	)

42 
	#ngx_°r_£t
(
°r
, 
ãxt
) \

43 (
°r
)->
Àn
 = (
ãxt
Ë- 1; (°r)->
d©a
 = (
u_ch¨
 *Ë
	)
text

44 
	#ngx_°r_nuŒ
(
°r
Ë(°r)->
Àn
 = 0; (°r)->
d©a
 = 
NULL


	)

47 
	#ngx_tﬁowî
(
c
Ë(
u_ch¨
Ë((¯>'A' && c <'Z'Ë? (¯| 0x20Ë: c)

	)

48 
	#ngx_touµî
(
c
Ë(
u_ch¨
Ë((¯>'a' && c <'z'Ë? (¯& ~0x20Ë: c)

	)

50 
ngx_°æow
(
u_ch¨
 *
d°
, u_ch¨ *
§c
, 
size_t
 
n
);

53 
	#ngx_°∫cmp
(
s1
, 
s2
, 
n
Ë
	`°∫cmp
((c⁄° *Ës1, (c⁄° *Ës2,Ç)

	)

57 
	#ngx_°rcmp
(
s1
, 
s2
Ë
	`°rcmp
((c⁄° *Ës1, (c⁄° *Ës2)

	)

60 
	#ngx_°r°r
(
s1
, 
s2
Ë
	`°r°r
((c⁄° *Ës1, (c⁄° *Ës2)

	)

61 
	#ngx_°æí
(
s
Ë
	`°æí
((c⁄° *Ës)

	)

63 
	#ngx_°rchr
(
s1
, 
c
Ë
	`°rchr
((c⁄° *Ës1, (Ëc)

	)

65 
ngx_ölöe
 
u_ch¨
 *

66 
	$ngx_°æchr
(
u_ch¨
 *
p
, u_ch¨ *
œ°
, u_ch¨ 
c
)

68 
p
 < 
œ°
) {

70 i‡(*
p
 =
c
) {

71  
p
;

74 
p
++;

77  
NULL
;

78 
	}
}

86 
	#ngx_memzîo
(
buf
, 
n
Ë(Ë
	`mem£t
(buf, 0,Ç)

	)

87 
	#ngx_mem£t
(
buf
, 
c
, 
n
Ë(Ë
	`mem£t
(buf, c,Ç)

	)

90 #i‡(
NGX_MEMCPY_LIMIT
)

92 *
ngx_mem˝y
(*
d°
, *
§c
, 
size_t
 
n
);

93 
	#ngx_˝ymem
(
d°
, 
§c
, 
n
Ë(((
u_ch¨
 *Ë
	`ngx_mem˝y
(d°, src,Ç)Ë+ (n))

	)

102 
	#ngx_mem˝y
(
d°
, 
§c
, 
n
Ë(Ë
	`mem˝y
(d°, src,Ç)

	)

103 
	#ngx_˝ymem
(
d°
, 
§c
, 
n
Ë(((
u_ch¨
 *Ë
	`mem˝y
(d°, src,Ç)Ë+ (n))

	)

108 #i‡–
__INTEL_COMPILER
 >= 800 )

115 
ngx_ölöe
 
u_ch¨
 *

116 
	$ngx_c›y
(
u_ch¨
 *
d°
, u_ch¨ *
§c
, 
size_t
 
Àn
)

118 i‡(
Àn
 < 17) {

120 
Àn
) {

121 *
d°
++ = *
§c
++;

122 
Àn
--;

125  
d°
;

128  
	`ngx_˝ymem
(
d°
, 
§c
, 
Àn
);

130 
	}
}

134 
	#ngx_c›y
 
ngx_˝ymem


	)

139 
	#ngx_memmove
(
d°
, 
§c
, 
n
Ë(Ë
	`memmove
(d°, src,Ç)

	)

140 
	#ngx_movemem
(
d°
, 
§c
, 
n
Ë(((
u_ch¨
 *Ë
	`memmove
(d°, src,Ç)Ë+ (n))

	)

144 
	#ngx_memcmp
(
s1
, 
s2
, 
n
Ë
	`memcmp
((c⁄° *Ës1, (c⁄° *Ës2,Ç)

	)

147 
u_ch¨
 *
ngx_˝y°∫
(u_ch¨ *
d°
, u_ch¨ *
§c
, 
size_t
 
n
);

148 
u_ch¨
 *
ngx_p°rdup
(
ngx_poﬁ_t
 *
poﬁ
, 
ngx_°r_t
 *
§c
);

149 
u_ch¨
 * 
ngx_cde˛
 
ngx_•rötf
(u_ch¨ *
buf
, c⁄° *
fmt
, ...);

150 
u_ch¨
 * 
ngx_cde˛
 
ngx_¢¥ötf
(u_ch¨ *
buf
, 
size_t
 
max
, c⁄° *
fmt
, ...);

151 
u_ch¨
 * 
ngx_cde˛
 
ngx_¶¥ötf
(u_ch¨ *
buf
, u_ch¨ *
œ°
, c⁄° *
fmt
,

153 
u_ch¨
 *
ngx_v¶¥ötf
(u_ch¨ *
buf
, u_ch¨ *
œ°
, c⁄° *
fmt
, 
va_li°
 
¨gs
);

154 
	#ngx_v¢¥ötf
(
buf
, 
max
, 
fmt
, 
¨gs
) \

155 
	`ngx_v¶¥ötf
(
buf
, bu‡+ (
max
), 
fmt
, 
¨gs
)

	)

157 
ngx_öt_t
 
ngx_°rˇ£cmp
(
u_ch¨
 *
s1
, u_ch¨ *
s2
);

158 
ngx_öt_t
 
ngx_°∫ˇ£cmp
(
u_ch¨
 *
s1
, u_ch¨ *
s2
, 
size_t
 
n
);

160 
u_ch¨
 *
ngx_°∫°r
(u_ch¨ *
s1
, *
s2
, 
size_t
 
n
);

162 
u_ch¨
 *
ngx_°r°∫
(u_ch¨ *
s1
, *
s2
, 
size_t
 
n
);

163 
u_ch¨
 *
ngx_°rˇ£°∫
(u_ch¨ *
s1
, *
s2
, 
size_t
 
n
);

164 
u_ch¨
 *
ngx_°æˇ£°∫
(u_ch¨ *
s1
, u_ch¨ *
œ°
, u_ch¨ *
s2
, 
size_t
 
n
);

166 
ngx_öt_t
 
ngx_r°∫cmp
(
u_ch¨
 *
s1
, u_ch¨ *
s2
, 
size_t
 
n
);

167 
ngx_öt_t
 
ngx_r°∫ˇ£cmp
(
u_ch¨
 *
s1
, u_ch¨ *
s2
, 
size_t
 
n
);

168 
ngx_öt_t
 
ngx_memn2cmp
(
u_ch¨
 *
s1
, u_ch¨ *
s2
, 
size_t
 
n1
, size_à
n2
);

169 
ngx_öt_t
 
ngx_dns_°rcmp
(
u_ch¨
 *
s1
, u_ch¨ *
s2
);

171 
ngx_öt_t
 
ngx_©oi
(
u_ch¨
 *
löe
, 
size_t
 
n
);

172 
ngx_öt_t
 
ngx_©oÂ
(
u_ch¨
 *
löe
, 
size_t
 
n
, size_à
poöt
);

173 
ssize_t
 
ngx_©osz
(
u_ch¨
 *
löe
, 
size_t
 
n
);

174 
off_t
 
ngx_©oof
(
u_ch¨
 *
löe
, 
size_t
 
n
);

175 
time_t
 
ngx_©Ÿm
(
u_ch¨
 *
löe
, 
size_t
 
n
);

176 
ngx_öt_t
 
ngx_hextoi
(
u_ch¨
 *
löe
, 
size_t
 
n
);

178 
u_ch¨
 *
ngx_hex_dump
(u_ch¨ *
d°
, u_ch¨ *
§c
, 
size_t
 
Àn
);

181 
	#ngx_ba£64_ícoded_Àngth
(
Àn
Ë((÷í + 2Ë/ 3Ë* 4)

	)

182 
	#ngx_ba£64_decoded_Àngth
(
Àn
Ë((÷í + 3Ë/ 4Ë* 3)

	)

184 
ngx_ícode_ba£64
(
ngx_°r_t
 *
d°
,Çgx_°r_à*
§c
);

185 
ngx_öt_t
 
ngx_decode_ba£64
(
ngx_°r_t
 *
d°
,Çgx_°r_à*
§c
);

186 
ngx_öt_t
 
ngx_decode_ba£64uæ
(
ngx_°r_t
 *
d°
,Çgx_°r_à*
§c
);

188 
uöt32_t
 
ngx_utf8_decode
(
u_ch¨
 **
p
, 
size_t
 
n
);

189 
size_t
 
ngx_utf8_Àngth
(
u_ch¨
 *
p
, size_à
n
);

190 
u_ch¨
 *
ngx_utf8_˝y°∫
(u_ch¨ *
d°
, u_ch¨ *
§c
, 
size_t
 
n
, size_à
Àn
);

193 
	#NGX_ESCAPE_URI
 0

	)

194 
	#NGX_ESCAPE_ARGS
 1

	)

195 
	#NGX_ESCAPE_URI_COMPONENT
 2

	)

196 
	#NGX_ESCAPE_HTML
 3

	)

197 
	#NGX_ESCAPE_REFRESH
 4

	)

198 
	#NGX_ESCAPE_MEMCACHED
 5

	)

199 
	#NGX_ESCAPE_MAIL_AUTH
 6

	)

201 
	#NGX_UNESCAPE_URI
 1

	)

202 
	#NGX_UNESCAPE_REDIRECT
 2

	)

204 
uöçå_t
 
ngx_esˇ≥_uri
(
u_ch¨
 *
d°
, u_ch¨ *
§c
, 
size_t
 
size
,

205 
ngx_uöt_t
 
ty≥
);

206 
ngx_u√sˇ≥_uri
(
u_ch¨
 **
d°
, u_ch¨ **
§c
, 
size_t
 
size
, 
ngx_uöt_t
 
ty≥
);

207 
uöçå_t
 
ngx_esˇ≥_html
(
u_ch¨
 *
d°
, u_ch¨ *
§c
, 
size_t
 
size
);

211 
ngx_rbåì_node_t
 
	mnode
;

212 
ngx_°r_t
 
	m°r
;

213 } 
	tngx_°r_node_t
;

216 
ngx_°r_rbåì_ö£π_vÆue
(
ngx_rbåì_node_t
 *
ãmp
,

217 
ngx_rbåì_node_t
 *
node
,Çgx_rbåì_node_à*
£¡öñ
);

218 
ngx_°r_node_t
 *
ngx_°r_rbåì_lookup
(
ngx_rbåì_t
 *
rbåì
, 
ngx_°r_t
 *
«me
,

219 
uöt32_t
 
hash
);

222 
ngx_s‹t
(*
ba£
, 
size_t
 
n
, size_à
size
,

223 
	$ngx_öt_t
 (*
cmp
)(const *, const *));

224 
	#ngx_qs‹t
 
qs‹t


	)

227 
	#ngx_vÆue_hñ≥r
(
n
Ë#n

	)

228 
	#ngx_vÆue
(
n
Ë
	`ngx_vÆue_hñ≥r
“)

	)

	@ngx_times.c

8 
	~<ngx_c⁄fig.h
>

9 
	~<ngx_c‹e.h
>

21 
	#NGX_TIME_SLOTS
 64

	)

23 
ngx_uöt_t
 
	g¶Ÿ
;

24 
ngx_©omic_t
 
	gngx_time_lock
;

26 vﬁ©ûê
ngx_m£c_t
 
	gngx_cuºít_m£c
;

27 vﬁ©ûê
ngx_time_t
 *
	gngx_ˇched_time
;

28 vﬁ©ûê
ngx_°r_t
 
	gngx_ˇched_îr_log_time
;

29 vﬁ©ûê
ngx_°r_t
 
	gngx_ˇched_hâp_time
;

30 vﬁ©ûê
ngx_°r_t
 
	gngx_ˇched_hâp_log_time
;

31 vﬁ©ûê
ngx_°r_t
 
	gngx_ˇched_hâp_log_iso8601
;

33 #i‡!(
NGX_WIN32
)

41 
ngx_öt_t
 
	gˇched_gmtoff
;

44 
ngx_time_t
 
	gˇched_time
[
NGX_TIME_SLOTS
];

45 
u_ch¨
 
	gˇched_îr_log_time
[
NGX_TIME_SLOTS
]

47 
u_ch¨
 
	gˇched_hâp_time
[
NGX_TIME_SLOTS
]

49 
u_ch¨
 
	gˇched_hâp_log_time
[
NGX_TIME_SLOTS
]

51 
u_ch¨
 
	gˇched_hâp_log_iso8601
[
NGX_TIME_SLOTS
]

55 *
	gwìk
[] = { "Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat" };

56 *
	gm⁄ths
[] = { "Jan", "Feb", "Mar", "Apr", "May", "Jun",

60 
	$ngx_time_öô
()

62 
ngx_ˇched_îr_log_time
.
Àn
 = ("1970/09/28 12:00:00") - 1;

63 
ngx_ˇched_hâp_time
.
Àn
 = ("Mon, 28 Sep 1970 06:00:00 GMT") - 1;

64 
ngx_ˇched_hâp_log_time
.
Àn
 = ("28/Sep/1970:12:00:00 +0600") - 1;

65 
ngx_ˇched_hâp_log_iso8601
.
Àn
 = ("1970-09-28T12:00:00+06:00") - 1;

67 
ngx_ˇched_time
 = &
ˇched_time
[0];

69 
	`ngx_time_upd©e
();

70 
	}
}

74 
	$ngx_time_upd©e
()

76 
u_ch¨
 *
p0
, *
p1
, *
p2
, *
p3
;

77 
ngx_tm_t
 
tm
, 
gmt
;

78 
time_t
 
£c
;

79 
ngx_uöt_t
 
m£c
;

80 
ngx_time_t
 *
ç
;

81 
timevÆ
 
tv
;

83 i‡(!
	`ngx_åylock
(&
ngx_time_lock
)) {

87 
	`ngx_gëtimeofday
(&
tv
);

89 
£c
 = 
tv
.
tv_£c
;

90 
m£c
 = 
tv
.
tv_u£c
 / 1000;

92 
ngx_cuºít_m£c
 = (
ngx_m£c_t
Ë
£c
 * 1000 + 
m£c
;

94 
ç
 = &
ˇched_time
[
¶Ÿ
];

96 i‡(
ç
->
£c
 == sec) {

97 
ç
->
m£c
 = msec;

98 
	`ngx_u∆ock
(&
ngx_time_lock
);

102 i‡(
¶Ÿ
 =
NGX_TIME_SLOTS
 - 1) {

103 
¶Ÿ
 = 0;

105 
¶Ÿ
++;

108 
ç
 = &
ˇched_time
[
¶Ÿ
];

110 
ç
->
£c
 = sec;

111 
ç
->
m£c
 = msec;

113 
	`ngx_gmtime
(
£c
, &
gmt
);

116 
p0
 = &
ˇched_hâp_time
[
¶Ÿ
][0];

118 (Ë
	`ngx_•rötf
(
p0
, "%s, %02d %s %4d %02d:%02d:%02d GMT",

119 
wìk
[
gmt
.
ngx_tm_wday
], gmt.
ngx_tm_mday
,

120 
m⁄ths
[
gmt
.
ngx_tm_m⁄
 - 1], gmt.
ngx_tm_yór
,

121 
gmt
.
ngx_tm_hour
, gmt.
ngx_tm_mö
, gmt.
ngx_tm_£c
);

123 #i‡(
NGX_HAVE_GETTIMEZONE
)

125 
ç
->
gmtoff
 = 
	`ngx_gëtimez⁄e
();

126 
	`ngx_gmtime
(
£c
 + 
ç
->
gmtoff
 * 60, &
tm
);

128 #ñi‡(
NGX_HAVE_GMTOFF
)

130 
	`ngx_loˇ…ime
(
£c
, &
tm
);

131 
ˇched_gmtoff
 = (
ngx_öt_t
Ë(
tm
.
ngx_tm_gmtoff
 / 60);

132 
ç
->
gmtoff
 = 
ˇched_gmtoff
;

136 
	`ngx_loˇ…ime
(
£c
, &
tm
);

137 
ˇched_gmtoff
 = 
	`ngx_timez⁄e
(
tm
.
ngx_tm_isd°
);

138 
ç
->
gmtoff
 = 
ˇched_gmtoff
;

143 
p1
 = &
ˇched_îr_log_time
[
¶Ÿ
][0];

145 (Ë
	`ngx_•rötf
(
p1
, "%4d/%02d/%02d %02d:%02d:%02d",

146 
tm
.
ngx_tm_yór
,Åm.
ngx_tm_m⁄
,

147 
tm
.
ngx_tm_mday
,Åm.
ngx_tm_hour
,

148 
tm
.
ngx_tm_mö
,Åm.
ngx_tm_£c
);

151 
p2
 = &
ˇched_hâp_log_time
[
¶Ÿ
][0];

153 (Ë
	`ngx_•rötf
(
p2
, "%02d/%s/%d:%02d:%02d:%02d %c%02d%02d",

154 
tm
.
ngx_tm_mday
, 
m⁄ths
[tm.
ngx_tm_m⁄
 - 1],

155 
tm
.
ngx_tm_yór
,Åm.
ngx_tm_hour
,

156 
tm
.
ngx_tm_mö
,Åm.
ngx_tm_£c
,

157 
ç
->
gmtoff
 < 0 ? '-' : '+',

158 
	`ngx_abs
(
ç
->
gmtoff
 / 60),Çgx_abs(tp->gmtoff % 60));

160 
p3
 = &
ˇched_hâp_log_iso8601
[
¶Ÿ
][0];

162 (Ë
	`ngx_•rötf
(
p3
, "%4d-%02d-%02dT%02d:%02d:%02d%c%02d:%02d",

163 
tm
.
ngx_tm_yór
,Åm.
ngx_tm_m⁄
,

164 
tm
.
ngx_tm_mday
,Åm.
ngx_tm_hour
,

165 
tm
.
ngx_tm_mö
,Åm.
ngx_tm_£c
,

166 
ç
->
gmtoff
 < 0 ? '-' : '+',

167 
	`ngx_abs
(
ç
->
gmtoff
 / 60),Çgx_abs(tp->gmtoff % 60));

170 
	`ngx_mem‹y_b¨rõr
();

172 
ngx_ˇched_time
 = 
ç
;

173 
ngx_ˇched_hâp_time
.
d©a
 = 
p0
;

174 
ngx_ˇched_îr_log_time
.
d©a
 = 
p1
;

175 
ngx_ˇched_hâp_log_time
.
d©a
 = 
p2
;

176 
ngx_ˇched_hâp_log_iso8601
.
d©a
 = 
p3
;

178 
	`ngx_u∆ock
(&
ngx_time_lock
);

179 
	}
}

182 #i‡!(
NGX_WIN32
)

185 
	$ngx_time_sigß„_upd©e
()

187 
u_ch¨
 *
p
;

188 
ngx_tm_t
 
tm
;

189 
time_t
 
£c
;

190 
ngx_time_t
 *
ç
;

191 
timevÆ
 
tv
;

193 i‡(!
	`ngx_åylock
(&
ngx_time_lock
)) {

197 
	`ngx_gëtimeofday
(&
tv
);

199 
£c
 = 
tv
.
tv_£c
;

201 
ç
 = &
ˇched_time
[
¶Ÿ
];

203 i‡(
ç
->
£c
 == sec) {

204 
	`ngx_u∆ock
(&
ngx_time_lock
);

208 i‡(
¶Ÿ
 =
NGX_TIME_SLOTS
 - 1) {

209 
¶Ÿ
 = 0;

211 
¶Ÿ
++;

214 
	`ngx_gmtime
(
£c
 + 
ˇched_gmtoff
 * 60, &
tm
);

216 
p
 = &
ˇched_îr_log_time
[
¶Ÿ
][0];

218 (Ë
	`ngx_•rötf
(
p
, "%4d/%02d/%02d %02d:%02d:%02d",

219 
tm
.
ngx_tm_yór
,Åm.
ngx_tm_m⁄
,

220 
tm
.
ngx_tm_mday
,Åm.
ngx_tm_hour
,

221 
tm
.
ngx_tm_mö
,Åm.
ngx_tm_£c
);

223 
	`ngx_mem‹y_b¨rõr
();

225 
ngx_ˇched_îr_log_time
.
d©a
 = 
p
;

227 
	`ngx_u∆ock
(&
ngx_time_lock
);

228 
	}
}

233 
u_ch¨
 *

234 
	$ngx_hâp_time
(
u_ch¨
 *
buf
, 
time_t
 
t
)

236 
ngx_tm_t
 
tm
;

238 
	`ngx_gmtime
(
t
, &
tm
);

240  
	`ngx_•rötf
(
buf
, "%s, %02d %s %4d %02d:%02d:%02d GMT",

241 
wìk
[
tm
.
ngx_tm_wday
],

242 
tm
.
ngx_tm_mday
,

243 
m⁄ths
[
tm
.
ngx_tm_m⁄
 - 1],

244 
tm
.
ngx_tm_yór
,

245 
tm
.
ngx_tm_hour
,

246 
tm
.
ngx_tm_mö
,

247 
tm
.
ngx_tm_£c
);

248 
	}
}

251 
u_ch¨
 *

252 
	$ngx_hâp_cookõ_time
(
u_ch¨
 *
buf
, 
time_t
 
t
)

254 
ngx_tm_t
 
tm
;

256 
	`ngx_gmtime
(
t
, &
tm
);

263  
	`ngx_•rötf
(
buf
,

264 (
tm
.
ngx_tm_yór
 > 2037) ?

267 
wìk
[
tm
.
ngx_tm_wday
],

268 
tm
.
ngx_tm_mday
,

269 
m⁄ths
[
tm
.
ngx_tm_m⁄
 - 1],

270 (
tm
.
ngx_tm_yór
 > 2037) ?Åm.ngx_tm_year:

271 
tm
.
ngx_tm_yór
 % 100,

272 
tm
.
ngx_tm_hour
,

273 
tm
.
ngx_tm_mö
,

274 
tm
.
ngx_tm_£c
);

275 
	}
}

279 
	$ngx_gmtime
(
time_t
 
t
, 
ngx_tm_t
 *
ç
)

281 
ngx_öt_t
 
yday
;

282 
ngx_uöt_t
 
n
, 
£c
, 
mö
, 
hour
, 
mday
, 
m⁄
, 
yór
, 
wday
, 
days
, 
À≠
;

286 
n
 = (
ngx_uöt_t
Ë
t
;

288 
days
 = 
n
 / 86400;

292 
wday
 = (4 + 
days
) % 7;

294 
n
 %= 86400;

295 
hour
 = 
n
 / 3600;

296 
n
 %= 3600;

297 
mö
 = 
n
 / 60;

298 
£c
 = 
n
 % 60;

306 
days
 = days - (31 + 28) + 719527;

315 
yór
 = (
days
 + 2) * 400 / (365 * 400 + 100 - 4 + 1);

317 
yday
 = 
days
 - (365 * 
yór
 + year / 4 - year / 100 + year / 400);

319 i‡(
yday
 < 0) {

320 
À≠
 = (
yór
 % 4 == 0) && (year % 100 || (year % 400 == 0));

321 
yday
 = 365 + 
À≠
 + yday;

322 
yór
--;

333 
m⁄
 = (
yday
 + 31) * 10 / 306;

337 
mday
 = 
yday
 - (367 * 
m⁄
 / 12 - 30) + 1;

339 i‡(
yday
 >= 306) {

341 
yór
++;

342 
m⁄
 -= 10;

352 
m⁄
 += 2;

361 
ç
->
ngx_tm_£c
 = (
ngx_tm_£c_t
Ë
£c
;

362 
ç
->
ngx_tm_mö
 = (
ngx_tm_mö_t
Ë
mö
;

363 
ç
->
ngx_tm_hour
 = (
ngx_tm_hour_t
Ë
hour
;

364 
ç
->
ngx_tm_mday
 = (
ngx_tm_mday_t
Ë
mday
;

365 
ç
->
ngx_tm_m⁄
 = (
ngx_tm_m⁄_t
Ë
m⁄
;

366 
ç
->
ngx_tm_yór
 = (
ngx_tm_yór_t
Ë
yór
;

367 
ç
->
ngx_tm_wday
 = (
ngx_tm_wday_t
Ë
wday
;

368 
	}
}

371 
time_t


372 
	$ngx_√xt_time
(
time_t
 
whí
)

374 
time_t
 
now
, 
√xt
;

375 
tm
Åm;

377 
now
 = 
	`ngx_time
();

379 
	`ngx_libc_loˇ…ime
(
now
, &
tm
);

381 
tm
.
tm_hour
 = (Ë(
whí
 / 3600);

382 
whí
 %= 3600;

383 
tm
.
tm_mö
 = (Ë(
whí
 / 60);

384 
tm
.
tm_£c
 = (Ë(
whí
 % 60);

386 
√xt
 = 
	`mktime
(&
tm
);

388 i‡(
√xt
 == -1) {

392 i‡(
√xt
 - 
now
 > 0) {

393  
√xt
;

396 
tm
.
tm_mday
++;

400 
√xt
 = 
	`mktime
(&
tm
);

402 i‡(
√xt
 != -1) {

403  
√xt
;

407 
	}
}

	@ngx_times.h

8 #i‚de‡
_NGX_TIMES_H_INCLUDED_


9 
	#_NGX_TIMES_H_INCLUDED_


	)

12 
	~<ngx_c⁄fig.h
>

13 
	~<ngx_c‹e.h
>

17 
time_t
 
	m£c
;

18 
ngx_uöt_t
 
	mm£c
;

19 
ngx_öt_t
 
	mgmtoff
;

20 } 
	tngx_time_t
;

23 
ngx_time_öô
();

24 
ngx_time_upd©e
();

25 
ngx_time_sigß„_upd©e
();

26 
u_ch¨
 *
ngx_hâp_time
(u_ch¨ *
buf
, 
time_t
 
t
);

27 
u_ch¨
 *
ngx_hâp_cookõ_time
(u_ch¨ *
buf
, 
time_t
 
t
);

28 
ngx_gmtime
(
time_t
 
t
, 
ngx_tm_t
 *
ç
);

30 
time_t
 
ngx_√xt_time
—ime_à
whí
);

31 
	#ngx_√xt_time_n
 "mktime()"

	)

34 vﬁ©ûê
ngx_time_t
 *
ngx_ˇched_time
;

36 
	#ngx_time
(Ë
ngx_ˇched_time
->
£c


	)

37 
	#ngx_timeofday
(Ë(
ngx_time_t
 *Ë
ngx_ˇched_time


	)

39 vﬁ©ûê
ngx_°r_t
 
ngx_ˇched_îr_log_time
;

40 vﬁ©ûê
ngx_°r_t
 
ngx_ˇched_hâp_time
;

41 vﬁ©ûê
ngx_°r_t
 
ngx_ˇched_hâp_log_time
;

42 vﬁ©ûê
ngx_°r_t
 
ngx_ˇched_hâp_log_iso8601
;

48 vﬁ©ûê
ngx_m£c_t
 
ngx_cuºít_m£c
;

	@/usr/include/openssl/md5.h

59 #i‚de‡
HEADER_MD5_H


60 
	#HEADER_MD5_H


	)

62 
	~<›ís¶/e_os2.h
>

63 
	~<°ddef.h
>

65 #ifde‡ 
__˝lu•lus


69 #ifde‡
OPENSSL_NO_MD5


70 #îr‹ 
MD5
 
is
 
dißbÀd
.

80 #i‡
deföed
(
OPENSSL_SYS_WIN16
Ë|| deföed(
__LP32__
)

81 
	#MD5_LONG
 

	)

82 #ñi‡
deföed
(
OPENSSL_SYS_CRAY
Ë|| deföed(
__ILP64__
)

83 
	#MD5_LONG
 

	)

84 
	#MD5_LONG_LOG2
 3

	)

93 
	#MD5_LONG
 

	)

96 
	#MD5_CBLOCK
 64

	)

97 
	#MD5_LBLOCK
 (
MD5_CBLOCK
/4)

	)

98 
	#MD5_DIGEST_LENGTH
 16

	)

100 
	sMD5°©e_°


102 
MD5_LONG
 
A
,
B
,
C
,
D
;

103 
MD5_LONG
 
Nl
,
Nh
;

104 
MD5_LONG
 
d©a
[
MD5_LBLOCK
];

105 
num
;

106 } 
	tMD5_CTX
;

108 #ifde‡
OPENSSL_FIPS


109 
¥iv©e_MD5_Inô
(
MD5_CTX
 *
c
);

111 
MD5_Inô
(
MD5_CTX
 *
c
);

112 
MD5_Upd©e
(
MD5_CTX
 *
c
, c⁄° *
d©a
, 
size_t
 
Àn
);

113 
MD5_FöÆ
(*
md
, 
MD5_CTX
 *
c
);

114 *
MD5
(c⁄° *
d
, 
size_t
 
n
, *
md
);

115 
MD5_Tønsf‹m
(
MD5_CTX
 *
c
, c⁄° *
b
);

116 #ifde‡ 
__˝lu•lus


	@/usr/include/openssl/sha.h

59 #i‚de‡
HEADER_SHA_H


60 
	#HEADER_SHA_H


	)

62 
	~<›ís¶/e_os2.h
>

63 
	~<°ddef.h
>

65 #ifde‡ 
__˝lu•lus


69 #i‡
deföed
(
OPENSSL_NO_SHA
Ë|| (deföed(
OPENSSL_NO_SHA0
Ë&& deföed(
OPENSSL_NO_SHA1
))

70 #îr‹ 
SHA
 
is
 
dißbÀd
.

73 #i‡
deföed
(
OPENSSL_FIPS
)

74 
	#FIPS_SHA_SIZE_T
 
size_t


	)

84 #i‡
deföed
(
OPENSSL_SYS_WIN16
Ë|| deföed(
__LP32__
)

85 
	#SHA_LONG
 

	)

86 #ñi‡
deföed
(
OPENSSL_SYS_CRAY
Ë|| deföed(
__ILP64__
)

87 
	#SHA_LONG
 

	)

88 
	#SHA_LONG_LOG2
 3

	)

90 
	#SHA_LONG
 

	)

93 
	#SHA_LBLOCK
 16

	)

94 
	#SHA_CBLOCK
 (
SHA_LBLOCK
*4Ë

	)

97 
	#SHA_LAST_BLOCK
 (
SHA_CBLOCK
-8)

	)

98 
	#SHA_DIGEST_LENGTH
 20

	)

100 
	sSHA°©e_°


102 
SHA_LONG
 
h0
,
h1
,
h2
,
h3
,
h4
;

103 
SHA_LONG
 
Nl
,
Nh
;

104 
SHA_LONG
 
d©a
[
SHA_LBLOCK
];

105 
num
;

106 } 
	tSHA_CTX
;

108 #i‚de‡
OPENSSL_NO_SHA0


109 #ifde‡
OPENSSL_FIPS


110 
¥iv©e_SHA_Inô
(
SHA_CTX
 *
c
);

112 
SHA_Inô
(
SHA_CTX
 *
c
);

113 
SHA_Upd©e
(
SHA_CTX
 *
c
, c⁄° *
d©a
, 
size_t
 
Àn
);

114 
SHA_FöÆ
(*
md
, 
SHA_CTX
 *
c
);

115 *
SHA
(c⁄° *
d
, 
size_t
 
n
, *
md
);

116 
SHA_Tønsf‹m
(
SHA_CTX
 *
c
, c⁄° *
d©a
);

118 #i‚de‡
OPENSSL_NO_SHA1


119 
SHA1_Inô
(
SHA_CTX
 *
c
);

120 
SHA1_Upd©e
(
SHA_CTX
 *
c
, c⁄° *
d©a
, 
size_t
 
Àn
);

121 
SHA1_FöÆ
(*
md
, 
SHA_CTX
 *
c
);

122 *
SHA1
(c⁄° *
d
, 
size_t
 
n
, *
md
);

123 
SHA1_Tønsf‹m
(
SHA_CTX
 *
c
, c⁄° *
d©a
);

126 
	#SHA256_CBLOCK
 (
SHA_LBLOCK
*4Ë

	)

129 
	#SHA224_DIGEST_LENGTH
 28

	)

130 
	#SHA256_DIGEST_LENGTH
 32

	)

132 
	sSHA256°©e_°


134 
SHA_LONG
 
h
[8];

135 
SHA_LONG
 
Nl
,
Nh
;

136 
SHA_LONG
 
d©a
[
SHA_LBLOCK
];

137 
num
,
md_Àn
;

138 } 
	tSHA256_CTX
;

140 #i‚de‡
OPENSSL_NO_SHA256


141 
SHA224_Inô
(
SHA256_CTX
 *
c
);

142 
SHA224_Upd©e
(
SHA256_CTX
 *
c
, c⁄° *
d©a
, 
size_t
 
Àn
);

143 
SHA224_FöÆ
(*
md
, 
SHA256_CTX
 *
c
);

144 *
SHA224
(c⁄° *
d
, 
size_t
 
n
,*
md
);

145 
SHA256_Inô
(
SHA256_CTX
 *
c
);

146 
SHA256_Upd©e
(
SHA256_CTX
 *
c
, c⁄° *
d©a
, 
size_t
 
Àn
);

147 
SHA256_FöÆ
(*
md
, 
SHA256_CTX
 *
c
);

148 *
SHA256
(c⁄° *
d
, 
size_t
 
n
,*
md
);

149 
SHA256_Tønsf‹m
(
SHA256_CTX
 *
c
, c⁄° *
d©a
);

152 
	#SHA384_DIGEST_LENGTH
 48

	)

153 
	#SHA512_DIGEST_LENGTH
 64

	)

155 #i‚de‡
OPENSSL_NO_SHA512


161 
	#SHA512_CBLOCK
 (
SHA_LBLOCK
*8Ë

	)

164 #i‡(
deföed
(
_WIN32
Ë|| deföed(
_WIN64
)Ë&& !deföed(
__MINGW32__
)

165 
	#SHA_LONG64
 
__öt64


	)

166 
	#U64
(
C
ËC##
UI64


	)

167 #ñi‡
deföed
(
__¨ch64__
)

168 
	#SHA_LONG64
 

	)

169 
	#U64
(
C
ËC##
UL


	)

171 
	#SHA_LONG64
 

	)

172 
	#U64
(
C
ËC##
ULL


	)

175 
	sSHA512°©e_°


177 
SHA_LONG64
 
h
[8];

178 
SHA_LONG64
 
Nl
,
Nh
;

180 
SHA_LONG64
 
d
[
SHA_LBLOCK
];

181 
p
[
SHA512_CBLOCK
];

182 } 
u
;

183 
num
,
md_Àn
;

184 } 
	tSHA512_CTX
;

187 #i‚de‡
OPENSSL_NO_SHA512


188 
SHA384_Inô
(
SHA512_CTX
 *
c
);

189 
SHA384_Upd©e
(
SHA512_CTX
 *
c
, c⁄° *
d©a
, 
size_t
 
Àn
);

190 
SHA384_FöÆ
(*
md
, 
SHA512_CTX
 *
c
);

191 *
SHA384
(c⁄° *
d
, 
size_t
 
n
,*
md
);

192 
SHA512_Inô
(
SHA512_CTX
 *
c
);

193 
SHA512_Upd©e
(
SHA512_CTX
 *
c
, c⁄° *
d©a
, 
size_t
 
Àn
);

194 
SHA512_FöÆ
(*
md
, 
SHA512_CTX
 *
c
);

195 *
SHA512
(c⁄° *
d
, 
size_t
 
n
,*
md
);

196 
SHA512_Tønsf‹m
(
SHA512_CTX
 *
c
, c⁄° *
d©a
);

199 #ifde‡ 
__˝lu•lus


	@/usr/include/pcre.h

39 #i‚de‡
_PCRE_H


40 
	#_PCRE_H


	)

55 
	#PCRE_MAJOR
 6

	)

56 
	#PCRE_MINOR
 6

	)

57 
	#PCRE_PRERELEASE


	)

58 
	#PCRE_DATE
 06-
Feb
-2006

	)

63 #ifde‡
_WIN32


64 #ifde‡
PCRE_DEFINITION


65 #ifde‡
DLL_EXPORT


66 
	#PCRE_DATA_SCOPE
 
	`__de˛•ec
(
dŒexp‹t
)

	)

69 #i‚de‡
PCRE_STATIC


70 
	#PCRE_DATA_SCOPE
 
	`__de˛•ec
(
dŒimp‹t
)

	)

77 #i‚de‡
PCRE_DATA_SCOPE


78 #ifde‡
__˝lu•lus


79 
	#PCRE_DATA_SCOPE
 "C"

	)

81 
	#PCRE_DATA_SCOPE
 

	)

88 
	~<°dlib.h
>

92 #ifde‡
__˝lu•lus


98 
	#PCRE_CASELESS
 0x00000001

	)

99 
	#PCRE_MULTILINE
 0x00000002

	)

100 
	#PCRE_DOTALL
 0x00000004

	)

101 
	#PCRE_EXTENDED
 0x00000008

	)

102 
	#PCRE_ANCHORED
 0x00000010

	)

103 
	#PCRE_DOLLAR_ENDONLY
 0x00000020

	)

104 
	#PCRE_EXTRA
 0x00000040

	)

105 
	#PCRE_NOTBOL
 0x00000080

	)

106 
	#PCRE_NOTEOL
 0x00000100

	)

107 
	#PCRE_UNGREEDY
 0x00000200

	)

108 
	#PCRE_NOTEMPTY
 0x00000400

	)

109 
	#PCRE_UTF8
 0x00000800

	)

110 
	#PCRE_NO_AUTO_CAPTURE
 0x00001000

	)

111 
	#PCRE_NO_UTF8_CHECK
 0x00002000

	)

112 
	#PCRE_AUTO_CALLOUT
 0x00004000

	)

113 
	#PCRE_PARTIAL
 0x00008000

	)

114 
	#PCRE_DFA_SHORTEST
 0x00010000

	)

115 
	#PCRE_DFA_RESTART
 0x00020000

	)

116 
	#PCRE_FIRSTLINE
 0x00040000

	)

120 
	#PCRE_ERROR_NOMATCH
 (-1)

	)

121 
	#PCRE_ERROR_NULL
 (-2)

	)

122 
	#PCRE_ERROR_BADOPTION
 (-3)

	)

123 
	#PCRE_ERROR_BADMAGIC
 (-4)

	)

124 
	#PCRE_ERROR_UNKNOWN_NODE
 (-5)

	)

125 
	#PCRE_ERROR_NOMEMORY
 (-6)

	)

126 
	#PCRE_ERROR_NOSUBSTRING
 (-7)

	)

127 
	#PCRE_ERROR_MATCHLIMIT
 (-8)

	)

128 
	#PCRE_ERROR_CALLOUT
 (-9Ë

	)

129 
	#PCRE_ERROR_BADUTF8
 (-10)

	)

130 
	#PCRE_ERROR_BADUTF8_OFFSET
 (-11)

	)

131 
	#PCRE_ERROR_PARTIAL
 (-12)

	)

132 
	#PCRE_ERROR_BADPARTIAL
 (-13)

	)

133 
	#PCRE_ERROR_INTERNAL
 (-14)

	)

134 
	#PCRE_ERROR_BADCOUNT
 (-15)

	)

135 
	#PCRE_ERROR_DFA_UITEM
 (-16)

	)

136 
	#PCRE_ERROR_DFA_UCOND
 (-17)

	)

137 
	#PCRE_ERROR_DFA_UMLIMIT
 (-18)

	)

138 
	#PCRE_ERROR_DFA_WSSIZE
 (-19)

	)

139 
	#PCRE_ERROR_DFA_RECURSE
 (-20)

	)

140 
	#PCRE_ERROR_RECURSIONLIMIT
 (-21)

	)

144 
	#PCRE_INFO_OPTIONS
 0

	)

145 
	#PCRE_INFO_SIZE
 1

	)

146 
	#PCRE_INFO_CAPTURECOUNT
 2

	)

147 
	#PCRE_INFO_BACKREFMAX
 3

	)

148 
	#PCRE_INFO_FIRSTBYTE
 4

	)

149 
	#PCRE_INFO_FIRSTCHAR
 4

	)

150 
	#PCRE_INFO_FIRSTTABLE
 5

	)

151 
	#PCRE_INFO_LASTLITERAL
 6

	)

152 
	#PCRE_INFO_NAMEENTRYSIZE
 7

	)

153 
	#PCRE_INFO_NAMECOUNT
 8

	)

154 
	#PCRE_INFO_NAMETABLE
 9

	)

155 
	#PCRE_INFO_STUDYSIZE
 10

	)

156 
	#PCRE_INFO_DEFAULT_TABLES
 11

	)

161 
	#PCRE_CONFIG_UTF8
 0

	)

162 
	#PCRE_CONFIG_NEWLINE
 1

	)

163 
	#PCRE_CONFIG_LINK_SIZE
 2

	)

164 
	#PCRE_CONFIG_POSIX_MALLOC_THRESHOLD
 3

	)

165 
	#PCRE_CONFIG_MATCH_LIMIT
 4

	)

166 
	#PCRE_CONFIG_STACKRECURSE
 5

	)

167 
	#PCRE_CONFIG_UNICODE_PROPERTIES
 6

	)

168 
	#PCRE_CONFIG_MATCH_LIMIT_RECURSION
 7

	)

173 
	#PCRE_EXTRA_STUDY_DATA
 0x0001

	)

174 
	#PCRE_EXTRA_MATCH_LIMIT
 0x0002

	)

175 
	#PCRE_EXTRA_CALLOUT_DATA
 0x0004

	)

176 
	#PCRE_EXTRA_TABLES
 0x0008

	)

177 
	#PCRE_EXTRA_MATCH_LIMIT_RECURSION
 0x0010

	)

181 
ªÆ_p¸e
;

182 
ªÆ_p¸e
 
	tp¸e
;

188 #i‚de‡
PCRE_SPTR


189 
	#PCRE_SPTR
 c⁄° *

	)

196 
	sp¸e_exåa
 {

197 
Êags
;

198 *
°udy_d©a
;

199 
m©ch_limô
;

200 *
ˇŒout_d©a
;

201 c⁄° *
èbÀs
;

202 
m©ch_limô_ªcursi⁄
;

203 } 
	tp¸e_exåa
;

210 
	sp¸e_ˇŒout_block
 {

211 
vîsi⁄
;

213 
ˇŒout_numbî
;

214 *
off£t_ve˘‹
;

215 
PCRE_SPTR
 
subje˘
;

216 
subje˘_Àngth
;

217 
°¨t_m©ch
;

218 
cuºít_posôi⁄
;

219 
ˇ±uª_t›
;

220 
ˇ±uª_œ°
;

221 *
ˇŒout_d©a
;

223 
∑âîn_posôi⁄
;

224 
√xt_ôem_Àngth
;

226 } 
	tp¸e_ˇŒout_block
;

234 #i‚de‡
VPCOMPAT


235 
PCRE_DATA_SCOPE
 *(*
p¸e_mÆloc
)(
size_t
);

236 
PCRE_DATA_SCOPE
 (*
p¸e_‰ì
)(*);

237 
PCRE_DATA_SCOPE
 *(*
p¸e_°ack_mÆloc
)(
size_t
);

238 
PCRE_DATA_SCOPE
 (*
p¸e_°ack_‰ì
)(*);

239 
PCRE_DATA_SCOPE
 (*
p¸e_ˇŒout
)(
p¸e_ˇŒout_block
 *);

241 
PCRE_DATA_SCOPE
 *
p¸e_mÆloc
(
size_t
);

242 
PCRE_DATA_SCOPE
 
p¸e_‰ì
(*);

243 
PCRE_DATA_SCOPE
 *
p¸e_°ack_mÆloc
(
size_t
);

244 
PCRE_DATA_SCOPE
 
p¸e_°ack_‰ì
(*);

245 
PCRE_DATA_SCOPE
 
p¸e_ˇŒout
(
p¸e_ˇŒout_block
 *);

250 
PCRE_DATA_SCOPE
 
p¸e
 *
p¸e_compûe
(const *, , const **, *,

252 
PCRE_DATA_SCOPE
 
p¸e
 *
p¸e_compûe2
(const *, , *, const **,

254 
PCRE_DATA_SCOPE
 
p¸e_c⁄fig
(, *);

255 
PCRE_DATA_SCOPE
 
p¸e_c›y_«med_sub°rög
(c⁄° 
p¸e
 *, const *,

257 
PCRE_DATA_SCOPE
 
p¸e_c›y_sub°rög
(const *, *, , , *,

259 
PCRE_DATA_SCOPE
 
p¸e_dÁ_exec
(c⁄° 
p¸e
 *, c⁄° 
p¸e_exåa
 *,

261 
PCRE_DATA_SCOPE
 
p¸e_exec
(c⁄° 
p¸e
 *, c⁄° 
p¸e_exåa
 *, 
PCRE_SPTR
,

263 
PCRE_DATA_SCOPE
 
p¸e_‰ì_sub°rög
(const *);

264 
PCRE_DATA_SCOPE
 
p¸e_‰ì_sub°rög_li°
(const **);

265 
PCRE_DATA_SCOPE
 
p¸e_fuŒöfo
(c⁄° 
p¸e
 *, c⁄° 
p¸e_exåa
 *, ,

267 
PCRE_DATA_SCOPE
 
p¸e_gë_«med_sub°rög
(c⁄° 
p¸e
 *, const *,

269 
PCRE_DATA_SCOPE
 
p¸e_gë_°rögnumbî
(c⁄° 
p¸e
 *, const *);

270 
PCRE_DATA_SCOPE
 
p¸e_gë_sub°rög
(const *, *, , ,

272 
PCRE_DATA_SCOPE
 
p¸e_gë_sub°rög_li°
(const *, *, ,

274 
PCRE_DATA_SCOPE
 
p¸e_öfo
(c⁄° 
p¸e
 *, *, *);

275 
PCRE_DATA_SCOPE
 c⁄° *
p¸e_makëabÀs
();

276 
PCRE_DATA_SCOPE
 
p¸e_ªfcou¡
(
p¸e
 *, );

277 
PCRE_DATA_SCOPE
 
p¸e_exåa
 *
p¸e_°udy
(c⁄° 
p¸e
 *, , const **);

278 
PCRE_DATA_SCOPE
 c⁄° *
p¸e_vîsi⁄
();

280 #ifde‡
__˝lu•lus


	@/usr/include/openssl/e_os2.h

56 
	~<›ís¶/›ís¶c⁄f.h
>

58 #i‚de‡
HEADER_E_OS2_H


59 
	#HEADER_E_OS2_H


	)

61 #ifde‡ 
__˝lu•lus


71 
	#OPENSSL_SYS_UNIX


	)

74 #i‡
deföed
(
__MWERKS__
Ë&& deföed(
macötosh
Ë|| deföed(
OPENSSL_SYSNAME_MAC
)

75 #unde‡
OPENSSL_SYS_UNIX


76 
	#OPENSSL_SYS_MACINTOSH_CLASSIC


	)

80 #i‡
deföed
(
NETWARE
Ë|| deföed(
OPENSSL_SYSNAME_NETWARE
)

81 #unde‡
OPENSSL_SYS_UNIX


82 
	#OPENSSL_SYS_NETWARE


	)

89 #i‡
deföed
(
OPENSSL_SYSNAME_MSDOS
)

90 #unde‡
OPENSSL_SYS_UNIX


91 
	#OPENSSL_SYS_MSDOS


	)

96 #i‡
deföed
(
OPENSSL_SYSNAME_UWIN
)

97 #unde‡
OPENSSL_SYS_UNIX


98 
	#OPENSSL_SYS_WIN32_UWIN


	)

100 #i‡
deföed
(
__CYGWIN32__
Ë|| deföed(
OPENSSL_SYSNAME_CYGWIN32
)

101 #unde‡
OPENSSL_SYS_UNIX


102 
	#OPENSSL_SYS_WIN32_CYGWIN


	)

104 #i‡
deföed
(
_WIN32
Ë|| deföed(
OPENSSL_SYSNAME_WIN32
)

105 #unde‡
OPENSSL_SYS_UNIX


106 
	#OPENSSL_SYS_WIN32


	)

108 #i‡
deföed
(
OPENSSL_SYSNAME_WINNT
)

109 #unde‡
OPENSSL_SYS_UNIX


110 
	#OPENSSL_SYS_WINNT


	)

112 #i‡
deföed
(
OPENSSL_SYSNAME_WINCE
)

113 #unde‡
OPENSSL_SYS_UNIX


114 
	#OPENSSL_SYS_WINCE


	)

120 #i‡
deföed
(
OPENSSL_SYS_WIN32
Ë|| deföed(
OPENSSL_SYS_WINNT
Ë|| deföed(
OPENSSL_SYS_WINCE
)

121 #unde‡
OPENSSL_SYS_UNIX


122 
	#OPENSSL_SYS_WINDOWS


	)

123 #i‚de‡
OPENSSL_SYS_MSDOS


124 
	#OPENSSL_SYS_MSDOS


	)

131 #ifde‡
OPENSSL_SYS_WINDOWS


132 #i‚de‡
OPENSSL_OPT_WINDLL


133 #i‡
deföed
(
_WINDLL
)

135 
	#OPENSSL_OPT_WINDLL


	)

141 #i‡
deföed
(
__VMS
Ë|| deföed(
VMS
Ë|| deföed(
OPENSSL_SYSNAME_VMS
)

142 #unde‡
OPENSSL_SYS_UNIX


143 
	#OPENSSL_SYS_VMS


	)

144 #i‡
deföed
(
__DECC
)

145 
	#OPENSSL_SYS_VMS_DECC


	)

146 #ñi‡
deföed
(
__DECCXX
)

147 
	#OPENSSL_SYS_VMS_DECC


	)

148 
	#OPENSSL_SYS_VMS_DECCXX


	)

150 
	#OPENSSL_SYS_VMS_NODECC


	)

155 #i‡
deföed
(
__EMX__
Ë|| deföed(
__OS2__
)

156 #unde‡
OPENSSL_SYS_UNIX


157 
	#OPENSSL_SYS_OS2


	)

161 #ifde‡
OPENSSL_SYS_UNIX


162 #i‡
deföed
(
löux
Ë|| deföed(
__löux__
Ë|| deföed(
OPENSSL_SYSNAME_LINUX
)

163 
	#OPENSSL_SYS_LINUX


	)

165 #ifde‡
OPENSSL_SYSNAME_MPE


166 
	#OPENSSL_SYS_MPE


	)

168 #ifde‡
OPENSSL_SYSNAME_SNI


169 
	#OPENSSL_SYS_SNI


	)

171 #ifde‡
OPENSSL_SYSNAME_ULTRASPARC


172 
	#OPENSSL_SYS_ULTRASPARC


	)

174 #ifde‡
OPENSSL_SYSNAME_NEWS4


175 
	#OPENSSL_SYS_NEWS4


	)

177 #ifde‡
OPENSSL_SYSNAME_MACOSX


178 
	#OPENSSL_SYS_MACOSX


	)

180 #ifde‡
OPENSSL_SYSNAME_MACOSX_RHAPSODY


181 
	#OPENSSL_SYS_MACOSX_RHAPSODY


	)

182 
	#OPENSSL_SYS_MACOSX


	)

184 #ifde‡
OPENSSL_SYSNAME_SUNOS


185 
	#OPENSSL_SYS_SUNOS


	)

187 #i‡
deföed
(
_CRAY
Ë|| deföed(
OPENSSL_SYSNAME_CRAY
)

188 
	#OPENSSL_SYS_CRAY


	)

190 #i‡
deföed
(
_AIX
Ë|| deföed(
OPENSSL_SYSNAME_AIX
)

191 
	#OPENSSL_SYS_AIX


	)

196 #ifde‡
OPENSSL_SYSNAME_VOS


197 
	#OPENSSL_SYS_VOS


	)

201 #ifde‡
OPENSSL_SYSNAME_VXWORKS


202 
	#OPENSSL_SYS_VXWORKS


	)

211 #ifde‡
OPENSSL_SYS_MSDOS


212 
	#OPENSSL_UNISTD_IO
 <
io
.
h
>

	)

213 
	#OPENSSL_DECLARE_EXIT
 
	`exô
();

	)

215 
	#OPENSSL_UNISTD_IO
 
OPENSSL_UNISTD


	)

216 
	#OPENSSL_DECLARE_EXIT


	)

238 #i‡
deföed
(
OPENSSL_SYS_VMS_NODECC
)

239 
	#OPENSSL_EXPORT
 
globÆªf


	)

240 
	#OPENSSL_IMPORT
 
globÆªf


	)

241 
	#OPENSSL_GLOBAL
 
globÆdef


	)

242 #ñi‡
deföed
(
OPENSSL_SYS_WINDOWS
Ë&& deföed(
OPENSSL_OPT_WINDLL
)

243 
	#OPENSSL_EXPORT
 
	`__de˛•ec
(
dŒexp‹t
)

	)

244 
	#OPENSSL_IMPORT
 
	`__de˛•ec
(
dŒimp‹t
)

	)

245 
	#OPENSSL_GLOBAL


	)

247 
	#OPENSSL_EXPORT
 

	)

248 
	#OPENSSL_IMPORT
 

	)

249 
	#OPENSSL_GLOBAL


	)

251 
	#OPENSSL_EXTERN
 
OPENSSL_IMPORT


	)

263 #ifde‡
OPENSSL_EXPORT_VAR_AS_FUNCTION


264 
	#OPENSSL_IMPLEMENT_GLOBAL
(
ty≥
,
«me
) \

265 
ty≥
 
_hide_
##
«me
; \

266 
ty≥
 *
_shadow_
##
	`«me
(Ë{  &
_hide_
##
«me
; } \

267 
ty≥
 
_hide_
##
«me


	)

268 
	#OPENSSL_DECLARE_GLOBAL
(
ty≥
,
«me
Ëty≥ *
_shadow_
##
	`«me
()

	)

269 
	#OPENSSL_GLOBAL_REF
(
«me
Ë(*(
_shadow_
##
	`«me
()))

	)

271 
	#OPENSSL_IMPLEMENT_GLOBAL
(
ty≥
,
«me
Ë
OPENSSL_GLOBAL
Åy≥ 
_shadow_
##
	)
name

272 
	#OPENSSL_DECLARE_GLOBAL
(
ty≥
,
«me
Ë
OPENSSL_EXPORT
Åy≥ 
_shadow_
##
	)
name

273 
	#OPENSSL_GLOBAL_REF
(
«me
Ë
_shadow_
##
	)
name

276 #ifde‡ 
__˝lu•lus


	@/usr/include/stdlib.h

23 #i‚def 
_STDLIB_H


25 
	~<„©uªs.h
>

28 
	#__√ed_size_t


	)

29 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


30 
	#__√ed_wch¨_t


	)

31 
	#__√ed_NULL


	)

33 
	~<°ddef.h
>

35 
	g__BEGIN_DECLS


37 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


38 
	#_STDLIB_H
 1

	)

40 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
_SYS_WAIT_H


42 
	~<bôs/waôÊags.h
>

43 
	~<bôs/waô°©us.h
>

45 #ifde‡
__USE_BSD


50 #i‡
deföed
 
__GNUC__
 && !deföed 
__˝lu•lus


51 
	#__WAIT_INT
(
°©us
) \

52 (
	`__exãnsi⁄__
 ({ uni⁄ { 
	`__ty≥of
(
°©us
Ë
__ö
; 
__i
; } 
__u
; \

53 
__u
.
__ö
 = (
°©us
); __u.
__i
; }))

	)

55 
	#__WAIT_INT
(
°©us
Ë(*(*Ë&(°©us))

	)

63 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2 || deföed 
__˝lu•lus


64 
	#__WAIT_STATUS
 *

	)

65 
	#__WAIT_STATUS_DEFN
 *

	)

70 
waô
 *
	m__u±r
;

71 *
	m__ùå
;

72 } 
	t__WAIT_STATUS
 
	t__©åibuã__
 ((
	t__å™•¨ít_uni⁄__
));

73 
	#__WAIT_STATUS_DEFN
 *

	)

78 
	#__WAIT_INT
(
°©us
Ë(°©us)

	)

79 
	#__WAIT_STATUS
 *

	)

80 
	#__WAIT_STATUS_DEFN
 *

	)

85 
	#WEXITSTATUS
(
°©us
Ë
	`__WEXITSTATUS
(
	`__WAIT_INT
(°©us))

	)

86 
	#WTERMSIG
(
°©us
Ë
	`__WTERMSIG
(
	`__WAIT_INT
(°©us))

	)

87 
	#WSTOPSIG
(
°©us
Ë
	`__WSTOPSIG
(
	`__WAIT_INT
(°©us))

	)

88 
	#WIFEXITED
(
°©us
Ë
	`__WIFEXITED
(
	`__WAIT_INT
(°©us))

	)

89 
	#WIFSIGNALED
(
°©us
Ë
	`__WIFSIGNALED
(
	`__WAIT_INT
(°©us))

	)

90 
	#WIFSTOPPED
(
°©us
Ë
	`__WIFSTOPPED
(
	`__WAIT_INT
(°©us))

	)

91 #ifde‡
__WIFCONTINUED


92 
	#WIFCONTINUED
(
°©us
Ë
	`__WIFCONTINUED
(
	`__WAIT_INT
(°©us))

	)

96 
__BEGIN_NAMESPACE_STD


100 
	mquŸ
;

101 
	mªm
;

102 } 
	tdiv_t
;

105 #i‚de‡
__ldiv_t_deföed


108 
	mquŸ
;

109 
	mªm
;

110 } 
	tldiv_t
;

111 
	#__ldiv_t_deföed
 1

	)

113 
	g__END_NAMESPACE_STD


115 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__Œdiv_t_deföed


116 
__BEGIN_NAMESPACE_C99


118 
__exãnsi⁄__
 struct

120 
	mquŸ
;

121 
	mªm
;

122 } 
	tŒdiv_t
;

123 
	#__Œdiv_t_deföed
 1

	)

124 
	g__END_NAMESPACE_C99


129 
	#RAND_MAX
 2147483647

	)

134 
	#EXIT_FAILURE
 1

	)

135 
	#EXIT_SUCCESS
 0

	)

139 
	#MB_CUR_MAX
 (
	`__˘y≥_gë_mb_cur_max
 ())

	)

140 
size_t
 
	$__˘y≥_gë_mb_cur_max
 (Ë
__THROW
 
__wur
;

143 
__BEGIN_NAMESPACE_STD


145 
	$©of
 (
__c⁄°
 *
__≈å
)

146 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

148 
	$©oi
 (
__c⁄°
 *
__≈å
)

149 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

151 
	$©ﬁ
 (
__c⁄°
 *
__≈å
)

152 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

153 
__END_NAMESPACE_STD


155 #i‡
deföed
 
__USE_ISOC99
 || (deföed 
__GLIBC_HAVE_LONG_LONG
 && deföed 
__USE_MISC
)

156 
__BEGIN_NAMESPACE_C99


158 
__exãnsi⁄__
 
	$©ﬁl
 (
__c⁄°
 *
__≈å
)

159 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

160 
__END_NAMESPACE_C99


163 
__BEGIN_NAMESPACE_STD


165 
	$°πod
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

166 **
__ª°ri˘
 
__íd±r
)

167 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

168 
__END_NAMESPACE_STD


170 #ifdef 
__USE_ISOC99


171 
__BEGIN_NAMESPACE_C99


173 
	$°πof
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

174 **
__ª°ri˘
 
__íd±r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

176 
	$°πﬁd
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

177 **
__ª°ri˘
 
__íd±r
)

178 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

179 
__END_NAMESPACE_C99


182 
__BEGIN_NAMESPACE_STD


184 
	$°πﬁ
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

185 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

186 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

188 
	$°πoul
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

189 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

190 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

191 
__END_NAMESPACE_STD


193 #i‡
deföed
 
__GLIBC_HAVE_LONG_LONG
 && deföed 
__USE_BSD


195 
__exãnsi⁄__


196 
	$°πoq
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

197 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

198 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

200 
__exãnsi⁄__


201 
	$°πouq
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

202 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

203 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

206 #i‡
deföed
 
__USE_ISOC99
 || (deföed 
__GLIBC_HAVE_LONG_LONG
 && deföed 
__USE_MISC
)

207 
__BEGIN_NAMESPACE_C99


209 
__exãnsi⁄__


210 
	$°πﬁl
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

211 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

212 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

214 
__exãnsi⁄__


215 
	$°πouŒ
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

216 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

217 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

218 
__END_NAMESPACE_C99


222 #ifde‡
__USE_GNU


236 
	~<xloˇÀ.h
>

240 
	$°πﬁ_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

241 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

242 
__loˇÀ_t
 
__loc
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 4)Ë
__wur
;

244 
	$°πoul_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

245 **
__ª°ri˘
 
__íd±r
,

246 
__ba£
, 
__loˇÀ_t
 
__loc
)

247 
__THROW
 
	`__n⁄nuŒ
 ((1, 4)Ë
__wur
;

249 
__exãnsi⁄__


250 
	$°πﬁl_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

251 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

252 
__loˇÀ_t
 
__loc
)

253 
__THROW
 
	`__n⁄nuŒ
 ((1, 4)Ë
__wur
;

255 
__exãnsi⁄__


256 
	$°πouŒ_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

257 **
__ª°ri˘
 
__íd±r
,

258 
__ba£
, 
__loˇÀ_t
 
__loc
)

259 
__THROW
 
	`__n⁄nuŒ
 ((1, 4)Ë
__wur
;

261 
	$°πod_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

262 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

263 
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

265 
	$°πof_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

266 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

267 
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

269 
	$°πﬁd_l
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

270 **
__ª°ri˘
 
__íd±r
,

271 
__loˇÀ_t
 
__loc
)

272 
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

279 
	$__°πod_öã∫Æ
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

280 **
__ª°ri˘
 
__íd±r
, 
__group
)

281 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

282 
	$__°πof_öã∫Æ
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

283 **
__ª°ri˘
 
__íd±r
, 
__group
)

284 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

285 
	$__°πﬁd_öã∫Æ
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

286 **
__ª°ri˘
 
__íd±r
,

287 
__group
)

288 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

289 #i‚de‡
__°πﬁ_öã∫Æ_deföed


290 
	$__°πﬁ_öã∫Æ
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

291 **
__ª°ri˘
 
__íd±r
,

292 
__ba£
, 
__group
)

293 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

294 
	#__°πﬁ_öã∫Æ_deföed
 1

	)

296 #i‚de‡
__°πoul_öã∫Æ_deföed


297 
	$__°πoul_öã∫Æ
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

298 **
__ª°ri˘
 
__íd±r
,

299 
__ba£
, 
__group
)

300 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

301 
	#__°πoul_öã∫Æ_deföed
 1

	)

303 #i‡
deföed
 
__GNUC__
 || deföed 
__USE_ISOC99


304 #i‚de‡
__°πﬁl_öã∫Æ_deföed


305 
__exãnsi⁄__


306 
	$__°πﬁl_öã∫Æ
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
,

307 **
__ª°ri˘
 
__íd±r
,

308 
__ba£
, 
__group
)

309 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

310 
	#__°πﬁl_öã∫Æ_deföed
 1

	)

312 #i‚de‡
__°πouŒ_öã∫Æ_deföed


313 
__exãnsi⁄__


314 
	$__°πouŒ_öã∫Æ
 (
__c⁄°
 *

315 
__ª°ri˘
 
__≈å
,

316 **
__ª°ri˘
 
__íd±r
,

317 
__ba£
, 
__group
)

318 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

319 
	#__°πouŒ_öã∫Æ_deföed
 1

	)

323 #ifde‡
__USE_EXTERN_INLINES


326 
__BEGIN_NAMESPACE_STD


327 
__ölöe
 

328 
	`__NTH
 (
	$°πod
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
, **__ª°ri˘ 
__íd±r
))

330  
	`__°πod_öã∫Æ
 (
__≈å
, 
__íd±r
, 0);

331 
	}
}

332 
__ölöe
 

333 
__NTH
 (
	$°πﬁ
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
, **__ª°ri˘ 
__íd±r
,

334 
__ba£
))

336  
	`__°πﬁ_öã∫Æ
 (
__≈å
, 
__íd±r
, 
__ba£
, 0);

337 
	}
}

338 
__ölöe
 

339 
__NTH
 (
	$°πoul
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
, **__ª°ri˘ 
__íd±r
,

340 
__ba£
))

342  
	`__°πoul_öã∫Æ
 (
__≈å
, 
__íd±r
, 
__ba£
, 0);

343 
	}
}

344 
__END_NAMESPACE_STD


346 #ifde‡
__USE_ISOC99


347 
__BEGIN_NAMESPACE_C99


348 
__ölöe
 

349 
__NTH
 (
	$°πof
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
, **__ª°ri˘ 
__íd±r
))

351  
	`__°πof_öã∫Æ
 (
__≈å
, 
__íd±r
, 0);

352 
	}
}

353 #i‚de‡
__LDBL_COMPAT


354 
__ölöe
 

355 
__NTH
 (
	$°πﬁd
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
, **__ª°ri˘ 
__íd±r
))

357  
	`__°πﬁd_öã∫Æ
 (
__≈å
, 
__íd±r
, 0);

358 
	}
}

360 
__END_NAMESPACE_C99


363 #ifde‡
__USE_BSD


364 
__exãnsi⁄__
 
__ölöe
 

365 
__NTH
 (
	$°πoq
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
, **__ª°ri˘ 
__íd±r
,

366 
__ba£
))

368  
	`__°πﬁl_öã∫Æ
 (
__≈å
, 
__íd±r
, 
__ba£
, 0);

369 
	}
}

370 
__exãnsi⁄__
 
__ölöe
 

371 
__NTH
 (
	$°πouq
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
, **__ª°ri˘ 
__íd±r
,

372 
__ba£
))

374  
	`__°πouŒ_öã∫Æ
 (
__≈å
, 
__íd±r
, 
__ba£
, 0);

375 
	}
}

378 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_ISOC99


379 
__BEGIN_NAMESPACE_C99


380 
__exãnsi⁄__
 
__ölöe
 

381 
__NTH
 (
	$°πﬁl
 (
__c⁄°
 *
__ª°ri˘
 
__≈å
, **__ª°ri˘ 
__íd±r
,

382 
__ba£
))

384  
	`__°πﬁl_öã∫Æ
 (
__≈å
, 
__íd±r
, 
__ba£
, 0);

385 
	}
}

386 
__exãnsi⁄__
 
__ölöe
 

387 
__NTH
 (
	$°πouŒ
 (
__c⁄°
 * 
__ª°ri˘
 
__≈å
, **__ª°ri˘ 
__íd±r
,

388 
__ba£
))

390  
	`__°πouŒ_öã∫Æ
 (
__≈å
, 
__íd±r
, 
__ba£
, 0);

391 
	}
}

392 
__END_NAMESPACE_C99


395 
__BEGIN_NAMESPACE_STD


396 
__ölöe
 

397 
__NTH
 (
	$©of
 (
__c⁄°
 *
__≈å
))

399  
	`°πod
 (
__≈å
, (**Ë
NULL
);

400 
	}
}

401 
__ölöe
 

402 
__NTH
 (
	$©oi
 (
__c⁄°
 *
__≈å
))

404  (Ë
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

405 
	}
}

406 
__ölöe
 

407 
__NTH
 (
	$©ﬁ
 (
__c⁄°
 *
__≈å
))

409  
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

410 
	}
}

411 
__END_NAMESPACE_STD


413 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_ISOC99


414 
__BEGIN_NAMESPACE_C99


415 
__exãnsi⁄__
 
__ölöe
 

416 
__NTH
 (
	$©ﬁl
 (
__c⁄°
 *
__≈å
))

418  
	`°πﬁl
 (
__≈å
, (**Ë
NULL
, 10);

419 
	}
}

420 
__END_NAMESPACE_C99


425 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED


429 *
	$l64a
 (
__n
Ë
__THROW
 
__wur
;

432 
	$a64l
 (
__c⁄°
 *
__s
)

433 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

437 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_BSD


438 
	~<sys/ty≥s.h
>

445 
	$øndom
 (Ë
__THROW
;

448 
	$§™dom
 (
__£ed
Ë
__THROW
;

454 *
	$öô°©e
 (
__£ed
, *
__°©ebuf
,

455 
size_t
 
__°©ñí
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

459 *
	$£t°©e
 (*
__°©ebuf
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

462 #ifde‡
__USE_MISC


467 
	søndom_d©a


469 
öt32_t
 *
Âå
;

470 
öt32_t
 *
Ωå
;

471 
öt32_t
 *
°©e
;

472 
ønd_ty≥
;

473 
ønd_deg
;

474 
ønd_£p
;

475 
öt32_t
 *
íd_±r
;

478 
	$øndom_r
 (
øndom_d©a
 *
__ª°ri˘
 
__buf
,

479 
öt32_t
 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

481 
	$§™dom_r
 (
__£ed
, 
øndom_d©a
 *
__buf
)

482 
__THROW
 
	`__n⁄nuŒ
 ((2));

484 
	$öô°©e_r
 (
__£ed
, *
__ª°ri˘
 
__°©ebuf
,

485 
size_t
 
__°©ñí
,

486 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

487 
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

489 
	$£t°©e_r
 (*
__ª°ri˘
 
__°©ebuf
,

490 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

491 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

496 
__BEGIN_NAMESPACE_STD


498 
	$ønd
 (Ë
__THROW
;

500 
	$§™d
 (
__£ed
Ë
__THROW
;

501 
__END_NAMESPACE_STD


503 #ifde‡
__USE_POSIX


505 
	$ønd_r
 (*
__£ed
Ë
__THROW
;

509 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


513 
	$dønd48
 (Ë
__THROW
;

514 
	`î™d48
 (
__xsubi
[3]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

517 
	$Ã™d48
 (Ë
__THROW
;

518 
	`ƒ™d48
 (
__xsubi
[3])

519 
__THROW
 
	`__n⁄nuŒ
 ((1));

522 
	$mønd48
 (Ë
__THROW
;

523 
	`jønd48
 (
__xsubi
[3])

524 
__THROW
 
	`__n⁄nuŒ
 ((1));

527 
	$§™d48
 (
__£edvÆ
Ë
__THROW
;

528 *
	`£ed48
 (
__£ed16v
[3])

529 
__THROW
 
	`__n⁄nuŒ
 ((1));

530 
	`lc⁄g48
 (
__∑øm
[7]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

532 #ifde‡
__USE_MISC


536 
	sdønd48_d©a


538 
__x
[3];

539 
__ﬁd_x
[3];

540 
__c
;

541 
__öô
;

542 
__a
;

546 
	$dønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

547 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

548 
	`î™d48_r
 (
__xsubi
[3],

549 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

550 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

553 
	$Ã™d48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

554 *
__ª°ri˘
 
__ªsu…
)

555 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

556 
	`ƒ™d48_r
 (
__xsubi
[3],

557 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

558 *
__ª°ri˘
 
__ªsu…
)

559 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

562 
	$mønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

563 *
__ª°ri˘
 
__ªsu…
)

564 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

565 
	`jønd48_r
 (
__xsubi
[3],

566 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

567 *
__ª°ri˘
 
__ªsu…
)

568 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

571 
	$§™d48_r
 (
__£edvÆ
, 
dønd48_d©a
 *
__buf„r
)

572 
__THROW
 
	`__n⁄nuŒ
 ((2));

574 
	`£ed48_r
 (
__£ed16v
[3],

575 
dønd48_d©a
 *
__buf„r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

577 
	`lc⁄g48_r
 (
__∑øm
[7],

578 
dønd48_d©a
 *
__buf„r
)

579 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

585 #i‚de‡
__mÆloc_™d_ˇŒoc_deföed


586 
	#__mÆloc_™d_ˇŒoc_deföed


	)

587 
__BEGIN_NAMESPACE_STD


589 *
	$mÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

591 *
	$ˇŒoc
 (
size_t
 
__nmemb
, size_à
__size
)

592 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

593 
__END_NAMESPACE_STD


596 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


597 
__BEGIN_NAMESPACE_STD


600 *
	$ªÆloc
 (*
__±r
, 
size_t
 
__size
)

601 
__THROW
 
__©åibuã_mÆloc__
 
__©åibuã_w¨n_unu£d_ªsu…__
;

603 
	$‰ì
 (*
__±r
Ë
__THROW
;

604 
__END_NAMESPACE_STD


606 #ifdef 
__USE_MISC


608 
	$c‰ì
 (*
__±r
Ë
__THROW
;

611 #i‡
deföed
 
__USE_GNU
 || deföed 
__USE_BSD
 || deföed 
__USE_MISC


612 
	~<Æloˇ.h
>

615 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


617 *
	$vÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

620 #ifde‡
__USE_XOPEN2K


622 
	$posix_memÆign
 (**
__mem±r
, 
size_t
 
__Æignmít
, size_à
__size
)

623 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

626 
__BEGIN_NAMESPACE_STD


628 
	$ab‹t
 (Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

632 
	`©exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

633 
__END_NAMESPACE_STD


635 #ifdef 
__USE_MISC


638 
	`⁄_exô
 ((*
__func
Ë(
__°©us
, *
__¨g
), *__arg)

639 
__THROW
 
	`__n⁄nuŒ
 ((1));

642 
__BEGIN_NAMESPACE_STD


646 
	$exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

647 
__END_NAMESPACE_STD


649 #ifde‡
__USE_ISOC99


650 
__BEGIN_NAMESPACE_C99


653 
	$_Exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

654 
__END_NAMESPACE_C99


658 
__BEGIN_NAMESPACE_STD


660 *
	$gëív
 (
__c⁄°
 *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

661 
__END_NAMESPACE_STD


665 *
	$__£cuª_gëív
 (
__c⁄°
 *
__«me
)

666 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

668 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


672 
	$puãnv
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

675 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN2K


678 
	$£ãnv
 (
__c⁄°
 *
__«me
, __c⁄° *
__vÆue
, 
__ª∂a˚
)

679 
__THROW
 
	`__n⁄nuŒ
 ((2));

682 
	$un£ãnv
 (
__c⁄°
 *
__«me
Ë
__THROW
;

685 #ifdef 
__USE_MISC


689 
	$˛óªnv
 (Ë
__THROW
;

693 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


698 *
	$mkãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

708 #i‚de‡
__USE_FILE_OFFSET64


709 
	$mk°emp
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

711 #ifde‡
__REDIRECT


712 
	`__REDIRECT
 (
mk°emp
, (*
__ãm∂©e
), 
mk°emp64
)

713 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

715 
	#mk°emp
 
mk°emp64


	)

718 #ifde‡
__USE_LARGEFILE64


719 
	$mk°emp64
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

723 #ifde‡
__USE_BSD


729 *
	$mkdãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

733 
__BEGIN_NAMESPACE_STD


738 
	$sy°em
 (
__c⁄°
 *
__comm™d
Ë
__wur
;

739 
__END_NAMESPACE_STD


742 #ifdef 
__USE_GNU


746 *
	$ˇn⁄iˇlize_fûe_«me
 (
__c⁄°
 *
__«me
)

747 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

750 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


756 *
	$ªÆ∑th
 (
__c⁄°
 *
__ª°ri˘
 
__«me
,

757 *
__ª°ri˘
 
__ªsﬁved
Ë
__THROW
 
__wur
;

762 #i‚de‡
__COMPAR_FN_T


763 
	#__COMPAR_FN_T


	)

764 (*
	t__com∑r_‚_t
Ë(
	t__c⁄°
 *, __const *);

766 #ifdef 
__USE_GNU


767 
__com∑r_‚_t
 
	tcom∑ris⁄_‚_t
;

771 
__BEGIN_NAMESPACE_STD


774 *
	$b£¨ch
 (
__c⁄°
 *
__key
, __c⁄° *
__ba£
,

775 
size_t
 
__nmemb
, size_à
__size
, 
__com∑r_‚_t
 
__com∑r
)

776 
	`__n⁄nuŒ
 ((1, 2, 5)Ë
__wur
;

780 
	$qs‹t
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

781 
__com∑r_‚_t
 
__com∑r
Ë
	`__n⁄nuŒ
 ((1, 4));

785 
	$abs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

786 
	$œbs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

787 
__END_NAMESPACE_STD


789 #ifde‡
__USE_ISOC99


790 
__exãnsi⁄__
 
	$Œabs
 (
__x
)

791 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

795 
__BEGIN_NAMESPACE_STD


799 
div_t
 
	$div
 (
__numî
, 
__díom
)

800 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

801 
ldiv_t
 
	$ldiv
 (
__numî
, 
__díom
)

802 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

803 
__END_NAMESPACE_STD


805 #ifde‡
__USE_ISOC99


806 
__BEGIN_NAMESPACE_C99


807 
__exãnsi⁄__
 
Œdiv_t
 
	$Œdiv
 (
__numî
,

808 
__díom
)

809 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

810 
__END_NAMESPACE_C99


814 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED


821 *
	$ecvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

822 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

827 *
	$fcvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

828 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

833 *
	$gcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

834 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

837 #ifde‡
__USE_MISC


839 *
	$qecvt
 (
__vÆue
, 
__ndigô
,

840 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

841 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

842 *
	$qfcvt
 (
__vÆue
, 
__ndigô
,

843 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

844 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

845 *
	$qgcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

846 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

851 
	$ecvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

852 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

853 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

854 
	$fcvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

855 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

856 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

858 
	$qecvt_r
 (
__vÆue
, 
__ndigô
,

859 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

860 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

861 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

862 
	$qfcvt_r
 (
__vÆue
, 
__ndigô
,

863 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

864 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

865 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

870 
__BEGIN_NAMESPACE_STD


873 
	$mbÀn
 (
__c⁄°
 *
__s
, 
size_t
 
__n
Ë
__THROW
 
__wur
;

876 
	$mbtowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

877 
__c⁄°
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
 
__wur
;

880 
	$w˘omb
 (*
__s
, 
wch¨_t
 
__wch¨
Ë
__THROW
 
__wur
;

884 
size_t
 
	$mb°owcs
 (
wch¨_t
 *
__ª°ri˘
 
__pwcs
,

885 
__c⁄°
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
;

887 
size_t
 
	$wc°ombs
 (*
__ª°ri˘
 
__s
,

888 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__pwcs
, 
size_t
 
__n
)

889 
__THROW
;

890 
__END_NAMESPACE_STD


893 #ifde‡
__USE_SVID


898 
	$Ωm©ch
 (
__c⁄°
 *
__ª•⁄£
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

902 #ifde‡
__USE_XOPEN_EXTENDED


909 
	$gësub›t
 (**
__ª°ri˘
 
__›ti⁄p
,

910 *
__c⁄°
 *
__ª°ri˘
 
__tokís
,

911 **
__ª°ri˘
 
__vÆuï
)

912 
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3)Ë
__wur
;

916 #ifde‡
__USE_XOPEN


918 
	$£tkey
 (
__c⁄°
 *
__key
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

924 #ifde‡
__USE_XOPEN2K


926 
	$posix_›í±
 (
__oÊag
Ë
__wur
;

929 #ifde‡
__USE_XOPEN


934 
	$gø¡±
 (
__fd
Ë
__THROW
;

938 
	$u∆ock±
 (
__fd
Ë
__THROW
;

943 *
	$±¢ame
 (
__fd
Ë
__THROW
 
__wur
;

946 #ifde‡
__USE_GNU


950 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

951 
__THROW
 
	`__n⁄nuŒ
 ((2));

954 
	`gë±
 ();

957 #ifde‡
__USE_BSD


961 
	$gëlﬂdavg
 (
__lﬂdavg
[], 
__√Àm
)

962 
__THROW
 
	`__n⁄nuŒ
 ((1));

967 #i‡
__USE_FORTIFY_LEVEL
 > 0 && !
deföed
 
__˝lu•lus


968 
	~<bôs/°dlib.h
>

970 #ifde‡
__LDBL_COMPAT


971 
	~<bôs/°dlib-ldbl.h
>

975 #unde‡
__√ed_mÆloc_™d_ˇŒoc


977 
__END_DECLS


	@/usr/include/alloca.h

19 #i‚def 
_ALLOCA_H


20 
	#_ALLOCA_H
 1

	)

22 
	~<„©uªs.h
>

24 
	#__√ed_size_t


	)

25 
	~<°ddef.h
>

27 
	g__BEGIN_DECLS


30 #unde‡
Æloˇ


33 *
	$Æloˇ
 (
size_t
 
__size
Ë
__THROW
;

35 #ifdef 
__GNUC__


36 
	#Æloˇ
(
size
Ë
	`__buûtö_Æloˇ
 (size)

	)

39 
__END_DECLS


	@/usr/include/bits/stdlib-ldbl.h

20 #i‚de‡
_STDLIB_H


24 #ifdef 
__USE_ISOC99


25 
__BEGIN_NAMESPACE_C99


26 
	$__LDBL_REDIR1_DECL
 (
°πﬁd
, 
°πod
)

27 
__END_NAMESPACE_C99


30 #ifde‡
__USE_GNU


31 
	$__LDBL_REDIR1_DECL
 (
°πﬁd_l
, 
°πod_l
)

34 
	$__LDBL_REDIR1_DECL
 (
__°πﬁd_öã∫Æ
, 
__°πod_öã∫Æ
)

36 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED


37 #ifde‡
__USE_MISC


38 
	$__LDBL_REDIR1_DECL
 (
qecvt
, 
ecvt
)

39 
	$__LDBL_REDIR1_DECL
 (
qfcvt
, 
fcvt
)

40 
	$__LDBL_REDIR1_DECL
 (
qgcvt
, 
gcvt
)

41 
	$__LDBL_REDIR1_DECL
 (
qecvt_r
, 
ecvt_r
)

42 
	$__LDBL_REDIR1_DECL
 (
qfcvt_r
, 
fcvt_r
)

	@/usr/include/bits/stdlib.h

20 #i‚de‡
_STDLIB_H


24 *
	$__ªÆ∑th_chk
 (
__c⁄°
 *
__ª°ri˘
 
__«me
,

25 *
__ª°ri˘
 
__ªsﬁved
,

26 
size_t
 
__ªsﬁvedÀn
Ë
__THROW
 
__wur
;

27 *
	`__REDIRECT_NTH
 (
__ªÆ∑th_Æüs
,

28 (
__c⁄°
 *
__ª°ri˘
 
__«me
,

29 *
__ª°ri˘
 
__ªsﬁved
), 
ªÆ∑th
Ë
__wur
;

31 
__Æways_ölöe
 
__wur
 *

32 
	`__NTH
 (
	$ªÆ∑th
 (
__c⁄°
 *
__ª°ri˘
 
__«me
, *__ª°ri˘ 
__ªsﬁved
))

34 i‡(
	`__bos
 (
__ªsﬁved
Ë!(
size_t
) -1)

35  
	`__ªÆ∑th_chk
 (
__«me
, 
__ªsﬁved
, 
	`__bos
 (__resolved));

37  
	`__ªÆ∑th_Æüs
 (
__«me
, 
__ªsﬁved
);

38 
	}
}

41 
	$__±¢ame_r_chk
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
,

42 
size_t
 
__ƒól
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

43 
	`__REDIRECT_NTH
 (
__±¢ame_r_Æüs
, (
__fd
, *
__buf
,

44 
size_t
 
__buÊí
), 
±¢ame_r
)

45 
	`__n⁄nuŒ
 ((2));

47 
__Æways_ölöe
 

48 
	`__NTH
 (
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
))

50 i‡(
	`__bos
 (
__buf
Ë!(
size_t
) -1

51 && (!
	`__buûtö_c⁄°™t_p
 (
__buÊí
Ë|| __buÊí > 
	`__bos
 (
__buf
)))

52  
	`__±¢ame_r_chk
 (
__fd
, 
__buf
, 
__buÊí
, 
	`__bos
 (__buf));

53  
	`__±¢ame_r_Æüs
 (
__fd
, 
__buf
, 
__buÊí
);

54 
	}
}

57 
	$__w˘omb_chk
 (*
__s
, 
wch¨_t
 
__wch¨
, 
size_t
 
__buÊí
)

58 
__THROW
 
__wur
;

59 
	`__REDIRECT_NTH
 (
__w˘omb_Æüs
, (*
__s
, 
wch¨_t
 
__wch¨
),

60 
w˘omb
Ë
__wur
;

62 
__Æways_ölöe
 
__wur
 

63 
	`__NTH
 (
	$w˘omb
 (*
__s
, 
wch¨_t
 
__wch¨
))

68 
	#__STDLIB_MB_LEN_MAX
 16

	)

69 #i‡
deföed
 
MB_LEN_MAX
 && MB_LEN_MAX !
__STDLIB_MB_LEN_MAX


72 i‡(
	`__bos
 (
__s
Ë!(
size_t
Ë-1 && 
__STDLIB_MB_LEN_MAX
 > __bos (__s))

73  
	`__w˘omb_chk
 (
__s
, 
__wch¨
, 
	`__bos
 (__s));

74  
	`__w˘omb_Æüs
 (
__s
, 
__wch¨
);

75 
	}
}

78 
size_t
 
	$__mb°owcs_chk
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

79 
__c⁄°
 *
__ª°ri˘
 
__§c
,

80 
size_t
 
__Àn
, size_à
__d°Àn
Ë
__THROW
;

81 
size_t
 
	`__REDIRECT_NTH
 (
__mb°owcs_Æüs
,

82 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

83 
__c⁄°
 *
__ª°ri˘
 
__§c
,

84 
size_t
 
__Àn
), 
mb°owcs
);

86 
__Æways_ölöe
 
size_t


87 
	`__NTH
 (
	$mb°owcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
, 
__c⁄°
 *__ª°ri˘ 
__§c
,

88 
size_t
 
__Àn
))

90 i‡(
	`__bos
 (
__d°
Ë!(
size_t
) -1

91 && (!
	`__buûtö_c⁄°™t_p
 (
__Àn
)

92 || 
__Àn
 > 
	`__bos
 (
__d°
Ë/  (
wch¨_t
)))

93  
	`__mb°owcs_chk
 (
__d°
, 
__§c
, 
__Àn
,

94 
	`__bos
 (
__d°
Ë/  (
wch¨_t
));

95  
	`__mb°owcs_Æüs
 (
__d°
, 
__§c
, 
__Àn
);

96 
	}
}

99 
size_t
 
	$__wc°ombs_chk
 (*
__ª°ri˘
 
__d°
,

100 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
,

101 
size_t
 
__Àn
, size_à
__d°Àn
Ë
__THROW
;

102 
size_t
 
	`__REDIRECT_NTH
 (
__wc°ombs_Æüs
,

103 (*
__ª°ri˘
 
__d°
,

104 
__c⁄°
 
wch¨_t
 *
__ª°ri˘
 
__§c
,

105 
size_t
 
__Àn
), 
wc°ombs
);

107 
__Æways_ölöe
 
size_t


108 
	`__NTH
 (
	$wc°ombs
 (*
__ª°ri˘
 
__d°
, 
__c⁄°
 
wch¨_t
 *__ª°ri˘ 
__§c
,

109 
size_t
 
__Àn
))

111 i‡(
	`__bos
 (
__d°
Ë!(
size_t
) -1

112 && (!
	`__buûtö_c⁄°™t_p
 (
__Àn
Ë|| __À¿> 
	`__bos
 (
__d°
)))

113  
	`__wc°ombs_chk
 (
__d°
, 
__§c
, 
__Àn
, 
	`__bos
 (__dst));

114  
	`__wc°ombs_Æüs
 (
__d°
, 
__§c
, 
__Àn
);

115 
	}
}

	@/usr/include/bits/waitflags.h

20 #i‡!
deföed
 
_SYS_WAIT_H
 && !deföed 
_STDLIB_H


26 
	#WNOHANG
 1

	)

27 
	#WUNTRACED
 2

	)

30 
	#WSTOPPED
 2

	)

31 
	#WEXITED
 4

	)

32 
	#WCONTINUED
 8

	)

33 
	#WNOWAIT
 0x01000000

	)

35 
	#__WNOTHREAD
 0x20000000

	)

37 
	#__WALL
 0x40000000

	)

38 
	#__WCLONE
 0x80000000

	)

	@/usr/include/bits/waitstatus.h

20 #i‡!
deföed
 
_SYS_WAIT_H
 && !deföed 
_STDLIB_H


29 
	#__WEXITSTATUS
(
°©us
Ë(((°©usË& 0xff00Ë>> 8)

	)

32 
	#__WTERMSIG
(
°©us
Ë((°©usË& 0x7f)

	)

35 
	#__WSTOPSIG
(
°©us
Ë
	`__WEXITSTATUS
(°©us)

	)

38 
	#__WIFEXITED
(
°©us
Ë(
	`__WTERMSIG
(°©usË=0)

	)

41 
	#__WIFSIGNALED
(
°©us
) \

42 (((sig√d Ë(((
°©us
Ë& 0x7fË+ 1Ë>> 1Ë> 0)

	)

45 
	#__WIFSTOPPED
(
°©us
Ë(((°©usË& 0xffË=0x7f)

	)

49 #ifde‡
WCONTINUED


50 
	#__WIFCONTINUED
(
°©us
Ë((°©usË=
__W_CONTINUED
)

	)

54 
	#__WCOREDUMP
(
°©us
Ë((°©usË& 
__WCOREFLAG
)

	)

57 
	#__W_EXITCODE
(
ªt
, 
sig
Ë(‘ëË<< 8 | (sig))

	)

58 
	#__W_STOPCODE
(
sig
Ë((sigË<< 8 | 0x7f)

	)

59 
	#__W_CONTINUED
 0xffff

	)

60 
	#__WCOREFLAG
 0x80

	)

63 #ifdef 
__USE_BSD


65 
	~<ídün.h
>

67 
	uwaô


69 
	mw_°©us
;

72 #if 
__BYTE_ORDER
 =
__LITTLE_ENDIAN


73 
	m__w_ãrmsig
:7;

74 
	m__w_c‹edump
:1;

75 
	m__w_ªtcode
:8;

78 #if 
__BYTE_ORDER
 =
__BIG_ENDIAN


80 
	m__w_ªtcode
:8;

81 
	m__w_c‹edump
:1;

82 
	m__w_ãrmsig
:7;

84 } 
	m__waô_ãrmö©ed
;

87 #if 
__BYTE_ORDER
 =
__LITTLE_ENDIAN


88 
	m__w_°›vÆ
:8;

89 
	m__w_°›sig
:8;

92 #if 
__BYTE_ORDER
 =
__BIG_ENDIAN


94 
	m__w_°›sig
:8;

95 
	m__w_°›vÆ
:8;

97 } 
	m__waô_°›≥d
;

100 
	#w_ãrmsig
 
__waô_ãrmö©ed
.
__w_ãrmsig


	)

101 
	#w_c‹edump
 
__waô_ãrmö©ed
.
__w_c‹edump


	)

102 
	#w_ªtcode
 
__waô_ãrmö©ed
.
__w_ªtcode


	)

103 
	#w_°›sig
 
__waô_°›≥d
.
__w_°›sig


	)

104 
	#w_°›vÆ
 
__waô_°›≥d
.
__w_°›vÆ


	)

	@/usr/include/features.h

20 #i‚def 
_FEATURES_H


21 
	#_FEATURES_H
 1

	)

93 #unde‡
__USE_ISOC99


94 #unde‡
__USE_POSIX


95 #unde‡
__USE_POSIX2


96 #unde‡
__USE_POSIX199309


97 #unde‡
__USE_POSIX199506


98 #unde‡
__USE_XOPEN


99 #unde‡
__USE_XOPEN_EXTENDED


100 #unde‡
__USE_UNIX98


101 #unde‡
__USE_XOPEN2K


102 #unde‡
__USE_LARGEFILE


103 #unde‡
__USE_LARGEFILE64


104 #unde‡
__USE_FILE_OFFSET64


105 #unde‡
__USE_BSD


106 #unde‡
__USE_SVID


107 #unde‡
__USE_MISC


108 #unde‡
__USE_ATFILE


109 #unde‡
__USE_GNU


110 #unde‡
__USE_REENTRANT


111 #unde‡
__USE_FORTIFY_LEVEL


112 #unde‡
__FAVOR_BSD


113 #unde‡
__KERNEL_STRICT_NAMES


117 #i‚de‡
_LOOSE_KERNEL_NAMES


118 
	#__KERNEL_STRICT_NAMES


	)

122 
	#__USE_ANSI
 1

	)

131 #i‡
deföed
 
__GNUC__
 && deföed 
__GNUC_MINOR__


132 
	#__GNUC_PREREQ
(
maj
, 
mö
) \

133 ((
__GNUC__
 << 16Ë+ 
__GNUC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

135 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë0

	)

140 #i‡
deföed
 
_BSD_SOURCE
 && \

141 !(
deföed
 
	g_POSIX_SOURCE
 || deföed 
	g_POSIX_C_SOURCE
 || \

142 
deföed
 
	g_XOPEN_SOURCE
 || deföed 
	g_XOPEN_SOURCE_EXTENDED
 || \

143 
deföed
 
	g_GNU_SOURCE
 || deföed 
	g_SVID_SOURCE
)

144 
	#__FAVOR_BSD
 1

	)

148 #ifde‡
_GNU_SOURCE


149 #unde‡
_ISOC99_SOURCE


150 
	#_ISOC99_SOURCE
 1

	)

151 #unde‡
_POSIX_SOURCE


152 
	#_POSIX_SOURCE
 1

	)

153 #unde‡
_POSIX_C_SOURCE


154 
	#_POSIX_C_SOURCE
 200112L

	)

155 #unde‡
_XOPEN_SOURCE


156 
	#_XOPEN_SOURCE
 600

	)

157 #unde‡
_XOPEN_SOURCE_EXTENDED


158 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

159 #unde‡
_LARGEFILE64_SOURCE


160 
	#_LARGEFILE64_SOURCE
 1

	)

161 #unde‡
_BSD_SOURCE


162 
	#_BSD_SOURCE
 1

	)

163 #unde‡
_SVID_SOURCE


164 
	#_SVID_SOURCE
 1

	)

165 #unde‡
_ATFILE_SOURCE


166 
	#_ATFILE_SOURCE
 1

	)

171 #i‡(!
deföed
 
__STRICT_ANSI__
 && !deföed 
_ISOC99_SOURCE
 && \

172 !
deföed
 
	g_POSIX_SOURCE
 && !deföed 
	g_POSIX_C_SOURCE
 && \

173 !
deföed
 
	g_XOPEN_SOURCE
 && !deföed 
	g_XOPEN_SOURCE_EXTENDED
 && \

174 !
deföed
 
	g_BSD_SOURCE
 && !deföed 
	g_SVID_SOURCE
)

175 
	#_BSD_SOURCE
 1

	)

176 
	#_SVID_SOURCE
 1

	)

183 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC9X_SOURCE
 \

184 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

185 
	#__USE_ISOC99
 1

	)

190 #i‡((!
deföed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

191 !
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE
)

192 
	#_POSIX_SOURCE
 1

	)

193 #i‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

194 
	#_POSIX_C_SOURCE
 2

	)

195 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

196 
	#_POSIX_C_SOURCE
 199506L

	)

198 
	#_POSIX_C_SOURCE
 200112L

	)

202 #i‡
deföed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >1 || deföed 
_XOPEN_SOURCE


203 
	#__USE_POSIX
 1

	)

206 #i‡
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >2 || deföed 
_XOPEN_SOURCE


207 
	#__USE_POSIX2
 1

	)

210 #i‡(
_POSIX_C_SOURCE
 - 0) >= 199309L

211 
	#__USE_POSIX199309
 1

	)

214 #i‡(
_POSIX_C_SOURCE
 - 0) >= 199506L

215 
	#__USE_POSIX199506
 1

	)

218 #i‡(
_POSIX_C_SOURCE
 - 0) >= 200112L

219 
	#__USE_XOPEN2K
 1

	)

222 #ifdef 
_XOPEN_SOURCE


223 
	#__USE_XOPEN
 1

	)

224 #i‡(
_XOPEN_SOURCE
 - 0) >= 500

225 
	#__USE_XOPEN_EXTENDED
 1

	)

226 
	#__USE_UNIX98
 1

	)

227 #unde‡
_LARGEFILE_SOURCE


228 
	#_LARGEFILE_SOURCE
 1

	)

229 #i‡(
_XOPEN_SOURCE
 - 0) >= 600

230 
	#__USE_XOPEN2K
 1

	)

231 #unde‡
__USE_ISOC99


232 
	#__USE_ISOC99
 1

	)

235 #ifde‡
_XOPEN_SOURCE_EXTENDED


236 
	#__USE_XOPEN_EXTENDED
 1

	)

241 #ifde‡
_LARGEFILE_SOURCE


242 
	#__USE_LARGEFILE
 1

	)

245 #ifde‡
_LARGEFILE64_SOURCE


246 
	#__USE_LARGEFILE64
 1

	)

249 #i‡
deföed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

250 
	#__USE_FILE_OFFSET64
 1

	)

253 #i‡
deföed
 
_BSD_SOURCE
 || deföed 
_SVID_SOURCE


254 
	#__USE_MISC
 1

	)

257 #ifdef 
_BSD_SOURCE


258 
	#__USE_BSD
 1

	)

261 #ifdef 
_SVID_SOURCE


262 
	#__USE_SVID
 1

	)

265 #ifdef 
_ATFILE_SOURCE


266 
	#__USE_ATFILE
 1

	)

269 #ifdef 
_GNU_SOURCE


270 
	#__USE_GNU
 1

	)

273 #i‡
deföed
 
_REENTRANT
 || deföed 
_THREAD_SAFE


274 
	#__USE_REENTRANT
 1

	)

277 #i‡
deföed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

278 && 
deföed
 
__OPTIMIZE__
 && __OPTIMIZE__ > 0 \

279 && (
__GNUC_PREREQ
 (4, 1) \

280 || (
deföed
 
	g__GNUC_RH_RELEASE__
 && 
__GNUC_PREREQ
 (4, 0)) \

281 || (
deföed
 
	g__GNUC_RH_RELEASE__
 && 
__GNUC_PREREQ
 (3, 4) \

282 && 
	g__GNUC_MINOR__
 == 4 \

283 && (
__GNUC_PATCHLEVEL__
 > 2 \

284 || (
__GNUC_PATCHLEVEL__
 =2 && 
__GNUC_RH_RELEASE__
 >= 8))))

285 #i‡
_FORTIFY_SOURCE
 > 1

286 
	#__USE_FORTIFY_LEVEL
 2

	)

288 
	#__USE_FORTIFY_LEVEL
 1

	)

291 
	#__USE_FORTIFY_LEVEL
 0

	)

295 
	#__STDC_IEC_559__
 1

	)

296 
	#__STDC_IEC_559_COMPLEX__
 1

	)

299 
	#__STDC_ISO_10646__
 200009L

	)

307 #unde‡
__GNU_LIBRARY__


308 
	#__GNU_LIBRARY__
 6

	)

312 
	#__GLIBC__
 2

	)

313 
	#__GLIBC_MINOR__
 5

	)

315 
	#__GLIBC_PREREQ
(
maj
, 
mö
) \

316 ((
__GLIBC__
 << 16Ë+ 
__GLIBC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

319 #i‡
deföed
 
__GNUC__
 \

320 || (
deföed
 
	g__PGI
 && deföed 
	g__i386__
 ) \

321 || (
deföed
 
	g__INTEL_COMPILER
 && (deföed 
	g__i386__
 || deföed 
	g__ü64__
)) \

322 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L)

323 
	#__GLIBC_HAVE_LONG_LONG
 1

	)

327 #i‚de‡
__ASSEMBLER__


328 #i‚de‡
_SYS_CDEFS_H


329 
	~<sys/cdefs.h
>

334 #i‡
deföed
 
__USE_FILE_OFFSET64
 && !deföed 
__REDIRECT


335 
	#__USE_LARGEFILE
 1

	)

336 
	#__USE_LARGEFILE64
 1

	)

342 #i‡
__GNUC_PREREQ
 (2, 7Ë&& 
deföed
 
__OPTIMIZE__
 \

343 && !
deföed
 
	g__OPTIMIZE_SIZE__
 && !deföed 
	g__NO_INLINE__


344 
	#__USE_EXTERN_INLINES
 1

	)

352 
	~<gnu/°ubs.h
>

	@/usr/include/openssl/opensslconf.h

7 #ifde‡
›ís¶_›ís¶c⁄f_mu…ûib_ªdúe˘i⁄_h


10 
	#›ís¶_›ís¶c⁄f_mu…ûib_ªdúe˘i⁄_h


	)

12 #i‡
deföed
(
__i386__
)

13 
	~"›ís¶c⁄f-i386.h
"

14 #ñi‡
deföed
(
__ü64__
)

15 
	~"›ís¶c⁄f-ü64.h
"

16 #ñi‡
deföed
(
__powîpc64__
)

17 
	~"›ís¶c⁄f-µc64.h
"

18 #ñi‡
deföed
(
__powîpc__
)

19 
	~"›ís¶c⁄f-µc.h
"

20 #ñi‡
deföed
(
__s390x__
)

21 
	~"›ís¶c⁄f-s390x.h
"

22 #ñi‡
deföed
(
__s390__
)

23 
	~"›ís¶c⁄f-s390.h
"

24 #ñi‡
deföed
(
__x86_64__
)

25 
	~"›ís¶c⁄f-x86_64.h
"

30 #unde‡
›ís¶_›ís¶c⁄f_mu…ûib_ªdúe˘i⁄_h


	@/usr/include/sys/types.h

24 #i‚def 
_SYS_TYPES_H


25 
	#_SYS_TYPES_H
 1

	)

27 
	~<„©uªs.h
>

29 
	g__BEGIN_DECLS


31 
	~<bôs/ty≥s.h
>

33 #ifdef 
__USE_BSD


34 #i‚de‡
__u_ch¨_deföed


35 
__u_ch¨
 
	tu_ch¨
;

36 
__u_sh‹t
 
	tu_sh‹t
;

37 
__u_öt
 
	tu_öt
;

38 
__u_l⁄g
 
	tu_l⁄g
;

39 
__quad_t
 
	tquad_t
;

40 
__u_quad_t
 
	tu_quad_t
;

41 
__fsid_t
 
	tfsid_t
;

42 
	#__u_ch¨_deföed


	)

46 
__loff_t
 
	tloff_t
;

48 #i‚de‡
__öo_t_deföed


49 #i‚de‡
__USE_FILE_OFFSET64


50 
__öo_t
 
	töo_t
;

52 
__öo64_t
 
	töo_t
;

54 
	#__öo_t_deföed


	)

56 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__öo64_t_deföed


57 
__öo64_t
 
	töo64_t
;

58 
	#__öo64_t_deföed


	)

61 #i‚de‡
__dev_t_deföed


62 
__dev_t
 
	tdev_t
;

63 
	#__dev_t_deföed


	)

66 #i‚de‡
__gid_t_deföed


67 
__gid_t
 
	tgid_t
;

68 
	#__gid_t_deföed


	)

71 #i‚de‡
__mode_t_deföed


72 
__mode_t
 
	tmode_t
;

73 
	#__mode_t_deföed


	)

76 #i‚de‡
__∆ök_t_deföed


77 
__∆ök_t
 
	t∆ök_t
;

78 
	#__∆ök_t_deföed


	)

81 #i‚de‡
__uid_t_deföed


82 
__uid_t
 
	tuid_t
;

83 
	#__uid_t_deföed


	)

86 #i‚de‡
__off_t_deföed


87 #i‚de‡
__USE_FILE_OFFSET64


88 
__off_t
 
	toff_t
;

90 
__off64_t
 
	toff_t
;

92 
	#__off_t_deföed


	)

94 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


95 
__off64_t
 
	toff64_t
;

96 
	#__off64_t_deföed


	)

99 #i‚de‡
__pid_t_deföed


100 
__pid_t
 
	tpid_t
;

101 
	#__pid_t_deföed


	)

104 #i‡(
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN
Ë&& !deföed 
__id_t_deföed


105 
__id_t
 
	tid_t
;

106 
	#__id_t_deföed


	)

109 #i‚de‡
__ssize_t_deföed


110 
__ssize_t
 
	tssize_t
;

111 
	#__ssize_t_deföed


	)

114 #ifdef 
__USE_BSD


115 #i‚de‡
__daddr_t_deföed


116 
__daddr_t
 
	tdaddr_t
;

117 
__ˇddr_t
 
	tˇddr_t
;

118 
	#__daddr_t_deföed


	)

122 #i‡(
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN
Ë&& !deföed 
__key_t_deföed


123 
__key_t
 
	tkey_t
;

124 
	#__key_t_deföed


	)

127 #ifde‡
__USE_XOPEN


128 
	#__√ed_˛ock_t


	)

130 
	#__√ed_time_t


	)

131 
	#__√ed_timî_t


	)

132 
	#__√ed_˛ockid_t


	)

133 
	~<time.h
>

135 #ifde‡
__USE_XOPEN


136 #i‚de‡
__u£c⁄ds_t_deföed


137 
__u£c⁄ds_t
 
	tu£c⁄ds_t
;

138 
	#__u£c⁄ds_t_deföed


	)

140 #i‚de‡
__su£c⁄ds_t_deföed


141 
__su£c⁄ds_t
 
	tsu£c⁄ds_t
;

142 
	#__su£c⁄ds_t_deföed


	)

146 
	#__√ed_size_t


	)

147 
	~<°ddef.h
>

149 #ifde‡
__USE_MISC


151 
	tul⁄g
;

152 
	tush‹t
;

153 
	tuöt
;

158 #i‡!
__GNUC_PREREQ
 (2, 7)

161 #i‚de‡
__öt8_t_deföed


162 
	#__öt8_t_deföed


	)

163 
	töt8_t
;

164 
	töt16_t
;

165 
	töt32_t
;

166 #i‡
__WORDSIZE
 == 64

167 
	töt64_t
;

168 #ñi‡
__GLIBC_HAVE_LONG_LONG


169 
__exãnsi⁄__
 
	töt64_t
;

174 
	tu_öt8_t
;

175 
	tu_öt16_t
;

176 
	tu_öt32_t
;

177 #i‡
__WORDSIZE
 == 64

178 
	tu_öt64_t
;

179 #ñi‡
__GLIBC_HAVE_LONG_LONG


180 
__exãnsi⁄__
 
	tu_öt64_t
;

183 
	tªgi°î_t
;

188 
	#__ötN_t
(
N
, 
MODE
) \

189 ##
	tN
##
	t_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	tMODE
)))

	)

190 
	t__u_ötN_t
(
	tN
, 
	tMODE
) \

191 
	tu_öt
##
	tN
##
	t_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	tMODE
)))

	)

193 #i‚de‡
	t__öt8_t_deföed


194 
	t__öt8_t_deföed


	)

195 
	t__ötN_t
 (8, 
	t__QI__
);

196 
__ötN_t
 (16, 
__HI__
);

197 
__ötN_t
 (32, 
__SI__
);

198 
__ötN_t
 (64, 
__DI__
);

201 
__u_ötN_t
 (8, 
__QI__
);

202 
__u_ötN_t
 (16, 
__HI__
);

203 
__u_ötN_t
 (32, 
__SI__
);

204 
__u_ötN_t
 (64, 
__DI__
);

206 
	tªgi°î_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	t__w‹d__
)));

212 
	#__BIT_TYPES_DEFINED__
 1

	)

215 #ifdef 
__USE_BSD


217 
	~<ídün.h
>

220 
	~<sys/£À˘.h
>

223 
	~<sys/sysma¸os.h
>

227 #i‡
deföed
 
__USE_UNIX98
 && !deföed 
__blksize_t_deföed


228 
__blksize_t
 
	tblksize_t
;

229 
	#__blksize_t_deföed


	)

233 #i‚de‡
__USE_FILE_OFFSET64


234 #i‚de‡
__blk˙t_t_deföed


235 
__blk˙t_t
 
	tblk˙t_t
;

236 
	#__blk˙t_t_deföed


	)

238 #i‚de‡
__fsblk˙t_t_deföed


239 
__fsblk˙t_t
 
	tfsblk˙t_t
;

240 
	#__fsblk˙t_t_deföed


	)

242 #i‚de‡
__fsfû˙t_t_deföed


243 
__fsfû˙t_t
 
	tfsfû˙t_t
;

244 
	#__fsfû˙t_t_deföed


	)

247 #i‚de‡
__blk˙t_t_deföed


248 
__blk˙t64_t
 
	tblk˙t_t
;

249 
	#__blk˙t_t_deföed


	)

251 #i‚de‡
__fsblk˙t_t_deföed


252 
__fsblk˙t64_t
 
	tfsblk˙t_t
;

253 
	#__fsblk˙t_t_deföed


	)

255 #i‚de‡
__fsfû˙t_t_deföed


256 
__fsfû˙t64_t
 
	tfsfû˙t_t
;

257 
	#__fsfû˙t_t_deföed


	)

261 #ifde‡
__USE_LARGEFILE64


262 
__blk˙t64_t
 
	tblk˙t64_t
;

263 
__fsblk˙t64_t
 
	tfsblk˙t64_t
;

264 
__fsfû˙t64_t
 
	tfsfû˙t64_t
;

269 #i‡
deföed
 
__USE_POSIX199506
 || deföed 
__USE_UNIX98


270 
	~<bôs/±hªadty≥s.h
>

273 
	g__END_DECLS


	@/usr/include/xlocale.h

21 #i‚de‡
_XLOCALE_H


22 
	#_XLOCALE_H
 1

	)

28 
	s__loˇÀ_°ru˘


31 
loˇÀ_d©a
 *
	m__loˇÀs
[13];

34 c⁄° *
	m__˘y≥_b
;

35 c⁄° *
	m__˘y≥_tﬁowî
;

36 c⁄° *
	m__˘y≥_touµî
;

39 c⁄° *
	m__«mes
[13];

40 } *
	t__loˇÀ_t
;

	@/usr/include/bits/pthreadtypes.h

20 #i‚de‡
_BITS_PTHREADTYPES_H


21 
	#_BITS_PTHREADTYPES_H
 1

	)

23 
	~<bôs/w‹dsize.h
>

25 #i‡
__WORDSIZE
 == 64

26 
	#__SIZEOF_PTHREAD_ATTR_T
 56

	)

27 
	#__SIZEOF_PTHREAD_MUTEX_T
 40

	)

28 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

29 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

30 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

31 
	#__SIZEOF_PTHREAD_RWLOCK_T
 56

	)

32 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

33 
	#__SIZEOF_PTHREAD_BARRIER_T
 32

	)

34 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

36 
	#__SIZEOF_PTHREAD_ATTR_T
 36

	)

37 
	#__SIZEOF_PTHREAD_MUTEX_T
 24

	)

38 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

39 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

40 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

41 
	#__SIZEOF_PTHREAD_RWLOCK_T
 32

	)

42 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

43 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

44 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

50 
	t±hªad_t
;

55 
	m__size
[
__SIZEOF_PTHREAD_ATTR_T
];

56 
	m__Æign
;

57 } 
	t±hªad_©å_t
;

60 #i‡
__WORDSIZE
 == 64

61 
	s__±hªad_öã∫Æ_li°


63 
__±hªad_öã∫Æ_li°
 *
	m__¥ev
;

64 
__±hªad_öã∫Æ_li°
 *
	m__√xt
;

65 } 
	t__±hªad_li°_t
;

67 
	s__±hªad_öã∫Æ_¶i°


69 
__±hªad_öã∫Æ_¶i°
 *
	m__√xt
;

70 } 
	t__±hªad_¶i°_t
;

78 
	s__±hªad_muãx_s


80 
	m__lock
;

81 
	m__cou¡
;

82 
	m__ow√r
;

83 #i‡
__WORDSIZE
 == 64

84 
	m__nu£rs
;

88 
	m__köd
;

89 #i‡
__WORDSIZE
 == 64

90 
	m__•ös
;

91 
__±hªad_li°_t
 
	m__li°
;

92 
	#__PTHREAD_MUTEX_HAVE_PREV
 1

	)

94 
	m__nu£rs
;

95 
__exãnsi⁄__
 union

97 
	m__•ös
;

98 
__±hªad_¶i°_t
 
	m__li°
;

101 } 
	m__d©a
;

102 
	m__size
[
__SIZEOF_PTHREAD_MUTEX_T
];

103 
	m__Æign
;

104 } 
	t±hªad_muãx_t
;

108 
	m__size
[
__SIZEOF_PTHREAD_MUTEXATTR_T
];

109 
	m__Æign
;

110 } 
	t±hªad_muãx©å_t
;

119 
	m__lock
;

120 
	m__fuãx
;

121 
__exãnsi⁄__
 
	m__tŸÆ_£q
;

122 
__exãnsi⁄__
 
	m__wakeup_£q
;

123 
__exãnsi⁄__
 
	m__wokí_£q
;

124 *
	m__muãx
;

125 
	m__nwaôîs
;

126 
	m__brﬂdˇ°_£q
;

127 } 
	m__d©a
;

128 
	m__size
[
__SIZEOF_PTHREAD_COND_T
];

129 
__exãnsi⁄__
 
	m__Æign
;

130 } 
	t±hªad_c⁄d_t
;

134 
	m__size
[
__SIZEOF_PTHREAD_CONDATTR_T
];

135 
	m__Æign
;

136 } 
	t±hªad_c⁄d©å_t
;

140 
	t±hªad_key_t
;

144 
	t±hªad_⁄˚_t
;

147 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


152 #i‡
__WORDSIZE
 == 64

155 
	m__lock
;

156 
	m__ƒ_ªadîs
;

157 
	m__ªadîs_wakeup
;

158 
	m__wrôî_wakeup
;

159 
	m__ƒ_ªadîs_queued
;

160 
	m__ƒ_wrôîs_queued
;

161 
	m__wrôî
;

162 
	m__sh¨ed
;

163 
	m__∑d1
;

164 
	m__∑d2
;

167 
	m__Êags
;

168 } 
	m__d©a
;

172 
	m__lock
;

173 
	m__ƒ_ªadîs
;

174 
	m__ªadîs_wakeup
;

175 
	m__wrôî_wakeup
;

176 
	m__ƒ_ªadîs_queued
;

177 
	m__ƒ_wrôîs_queued
;

180 
	m__Êags
;

181 
	m__sh¨ed
;

182 
	m__∑d1
;

183 
	m__∑d2
;

184 
	m__wrôî
;

185 } 
	m__d©a
;

187 
	m__size
[
__SIZEOF_PTHREAD_RWLOCK_T
];

188 
	m__Æign
;

189 } 
	t±hªad_rwlock_t
;

193 
	m__size
[
__SIZEOF_PTHREAD_RWLOCKATTR_T
];

194 
	m__Æign
;

195 } 
	t±hªad_rwlock©å_t
;

199 #ifde‡
__USE_XOPEN2K


201 vﬁ©ûê
	t±hªad_•ölock_t
;

208 
	m__size
[
__SIZEOF_PTHREAD_BARRIER_T
];

209 
	m__Æign
;

210 } 
	t±hªad_b¨rõr_t
;

214 
	m__size
[
__SIZEOF_PTHREAD_BARRIERATTR_T
];

215 
	m__Æign
;

216 } 
	t±hªad_b¨rõøâr_t
;

220 #i‡
__WORDSIZE
 == 32

222 
	#__˛ónup_f˘_©åibuã
 
	`__©åibuã__
 ((
	`__ªg∑rm__
 (1)))

	)

	@/usr/include/bits/types.h

24 #i‚def 
_BITS_TYPES_H


25 
	#_BITS_TYPES_H
 1

	)

27 
	~<„©uªs.h
>

28 
	~<bôs/w‹dsize.h
>

30 
	#__√ed_size_t


	)

31 
	~<°ddef.h
>

34 
	t__u_ch¨
;

35 
	t__u_sh‹t
;

36 
	t__u_öt
;

37 
	t__u_l⁄g
;

40 sig√d 
	t__öt8_t
;

41 
	t__uöt8_t
;

42 sig√d 
	t__öt16_t
;

43 
	t__uöt16_t
;

44 sig√d 
	t__öt32_t
;

45 
	t__uöt32_t
;

46 #i‡
__WORDSIZE
 == 64

47 sig√d 
	t__öt64_t
;

48 
	t__uöt64_t
;

49 #ñi‡
deföed
 
__GLIBC_HAVE_LONG_LONG


50 
__exãnsi⁄__
 sig√d 
	t__öt64_t
;

51 
__exãnsi⁄__
 
	t__uöt64_t
;

55 #i‡
__WORDSIZE
 == 64

56 
	t__quad_t
;

57 
	t__u_quad_t
;

58 #ñi‡
deföed
 
__GLIBC_HAVE_LONG_LONG


59 
__exãnsi⁄__
 
	t__quad_t
;

60 
__exãnsi⁄__
 
	t__u_quad_t
;

64 
	m__vÆ
[2];

65 } 
	t__quad_t
;

68 
__u_l⁄g
 
	m__vÆ
[2];

69 } 
	t__u_quad_t
;

102 
	#__S16_TYPE
 

	)

103 
	#__U16_TYPE
 

	)

104 
	#__S32_TYPE
 

	)

105 
	#__U32_TYPE
 

	)

106 
	#__SLONGWORD_TYPE
 

	)

107 
	#__ULONGWORD_TYPE
 

	)

108 #i‡
__WORDSIZE
 == 32

109 
	#__SQUAD_TYPE
 
__quad_t


	)

110 
	#__UQUAD_TYPE
 
__u_quad_t


	)

111 
	#__SWORD_TYPE
 

	)

112 
	#__UWORD_TYPE
 

	)

113 
	#__SLONG32_TYPE
 

	)

114 
	#__ULONG32_TYPE
 

	)

115 
	#__S64_TYPE
 
__quad_t


	)

116 
	#__U64_TYPE
 
__u_quad_t


	)

119 
	#__STD_TYPE
 
__exãnsi⁄__
 

	)

120 #ñi‡
__WORDSIZE
 == 64

121 
	t__SQUAD_TYPE
 

	)

122 
	t__UQUAD_TYPE
 

	)

123 
	t__SWORD_TYPE
 

	)

124 
	t__UWORD_TYPE
 

	)

125 
	t__SLONG32_TYPE
 

	)

126 
	t__ULONG32_TYPE
 

	)

127 
	t__S64_TYPE
 

	)

128 
	t__U64_TYPE
 

	)

130 
	t__STD_TYPE
 

	)

134 
	~<bôs/ty≥sizes.h
>

137 
__STD_TYPE
 
	t__DEV_T_TYPE
 
	t__dev_t
;

138 
__STD_TYPE
 
__UID_T_TYPE
 
	g__uid_t
;

139 
__STD_TYPE
 
__GID_T_TYPE
 
	g__gid_t
;

140 
__STD_TYPE
 
__INO_T_TYPE
 
	g__öo_t
;

141 
__STD_TYPE
 
__INO64_T_TYPE
 
	g__öo64_t
;

142 
__STD_TYPE
 
__MODE_T_TYPE
 
	g__mode_t
;

143 
__STD_TYPE
 
__NLINK_T_TYPE
 
	g__∆ök_t
;

144 
__STD_TYPE
 
__OFF_T_TYPE
 
	g__off_t
;

145 
__STD_TYPE
 
__OFF64_T_TYPE
 
	g__off64_t
;

146 
__STD_TYPE
 
__PID_T_TYPE
 
	g__pid_t
;

147 
__STD_TYPE
 
__FSID_T_TYPE
 
	g__fsid_t
;

148 
__STD_TYPE
 
__CLOCK_T_TYPE
 
	g__˛ock_t
;

149 
__STD_TYPE
 
__RLIM_T_TYPE
 
	g__æim_t
;

150 
__STD_TYPE
 
__RLIM64_T_TYPE
 
	g__æim64_t
;

151 
__STD_TYPE
 
__ID_T_TYPE
 
	g__id_t
;

152 
__STD_TYPE
 
__TIME_T_TYPE
 
	g__time_t
;

153 
__STD_TYPE
 
__USECONDS_T_TYPE
 
	g__u£c⁄ds_t
;

154 
__STD_TYPE
 
__SUSECONDS_T_TYPE
 
	g__su£c⁄ds_t
;

156 
__STD_TYPE
 
__DADDR_T_TYPE
 
	g__daddr_t
;

157 
__STD_TYPE
 
__SWBLK_T_TYPE
 
	g__swblk_t
;

158 
__STD_TYPE
 
__KEY_T_TYPE
 
	g__key_t
;

161 
__STD_TYPE
 
__CLOCKID_T_TYPE
 
	g__˛ockid_t
;

164 
__STD_TYPE
 
__TIMER_T_TYPE
 
	g__timî_t
;

167 
__STD_TYPE
 
__BLKSIZE_T_TYPE
 
	g__blksize_t
;

172 
__STD_TYPE
 
__BLKCNT_T_TYPE
 
	g__blk˙t_t
;

173 
__STD_TYPE
 
__BLKCNT64_T_TYPE
 
	g__blk˙t64_t
;

176 
__STD_TYPE
 
__FSBLKCNT_T_TYPE
 
	g__fsblk˙t_t
;

177 
__STD_TYPE
 
__FSBLKCNT64_T_TYPE
 
	g__fsblk˙t64_t
;

180 
__STD_TYPE
 
__FSFILCNT_T_TYPE
 
	g__fsfû˙t_t
;

181 
__STD_TYPE
 
__FSFILCNT64_T_TYPE
 
	g__fsfû˙t64_t
;

183 
__STD_TYPE
 
__SSIZE_T_TYPE
 
	g__ssize_t
;

187 
__off64_t
 
	t__loff_t
;

188 
__quad_t
 *
	t__qaddr_t
;

189 *
	t__ˇddr_t
;

192 
__STD_TYPE
 
__SWORD_TYPE
 
	g__öçå_t
;

195 
__STD_TYPE
 
__U32_TYPE
 
	g__sockÀn_t
;

198 #unde‡
__STD_TYPE


	@/usr/include/endian.h

19 #i‚def 
_ENDIAN_H


20 
	#_ENDIAN_H
 1

	)

22 
	~<„©uªs.h
>

32 
	#__LITTLE_ENDIAN
 1234

	)

33 
	#__BIG_ENDIAN
 4321

	)

34 
	#__PDP_ENDIAN
 3412

	)

37 
	~<bôs/ídün.h
>

41 #i‚de‡
__FLOAT_WORD_ORDER


42 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

45 #ifdef 
__USE_BSD


46 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

47 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

48 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

49 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

52 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


53 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËLO, 
	)
HI

54 #ñi‡
__BYTE_ORDER
 =
__BIG_ENDIAN


55 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËHI, 
	)
LO

	@/usr/include/gnu/stubs.h

4 
	~<bôs/w‹dsize.h
>

6 #i‡
__WORDSIZE
 == 32

7 
	~<gnu/°ubs-32.h
>

8 #ñi‡
__WORDSIZE
 == 64

9 
	~<gnu/°ubs-64.h
>

	@/usr/include/sys/cdefs.h

20 #i‚def 
_SYS_CDEFS_H


21 
	#_SYS_CDEFS_H
 1

	)

24 #i‚de‡
_FEATURES_H


25 
	~<„©uªs.h
>

31 #i‡
deföed
 
__GNUC__
 && !deföed 
__STDC__


36 #unde‡
__P


37 #unde‡
__PMT


39 #ifde‡
__GNUC__


46 #i‡!
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (3, 3)

47 
	#__THROW
 
	`__©åibuã__
 ((
__nŸhrow__
))

	)

48 
	#__NTH
(
f˘
Ë
	`__©åibuã__
 ((
__nŸhrow__
)Ë
	)
fct

50 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,8)

51 
	#__THROW
 
	`throw
 ()

	)

52 
	#__NTH
(
f˘
Ëf˘ 
	`throw
 ()

	)

54 
	#__THROW


	)

55 
	#__NTH
(
f˘
Ë
	)
fct

61 
	#__ölöe


	)

63 
	#__THROW


	)

64 
	#__NTH
(
f˘
Ë
	)
fct

66 
	#__c⁄°
 c⁄°

	)

67 
	#__sig√d
 sig√d

	)

68 
	#__vﬁ©ûe
 vﬁ©ûe

	)

74 
	#__P
(
¨gs
Ë
	)
args

75 
	#__PMT
(
¨gs
Ë
	)
args

80 
	#__CONCAT
(
x
,
y
Ëx ## 
	)
y

81 
	#__STRING
(
x
Ë#x

	)

84 
	#__±r_t
 *

	)

85 
	#__l⁄g_doubÀ_t
 

	)

89 #ifdef 
__˝lu•lus


90 
	#__BEGIN_DECLS
 "C" {

	)

91 
	#__END_DECLS
 }

	)

93 
	#__BEGIN_DECLS


	)

94 
	#__END_DECLS


	)

103 #i‡
deföed
 
__˝lu•lus
 && deföed 
_GLIBCPP_USE_NAMESPACES


104 
	#__BEGIN_NAMESPACE_STD
 
«me•a˚
 
°d
 {

	)

105 
	#__END_NAMESPACE_STD
 }

	)

106 
	#__USING_NAMESPACE_STD
(
«me
Ë
usög
 
°d
::«me;

	)

107 
	#__BEGIN_NAMESPACE_C99
 
«me•a˚
 
__c99
 {

	)

108 
	#__END_NAMESPACE_C99
 }

	)

109 
	#__USING_NAMESPACE_C99
(
«me
Ë
usög
 
__c99
::«me;

	)

114 
	#__BEGIN_NAMESPACE_STD


	)

115 
	#__END_NAMESPACE_STD


	)

116 
	#__USING_NAMESPACE_STD
(
«me
)

	)

117 
	#__BEGIN_NAMESPACE_C99


	)

118 
	#__END_NAMESPACE_C99


	)

119 
	#__USING_NAMESPACE_C99
(
«me
)

	)

124 #i‚de‡
__BOUNDED_POINTERS__


125 
	#__bounded


	)

126 
	#__unbounded


	)

127 
	#__±rvÆue


	)

132 
	#__bos
(
±r
Ë
	`__buûtö_obje˘_size
 (±r, 
__USE_FORTIFY_LEVEL
 > 1)

	)

133 
	#__bos0
(
±r
Ë
	`__buûtö_obje˘_size
 (±r, 0)

	)

134 
	#__w¨nde˛
(
«me
, 
msg
Ë
	`«me
 ()

	)

138 #i‡
__GNUC_PREREQ
 (2,97)

140 
	#__Êex¨r
 []

	)

142 #ifde‡
__GNUC__


143 
	#__Êex¨r
 [0]

	)

145 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

146 
	#__Êex¨r
 []

	)

149 
	#__Êex¨r
 [1]

	)

165 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

167 
	#__REDIRECT
(
«me
, 
¥Ÿo
, 
Æüs
Ë«mê¥Ÿÿ
	`__asm__
 (
	`__ASMNAME
 (#Æüs))

	)

168 #ifde‡
__˝lu•lus


169 
	#__REDIRECT_NTH
(
«me
, 
¥Ÿo
, 
Æüs
) \

170 
«me
 
¥Ÿo
 
__THROW
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs))

	)

172 
	#__REDIRECT_NTH
(
«me
, 
¥Ÿo
, 
Æüs
) \

173 
«me
 
¥Ÿo
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs)Ë
__THROW


	)

175 
	#__ASMNAME
(
˙ame
Ë
	`__ASMNAME2
 (
__USER_LABEL_PREFIX__
, c«me)

	)

176 
	#__ASMNAME2
(
¥efix
, 
˙ame
Ë
	`__STRING
 (¥efixË
	)
cname

189 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2

190 
	#__©åibuã__
(
xyz
Ë

	)

196 #i‡
__GNUC_PREREQ
 (2,96)

197 
	#__©åibuã_mÆloc__
 
	`__©åibuã__
 ((
__mÆloc__
))

	)

199 
	#__©åibuã_mÆloc__


	)

205 #i‡
__GNUC_PREREQ
 (2,96)

206 
	#__©åibuã_puª__
 
	`__©åibuã__
 ((
__puª__
))

	)

208 
	#__©åibuã_puª__


	)

214 #i‡
__GNUC_PREREQ
 (3,1)

215 
	#__©åibuã_u£d__
 
	`__©åibuã__
 ((
__u£d__
))

	)

216 
	#__©åibuã_noölöe__
 
	`__©åibuã__
 ((
__noölöe__
))

	)

218 
	#__©åibuã_u£d__
 
	`__©åibuã__
 ((
__unu£d__
))

	)

219 
	#__©åibuã_noölöe__


	)

223 #i‡
__GNUC_PREREQ
 (3,2)

224 
	#__©åibuã_dïªˇãd__
 
	`__©åibuã__
 ((
__dïªˇãd__
))

	)

226 
	#__©åibuã_dïªˇãd__


	)

235 #i‡
__GNUC_PREREQ
 (2,8)

236 
	#__©åibuã_f‹m©_¨g__
(
x
Ë
	`__©åibuã__
 ((
	`__f‹m©_¨g__
 (x)))

	)

238 
	#__©åibuã_f‹m©_¨g__
(
x
Ë

	)

245 #i‡
__GNUC_PREREQ
 (2,97)

246 
	#__©åibuã_f‹m©_°rfm⁄__
(
a
,
b
) \

247 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__°rfm⁄__
, 
a
, 
b
)))

	)

249 
	#__©åibuã_f‹m©_°rfm⁄__
(
a
,
b
Ë

	)

254 #i‡
__GNUC_PREREQ
 (3,3)

255 
	#__n⁄nuŒ
(
∑øms
Ë
	`__©åibuã__
 ((
__n⁄nuŒ__
Ö¨ams))

	)

257 
	#__n⁄nuŒ
(
∑øms
)

	)

262 #i‡
__GNUC_PREREQ
 (3,4)

263 
	#__©åibuã_w¨n_unu£d_ªsu…__
 \

264 
	`__©åibuã__
 ((
__w¨n_unu£d_ªsu…__
))

	)

265 #i‡
__USE_FORTIFY_LEVEL
 > 0

266 
	#__wur
 
__©åibuã_w¨n_unu£d_ªsu…__


	)

269 
	#__©åibuã_w¨n_unu£d_ªsu…__


	)

271 #i‚de‡
__wur


272 
	#__wur


	)

276 #i‡
__GNUC_PREREQ
 (3,2)

277 
	#__Æways_ölöe
 
__ölöe
 
	`__©åibuã__
 ((
__Æways_ölöe__
))

	)

279 
	#__Æways_ölöe
 
__ölöe


	)

286 #i‡!
__GNUC_PREREQ
 (2,8)

287 
	#__exãnsi⁄__


	)

291 #i‡!
__GNUC_PREREQ
 (2,92)

292 
	#__ª°ri˘


	)

298 #i‡
__GNUC_PREREQ
 (3,1Ë&& !
deföed
 
__GNUG__


299 
	#__ª°ri˘_¨r
 
__ª°ri˘


	)

301 #ifde‡
__GNUC__


302 
	#__ª°ri˘_¨r


	)

304 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

305 
	#__ª°ri˘_¨r
 
ª°ri˘


	)

308 
	#__ª°ri˘_¨r


	)

313 
	~<bôs/w‹dsize.h
>

315 #i‡
deföed
 
__LONG_DOUBLE_MATH_OPTIONAL
 && deföed 
__NO_LONG_DOUBLE_MATH


316 
	#__LDBL_COMPAT
 1

	)

317 #ifde‡
__REDIRECT


318 
	#__LDBL_REDIR1
(
«me
, 
¥Ÿo
, 
Æüs
Ë
	`__REDIRECT
 («me,ÖrŸo,álüs)

	)

319 
	#__LDBL_REDIR
(
«me
, 
¥Ÿo
) \

320 
	`__LDBL_REDIR1
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##«me)

	)

321 
	#__LDBL_REDIR1_NTH
(
«me
, 
¥Ÿo
, 
Æüs
Ë
	`__REDIRECT_NTH
 («me,ÖrŸo,álüs)

	)

322 
	#__LDBL_REDIR_NTH
(
«me
, 
¥Ÿo
) \

323 
	`__LDBL_REDIR1_NTH
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##«me)

	)

324 
	#__LDBL_REDIR1_DECL
(
«me
, 
Æüs
) \

325 
	`__ty≥of
 (
«me
Ë«mê
	`__asm
 (
	`__ASMNAME
 (#Æüs));

	)

326 
	#__LDBL_REDIR_DECL
(
«me
) \

327 
	`__ty≥of
 (
«me
Ë«mê
	`__asm
 (
	`__ASMNAME
 ("__∆dbl_" #«me));

	)

330 #i‡!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT


331 
	#__LDBL_REDIR1
(
«me
, 
¥Ÿo
, 
Æüs
Ë«mê
	)
proto

332 
	#__LDBL_REDIR
(
«me
, 
¥Ÿo
Ë«mê
	)
proto

333 
	#__LDBL_REDIR1_NTH
(
«me
, 
¥Ÿo
, 
Æüs
Ë«mê¥Ÿÿ
__THROW


	)

334 
	#__LDBL_REDIR_NTH
(
«me
, 
¥Ÿo
Ë«mê¥Ÿÿ
__THROW


	)

335 
	#__LDBL_REDIR_DECL
(
«me
)

	)

	@/usr/include/sys/select.h

22 #i‚de‡
_SYS_SELECT_H


23 
	#_SYS_SELECT_H
 1

	)

25 
	~<„©uªs.h
>

28 
	~<bôs/ty≥s.h
>

31 
	~<bôs/£À˘.h
>

34 
	~<bôs/sig£t.h
>

36 #i‚de‡
__sig£t_t_deföed


37 
	#__sig£t_t_deföed


	)

38 
__sig£t_t
 
	tsig£t_t
;

42 
	#__√ed_time_t


	)

43 
	#__√ed_time•ec


	)

44 
	~<time.h
>

45 
	#__√ed_timevÆ


	)

46 
	~<bôs/time.h
>

48 #i‚de‡
__su£c⁄ds_t_deföed


49 
__su£c⁄ds_t
 
	tsu£c⁄ds_t
;

50 
	#__su£c⁄ds_t_deföed


	)

55 
	t__fd_mask
;

58 #unde‡
__NFDBITS


59 #unde‡
__FDELT


60 #unde‡
__FDMASK


62 
	#__NFDBITS
 (8 *  (
__fd_mask
))

	)

63 
	#__FDELT
(
d
Ë((dË/ 
__NFDBITS
)

	)

64 
	#__FDMASK
(
d
Ë((
__fd_mask
Ë1 << ((dË% 
__NFDBITS
))

	)

71 #ifde‡
__USE_XOPEN


72 
__fd_mask
 
	mfds_bôs
[
__FD_SETSIZE
 / 
__NFDBITS
];

73 
	#__FDS_BITS
(
£t
Ë((£t)->
fds_bôs
)

	)

75 
__fd_mask
 
	m__fds_bôs
[
__FD_SETSIZE
 / 
__NFDBITS
];

76 
	#__FDS_BITS
(
£t
Ë((£t)->
__fds_bôs
)

	)

78 } 
	tfd_£t
;

81 
	#FD_SETSIZE
 
__FD_SETSIZE


	)

83 #ifde‡
__USE_MISC


85 
__fd_mask
 
	tfd_mask
;

88 
	#NFDBITS
 
__NFDBITS


	)

93 
	#FD_SET
(
fd
, 
fd£ç
Ë
	`__FD_SET
 (fd, fd£ç)

	)

94 
	#FD_CLR
(
fd
, 
fd£ç
Ë
	`__FD_CLR
 (fd, fd£ç)

	)

95 
	#FD_ISSET
(
fd
, 
fd£ç
Ë
	`__FD_ISSET
 (fd, fd£ç)

	)

96 
	#FD_ZERO
(
fd£ç
Ë
	`__FD_ZERO
 (fd£ç)

	)

99 
__BEGIN_DECLS


109 
£À˘
 (
__nfds
, 
fd_£t
 *
__ª°ri˘
 
__ªadfds
,

110 
fd_£t
 *
__ª°ri˘
 
__wrôefds
,

111 
fd_£t
 *
__ª°ri˘
 
__ex˚±fds
,

112 
timevÆ
 *
__ª°ri˘
 
__timeout
);

114 #ifde‡
__USE_XOPEN2K


121 
p£À˘
 (
__nfds
, 
fd_£t
 *
__ª°ri˘
 
__ªadfds
,

122 
fd_£t
 *
__ª°ri˘
 
__wrôefds
,

123 
fd_£t
 *
__ª°ri˘
 
__ex˚±fds
,

124 c⁄° 
time•ec
 *
__ª°ri˘
 
__timeout
,

125 c⁄° 
__sig£t_t
 *
__ª°ri˘
 
__sigmask
);

128 
	g__END_DECLS


	@/usr/include/sys/sysmacros.h

20 #i‚de‡
_SYS_SYSMACROS_H


21 
	#_SYS_SYSMACROS_H
 1

	)

23 
	~<„©uªs.h
>

28 #ifde‡
__GLIBC_HAVE_LONG_LONG


29 
__exãnsi⁄__


30 
__ölöe
 
	$gnu_dev_maj‹
 (
__dev
)

31 
__THROW
;

32 
__exãnsi⁄__


33 
__ölöe
 
	$gnu_dev_mö‹
 (
__dev
)

34 
__THROW
;

35 
__exãnsi⁄__


36 
__ölöe
 
	$gnu_dev_makedev
 (
__maj‹
,

37 
__mö‹
)

38 
__THROW
;

40 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

41 
__exãnsi⁄__
 
__ölöe
 

42 
	`__NTH
 (
	$gnu_dev_maj‹
 (
__dev
))

44  ((
__dev
 >> 8) & 0xfff) | (() (__dev >> 32) & ~0xfff);

45 
	}
}

47 
__exãnsi⁄__
 
__ölöe
 

48 
__NTH
 (
	$gnu_dev_mö‹
 (
__dev
))

50  (
__dev
 & 0xff) | (() (__dev >> 12) & ~0xff);

51 
	}
}

53 
__exãnsi⁄__
 
__ölöe
 

54 
__NTH
 (
	$gnu_dev_makedev
 (
__maj‹
, 
__mö‹
))

56  ((
__mö‹
 & 0xffË| ((
__maj‹
 & 0xfff) << 8)

57 | (((Ë(
__mö‹
 & ~0xff)) << 12)

58 | (((Ë(
__maj‹
 & ~0xfff)) << 32));

59 
	}
}

64 
	#maj‹
(
dev
Ë
	`gnu_dev_maj‹
 (dev)

	)

65 
	#mö‹
(
dev
Ë
	`gnu_dev_mö‹
 (dev)

	)

66 
	#makedev
(
maj
, 
mö
Ë
	`gnu_dev_makedev
 (maj, mö)

	)

	@/usr/include/time.h

24 #i‚def 
_TIME_H


26 #i‡(! 
deföed
 
__√ed_time_t
 && !deföed 
__√ed_˛ock_t
 && \

27 ! 
deföed
 
	g__√ed_time•ec
)

28 
	#_TIME_H
 1

	)

29 
	~<„©uªs.h
>

31 
	g__BEGIN_DECLS


35 #ifdef 
_TIME_H


37 
	#__√ed_size_t


	)

38 
	#__√ed_NULL


	)

39 
	~<°ddef.h
>

43 
	~<bôs/time.h
>

46 #i‡!
deföed
 
__STRICT_ANSI__
 && !deföed 
__USE_XOPEN2K


47 #i‚de‡
CLK_TCK


48 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

54 #i‡!
deföed
 
__˛ock_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_˛ock_t
)

55 
	#__˛ock_t_deföed
 1

	)

57 
	~<bôs/ty≥s.h
>

59 
__BEGIN_NAMESPACE_STD


61 
__˛ock_t
 
	t˛ock_t
;

62 
	g__END_NAMESPACE_STD


63 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX
 || deföed 
__USE_MISC


64 
	$__USING_NAMESPACE_STD
(
˛ock_t
)

68 #unde‡
__√ed_˛ock_t


70 #i‡!
deföed
 
__time_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_time_t
)

71 
	#__time_t_deföed
 1

	)

73 
	~<bôs/ty≥s.h
>

75 
__BEGIN_NAMESPACE_STD


77 
__time_t
 
	ttime_t
;

78 
__END_NAMESPACE_STD


79 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC
 || deföed 
__USE_SVID


80 
	$__USING_NAMESPACE_STD
(
time_t
)

84 #unde‡
__√ed_time_t


86 #i‡!
deföed
 
__˛ockid_t_deföed
 && \

87 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_˛ockid_t
)

88 
	#__˛ockid_t_deföed
 1

	)

90 
	~<bôs/ty≥s.h
>

93 
__˛ockid_t
 
	t˛ockid_t
;

96 #unde‡
__˛ockid_time_t


98 #i‡!
deföed
 
__timî_t_deföed
 && \

99 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_timî_t
)

100 
	#__timî_t_deföed
 1

	)

102 
	~<bôs/ty≥s.h
>

105 
__timî_t
 
	ttimî_t
;

108 #unde‡
__√ed_timî_t


111 #i‡!
deföed
 
__time•ec_deföed
 && \

112 ((
deföed
 
_TIME_H
 && \

113 (
deföed
 
__USE_POSIX199309
 || deföed 
__USE_MISC
)) || \

114 
deföed
 
__√ed_time•ec
)

115 
	#__time•ec_deföed
 1

	)

117 
	~<bôs/ty≥s.h
>

121 
	stime•ec


123 
__time_t
 
tv_£c
;

124 
tv_n£c
;

128 #unde‡
__√ed_time•ec


131 #ifdef 
_TIME_H


132 
__BEGIN_NAMESPACE_STD


134 
	stm


136 
tm_£c
;

137 
tm_mö
;

138 
tm_hour
;

139 
tm_mday
;

140 
tm_m⁄
;

141 
tm_yór
;

142 
tm_wday
;

143 
tm_yday
;

144 
tm_isd°
;

146 #ifdef 
__USE_BSD


147 
tm_gmtoff
;

148 
__c⁄°
 *
tm_z⁄e
;

150 
__tm_gmtoff
;

151 
__c⁄°
 *
__tm_z⁄e
;

154 
__END_NAMESPACE_STD


155 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX
 || deföed 
__USE_MISC


156 
	$__USING_NAMESPACE_STD
(
tm
)

160 #ifde‡
__USE_POSIX199309


162 
	sôimî•ec


164 
time•ec
 
ô_öãrvÆ
;

165 
time•ec
 
ô_vÆue
;

169 
sigevít
;

173 #ifde‡
__USE_XOPEN2K


174 #i‚de‡
__pid_t_deföed


175 
__pid_t
 
	tpid_t
;

176 
	#__pid_t_deföed


	)

181 
__BEGIN_NAMESPACE_STD


184 
˛ock_t
 
	$˛ock
 (Ë
__THROW
;

187 
time_t
 
	$time
 (
time_t
 *
__timî
Ë
__THROW
;

190 
	$dif·ime
 (
time_t
 
__time1
,Åime_à
__time0
)

191 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

194 
time_t
 
	$mktime
 (
tm
 *
__ç
Ë
__THROW
;

200 
size_t
 
	$°r·ime
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

201 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

202 
__c⁄°
 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

203 
__END_NAMESPACE_STD


205 #ifde‡
__USE_XOPEN


208 *
	$°Ωtime
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

209 
__c⁄°
 *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
)

210 
__THROW
;

213 #ifde‡
__USE_GNU


216 
	~<xloˇÀ.h
>

218 
size_t
 
	$°r·ime_l
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

219 
__c⁄°
 *
__ª°ri˘
 
__f‹m©
,

220 
__c⁄°
 
tm
 *
__ª°ri˘
 
__ç
,

221 
__loˇÀ_t
 
__loc
Ë
__THROW
;

223 *
	$°Ωtime_l
 (
__c⁄°
 *
__ª°ri˘
 
__s
,

224 
__c⁄°
 *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
,

225 
__loˇÀ_t
 
__loc
Ë
__THROW
;

229 
__BEGIN_NAMESPACE_STD


232 
tm
 *
	$gmtime
 (
__c⁄°
 
time_t
 *
__timî
Ë
__THROW
;

236 
tm
 *
	$loˇ…ime
 (
__c⁄°
 
time_t
 *
__timî
Ë
__THROW
;

237 
__END_NAMESPACE_STD


239 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


242 
tm
 *
	$gmtime_r
 (
__c⁄°
 
time_t
 *
__ª°ri˘
 
__timî
,

243 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

247 
tm
 *
	$loˇ…ime_r
 (
__c⁄°
 
time_t
 *
__ª°ri˘
 
__timî
,

248 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

251 
__BEGIN_NAMESPACE_STD


254 *
	$as˘ime
 (
__c⁄°
 
tm
 *
__ç
Ë
__THROW
;

257 *
	$˘ime
 (
__c⁄°
 
time_t
 *
__timî
Ë
__THROW
;

258 
__END_NAMESPACE_STD


260 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


265 *
	$as˘ime_r
 (
__c⁄°
 
tm
 *
__ª°ri˘
 
__ç
,

266 *
__ª°ri˘
 
__buf
Ë
__THROW
;

269 *
	$˘ime_r
 (
__c⁄°
 
time_t
 *
__ª°ri˘
 
__timî
,

270 *
__ª°ri˘
 
__buf
Ë
__THROW
;

275 *
__tz«me
[2];

276 
__daylight
;

277 
__timez⁄e
;

280 #ifdef 
__USE_POSIX


282 *
tz«me
[2];

286 
	$tz£t
 (Ë
__THROW
;

289 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


290 
daylight
;

291 
timez⁄e
;

294 #ifde‡
__USE_SVID


297 
	$°ime
 (
__c⁄°
 
time_t
 *
__whí
Ë
__THROW
;

303 
	#__i¶óp
(
yór
) \

304 ((
yór
Ë% 4 =0 && ((yórË% 100 !0 || (yórË% 400 =0))

	)

307 #ifde‡
__USE_MISC


312 
time_t
 
	$timegm
 (
tm
 *
__ç
Ë
__THROW
;

315 
time_t
 
	$timñoˇl
 (
tm
 *
__ç
Ë
__THROW
;

318 
	$dysize
 (
__yór
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

322 #ifde‡
__USE_POSIX199309


327 
	`«no¶ìp
 (
__c⁄°
 
time•ec
 *
__ªque°ed_time
,

328 
time•ec
 *
__ªmaöög
);

332 
	$˛ock_gëªs
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ªs
Ë
__THROW
;

335 
	$˛ock_gëtime
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ç
Ë
__THROW
;

338 
	$˛ock_£âime
 (
˛ockid_t
 
__˛ock_id
, 
__c⁄°
 
time•ec
 *
__ç
)

339 
__THROW
;

341 #ifde‡
__USE_XOPEN2K


346 
	`˛ock_«no¶ìp
 (
˛ockid_t
 
__˛ock_id
, 
__Êags
,

347 
__c⁄°
 
time•ec
 *
__ªq
,

348 
time•ec
 *
__ªm
);

351 
	$˛ock_gë˝u˛ockid
 (
pid_t
 
__pid
, 
˛ockid_t
 *
__˛ock_id
Ë
__THROW
;

356 
	$timî_¸óã
 (
˛ockid_t
 
__˛ock_id
,

357 
sigevít
 *
__ª°ri˘
 
__evp
,

358 
timî_t
 *
__ª°ri˘
 
__timîid
Ë
__THROW
;

361 
	$timî_dñëe
 (
timî_t
 
__timîid
Ë
__THROW
;

364 
	$timî_£âime
 (
timî_t
 
__timîid
, 
__Êags
,

365 
__c⁄°
 
ôimî•ec
 *
__ª°ri˘
 
__vÆue
,

366 
ôimî•ec
 *
__ª°ri˘
 
__ovÆue
Ë
__THROW
;

369 
	$timî_gëtime
 (
timî_t
 
__timîid
, 
ôimî•ec
 *
__vÆue
)

370 
__THROW
;

373 
	$timî_gëovîrun
 (
timî_t
 
__timîid
Ë
__THROW
;

377 #ifde‡
__USE_XOPEN_EXTENDED


389 
gëd©e_îr
;

398 
tm
 *
	`gëd©e
 (
__c⁄°
 *
__°rög
);

401 #ifde‡
__USE_GNU


412 
	`gëd©e_r
 (
__c⁄°
 *
__ª°ri˘
 
__°rög
,

413 
tm
 *
__ª°ri˘
 
__ªsbuÂ
);

416 
__END_DECLS


	@/usr/include/bits/endian.h

3 #i‚de‡
_ENDIAN_H


7 
	#__BYTE_ORDER
 
__LITTLE_ENDIAN


	)

	@/usr/include/bits/select.h

19 #i‚de‡
_SYS_SELECT_H


26 
	#__FD_ZERO
(
s
) \

28 
__i
; \

29 
fd_£t
 *
__¨r
 = (
s
); \

30 
__i
 = 0; __ò<  (
fd_£t
Ë/  (
__fd_mask
); ++__i) \

31 
	`__FDS_BITS
 (
__¨r
)[
__i
] = 0; \

32 } 0)

	)

33 
	#__FD_SET
(
d
, 
s
Ë(
	`__FDS_BITS
 (s)[
	`__FDELT
(d)] |
	`__FDMASK
(d))

	)

34 
	#__FD_CLR
(
d
, 
s
Ë(
	`__FDS_BITS
 (s)[
	`__FDELT
(d)] &~
	`__FDMASK
(d))

	)

35 
	#__FD_ISSET
(
d
, 
s
Ë((
	`__FDS_BITS
 (s)[
	`__FDELT
(d)] & 
	`__FDMASK
(d)Ë!0)

	)

	@/usr/include/bits/sigset.h

20 #i‚def 
_SIGSET_H_ty≥s


21 
	#_SIGSET_H_ty≥s
 1

	)

23 
	t__sig_©omic_t
;

27 
	#_SIGSET_NWORDS
 (1024 / (8 *  ()))

	)

30 
	m__vÆ
[
_SIGSET_NWORDS
];

31 } 
	t__sig£t_t
;

42 #i‡!
deföed
 
_SIGSET_H_‚s
 && deföed 
_SIGNAL_H


43 
	#_SIGSET_H_‚s
 1

	)

45 #i‚de‡
_EXTERN_INLINE


46 
	#_EXTERN_INLINE
 
__ölöe


	)

50 
	#__sigmask
(
sig
) \

51 (((Ë1Ë<< (((
sig
Ë- 1Ë% (8 *  ())))

	)

54 
	#__sigw‹d
(
sig
Ë(((sigË- 1Ë/ (8 *  ()))

	)

56 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

57 
	#__sigem±y£t
(
£t
) \

58 (
	`__exãnsi⁄__
 ({ 
__˙t
 = 
_SIGSET_NWORDS
; \

59 
sig£t_t
 *
__£t
 = (
£t
); \

60 --
__˙t
 >0Ë
__£t
->
__vÆ
[__cnt] = 0; \

61 0; }))

	)

62 
	#__sigfûl£t
(
£t
) \

63 (
	`__exãnsi⁄__
 ({ 
__˙t
 = 
_SIGSET_NWORDS
; \

64 
sig£t_t
 *
__£t
 = (
£t
); \

65 --
__˙t
 >0Ë
__£t
->
__vÆ
[__cnt] = ~0UL; \

66 0; }))

	)

68 #ifde‡
__USE_GNU


72 
	#__sigi£m±y£t
(
£t
) \

73 (
	`__exãnsi⁄__
 ({ 
__˙t
 = 
_SIGSET_NWORDS
; \

74 c⁄° 
sig£t_t
 *
__£t
 = (
£t
); \

75 
__ªt
 = 
__£t
->
__vÆ
[--
__˙t
]; \

76 !
__ªt
 && --
__˙t
 >= 0) \

77 
__ªt
 = 
__£t
->
__vÆ
[
__˙t
]; \

78 
__ªt
 =0; }))

	)

79 
	#__sig™d£t
(
de°
, 
À·
, 
right
) \

80 (
	`__exãnsi⁄__
 ({ 
__˙t
 = 
_SIGSET_NWORDS
; \

81 
sig£t_t
 *
__de°
 = (
de°
); \

82 c⁄° 
sig£t_t
 *
__À·
 = (
À·
); \

83 c⁄° 
sig£t_t
 *
__right
 = (
right
); \

84 --
__˙t
 >= 0) \

85 
__de°
->
__vÆ
[
__˙t
] = (
__À·
->__val[__cnt] \

86 & 
__right
->
__vÆ
[
__˙t
]); \

87 0; }))

	)

88 
	#__sig‹£t
(
de°
, 
À·
, 
right
) \

89 (
	`__exãnsi⁄__
 ({ 
__˙t
 = 
_SIGSET_NWORDS
; \

90 
sig£t_t
 *
__de°
 = (
de°
); \

91 c⁄° 
sig£t_t
 *
__À·
 = (
À·
); \

92 c⁄° 
sig£t_t
 *
__right
 = (
right
); \

93 --
__˙t
 >= 0) \

94 
__de°
->
__vÆ
[
__˙t
] = (
__À·
->__val[__cnt] \

95 | 
__right
->
__vÆ
[
__˙t
]); \

96 0; }))

	)

103 
__sigismembî
 (
__c⁄°
 
__sig£t_t
 *, );

104 
__sigadd£t
 (
__sig£t_t
 *, );

105 
__sigdñ£t
 (
__sig£t_t
 *, );

107 #ifde‡
__USE_EXTERN_INLINES


108 
	#__SIGSETFN
(
NAME
, 
BODY
, 
CONST
) \

109 
_EXTERN_INLINE
 \

110 
	`NAME
 (
CONST
 
__sig£t_t
 *
__£t
, 
__sig
) \

112 
__mask
 = 
	`__sigmask
 (
__sig
); \

113 
__w‹d
 = 
	`__sigw‹d
 (
__sig
); \

114  
BODY
; \

115 }

	)

117 
__SIGSETFN
 (
__sigismembî
, (
__£t
->
__vÆ
[
__w‹d
] & 
__mask
Ë? 1 : 0, 
__c⁄°
)

118 
__SIGSETFN
 (
__sigadd£t
, ((
__£t
->
__vÆ
[
__w‹d
] |
__mask
), 0), )

119 
__SIGSETFN
 (
__sigdñ£t
, ((
__£t
->
__vÆ
[
__w‹d
] &~
__mask
), 0), )

121 #unde‡
__SIGSETFN


	@/usr/include/bits/time.h

24 #i‚de‡
__√ed_timevÆ


25 #i‚de‡
_BITS_TIME_H


26 
	#_BITS_TIME_H
 1

	)

34 
	#CLOCKS_PER_SEC
 1000000l

	)

36 #i‡!
deföed
 
__STRICT_ANSI__
 && !deföed 
__USE_XOPEN2K


39 
	~<bôs/ty≥s.h
>

40 
__sysc⁄f
 ();

41 
	#CLK_TCK
 ((
__˛ock_t
Ë
	`__sysc⁄f
 (2)Ë

	)

44 #ifde‡
__USE_POSIX199309


46 
	#CLOCK_REALTIME
 0

	)

48 
	#CLOCK_MONOTONIC
 1

	)

50 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

52 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

55 
	#TIMER_ABSTIME
 1

	)

61 #ifde‡
__√ed_timevÆ


62 #unde‡
__√ed_timevÆ


63 #i‚de‡
_STRUCT_TIMEVAL


64 
	#_STRUCT_TIMEVAL
 1

	)

65 
	~<bôs/ty≥s.h
>

69 
	stimevÆ


71 
__time_t
 
	mtv_£c
;

72 
__su£c⁄ds_t
 
	mtv_u£c
;

	@/usr/include/bits/typesizes.h

20 #i‚de‡
_BITS_TYPES_H


24 #i‚def 
_BITS_TYPESIZES_H


25 
	#_BITS_TYPESIZES_H
 1

	)

30 
	#__DEV_T_TYPE
 
__UQUAD_TYPE


	)

31 
	#__UID_T_TYPE
 
__U32_TYPE


	)

32 
	#__GID_T_TYPE
 
__U32_TYPE


	)

33 
	#__INO_T_TYPE
 
__ULONGWORD_TYPE


	)

34 
	#__INO64_T_TYPE
 
__UQUAD_TYPE


	)

35 
	#__MODE_T_TYPE
 
__U32_TYPE


	)

36 
	#__NLINK_T_TYPE
 
__UWORD_TYPE


	)

37 
	#__OFF_T_TYPE
 
__SLONGWORD_TYPE


	)

38 
	#__OFF64_T_TYPE
 
__SQUAD_TYPE


	)

39 
	#__PID_T_TYPE
 
__S32_TYPE


	)

40 
	#__RLIM_T_TYPE
 
__ULONGWORD_TYPE


	)

41 
	#__RLIM64_T_TYPE
 
__UQUAD_TYPE


	)

42 
	#__BLKCNT_T_TYPE
 
__SLONGWORD_TYPE


	)

43 
	#__BLKCNT64_T_TYPE
 
__SQUAD_TYPE


	)

44 
	#__FSBLKCNT_T_TYPE
 
__ULONGWORD_TYPE


	)

45 
	#__FSBLKCNT64_T_TYPE
 
__UQUAD_TYPE


	)

46 
	#__FSFILCNT_T_TYPE
 
__ULONGWORD_TYPE


	)

47 
	#__FSFILCNT64_T_TYPE
 
__UQUAD_TYPE


	)

48 
	#__ID_T_TYPE
 
__U32_TYPE


	)

49 
	#__CLOCK_T_TYPE
 
__SLONGWORD_TYPE


	)

50 
	#__TIME_T_TYPE
 
__SLONGWORD_TYPE


	)

51 
	#__USECONDS_T_TYPE
 
__U32_TYPE


	)

52 
	#__SUSECONDS_T_TYPE
 
__SLONGWORD_TYPE


	)

53 
	#__DADDR_T_TYPE
 
__S32_TYPE


	)

54 
	#__SWBLK_T_TYPE
 
__SLONGWORD_TYPE


	)

55 
	#__KEY_T_TYPE
 
__S32_TYPE


	)

56 
	#__CLOCKID_T_TYPE
 
__S32_TYPE


	)

57 
	#__TIMER_T_TYPE
 *

	)

58 
	#__BLKSIZE_T_TYPE
 
__SLONGWORD_TYPE


	)

59 
	#__FSID_T_TYPE
 såu˘ { 
__vÆ
[2]; }

	)

60 
	#__SSIZE_T_TYPE
 
__SWORD_TYPE


	)

63 
	#__FD_SETSIZE
 1024

	)

	@/usr/include/bits/wordsize.h

3 #i‡
deföed
 
__x86_64__


4 
	#__WORDSIZE
 64

	)

5 
	#__WORDSIZE_COMPAT32
 1

	)

7 
	#__WORDSIZE
 32

	)

	@/usr/include/gnu/stubs-32.h

6 #ifde‡
_LIBC


7 #îr‹ 
Aµliˇti⁄s
 
may
 
nŸ
 
deföe
 
the
 
ma¸o
 
_LIBC


10 
	#__°ub___kî√l_co¶


	)

11 
	#__°ub___kî√l_söl


	)

12 
	#__°ub___kî√l_è∆


	)

13 
	#__°ub_chÊags


	)

14 
	#__°ub_Áâach


	)

15 
	#__°ub_fchÊags


	)

16 
	#__°ub_fdëach


	)

17 
	#__°ub_gây


	)

18 
	#__°ub_lchmod


	)

19 
	#__°ub_lutimes


	)

20 
	#__°ub_ªvoke


	)

21 
	#__°ub_£éogö


	)

22 
	#__°ub_sigªtu∫


	)

23 
	#__°ub_s°k


	)

24 
	#__°ub_°ty


	)

	@/usr/include/gnu/stubs-64.h

6 #ifde‡
_LIBC


7 #îr‹ 
Aµliˇti⁄s
 
may
 
nŸ
 
deföe
 
the
 
ma¸o
 
_LIBC


10 
	#__°ub___kî√l_co¶


	)

11 
	#__°ub___kî√l_ªm_pio2l


	)

12 
	#__°ub___kî√l_söl


	)

13 
	#__°ub___kî√l_è∆


	)

14 
	#__°ub_bdÊush


	)

15 
	#__°ub_chÊags


	)

16 
	#__°ub_Áâach


	)

17 
	#__°ub_fchÊags


	)

18 
	#__°ub_fdëach


	)

19 
	#__°ub_„upd©ìnv


	)

20 
	#__°ub_gëmsg


	)

21 
	#__°ub_gây


	)

22 
	#__°ub_lchmod


	)

23 
	#__°ub_lutimes


	)

24 
	#__°ub_putmsg


	)

25 
	#__°ub_ªvoke


	)

26 
	#__°ub_£éogö


	)

27 
	#__°ub_sigªtu∫


	)

28 
	#__°ub_s°k


	)

29 
	#__°ub_°ty


	)

	@
1
.
1
/usr/include
91
1582
nginx.c
nginx.h
ngx_array.c
ngx_array.h
ngx_buf.c
ngx_buf.h
ngx_conf_file.c
ngx_conf_file.h
ngx_config.h
ngx_connection.c
ngx_connection.h
ngx_core.h
ngx_cpuinfo.c
ngx_crc.h
ngx_crc32.c
ngx_crc32.h
ngx_crypt.c
ngx_crypt.h
ngx_cycle.c
ngx_cycle.h
ngx_file.c
ngx_file.h
ngx_hash.c
ngx_hash.h
ngx_inet.c
ngx_inet.h
ngx_list.c
ngx_list.h
ngx_log.c
ngx_log.h
ngx_md5.c
ngx_md5.h
ngx_murmurhash.c
ngx_murmurhash.h
ngx_open_file_cache.c
ngx_open_file_cache.h
ngx_output_chain.c
ngx_palloc.c
ngx_palloc.h
ngx_parse.c
ngx_parse.h
ngx_queue.c
ngx_queue.h
ngx_radix_tree.c
ngx_radix_tree.h
ngx_rbtree.c
ngx_rbtree.h
ngx_regex.c
ngx_regex.h
ngx_resolver.c
ngx_resolver.h
ngx_sha1.h
ngx_shmtx.c
ngx_shmtx.h
ngx_slab.c
ngx_slab.h
ngx_spinlock.c
ngx_string.c
ngx_string.h
ngx_times.c
ngx_times.h
/usr/include/openssl/md5.h
/usr/include/openssl/sha.h
/usr/include/pcre.h
/usr/include/openssl/e_os2.h
/usr/include/stdlib.h
/usr/include/alloca.h
/usr/include/bits/stdlib-ldbl.h
/usr/include/bits/stdlib.h
/usr/include/bits/waitflags.h
/usr/include/bits/waitstatus.h
/usr/include/features.h
/usr/include/openssl/opensslconf.h
/usr/include/sys/types.h
/usr/include/xlocale.h
/usr/include/bits/pthreadtypes.h
/usr/include/bits/types.h
/usr/include/endian.h
/usr/include/gnu/stubs.h
/usr/include/sys/cdefs.h
/usr/include/sys/select.h
/usr/include/sys/sysmacros.h
/usr/include/time.h
/usr/include/bits/endian.h
/usr/include/bits/select.h
/usr/include/bits/sigset.h
/usr/include/bits/time.h
/usr/include/bits/typesizes.h
/usr/include/bits/wordsize.h
/usr/include/gnu/stubs-32.h
/usr/include/gnu/stubs-64.h
